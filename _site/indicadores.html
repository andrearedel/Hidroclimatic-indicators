<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Andrea Redel">

<title>Automated generation of hydroclimatic indicators – Andrea Redel</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-5bf7ca59d8cc7f7a8155307016a58e21.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Andrea Redel</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./indicadores.html" aria-current="page"> 
<span class="menu-text">Hidroclimatic indicators</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About me</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview"><span class="header-section-number">1</span> Overview</a></li>
  <li><a href="#how-to-use" id="toc-how-to-use" class="nav-link" data-scroll-target="#how-to-use"><span class="header-section-number">2</span> How to use</a></li>
  <li><a href="#indicators" id="toc-indicators" class="nav-link" data-scroll-target="#indicators"><span class="header-section-number">3</span> Indicators</a></li>
  <li><a href="#hydroclimatic-data-preprocessing-script" id="toc-hydroclimatic-data-preprocessing-script" class="nav-link" data-scroll-target="#hydroclimatic-data-preprocessing-script"><span class="header-section-number">4</span> Hydroclimatic Data Preprocessing Script</a>
  <ul class="collapse">
  <li><a href="#filter-camels-cl-data" id="toc-filter-camels-cl-data" class="nav-link" data-scroll-target="#filter-camels-cl-data"><span class="header-section-number">4.1</span> Filter CAMELS-CL data</a></li>
  <li><a href="#create-separate-csv-files-for-each-station-and-variable" id="toc-create-separate-csv-files-for-each-station-and-variable" class="nav-link" data-scroll-target="#create-separate-csv-files-for-each-station-and-variable"><span class="header-section-number">4.2</span> Create separate CSV files for each station and variable</a></li>
  <li><a href="#split-data-by-station" id="toc-split-data-by-station" class="nav-link" data-scroll-target="#split-data-by-station"><span class="header-section-number">4.3</span> Split data by station</a></li>
  <li><a href="#extra-files-and-folders-for-sorting-results" id="toc-extra-files-and-folders-for-sorting-results" class="nav-link" data-scroll-target="#extra-files-and-folders-for-sorting-results"><span class="header-section-number">4.4</span> Extra files and folders for sorting results</a></li>
  </ul></li>
  <li><a href="#generation-of-figures-for-climate-indicators-script" id="toc-generation-of-figures-for-climate-indicators-script" class="nav-link" data-scroll-target="#generation-of-figures-for-climate-indicators-script"><span class="header-section-number">5</span> Generation of figures for climate indicators script</a>
  <ul class="collapse">
  <li><a href="#general-framework-for-customized-figures" id="toc-general-framework-for-customized-figures" class="nav-link" data-scroll-target="#general-framework-for-customized-figures"><span class="header-section-number">5.1</span> General framework for customized figures</a></li>
  <li><a href="#suggested-precipitation-indicators-and-their-figures" id="toc-suggested-precipitation-indicators-and-their-figures" class="nav-link" data-scroll-target="#suggested-precipitation-indicators-and-their-figures"><span class="header-section-number">5.2</span> Suggested precipitation indicators and their figures</a></li>
  <li><a href="#suggested-temperature-indicators-and-their-figures" id="toc-suggested-temperature-indicators-and-their-figures" class="nav-link" data-scroll-target="#suggested-temperature-indicators-and-their-figures"><span class="header-section-number">5.3</span> Suggested temperature indicators and their figures</a></li>
  </ul></li>
  <li><a href="#generation-of-figures-for-hydrologic-indicators-script" id="toc-generation-of-figures-for-hydrologic-indicators-script" class="nav-link" data-scroll-target="#generation-of-figures-for-hydrologic-indicators-script"><span class="header-section-number">6</span> Generation of figures for hydrologic indicators script</a>
  <ul class="collapse">
  <li><a href="#libraries-and-workspace." id="toc-libraries-and-workspace." class="nav-link" data-scroll-target="#libraries-and-workspace."><span class="header-section-number">6.1</span> Libraries and workspace.</a></li>
  <li><a href="#streamflow-figures" id="toc-streamflow-figures" class="nav-link" data-scroll-target="#streamflow-figures"><span class="header-section-number">6.2</span> Streamflow figures</a></li>
  <li><a href="#time-series-figures" id="toc-time-series-figures" class="nav-link" data-scroll-target="#time-series-figures"><span class="header-section-number">6.3</span> Time series figures</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Automated generation of hydroclimatic indicators</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Andrea Redel </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<p>The following workflow was developed as part of an academic residency for the undergraduate Forestry Engineering program under the supervision of Dr.&nbsp;Isabel Rojas.</p>
<p>This repository contains Python scripts designed to filter, organize, and prepare daily hydrometeorological data from the <em>CAMELS-CL</em> dataset for further analysis, such as with <em>Climpact</em> and <em>Indicators of Hydrologic Alteration (IHA)</em> tools. Climpact generates <strong>33 climate indicators</strong> to assess climate change at each meteorological station. IHA (Indicators of Hydrologic Alteration) provides <strong>33 indicators of hydrologic alteration</strong> and <strong>34 indicators related to components of ecological flow</strong>, for each streamflow (hydrometric) station. This script allows for the <strong>systematic preparation of results</strong> from each station within a watershed into selected graphical figures.</p>
<p>Some variable names and code comments are in Spanish as the original dataset and workflow were developed using Chilean climatic and hydrological data. However, all documentation, figures, and explanations are provided in English for international use. The code can be easily adapted to other languages or datasets. Variable names in Spanish follow the structure of the national dataset (Chile), but can be replaced as needed.</p>
<section id="overview" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="overview"><span class="header-section-number">1</span> Overview</h2>
<p>The scripts perform the following main tasks:</p>
<ol type="1">
<li><p><strong>Filter CAMELS-CL data</strong> (<code>tmax</code>, <code>tmin</code>, <code>precip</code>, and <code>q</code>) for specific stations based on station codes</p></li>
<li><p><strong>Create CSV files</strong> with <code>year</code>, <code>month</code>, and <code>day</code> columns plus values for each station.</p></li>
<li><p><strong>Split data by station</strong>, saving individual files per station for each variable.</p></li>
<li><p><strong>Format data</strong> for compatibility with Climpact and IHA:</p></li>
</ol>
<ul>
<li><p>Remove <code>NA</code> and <code>inf</code>/<code>-inf</code> values.</p></li>
<li><p>Remove column headers.</p></li>
<li><p>Format output into required directory structure.</p></li>
</ul>
<ol start="5" type="1">
<li><p>Generate <strong>custom climate indicator figures</strong> from the output files generated by the Climpact tool.</p></li>
<li><p>Generate <strong>custom hydrologic indicator figures</strong> from the output files generated by the IHA tool.</p></li>
</ol>
</section>
<section id="how-to-use" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="how-to-use"><span class="header-section-number">2</span> How to use</h2>
<ol type="1">
<li><p>Clone this repository and open it in a Python-capable editor (recommended: Visual Studio Code).</p></li>
<li><p>Download here the working directory.</p></li>
<li><p>Run the Preprocessing Data script.</p></li>
<li><p>Use the generated products to import them into Climpact and IHA software.</p></li>
<li><p>Run the script for automated generation of figures for climate and fluvial indicators</p></li>
</ol>
</section>
<section id="indicators" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="indicators"><span class="header-section-number">3</span> Indicators</h2>
<p>In the presentation of figures in this work, a selection of climatic and hydrological indicators was made based on their ability to assess climate change and their ecological relevance.</p>
<ol type="1">
<li>Climatic indicators</li>
</ol>
<ul>
<li><p>Precipitation intensity (<a href="#fig-polar-2" class="quarto-xref">Figure&nbsp;2</a>)</p></li>
<li><p>Annual precipitation (<a href="#fig-polar-3" class="quarto-xref">Figure&nbsp;3</a>)</p></li>
<li><p>Consecutive dry days (<a href="#fig-polar-4" class="quarto-xref">Figure&nbsp;4</a>)</p></li>
<li><p>Days with precipitation &gt;= 30 mm (<a href="#fig-polar-5" class="quarto-xref">Figure&nbsp;5</a>)</p></li>
<li><p>Standardised Precipitation Evapostranspiration Index (<a href="#fig-polar-6" class="quarto-xref">Figure&nbsp;6</a>)</p></li>
<li><p>Annual mean daily minimum temperature (<a href="#fig-polar-7" class="quarto-xref">Figure&nbsp;7</a>)</p></li>
<li><p>Annual mean daily maximum temperature (<a href="#fig-polar-8" class="quarto-xref">Figure&nbsp;8</a>)</p></li>
<li><p>Annual warmest daily maximum temperature (<a href="#fig-polar-9" class="quarto-xref">Figure&nbsp;9</a>)</p></li>
<li><p>Days when minimum temperature &lt; 0ºC (<a href="#fig-polar-10" class="quarto-xref">Figure&nbsp;10</a>)</p></li>
</ul>
<ol start="2" type="1">
<li>Statistical analysis of flow rates</li>
</ol>
<ul>
<li><p>Flow hydrograph (<a href="#fig-polar-11" class="quarto-xref">Figure&nbsp;11</a>)</p></li>
<li><p>Boxplot of median monthly flow (<a href="#fig-polar-12" class="quarto-xref">Figure&nbsp;12</a>)</p></li>
<li><p>Percentiles of monthly flow (<a href="#fig-polar-13" class="quarto-xref">Figure&nbsp;13</a>)</p></li>
<li><p>Flow Duration Curve (<a href="#fig-polar-14" class="quarto-xref">Figure&nbsp;14</a>)</p></li>
<li><p>Median monthly flow of the entire basin (<a href="#fig-polar-15" class="quarto-xref">Figure&nbsp;15</a>)</p></li>
</ul>
<ol start="3" type="1">
<li>Time series of hydrological indicators</li>
</ol>
<ul>
<li><p>Median flow in July (<a href="#fig-polar-16" class="quarto-xref">Figure&nbsp;16</a>)</p></li>
<li><p>High pulse duration (<a href="#fig-polar-17" class="quarto-xref">Figure&nbsp;17</a>)</p></li>
<li><p>Base flow index (<a href="#fig-polar-18" class="quarto-xref">Figure&nbsp;18</a>)</p></li>
<li><p>Small flood peak (<a href="#fig-polar-19" class="quarto-xref">Figure&nbsp;19</a>)</p></li>
<li><p>Large flood peak (<a href="#fig-polar-20" class="quarto-xref">Figure&nbsp;20</a>)</p></li>
</ul>
</section>
<section id="hydroclimatic-data-preprocessing-script" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="hydroclimatic-data-preprocessing-script"><span class="header-section-number">4</span> Hydroclimatic Data Preprocessing Script</h2>
<section id="filter-camels-cl-data" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="filter-camels-cl-data"><span class="header-section-number">4.1</span> Filter CAMELS-CL data</h3>
<p>4.1.1. Dependencies and workspace</p>
<p>4.1.1.1 Import libraries</p>
<div id="f61a250d" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>, category<span class="op">=</span><span class="pp">FutureWarning</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>4.1.1.2. Make sure the directory exists</p>
<div id="a74bd17d" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> asegurar_directorio(ruta):</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    os.makedirs(ruta, exist_ok<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>4.1.1.3. Define folder paths</p>
<div id="e178aabc" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>ruta_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos'</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>ruta_guardado <span class="op">=</span> os.path.join(ruta_base, <span class="st">'0.filtrado_estaciones'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>4.1.1.4. Create the directory if it doesn’t exist</p>
<div id="f439f050" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>asegurar_directorio(ruta_guardado)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>4.1.1.5. Additional columns</p>
<div id="aea07a22" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>columnas_adicionales <span class="op">=</span> [<span class="st">'year'</span>, <span class="st">'month'</span>, <span class="st">'day'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>4.1.2. Maximum temperature filter 4.1.2.1. Read the CSV file</p>
<div id="cbf9a4dd" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(os.path.join(ruta_base, <span class="st">'CAMELS_CL_v202201/tmax_cr2met_C_day.csv'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>4.1.2.2. Filter columns based on River Basin</p>
<div id="da7e5425" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>columnas_filtradas <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> df.columns <span class="cf">if</span> col.isdigit() <span class="kw">and</span> <span class="dv">9100000</span> <span class="op">&lt;=</span> <span class="bu">int</span>(col) <span class="op">&lt;=</span> <span class="dv">9199999</span>]</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>columnas_filtradas <span class="op">+=</span> [col <span class="cf">for</span> col <span class="kw">in</span> columnas_adicionales <span class="cf">if</span> col <span class="kw">in</span> df.columns]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>In this article, we will use the Toltén River Basin, Chile, identified by the code <code>94</code>, as a case study.</p>
<p>To analyze a different basin:</p>
<ul>
<li>Change the station code range, for example, the Imperial River Basin, identified by the code <code>91</code>.</li>
<li>Update all relevant parts of the script accordingly.</li>
</ul>
<div id="7042dc9a" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>columnas_filtradas <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> df.columns <span class="cf">if</span> col.isdigit() <span class="kw">and</span> <span class="dv">9400000</span> <span class="op">&lt;=</span> <span class="bu">int</span>(col) <span class="op">&lt;=</span> <span class="dv">9499999</span>]</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>columnas_filtradas <span class="op">+=</span> [col <span class="cf">for</span> col <span class="kw">in</span> columnas_adicionales <span class="cf">if</span> col <span class="kw">in</span> df.columns]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>4.1.2.3. Create a new Data Frame with the filtered columns</p>
<div id="38c8032b" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df_filtrado <span class="op">=</span> df[columnas_filtradas]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>4.1.2.4. Save the new Data Frame to a CSV file</p>
<div class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df_filtrado.to_csv(os.path.join(ruta_guardado, <span class="st">'tmax.csv'</span>), index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Filtered columns and new file of maximum temperatures for the basin's stations saved."</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Preview:"</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>df.iloc[:<span class="dv">5</span>, :<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Filtered columns and new file of maximum temperatures for the basin's stations saved.
Preview:</code></pre>
</div>
<div id="tbl-polar-1" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="10">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-polar-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Maximum temperature filter for the stations in each basin
</figcaption>
<div aria-describedby="tbl-polar-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">day</th>
<th data-quarto-table-cell-role="th">1001001</th>
<th data-quarto-table-cell-role="th">1001002</th>
<th data-quarto-table-cell-role="th">1001003</th>
<th data-quarto-table-cell-role="th">1020002</th>
<th data-quarto-table-cell-role="th">1020003</th>
<th data-quarto-table-cell-role="th">1021001</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1979-01-01</td>
<td>1979</td>
<td>1</td>
<td>1</td>
<td>10.177674</td>
<td>10.939560</td>
<td>10.132287</td>
<td>10.424700</td>
<td>10.716425</td>
<td>11.585810</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1979-01-02</td>
<td>1979</td>
<td>1</td>
<td>2</td>
<td>10.073322</td>
<td>10.855575</td>
<td>9.982770</td>
<td>10.489676</td>
<td>10.810094</td>
<td>11.818355</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1979-01-03</td>
<td>1979</td>
<td>1</td>
<td>3</td>
<td>10.978896</td>
<td>11.760256</td>
<td>10.890517</td>
<td>11.500134</td>
<td>11.781082</td>
<td>12.665569</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1979-01-04</td>
<td>1979</td>
<td>1</td>
<td>4</td>
<td>8.506858</td>
<td>9.651696</td>
<td>8.612532</td>
<td>8.862529</td>
<td>9.321736</td>
<td>10.355026</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1979-01-05</td>
<td>1979</td>
<td>1</td>
<td>5</td>
<td>10.356481</td>
<td>11.121019</td>
<td>10.359378</td>
<td>10.481868</td>
<td>10.799477</td>
<td>11.235866</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
<p>4.1.3. Minimum Temperature filter The same process is repeated as with the maximum temperature.</p>
<div class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(os.path.join(ruta_base, <span class="st">'CAMELS_CL_v202201/tmin_cr2met_C_day.csv'</span>))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>columnas_filtradas <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> df.columns <span class="cf">if</span> col.isdigit() <span class="kw">and</span> <span class="dv">9400000</span> <span class="op">&lt;=</span> <span class="bu">int</span>(col) <span class="op">&lt;=</span> <span class="dv">9499999</span>]</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>columnas_filtradas <span class="op">+=</span> [col <span class="cf">for</span> col <span class="kw">in</span> columnas_adicionales <span class="cf">if</span> col <span class="kw">in</span> df.columns]</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>df_filtrado <span class="op">=</span> df[columnas_filtradas]</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>df_filtrado.to_csv(os.path.join(ruta_guardado, <span class="st">'tmin.csv'</span>), index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Filtered columns and new file of minimum temperatures for the basin's stations saved."</span>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Preview:"</span>)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>df.iloc[:<span class="dv">5</span>, :<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Filtered columns and new file of minimum temperatures for the basin's stations saved.
Preview:</code></pre>
</div>
<div id="tbl-polar-2" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="11">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-polar-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Minimum temperature filter for the stations in each basin
</figcaption>
<div aria-describedby="tbl-polar-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">day</th>
<th data-quarto-table-cell-role="th">1001001</th>
<th data-quarto-table-cell-role="th">1001002</th>
<th data-quarto-table-cell-role="th">1001003</th>
<th data-quarto-table-cell-role="th">1020002</th>
<th data-quarto-table-cell-role="th">1020003</th>
<th data-quarto-table-cell-role="th">1021001</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1979-01-01</td>
<td>1979</td>
<td>1</td>
<td>1</td>
<td>-5.849425</td>
<td>-5.033302</td>
<td>-5.138722</td>
<td>-5.704229</td>
<td>-5.709160</td>
<td>-5.510278</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1979-01-02</td>
<td>1979</td>
<td>1</td>
<td>2</td>
<td>-5.765660</td>
<td>-4.986696</td>
<td>-5.135554</td>
<td>-5.446885</td>
<td>-5.443863</td>
<td>-5.084203</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1979-01-03</td>
<td>1979</td>
<td>1</td>
<td>3</td>
<td>-5.718315</td>
<td>-4.929108</td>
<td>-5.020927</td>
<td>-5.438698</td>
<td>-5.442942</td>
<td>-5.027288</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1979-01-04</td>
<td>1979</td>
<td>1</td>
<td>4</td>
<td>-3.798310</td>
<td>-2.945276</td>
<td>-3.108570</td>
<td>-4.030442</td>
<td>-3.834039</td>
<td>-3.309620</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1979-01-05</td>
<td>1979</td>
<td>1</td>
<td>5</td>
<td>-4.913381</td>
<td>-4.138040</td>
<td>-4.194681</td>
<td>-4.774841</td>
<td>-4.826542</td>
<td>-4.284366</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
<p>4.1.4. Precipitation filter The same process is repeated.</p>
<div class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(os.path.join(ruta_base, <span class="st">'CAMELS_CL_v202201/precip_cr2met_mm_day.csv'</span>))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>columnas_filtradas <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> df.columns <span class="cf">if</span> col.isdigit() <span class="kw">and</span> <span class="dv">9400000</span> <span class="op">&lt;=</span> <span class="bu">int</span>(col) <span class="op">&lt;=</span> <span class="dv">9499999</span>]</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>columnas_filtradas <span class="op">+=</span> [col <span class="cf">for</span> col <span class="kw">in</span> columnas_adicionales <span class="cf">if</span> col <span class="kw">in</span> df.columns]</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>df_filtrado <span class="op">=</span> df[columnas_filtradas]</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>df_filtrado.to_csv(os.path.join(ruta_guardado, <span class="st">'pp.csv'</span>), index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Filtered columns and new file of precipitation for the basin's stations saved."</span>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Preview:"</span>)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>df.iloc[:<span class="dv">5</span>, :<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Filtered columns and new file of precipitation for the basin's stations saved.
Preview:</code></pre>
</div>
<div id="tbl-polar-3" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="12">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-polar-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: Precipitation filter for the stations in each basin
</figcaption>
<div aria-describedby="tbl-polar-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">day</th>
<th data-quarto-table-cell-role="th">1001001</th>
<th data-quarto-table-cell-role="th">1001002</th>
<th data-quarto-table-cell-role="th">1001003</th>
<th data-quarto-table-cell-role="th">1020002</th>
<th data-quarto-table-cell-role="th">1020003</th>
<th data-quarto-table-cell-role="th">1021001</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1979-01-01</td>
<td>1979</td>
<td>1</td>
<td>1</td>
<td>3.830792</td>
<td>2.995933</td>
<td>4.351452</td>
<td>2.620128</td>
<td>1.811431</td>
<td>0.376418</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1979-01-02</td>
<td>1979</td>
<td>1</td>
<td>2</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1979-01-03</td>
<td>1979</td>
<td>1</td>
<td>3</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.033105</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1979-01-04</td>
<td>1979</td>
<td>1</td>
<td>4</td>
<td>2.855784</td>
<td>2.070867</td>
<td>2.963318</td>
<td>3.065628</td>
<td>2.160813</td>
<td>1.676861</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1979-01-05</td>
<td>1979</td>
<td>1</td>
<td>5</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
<p>4.1.5. Streamflow filter The same process is repeated.</p>
<div class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(os.path.join(ruta_base, <span class="st">'CAMELS_CL_v202201/q_m3s_day.csv'</span>))</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>columnas_filtradas <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> df.columns <span class="cf">if</span> col.isdigit() <span class="kw">and</span> <span class="dv">9400000</span> <span class="op">&lt;=</span> <span class="bu">int</span>(col) <span class="op">&lt;=</span> <span class="dv">9499999</span>]</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>columnas_filtradas <span class="op">+=</span> [col <span class="cf">for</span> col <span class="kw">in</span> columnas_adicionales <span class="cf">if</span> col <span class="kw">in</span> df.columns]</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>df_filtrado <span class="op">=</span> df[columnas_filtradas]</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>df_filtrado.to_csv(os.path.join(ruta_guardado, <span class="st">'q.csv'</span>), index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Filtered columns and new file of streamflow for the basin's stations saved."</span>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Preview:"</span>)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>df.iloc[:<span class="dv">5</span>, :<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Filtered columns and new file of streamflow for the basin's stations saved.
Preview:</code></pre>
</div>
<div id="tbl-polar-4" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="13">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-polar-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4: Streamflow filter for the stations in each basin
</figcaption>
<div aria-describedby="tbl-polar-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">day</th>
<th data-quarto-table-cell-role="th">1001001</th>
<th data-quarto-table-cell-role="th">1001002</th>
<th data-quarto-table-cell-role="th">1001003</th>
<th data-quarto-table-cell-role="th">1020002</th>
<th data-quarto-table-cell-role="th">1020003</th>
<th data-quarto-table-cell-role="th">1021001</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1900-01-01</td>
<td>1900</td>
<td>1</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1900-01-02</td>
<td>1900</td>
<td>1</td>
<td>2</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1900-01-03</td>
<td>1900</td>
<td>1</td>
<td>3</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1900-01-04</td>
<td>1900</td>
<td>1</td>
<td>4</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1900-01-05</td>
<td>1900</td>
<td>1</td>
<td>5</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="create-separate-csv-files-for-each-station-and-variable" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="create-separate-csv-files-for-each-station-and-variable"><span class="header-section-number">4.2</span> Create separate CSV files for each station and variable</h3>
<p>4.2.1. Minimum Temperature 4.2.1.1. CSV file path</p>
<div id="155ffce2" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>archivo_csv <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/0.filtrado_estaciones/tmin.csv'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>4.2.1.2. Read CSV file</p>
<div id="f249818b" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(archivo_csv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>4.2.1.3. Get the Data Frame columns</p>
<div id="6b253f53" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>columnas <span class="op">=</span> df.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>4.2.1.4. Create a directory to save files by column</p>
<div id="0d85a8b1" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>output_dir <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/1.temperaturas_min'</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>os.makedirs(output_dir, exist_ok<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>4.2.1.5. Iterate over the columns and save the data for <code>year</code>, <code>month,</code> and <code>day</code></p>
<div class="cell" data-execution_count="18">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> columnas:</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    df_col <span class="op">=</span> df[[<span class="st">'year'</span>, <span class="st">'month'</span>, <span class="st">'day'</span>, col]].copy()</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    df_col <span class="op">=</span> df_col.rename(columns<span class="op">=</span>{col: <span class="st">'tmin'</span>})</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    output_path <span class="op">=</span> os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    df_col.to_csv(output_path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Files of minimum temperature (tmin) separated by station were successfully generated."</span>)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>archivos_generados <span class="op">=</span> os.listdir(output_dir)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Generated_files:"</span>)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(archivos_generados)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>primer_archivo <span class="op">=</span> archivos_generados[<span class="dv">1</span>]</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>ruta_primero <span class="op">=</span> os.path.join(output_dir, primer_archivo)</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>df_primero <span class="op">=</span> pd.read_csv(ruta_primero)</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"First file: station </span><span class="sc">{</span>primer_archivo<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>display(df_primero.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Files of minimum temperature (tmin) separated by station were successfully generated.
Generated_files:
['9437002.csv', '9433001.csv', '9405001.csv', '9423001.csv', '9434001.csv', 'year.csv', '9402001.csv', '9436001.csv', '9400000.csv', '9412001.csv', 'month.csv', 'day.csv', '9416001.csv', '9404001.csv', '9420001.csv', '9414001.csv']
First file: station 9433001.csv</code></pre>
</div>
<div id="tbl-polar-5" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="18">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-polar-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;5: Daily minimum temperature for station 9437002
</figcaption>
<div aria-describedby="tbl-polar-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">day</th>
<th data-quarto-table-cell-role="th">tmin</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1979</td>
<td>1</td>
<td>1</td>
<td>7.184061</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1979</td>
<td>1</td>
<td>2</td>
<td>6.857838</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1979</td>
<td>1</td>
<td>3</td>
<td>7.691808</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1979</td>
<td>1</td>
<td>4</td>
<td>7.785254</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1979</td>
<td>1</td>
<td>5</td>
<td>8.728067</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
<p>4.2.2. Maximum Temperature The same process is repeated</p>
<div class="cell" data-execution_count="19">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>archivo_csv <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/0.filtrado_estaciones/tmax.csv'</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(archivo_csv)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>columnas <span class="op">=</span> df.columns</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>output_dir <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/2.temperaturas_max'</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>os.makedirs(output_dir, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> columnas:</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    df_col <span class="op">=</span> df[[<span class="st">'year'</span>, <span class="st">'month'</span>, <span class="st">'day'</span>, col]].copy()</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    df_col <span class="op">=</span> df_col.rename(columns<span class="op">=</span>{col: <span class="st">'tmax'</span>})</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    output_path <span class="op">=</span> os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    df_col.to_csv(output_path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Files of maximum temperature (tmax) separated by station were successfully generated."</span>)</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>archivos_generados <span class="op">=</span> os.listdir(output_dir)</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Generated_files:"</span>)</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(archivos_generados)</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>primer_archivo <span class="op">=</span> archivos_generados[<span class="dv">1</span>]</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>ruta_primero <span class="op">=</span> os.path.join(output_dir, primer_archivo)</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>df_primero <span class="op">=</span> pd.read_csv(ruta_primero)</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"First file: station </span><span class="sc">{</span>primer_archivo<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>display(df_primero.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Files of maximum temperature (tmax) separated by station were successfully generated.
Generated_files:
['9437002.csv', '9433001.csv', '9405001.csv', '9423001.csv', '9434001.csv', 'year.csv', '9402001.csv', '9436001.csv', '9400000.csv', '9412001.csv', 'month.csv', 'day.csv', '9416001.csv', '9404001.csv', '9420001.csv', '9414001.csv']
First file: station 9433001.csv</code></pre>
</div>
<div id="tbl-polar-6" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="19">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-polar-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;6: Daily maximum temperature for station 9437002
</figcaption>
<div aria-describedby="tbl-polar-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">day</th>
<th data-quarto-table-cell-role="th">tmax</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1979</td>
<td>1</td>
<td>1</td>
<td>23.202289</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1979</td>
<td>1</td>
<td>2</td>
<td>25.763368</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1979</td>
<td>1</td>
<td>3</td>
<td>25.706376</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1979</td>
<td>1</td>
<td>4</td>
<td>27.272382</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1979</td>
<td>1</td>
<td>5</td>
<td>27.402793</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
<p>4.2.3. Precipitation The same process is repeated</p>
<div class="cell" data-execution_count="20">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>archivo_csv <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/0.filtrado_estaciones/pp.csv'</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(archivo_csv)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>columnas <span class="op">=</span> df.columns</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>output_dir <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/3.precipitaciones'</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>os.makedirs(output_dir, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> columnas:</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    df_col <span class="op">=</span> df[[<span class="st">'year'</span>, <span class="st">'month'</span>, <span class="st">'day'</span>, col]].copy()</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    df_col <span class="op">=</span> df_col.rename(columns<span class="op">=</span>{col: <span class="st">'pp'</span>})</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    output_path <span class="op">=</span> os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    df_col.to_csv(output_path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Files of precipitation (pp) separated by station were successfully generated."</span>)</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>archivos_generados <span class="op">=</span> os.listdir(output_dir)</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Generated_files:"</span>)</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(archivos_generados)</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>primer_archivo <span class="op">=</span> archivos_generados[<span class="dv">1</span>]</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>ruta_primero <span class="op">=</span> os.path.join(output_dir, primer_archivo)</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>df_primero <span class="op">=</span> pd.read_csv(ruta_primero)</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"First file: station </span><span class="sc">{</span>primer_archivo<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>display(df_primero.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Files of precipitation (pp) separated by station were successfully generated.
Generated_files:
['9437002.csv', '9433001.csv', '9405001.csv', '9423001.csv', '9434001.csv', 'year.csv', '9402001.csv', '9436001.csv', '9400000.csv', '9412001.csv', 'month.csv', 'day.csv', '9416001.csv', '9404001.csv', '9420001.csv', '9414001.csv']
First file: station 9433001.csv</code></pre>
</div>
<div id="tbl-polar-7" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="20">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-polar-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;7: Daily precipitation for station 9437002
</figcaption>
<div aria-describedby="tbl-polar-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">day</th>
<th data-quarto-table-cell-role="th">pp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1979</td>
<td>1</td>
<td>1</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1979</td>
<td>1</td>
<td>2</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1979</td>
<td>1</td>
<td>3</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1979</td>
<td>1</td>
<td>4</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1979</td>
<td>1</td>
<td>5</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
<p>4.2.4. Streamflow The same process is repeated</p>
<div class="cell" data-execution_count="21">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>archivo_csv <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/0.filtrado_estaciones/q.csv'</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(archivo_csv)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>columnas <span class="op">=</span> df.columns</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>output_dir <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/7.caudales'</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>os.makedirs(output_dir, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> columnas:</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    df_col <span class="op">=</span> df[[<span class="st">'year'</span>, <span class="st">'month'</span>, <span class="st">'day'</span>, col]].copy()</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    df_col <span class="op">=</span> df_col.rename(columns<span class="op">=</span>{col: <span class="st">'q'</span>})</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    output_path <span class="op">=</span> os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    df_col.to_csv(output_path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Files of streamflow (q) separated by station were successfully generated."</span>)</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>archivos_generados <span class="op">=</span> os.listdir(output_dir)</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Generated_files:"</span>)</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(archivos_generados)</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>primer_archivo <span class="op">=</span> archivos_generados[<span class="dv">1</span>]</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>ruta_primero <span class="op">=</span> os.path.join(output_dir, primer_archivo)</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>df_primero <span class="op">=</span> pd.read_csv(ruta_primero)</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"First file: station </span><span class="sc">{</span>primer_archivo<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>display(df_primero.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Files of streamflow (q) separated by station were successfully generated.
Generated_files:
['9437002.csv', '9433001.csv', '9405001.csv', '9423001.csv', '9434001.csv', 'year.csv', '9402001.csv', '9436001.csv', '9400000.csv', '9412001.csv', 'month.csv', 'day.csv', '9416001.csv', '9404001.csv', '9420001.csv', '9414001.csv']
First file: station 9433001.csv</code></pre>
</div>
<div id="tbl-polar-8" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="21">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-polar-8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;8: Daily streamflow for station 9437002
</figcaption>
<div aria-describedby="tbl-polar-8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">day</th>
<th data-quarto-table-cell-role="th">q</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1900</td>
<td>1</td>
<td>1</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1900</td>
<td>1</td>
<td>2</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1900</td>
<td>1</td>
<td>3</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1900</td>
<td>1</td>
<td>4</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1900</td>
<td>1</td>
<td>5</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="split-data-by-station" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="split-data-by-station"><span class="header-section-number">4.3</span> Split data by station</h3>
<p>4.3.1. Format data for compability with Climpact 4.3.1.1. Mapping precipitation, minimum and maximum temperature based on filename and file path</p>
<div id="716846a3" class="cell" data-execution_count="22">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>dir_principal <span class="op">=</span> <span class="st">'Hidroclima/Base de datos'</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>subcarpetas <span class="op">=</span> [<span class="st">'1.temperaturas_min'</span>, <span class="st">'2.temperaturas_max'</span>, <span class="st">'3.precipitaciones'</span>]</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>columna_map <span class="op">=</span> {</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'1.temperaturas_min'</span>: <span class="st">'tmin'</span>,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2.temperaturas_max'</span>: <span class="st">'tmax'</span>,</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'3.precipitaciones'</span>: <span class="st">'prcp'</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> obtener_archivos(subcarpeta):</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    ruta_subcarpeta <span class="op">=</span> os.path.join(dir_principal, subcarpeta)</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    archivos <span class="op">=</span> [archivo <span class="cf">for</span> archivo <span class="kw">in</span> os.listdir(ruta_subcarpeta) <span class="cf">if</span> archivo.endswith(<span class="st">'.csv'</span>) <span class="kw">and</span> archivo <span class="kw">not</span> <span class="kw">in</span> [<span class="st">'year.csv'</span>, <span class="st">'month.csv'</span>, <span class="st">'day.csv'</span>]]</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> archivos</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> leer_archivo(ruta, columna):</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_csv(ruta)</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.rename(columns<span class="op">=</span>{df.columns[<span class="op">-</span><span class="dv">1</span>]: columna})</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>estaciones_data <span class="op">=</span> {}</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> subcarpeta <span class="kw">in</span> subcarpetas:</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>    columna <span class="op">=</span> columna_map[subcarpeta]</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>    archivos <span class="op">=</span> obtener_archivos(subcarpeta)</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> archivo <span class="kw">in</span> archivos:</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>        estacion <span class="op">=</span> os.path.splitext(archivo)[<span class="dv">0</span>]</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>        ruta_archivo <span class="op">=</span> os.path.join(dir_principal, subcarpeta, archivo)</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> leer_archivo(ruta_archivo, columna)</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> estacion <span class="kw">not</span> <span class="kw">in</span> estaciones_data:</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>            estaciones_data[estacion] <span class="op">=</span> df[[<span class="st">'year'</span>, <span class="st">'month'</span>, <span class="st">'day'</span>, columna]]</span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>            estaciones_data[estacion] <span class="op">=</span> estaciones_data[estacion].merge(df[[<span class="st">'year'</span>, <span class="st">'month'</span>, <span class="st">'day'</span>, columna]], on<span class="op">=</span>[<span class="st">'year'</span>, <span class="st">'month'</span>, <span class="st">'day'</span>], how<span class="op">=</span><span class="st">'outer'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>4.3.1.2. Save files by station</p>
<div id="89688161" class="cell" data-execution_count="23">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>output_dir <span class="op">=</span> os.path.join(dir_principal, <span class="st">'4.pre_Climpact'</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>os.makedirs(output_dir, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> estacion, df <span class="kw">in</span> estaciones_data.items():</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> columna <span class="kw">in</span> [<span class="st">'prcp'</span>, <span class="st">'tmax'</span>, <span class="st">'tmin'</span>]:</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> columna <span class="kw">not</span> <span class="kw">in</span> df.columns:</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>            df[columna] <span class="op">=</span> pd.NA</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[[<span class="st">'year'</span>, <span class="st">'month'</span>, <span class="st">'day'</span>, <span class="st">'prcp'</span>, <span class="st">'tmax'</span>, <span class="st">'tmin'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>4.3.1.3. Format:</p>
<ul>
<li><p>Approximate variable values to 1 decimal place</p></li>
<li><p>Convert <code>day</code>and <code>month</code> values to 2 digits</p></li>
<li><p>Combine <code>year</code>, <code>month</code> and <code>day</code> into a single ‘date’ column</p></li>
<li><p>Replace <code>inf</code>, <code>-inf</code> and <code>NaN</code> values ​​with <code>-99.9</code></p></li>
<li><p>Export as a <code>.txt</code> file</p></li>
<li><p>Correct order of columns</p></li>
</ul>
<div class="cell" data-execution_count="24">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>    df[[<span class="st">'prcp'</span>, <span class="st">'tmax'</span>, <span class="st">'tmin'</span>]] <span class="op">=</span> df[[<span class="st">'prcp'</span>, <span class="st">'tmax'</span>, <span class="st">'tmin'</span>]].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">round</span>(x, <span class="dv">1</span>))</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'month'</span>] <span class="op">=</span> df[<span class="st">'month'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="ss">f'</span><span class="sc">{</span>x<span class="sc">:02}</span><span class="ss">'</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'day'</span>] <span class="op">=</span> df[<span class="st">'day'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="ss">f'</span><span class="sc">{</span>x<span class="sc">:02}</span><span class="ss">'</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'fecha'</span>] <span class="op">=</span> df.<span class="bu">apply</span>(<span class="kw">lambda</span> row: <span class="ss">f"</span><span class="sc">{</span><span class="bu">int</span>(row[<span class="st">'year'</span>])<span class="sc">:4d}</span><span class="ss"> </span><span class="sc">{</span>row[<span class="st">'month'</span>]<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>row[<span class="st">'day'</span>]<span class="sc">}</span><span class="ss">"</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.replace([<span class="bu">float</span>(<span class="st">'inf'</span>), <span class="bu">float</span>(<span class="st">'-inf'</span>)], <span class="op">-</span><span class="fl">99.9</span>).fillna(<span class="op">-</span><span class="fl">99.9</span>)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    ruta_salida <span class="op">=</span> os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>estacion<span class="sc">}</span><span class="ss">.txt'</span>)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(ruta_salida, <span class="st">'w'</span>) <span class="im">as</span> f:</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _, row <span class="kw">in</span> df.iterrows():</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>            f.write(<span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'fecha'</span>]<span class="sc">}</span><span class="ss">    </span><span class="sc">{</span>row[<span class="st">'prcp'</span>]<span class="sc">:5.1f}</span><span class="ss">     </span><span class="sc">{</span>row[<span class="st">'tmax'</span>]<span class="sc">:4.1f}</span><span class="ss">     </span><span class="sc">{</span>row[<span class="st">'tmin'</span>]<span class="sc">:4.1f}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Files for Climpact generated successfully."</span>)</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>archivos_generados <span class="op">=</span> <span class="bu">sorted</span>(os.listdir(output_dir))</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>df_archivos <span class="op">=</span> pd.DataFrame(archivos_generados, columns<span class="op">=</span>[<span class="st">'Generated files'</span>])</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>display(df_archivos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Files for Climpact generated successfully.</code></pre>
</div>
<div id="tbl-polar-9" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="24">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-polar-9-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;9: List of the generated files in the output directory
</figcaption>
<div aria-describedby="tbl-polar-9-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Generated files</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>9414001.txt</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
<div class="cell" data-execution_count="25">
<div id="tbl-polar-10" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="25">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-polar-10-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;10: Station 9437002 file with information on each variable
</figcaption>
<div aria-describedby="tbl-polar-10-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display">
<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<tbody>
<tr class="odd">
<td>1900</td>
<td>1</td>
<td>1</td>
<td>NaN</td>
</tr>
<tr class="even">
<td>1900</td>
<td>1</td>
<td>2</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td>1900</td>
<td>1</td>
<td>3</td>
<td>NaN</td>
</tr>
<tr class="even">
<td>1900</td>
<td>1</td>
<td>4</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td>1900</td>
<td>1</td>
<td>5</td>
<td>NaN</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>4.3.2. Format data for compability with IHA 4.3.2.1. The same process is repeated, now for the streamflow.</p>
<div id="bb5adb0e" class="cell" data-execution_count="26">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>dir_entrada <span class="op">=</span> os.path.join(<span class="st">'Hidroclima'</span>, <span class="st">'Base de datos'</span>, <span class="st">'7.caudales'</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>dir_salida <span class="op">=</span> os.path.join(<span class="st">'Hidroclima'</span>, <span class="st">'Base de datos'</span>, <span class="st">'8.pre_IHA'</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>os.makedirs(dir_salida, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> archivo <span class="kw">in</span> os.listdir(dir_entrada):</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> archivo.endswith(<span class="st">'.csv'</span>):</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>        ruta_entrada <span class="op">=</span> os.path.join(dir_entrada, archivo)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>        archivo_salida <span class="op">=</span> os.path.splitext(archivo)[<span class="dv">0</span>] <span class="op">+</span> <span class="st">'.txt'</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>        ruta_salida <span class="op">=</span> os.path.join(dir_salida, archivo_salida)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_csv(ruta_entrada)</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>        columnas_requeridas <span class="op">=</span> {<span class="st">'year'</span>, <span class="st">'month'</span>, <span class="st">'day'</span>, <span class="st">'q'</span>}</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> columnas_requeridas.issubset(df.columns):</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"The </span><span class="sc">{</span>archivo<span class="sc">}</span><span class="ss"> file does not contain the required columns: </span><span class="sc">{</span>columnas_requeridas<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[[<span class="st">'year'</span>, <span class="st">'month'</span>, <span class="st">'day'</span>, <span class="st">'q'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>The year.csv file does not contain the required columns: {'year', 'day', 'month', 'q'}
The month.csv file does not contain the required columns: {'year', 'day', 'month', 'q'}
The day.csv file does not contain the required columns: {'year', 'day', 'month', 'q'}</code></pre>
</div>
</div>
<p>4.3.2.2. Format:</p>
<ul>
<li><p>Aproximate streamflow values to 1 decimal place</p></li>
<li><p>Date column in <strong>YYYY-MM-DD</strong> format</p></li>
<li><p>Replace <code>inf</code>, <code>-inf</code>, and <code>NaN</code> values ​​with <code>-1.0</code></p></li>
<li><p>Delete leading rows where ‘q’ equals -1.0</p></li>
<li><p>Streamflow column named <code>flow</code></p></li>
<li><p>Export as <code>.txt</code>file</p></li>
</ul>
<div id="dcf51810" class="cell" data-execution_count="27">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df.replace([<span class="bu">float</span>(<span class="st">'inf'</span>), <span class="bu">float</span>(<span class="st">'-inf'</span>)], <span class="op">-</span><span class="fl">1.0</span>).fillna(<span class="op">-</span><span class="fl">1.0</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df.loc[df[<span class="st">'q'</span>] <span class="op">!=</span> <span class="op">-</span><span class="fl">1.0</span>].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'q'</span>] <span class="op">=</span> df[<span class="st">'q'</span>].<span class="bu">round</span>(<span class="dv">1</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'date'</span>] <span class="op">=</span> pd.to_datetime(df[[<span class="st">'year'</span>, <span class="st">'month'</span>, <span class="st">'day'</span>]])</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[[<span class="st">'date'</span>, <span class="st">'q'</span>]].rename(columns<span class="op">=</span>{<span class="st">'q'</span>: <span class="st">'flow'</span>})</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>        df.to_csv(ruta_salida, index<span class="op">=</span><span class="va">False</span>, header<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"IHA files processed successfully."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>IHA files processed successfully.</code></pre>
</div>
</div>
</section>
<section id="extra-files-and-folders-for-sorting-results" class="level3" data-number="4.4">
<h3 data-number="4.4" class="anchored" data-anchor-id="extra-files-and-folders-for-sorting-results"><span class="header-section-number">4.4</span> Extra files and folders for sorting results</h3>
<p>4.4.1. List of folders to create:</p>
<ul>
<li><p>Folder 5 stores the station-specific folders generated by Climpact.</p></li>
<li><p>Folder 6 contains customized plots based on Climpact results.</p></li>
<li><p>Folder 9 stores the Excel files generated by IHA for each station, along with their processed CSV versions.</p></li>
<li><p>Folder 10 includes the figures created from IHA data.</p></li>
<li><p>Folder 11 contains text files intended to be imported into QGIS for georeferencing.</p></li>
</ul>
<div id="a0cc3d97" class="cell" data-execution_count="28">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>ruta_base <span class="op">=</span> os.path.join(<span class="st">'Hidroclima'</span>, <span class="st">'Base de datos'</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>carpetas <span class="op">=</span> [</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'5.Climpact'</span>,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'6.Figuras_Climpact'</span>,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'9.IHA'</span>,</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'10.Figuras_IHA'</span>,</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'11.Georreferenciación'</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> carpeta <span class="kw">in</span> carpetas:</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    ruta_carpeta <span class="op">=</span> os.path.join(ruta_base, carpeta)</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    os.makedirs(ruta_carpeta, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Folder created: </span><span class="sc">{</span>ruta_carpeta<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"All necessary folders for the results have been created successfully."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Folder created: Hidroclima/Base de datos/5.Climpact
Folder created: Hidroclima/Base de datos/6.Figuras_Climpact
Folder created: Hidroclima/Base de datos/9.IHA
Folder created: Hidroclima/Base de datos/10.Figuras_IHA
Folder created: Hidroclima/Base de datos/11.Georreferenciación
All necessary folders for the results have been created successfully.</code></pre>
</div>
</div>
<p>4.4.2. Georeference the stations in the study basin</p>
<div class="cell" data-execution_count="29">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>archivo_entrada <span class="op">=</span> <span class="st">"Hidroclima/Base de datos/CAMELS_CL_v202201/catchment_attributes.csv"</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(archivo_entrada)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>df_filtrado <span class="op">=</span> df[(df[<span class="st">'gauge_id'</span>] <span class="op">&gt;=</span> <span class="dv">9400000</span>) <span class="op">&amp;</span> (df[<span class="st">'gauge_id'</span>] <span class="op">&lt;=</span> <span class="dv">9499999</span>)]</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>df_filtrado <span class="op">=</span> df_filtrado[[<span class="st">'gauge_id'</span>, <span class="st">'gauge_name'</span>, <span class="st">'gauge_lat'</span>, <span class="st">'gauge_lon'</span>, <span class="st">'record_period_start'</span>, <span class="st">'record_period_end'</span>]]</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>directorio_salida <span class="op">=</span> <span class="st">"Hidroclima/Base de datos/11.Georreferenciación/Estaciones.csv"</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>df_filtrado.to_csv(directorio_salida, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Filtered file saved as:"</span>, directorio_salida)</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>display(df_filtrado)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Filtered file saved as: Hidroclima/Base de datos/11.Georreferenciación/Estaciones.csv</code></pre>
</div>
<div id="tbl-polar-11" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="29">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-polar-11-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;11: Information by georeferenced station
</figcaption>
<div aria-describedby="tbl-polar-11-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">gauge_id</th>
<th data-quarto-table-cell-role="th">gauge_name</th>
<th data-quarto-table-cell-role="th">gauge_lat</th>
<th data-quarto-table-cell-role="th">gauge_lon</th>
<th data-quarto-table-cell-role="th">record_period_start</th>
<th data-quarto-table-cell-role="th">record_period_end</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">370</td>
<td>9400000</td>
<td>Rio Truful En Camino Internacional</td>
<td>-38.8444</td>
<td>-71.6536</td>
<td>2014-12-18</td>
<td>2020-03-24</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">371</td>
<td>9402001</td>
<td>Rio Allipen En Melipeuco</td>
<td>-38.8653</td>
<td>-71.7336</td>
<td>1985-01-17</td>
<td>2019-08-31</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">372</td>
<td>9404001</td>
<td>Rio Allipen En Los Laureles</td>
<td>-38.9833</td>
<td>-72.2333</td>
<td>1946-03-18</td>
<td>2019-11-10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">373</td>
<td>9405001</td>
<td>Rio Curaco En Colico</td>
<td>-39.0333</td>
<td>-72.0833</td>
<td>1986-10-31</td>
<td>2019-03-27</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">374</td>
<td>9412001</td>
<td>Rio Trancura En Curarrehue</td>
<td>-39.3600</td>
<td>-71.5808</td>
<td>1968-09-01</td>
<td>2020-04-07</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">375</td>
<td>9414001</td>
<td>Rio Trancura Antes Rio Llafenco</td>
<td>-39.3333</td>
<td>-71.7667</td>
<td>1970-10-01</td>
<td>2019-08-31</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">376</td>
<td>9416001</td>
<td>Rio Liucura En Liucura</td>
<td>-39.2561</td>
<td>-71.8244</td>
<td>1971-10-01</td>
<td>2019-04-29</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">377</td>
<td>9420001</td>
<td>Rio Tolten En Villarica</td>
<td>-39.2667</td>
<td>-72.2333</td>
<td>1929-03-05</td>
<td>2020-03-01</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">378</td>
<td>9423001</td>
<td>Rio Tolten En Coipue</td>
<td>-39.1000</td>
<td>-72.3833</td>
<td>1929-12-16</td>
<td>2020-03-25</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">379</td>
<td>9433001</td>
<td>Rio Puyehue En Quitratue</td>
<td>-39.1500</td>
<td>-72.6667</td>
<td>1947-10-07</td>
<td>2019-08-31</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">380</td>
<td>9434001</td>
<td>Rio Donguil En Gorbea</td>
<td>-39.1000</td>
<td>-72.6833</td>
<td>1947-10-06</td>
<td>2019-08-31</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">381</td>
<td>9436001</td>
<td>Rio Mahuidanche En Santa Ana</td>
<td>-39.0833</td>
<td>-72.9333</td>
<td>1987-03-17</td>
<td>2019-04-30</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">382</td>
<td>9437002</td>
<td>Rio Tolten En Teodoro Schmidt</td>
<td>-39.0144</td>
<td>-73.0828</td>
<td>1991-02-12</td>
<td>2020-04-07</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
</section>
</section>
<section id="generation-of-figures-for-climate-indicators-script" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="generation-of-figures-for-climate-indicators-script"><span class="header-section-number">5</span> Generation of figures for climate indicators script</h2>
<p>By default, Climpact generates figures for each calculated indicator at each station. However, the following script provides a general framework for creating customized figures.</p>
<section id="general-framework-for-customized-figures" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="general-framework-for-customized-figures"><span class="header-section-number">5.1</span> General framework for customized figures</h3>
<p>5.1.1. Libraries.</p>
<div id="11c3a1cd" class="cell" data-execution_count="30">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.dates <span class="im">as</span> mdates</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> linregress</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>5.1.2. Base route and output route.</p>
<p>In this case, the figure of the annual accumulated precipitation indicator is generated.</p>
<div id="78873d39" class="cell" data-execution_count="31">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>ruta_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/5.Climpact'</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>ruta_salida_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/6.Figuras_Climpact/Precipitation'</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>os.makedirs(ruta_salida_base, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>subcarpetas <span class="op">=</span> [os.path.join(ruta_base, carpeta) <span class="cf">for</span> carpeta <span class="kw">in</span> os.listdir(ruta_base) <span class="cf">if</span> os.path.isdir(os.path.join(ruta_base, carpeta))]</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> subcarpeta <span class="kw">in</span> subcarpetas:</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    carpeta_indices <span class="op">=</span> os.path.join(subcarpeta, <span class="st">'indices'</span>)</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(carpeta_indices):</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>5.1.3. Selecting the indicator to be graphed.</p>
<p>In this case, the annual total precipitation indicator is used, identified as <code>prcptot</code> in the dataset and therefore with its corresponding station code followed by <code>_prcptot_ANN.csv</code> in its file name. To select a different indicator, simply use the name of the corresponding file that contains the desired variable, for example, <code>_txx_ANN.csv</code> and the <code>txx</code> variable for monthly maximum daily temperature.</p>
<div id="16839a30" class="cell" data-execution_count="32">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>    archivos <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(carpeta_indices) <span class="cf">if</span> f.endswith(<span class="st">'_prcptot_ANN.csv'</span>)]</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> archivo <span class="kw">in</span> archivos:</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>        ruta_archivo <span class="op">=</span> os.path.join(carpeta_indices, archivo)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_csv(ruta_archivo, skiprows<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>        df.columns <span class="op">=</span> df.columns.<span class="bu">str</span>.strip()</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[[<span class="st">'time'</span>, <span class="st">'prcptot'</span>]]</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'time'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'time'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">'%Y'</span>)</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[df[<span class="st">'prcptot'</span>] <span class="op">!=</span> <span class="op">-</span><span class="fl">99.9</span>]</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>        df.set_index(<span class="st">'time'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>5.1.4. Create the figure.</p>
<p>The use of Sen’s slope, the regression line, and the statistical values calculated by the Climpact software have not yet been systematically included in the figure.</p>
<div id="cell-fig-polar-1" class="cell" data-execution_count="33">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, df[<span class="st">'prcptot'</span>], marker<span class="op">=</span><span class="st">'D'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Annual precipitation'</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>        slope, intercept, r_value, p_value, std_err <span class="op">=</span> linregress(mdates.date2num(df.index), df[<span class="st">'prcptot'</span>])</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, intercept <span class="op">+</span> slope <span class="op">*</span> mdates.date2num(df.index), linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Regression line'</span>)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>        plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>        titulo <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>archivo<span class="sc">.</span>split(<span class="st">'_'</span>)[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> Station - Annual precipitation"</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">#plt.title(titulo, fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'Year'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Precipitation (mm)'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_locator(mdates.YearLocator(<span class="dv">5</span>))</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_formatter(mdates.DateFormatter(<span class="st">'%Y'</span>))</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>        plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, fontsize<span class="op">=</span><span class="dv">20</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>        plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>        info_text <span class="op">=</span> (</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Slope: </span><span class="sc">{</span>slope<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Confidence interval: [</span><span class="sc">{</span>intercept <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>intercept <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">]</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"p-value: </span><span class="sc">{</span>p_value<span class="sc">:.3f}</span><span class="ss">"</span></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>        plt.text(<span class="fl">1.1</span>, <span class="fl">0.65</span>, info_text, transform<span class="op">=</span>plt.gca().transAxes, fontsize<span class="op">=</span><span class="dv">14</span>, verticalalignment<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>                 bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>        plt.grid(<span class="va">False</span>)</span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a>        plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.1</span>, <span class="fl">0.4</span>), fontsize<span class="op">=</span><span class="dv">14</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a>        estacion_codigo <span class="op">=</span> archivo.split(<span class="st">'_'</span>)[<span class="dv">0</span>]</span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a>        ruta_salida_estacion <span class="op">=</span> os.path.join(ruta_salida_base, estacion_codigo)</span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a>        os.makedirs(ruta_salida_estacion, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a>        ruta_salida <span class="op">=</span> os.path.join(ruta_salida_estacion, <span class="ss">f"</span><span class="sc">{</span>estacion_codigo<span class="sc">}</span><span class="ss">_prcptot_ANN_plot.png"</span>)</span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a>        plt.savefig(ruta_salida)</span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-36"><a href="#cb45-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb45-37"><a href="#cb45-37" aria-hidden="true" tabindex="-1"></a>            plt.show()</span>
<span id="cb45-38"><a href="#cb45-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb45-39"><a href="#cb45-39" aria-hidden="true" tabindex="-1"></a>            plt.close()</span>
<span id="cb45-40"><a href="#cb45-40" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb45-41"><a href="#cb45-41" aria-hidden="true" tabindex="-1"></a>        contador <span class="op">+=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-polar-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-polar-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="indicadores_files/figure-html/fig-polar-1-output-1.png" width="1072" height="717" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-polar-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Indicator of total accumulated precipitation at station 9434001
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="suggested-precipitation-indicators-and-their-figures" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="suggested-precipitation-indicators-and-their-figures"><span class="header-section-number">5.2</span> Suggested precipitation indicators and their figures</h3>
<p>5.2.1. Precipitation intensity (sdii).</p>
<p>Annual total precipitation divided by the number of wet days (when total precipitation &gt;= 1.0 mm) is now graphed for each station.</p>
<div id="cell-fig-polar-2" class="cell" data-execution_count="34">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>ruta_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/5.Climpact'</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>ruta_salida_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/6.Figuras_Climpact/Precipitation'</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>os.makedirs(ruta_salida_base, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>subcarpetas <span class="op">=</span> [os.path.join(ruta_base, carpeta) <span class="cf">for</span> carpeta <span class="kw">in</span> os.listdir(ruta_base) <span class="cf">if</span> os.path.isdir(os.path.join(ruta_base, carpeta))]</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> subcarpeta <span class="kw">in</span> subcarpetas:</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    carpeta_indices <span class="op">=</span> os.path.join(subcarpeta, <span class="st">'indices'</span>)</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(carpeta_indices):</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>    archivos <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(carpeta_indices) <span class="cf">if</span> f.endswith(<span class="st">'_sdii_ANN.csv'</span>)]</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> archivo <span class="kw">in</span> archivos:</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>        ruta_archivo <span class="op">=</span> os.path.join(carpeta_indices, archivo)</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_csv(ruta_archivo, skiprows<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>        df.columns <span class="op">=</span> df.columns.<span class="bu">str</span>.strip()</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[[<span class="st">'time'</span>, <span class="st">'sdii'</span>]]</span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'time'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'time'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">'%Y'</span>)</span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[df[<span class="st">'sdii'</span>] <span class="op">!=</span> <span class="op">-</span><span class="fl">99.9</span>]</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>        df.set_index(<span class="st">'time'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, df[<span class="st">'sdii'</span>], marker<span class="op">=</span><span class="st">'D'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Precipitation intensity'</span>)</span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a>        slope, intercept, r_value, p_value, std_err <span class="op">=</span> linregress(mdates.date2num(df.index), df[<span class="st">'sdii'</span>])</span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, intercept <span class="op">+</span> slope <span class="op">*</span> mdates.date2num(df.index), linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Regression line'</span>)</span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a>        plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a>        titulo <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>archivo<span class="sc">.</span>split(<span class="st">'_'</span>)[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> Station - Precipitation intensity"</span></span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a>        <span class="co">#plt.title(titulo, fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb46-34"><a href="#cb46-34" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'Year'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb46-35"><a href="#cb46-35" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Precipitation (mm)'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb46-36"><a href="#cb46-36" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_locator(mdates.YearLocator(<span class="dv">5</span>))</span>
<span id="cb46-37"><a href="#cb46-37" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_formatter(mdates.DateFormatter(<span class="st">'%Y'</span>))</span>
<span id="cb46-38"><a href="#cb46-38" aria-hidden="true" tabindex="-1"></a>        plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, fontsize<span class="op">=</span><span class="dv">20</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb46-39"><a href="#cb46-39" aria-hidden="true" tabindex="-1"></a>        plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb46-40"><a href="#cb46-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-41"><a href="#cb46-41" aria-hidden="true" tabindex="-1"></a>        info_text <span class="op">=</span> (</span>
<span id="cb46-42"><a href="#cb46-42" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Slope: </span><span class="sc">{</span>slope<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb46-43"><a href="#cb46-43" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Confidence interval: [</span><span class="sc">{</span>intercept <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>intercept <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">]</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb46-44"><a href="#cb46-44" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"p-value: </span><span class="sc">{</span>p_value<span class="sc">:.3f}</span><span class="ss">"</span></span>
<span id="cb46-45"><a href="#cb46-45" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb46-46"><a href="#cb46-46" aria-hidden="true" tabindex="-1"></a>        plt.text(<span class="fl">1.1</span>, <span class="fl">0.65</span>, info_text, transform<span class="op">=</span>plt.gca().transAxes, fontsize<span class="op">=</span><span class="dv">14</span>, verticalalignment<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb46-47"><a href="#cb46-47" aria-hidden="true" tabindex="-1"></a>                 bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb46-48"><a href="#cb46-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-49"><a href="#cb46-49" aria-hidden="true" tabindex="-1"></a>        plt.grid(<span class="va">False</span>)</span>
<span id="cb46-50"><a href="#cb46-50" aria-hidden="true" tabindex="-1"></a>        plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.1</span>, <span class="fl">0.4</span>), fontsize<span class="op">=</span><span class="dv">14</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb46-51"><a href="#cb46-51" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb46-52"><a href="#cb46-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-53"><a href="#cb46-53" aria-hidden="true" tabindex="-1"></a>        estacion_codigo <span class="op">=</span> archivo.split(<span class="st">'_'</span>)[<span class="dv">0</span>]</span>
<span id="cb46-54"><a href="#cb46-54" aria-hidden="true" tabindex="-1"></a>        ruta_salida_estacion <span class="op">=</span> os.path.join(ruta_salida_base, estacion_codigo)</span>
<span id="cb46-55"><a href="#cb46-55" aria-hidden="true" tabindex="-1"></a>        os.makedirs(ruta_salida_estacion, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb46-56"><a href="#cb46-56" aria-hidden="true" tabindex="-1"></a>        ruta_salida <span class="op">=</span> os.path.join(ruta_salida_estacion, <span class="ss">f"</span><span class="sc">{</span>estacion_codigo<span class="sc">}</span><span class="ss">_sdii_ANN_plot.png"</span>)</span>
<span id="cb46-57"><a href="#cb46-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-58"><a href="#cb46-58" aria-hidden="true" tabindex="-1"></a>        plt.savefig(ruta_salida)</span>
<span id="cb46-59"><a href="#cb46-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-60"><a href="#cb46-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb46-61"><a href="#cb46-61" aria-hidden="true" tabindex="-1"></a>            plt.show()</span>
<span id="cb46-62"><a href="#cb46-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb46-63"><a href="#cb46-63" aria-hidden="true" tabindex="-1"></a>            plt.close()</span>
<span id="cb46-64"><a href="#cb46-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-65"><a href="#cb46-65" aria-hidden="true" tabindex="-1"></a>        contador <span class="op">+=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-polar-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-polar-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="indicadores_files/figure-html/fig-polar-2-output-1.png" width="1077" height="717" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-polar-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Indicator of precipitation intensity at station 9423001
</figcaption>
</figure>
</div>
</div>
</div>
<p>5.2.2. Anual accumulated precipitation (prcptot).</p>
<p>Annual sum of daily precipitation &gt;= 1.0 mm is now graphed for each station. This was already calculated above.</p>
<div id="cell-fig-polar-3" class="cell" data-execution_count="35">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>ruta_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/5.Climpact'</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>ruta_salida_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/6.Figuras_Climpact/Precipitation'</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>os.makedirs(ruta_salida_base, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>subcarpetas <span class="op">=</span> [os.path.join(ruta_base, carpeta) <span class="cf">for</span> carpeta <span class="kw">in</span> os.listdir(ruta_base) <span class="cf">if</span> os.path.isdir(os.path.join(ruta_base, carpeta))]</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> subcarpeta <span class="kw">in</span> subcarpetas:</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>    carpeta_indices <span class="op">=</span> os.path.join(subcarpeta, <span class="st">'indices'</span>)</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(carpeta_indices):</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>    archivos <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(carpeta_indices) <span class="cf">if</span> f.endswith(<span class="st">'_prcptot_ANN.csv'</span>)]</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> archivo <span class="kw">in</span> archivos:</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>        ruta_archivo <span class="op">=</span> os.path.join(carpeta_indices, archivo)</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_csv(ruta_archivo, skiprows<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>        df.columns <span class="op">=</span> df.columns.<span class="bu">str</span>.strip()</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[[<span class="st">'time'</span>, <span class="st">'prcptot'</span>]]</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'time'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'time'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">'%Y'</span>)</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[df[<span class="st">'prcptot'</span>] <span class="op">!=</span> <span class="op">-</span><span class="fl">99.9</span>]</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>        df.set_index(<span class="st">'time'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, df[<span class="st">'prcptot'</span>], marker<span class="op">=</span><span class="st">'D'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Total Precipitation'</span>)</span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>        slope, intercept, r_value, p_value, std_err <span class="op">=</span> linregress(mdates.date2num(df.index), df[<span class="st">'prcptot'</span>])</span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, intercept <span class="op">+</span> slope <span class="op">*</span> mdates.date2num(df.index), linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Regression line'</span>)</span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a>        plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>        titulo <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>archivo<span class="sc">.</span>split(<span class="st">'_'</span>)[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> Station - Anual precipitation"</span></span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a>        <span class="co">#plt.title(titulo, fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'Year'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Precipitation (mm)'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_locator(mdates.YearLocator(<span class="dv">5</span>))</span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_formatter(mdates.DateFormatter(<span class="st">'%Y'</span>))</span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a>        plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, fontsize<span class="op">=</span><span class="dv">20</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a>        plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb47-40"><a href="#cb47-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-41"><a href="#cb47-41" aria-hidden="true" tabindex="-1"></a>        info_text <span class="op">=</span> (</span>
<span id="cb47-42"><a href="#cb47-42" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Slope: </span><span class="sc">{</span>slope<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb47-43"><a href="#cb47-43" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Confidence interval: [</span><span class="sc">{</span>intercept <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>intercept <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">]</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb47-44"><a href="#cb47-44" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"p-value: </span><span class="sc">{</span>p_value<span class="sc">:.3f}</span><span class="ss">"</span></span>
<span id="cb47-45"><a href="#cb47-45" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb47-46"><a href="#cb47-46" aria-hidden="true" tabindex="-1"></a>        plt.text(<span class="fl">1.1</span>, <span class="fl">0.65</span>, info_text, transform<span class="op">=</span>plt.gca().transAxes, fontsize<span class="op">=</span><span class="dv">14</span>, verticalalignment<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb47-47"><a href="#cb47-47" aria-hidden="true" tabindex="-1"></a>                 bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb47-48"><a href="#cb47-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-49"><a href="#cb47-49" aria-hidden="true" tabindex="-1"></a>        plt.grid(<span class="va">False</span>)</span>
<span id="cb47-50"><a href="#cb47-50" aria-hidden="true" tabindex="-1"></a>        plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.1</span>, <span class="fl">0.4</span>), fontsize<span class="op">=</span><span class="dv">14</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb47-51"><a href="#cb47-51" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb47-52"><a href="#cb47-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-53"><a href="#cb47-53" aria-hidden="true" tabindex="-1"></a>        estacion_codigo <span class="op">=</span> archivo.split(<span class="st">'_'</span>)[<span class="dv">0</span>]</span>
<span id="cb47-54"><a href="#cb47-54" aria-hidden="true" tabindex="-1"></a>        ruta_salida_estacion <span class="op">=</span> os.path.join(ruta_salida_base, estacion_codigo)</span>
<span id="cb47-55"><a href="#cb47-55" aria-hidden="true" tabindex="-1"></a>        os.makedirs(ruta_salida_estacion, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb47-56"><a href="#cb47-56" aria-hidden="true" tabindex="-1"></a>        ruta_salida <span class="op">=</span> os.path.join(ruta_salida_estacion, <span class="ss">f"</span><span class="sc">{</span>estacion_codigo<span class="sc">}</span><span class="ss">_prcptot_ANN_plot.png"</span>)</span>
<span id="cb47-57"><a href="#cb47-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-58"><a href="#cb47-58" aria-hidden="true" tabindex="-1"></a>        plt.savefig(ruta_salida)</span>
<span id="cb47-59"><a href="#cb47-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-60"><a href="#cb47-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb47-61"><a href="#cb47-61" aria-hidden="true" tabindex="-1"></a>            plt.show()</span>
<span id="cb47-62"><a href="#cb47-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb47-63"><a href="#cb47-63" aria-hidden="true" tabindex="-1"></a>            plt.close()</span>
<span id="cb47-64"><a href="#cb47-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-65"><a href="#cb47-65" aria-hidden="true" tabindex="-1"></a>        contador <span class="op">+=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-polar-3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-polar-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="indicadores_files/figure-html/fig-polar-3-output-1.png" width="1072" height="717" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-polar-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Indicator of total accumulated precipitation at station 9423001
</figcaption>
</figure>
</div>
</div>
</div>
<p>5.2.3. Consecutive dry days (cdd).</p>
<p>Maximum annual number of consecutive dry days (when precipitation &lt; 1.0 mm).</p>
<div id="cell-fig-polar-4" class="cell" data-execution_count="36">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>ruta_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/5.Climpact'</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>ruta_salida_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/6.Figuras_Climpact/Precipitation'</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>os.makedirs(ruta_salida_base, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>subcarpetas <span class="op">=</span> [os.path.join(ruta_base, carpeta) <span class="cf">for</span> carpeta <span class="kw">in</span> os.listdir(ruta_base) <span class="cf">if</span> os.path.isdir(os.path.join(ruta_base, carpeta))]</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> subcarpeta <span class="kw">in</span> subcarpetas:</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>    carpeta_indices <span class="op">=</span> os.path.join(subcarpeta, <span class="st">'indices'</span>)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(carpeta_indices):</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>    archivos <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(carpeta_indices) <span class="cf">if</span> f.endswith(<span class="st">'_cdd_ANN.csv'</span>)]</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> archivo <span class="kw">in</span> archivos:</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>        ruta_archivo <span class="op">=</span> os.path.join(carpeta_indices, archivo)</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_csv(ruta_archivo, skiprows<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>        df.columns <span class="op">=</span> df.columns.<span class="bu">str</span>.strip()</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[[<span class="st">'time'</span>, <span class="st">'cdd'</span>]]</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'time'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'time'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">'%Y'</span>)</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[df[<span class="st">'cdd'</span>] <span class="op">!=</span> <span class="op">-</span><span class="fl">99.9</span>]</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>        df.set_index(<span class="st">'time'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, df[<span class="st">'cdd'</span>], marker<span class="op">=</span><span class="st">'D'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Dry days'</span>)</span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>        slope, intercept, r_value, p_value, std_err <span class="op">=</span> linregress(mdates.date2num(df.index), df[<span class="st">'cdd'</span>])</span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, intercept <span class="op">+</span> slope <span class="op">*</span> mdates.date2num(df.index), linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Regression line'</span>)</span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>        plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>        titulo <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>archivo<span class="sc">.</span>split(<span class="st">'_'</span>)[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> Station - Consecutive dry days"</span></span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a>        <span class="co">#plt.title(titulo, fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'Year'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Days'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_locator(mdates.YearLocator(<span class="dv">5</span>))</span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_formatter(mdates.DateFormatter(<span class="st">'%Y'</span>))</span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a>        plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, fontsize<span class="op">=</span><span class="dv">20</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a>        plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a>        info_text <span class="op">=</span> (</span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Slope: </span><span class="sc">{</span>slope<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Confidence interval: [</span><span class="sc">{</span>intercept <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>intercept <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">]</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"p-value: </span><span class="sc">{</span>p_value<span class="sc">:.3f}</span><span class="ss">"</span></span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb48-46"><a href="#cb48-46" aria-hidden="true" tabindex="-1"></a>        plt.text(<span class="fl">1.1</span>, <span class="fl">0.65</span>, info_text, transform<span class="op">=</span>plt.gca().transAxes, fontsize<span class="op">=</span><span class="dv">14</span>, verticalalignment<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb48-47"><a href="#cb48-47" aria-hidden="true" tabindex="-1"></a>                 bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb48-48"><a href="#cb48-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-49"><a href="#cb48-49" aria-hidden="true" tabindex="-1"></a>        plt.grid(<span class="va">False</span>)</span>
<span id="cb48-50"><a href="#cb48-50" aria-hidden="true" tabindex="-1"></a>        plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.1</span>, <span class="fl">0.4</span>), fontsize<span class="op">=</span><span class="dv">14</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb48-51"><a href="#cb48-51" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb48-52"><a href="#cb48-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-53"><a href="#cb48-53" aria-hidden="true" tabindex="-1"></a>        estacion_codigo <span class="op">=</span> archivo.split(<span class="st">'_'</span>)[<span class="dv">0</span>]</span>
<span id="cb48-54"><a href="#cb48-54" aria-hidden="true" tabindex="-1"></a>        ruta_salida_estacion <span class="op">=</span> os.path.join(ruta_salida_base, estacion_codigo)</span>
<span id="cb48-55"><a href="#cb48-55" aria-hidden="true" tabindex="-1"></a>        os.makedirs(ruta_salida_estacion, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb48-56"><a href="#cb48-56" aria-hidden="true" tabindex="-1"></a>        ruta_salida <span class="op">=</span> os.path.join(ruta_salida_estacion, <span class="ss">f"</span><span class="sc">{</span>estacion_codigo<span class="sc">}</span><span class="ss">_cdd_ANN_plot.png"</span>)</span>
<span id="cb48-57"><a href="#cb48-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-58"><a href="#cb48-58" aria-hidden="true" tabindex="-1"></a>        plt.savefig(ruta_salida)</span>
<span id="cb48-59"><a href="#cb48-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-60"><a href="#cb48-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb48-61"><a href="#cb48-61" aria-hidden="true" tabindex="-1"></a>            plt.show()</span>
<span id="cb48-62"><a href="#cb48-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb48-63"><a href="#cb48-63" aria-hidden="true" tabindex="-1"></a>            plt.close()</span>
<span id="cb48-64"><a href="#cb48-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-65"><a href="#cb48-65" aria-hidden="true" tabindex="-1"></a>        contador <span class="op">+=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-polar-4" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-polar-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="indicadores_files/figure-html/fig-polar-4-output-1.png" width="1078" height="717" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-polar-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Indicator of consecutive dry days at station 9423001
</figcaption>
</figure>
</div>
</div>
</div>
<p>5.2.4. Days with precipitation greater than 30mm (r30mm).</p>
<p>Number of days when precipitation &gt;= 30mm.</p>
<div id="cell-fig-polar-5" class="cell" data-execution_count="37">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>ruta_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/5.Climpact'</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>ruta_salida_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/6.Figuras_Climpact/Precipitation'</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>os.makedirs(ruta_salida_base, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>subcarpetas <span class="op">=</span> [os.path.join(ruta_base, carpeta) <span class="cf">for</span> carpeta <span class="kw">in</span> os.listdir(ruta_base) <span class="cf">if</span> os.path.isdir(os.path.join(ruta_base, carpeta))]</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> subcarpeta <span class="kw">in</span> subcarpetas:</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>    carpeta_indices <span class="op">=</span> os.path.join(subcarpeta, <span class="st">'indices'</span>)</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(carpeta_indices):</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>    archivos <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(carpeta_indices) <span class="cf">if</span> f.endswith(<span class="st">'_r30mm_ANN.csv'</span>)]</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> archivo <span class="kw">in</span> archivos:</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>        ruta_archivo <span class="op">=</span> os.path.join(carpeta_indices, archivo)</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_csv(ruta_archivo, skiprows<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>        df.columns <span class="op">=</span> df.columns.<span class="bu">str</span>.strip()</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[[<span class="st">'time'</span>, <span class="st">'r30mm'</span>]]</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'time'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'time'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">'%Y'</span>)</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[df[<span class="st">'r30mm'</span>] <span class="op">!=</span> <span class="op">-</span><span class="fl">99.9</span>]</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>        df.set_index(<span class="st">'time'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, df[<span class="st">'r30mm'</span>], marker<span class="op">=</span><span class="st">'D'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Dry days'</span>)</span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a>        slope, intercept, r_value, p_value, std_err <span class="op">=</span> linregress(mdates.date2num(df.index), df[<span class="st">'r30mm'</span>])</span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, intercept <span class="op">+</span> slope <span class="op">*</span> mdates.date2num(df.index), linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Regression line'</span>)</span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a>        plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a>        titulo <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>archivo<span class="sc">.</span>split(<span class="st">'_'</span>)[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> Station - Precipitation &gt;= 30mm"</span></span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a>        <span class="co">#plt.title(titulo, fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'Year'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Days'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_locator(mdates.YearLocator(<span class="dv">5</span>))</span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_formatter(mdates.DateFormatter(<span class="st">'%Y'</span>))</span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a>        plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, fontsize<span class="op">=</span><span class="dv">20</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true" tabindex="-1"></a>        plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb49-40"><a href="#cb49-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-41"><a href="#cb49-41" aria-hidden="true" tabindex="-1"></a>        info_text <span class="op">=</span> (</span>
<span id="cb49-42"><a href="#cb49-42" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Slope: </span><span class="sc">{</span>slope<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb49-43"><a href="#cb49-43" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Confidence interval: [</span><span class="sc">{</span>intercept <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>intercept <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">]</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb49-44"><a href="#cb49-44" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"p-value: </span><span class="sc">{</span>p_value<span class="sc">:.3f}</span><span class="ss">"</span></span>
<span id="cb49-45"><a href="#cb49-45" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb49-46"><a href="#cb49-46" aria-hidden="true" tabindex="-1"></a>        plt.text(<span class="fl">1.1</span>, <span class="fl">0.65</span>, info_text, transform<span class="op">=</span>plt.gca().transAxes, fontsize<span class="op">=</span><span class="dv">14</span>, verticalalignment<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb49-47"><a href="#cb49-47" aria-hidden="true" tabindex="-1"></a>                 bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb49-48"><a href="#cb49-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-49"><a href="#cb49-49" aria-hidden="true" tabindex="-1"></a>        plt.grid(<span class="va">False</span>)</span>
<span id="cb49-50"><a href="#cb49-50" aria-hidden="true" tabindex="-1"></a>        plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.1</span>, <span class="fl">0.4</span>), fontsize<span class="op">=</span><span class="dv">14</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb49-51"><a href="#cb49-51" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb49-52"><a href="#cb49-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-53"><a href="#cb49-53" aria-hidden="true" tabindex="-1"></a>        estacion_codigo <span class="op">=</span> archivo.split(<span class="st">'_'</span>)[<span class="dv">0</span>]</span>
<span id="cb49-54"><a href="#cb49-54" aria-hidden="true" tabindex="-1"></a>        ruta_salida_estacion <span class="op">=</span> os.path.join(ruta_salida_base, estacion_codigo)</span>
<span id="cb49-55"><a href="#cb49-55" aria-hidden="true" tabindex="-1"></a>        os.makedirs(ruta_salida_estacion, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb49-56"><a href="#cb49-56" aria-hidden="true" tabindex="-1"></a>        ruta_salida <span class="op">=</span> os.path.join(ruta_salida_estacion, <span class="ss">f"</span><span class="sc">{</span>estacion_codigo<span class="sc">}</span><span class="ss">_r30mm_ANN_plot.png"</span>)</span>
<span id="cb49-57"><a href="#cb49-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-58"><a href="#cb49-58" aria-hidden="true" tabindex="-1"></a>        plt.savefig(ruta_salida)</span>
<span id="cb49-59"><a href="#cb49-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-60"><a href="#cb49-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb49-61"><a href="#cb49-61" aria-hidden="true" tabindex="-1"></a>            plt.show()</span>
<span id="cb49-62"><a href="#cb49-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb49-63"><a href="#cb49-63" aria-hidden="true" tabindex="-1"></a>            plt.close()</span>
<span id="cb49-64"><a href="#cb49-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-65"><a href="#cb49-65" aria-hidden="true" tabindex="-1"></a>        contador <span class="op">+=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-polar-5" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-polar-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="indicadores_files/figure-html/fig-polar-5-output-1.png" width="1079" height="717" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-polar-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Indicator of days with precipitation greater than 30 mm at station 9423001
</figcaption>
</figure>
</div>
</div>
</div>
<p>5.2.5. Standardised Precipitation Evapotranspiration Index (SPEI)</p>
<p>This indicator estimates water balance using precipitation and temperature information. It provides a drought indicator. In this case, it is graphed on a 24-month scale. Due to the monthly scale of the indicator, the code has slight adjustments.</p>
<div id="cell-fig-polar-6" class="cell" data-execution_count="38">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>ruta_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/5.Climpact'</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>ruta_salida_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/6.Figuras_Climpact/Precipitation'</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>os.makedirs(ruta_salida_base, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>subcarpetas <span class="op">=</span> [os.path.join(ruta_base, carpeta) <span class="cf">for</span> carpeta <span class="kw">in</span> os.listdir(ruta_base) <span class="cf">if</span> os.path.isdir(os.path.join(ruta_base, carpeta))]</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> subcarpeta <span class="kw">in</span> subcarpetas:</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>    carpeta_indices <span class="op">=</span> os.path.join(subcarpeta, <span class="st">'indices'</span>)</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(carpeta_indices):</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>    archivos <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(carpeta_indices) <span class="cf">if</span> f.endswith(<span class="st">'_24month_spei_MON.csv'</span>)]</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> archivo <span class="kw">in</span> archivos:</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>        ruta_archivo <span class="op">=</span> os.path.join(carpeta_indices, archivo)</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_csv(ruta_archivo, skiprows<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>        df.columns <span class="op">=</span> df.columns.<span class="bu">str</span>.strip()</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[[<span class="st">'time'</span>, <span class="st">'spei'</span>]]</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'time'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'time'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">'%Y-%m'</span>)</span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[df[<span class="st">'spei'</span>] <span class="op">!=</span> <span class="op">-</span><span class="fl">99.9</span>]</span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>        df.set_index(<span class="st">'time'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a>        df_pos <span class="op">=</span> df[df[<span class="st">'spei'</span>] <span class="op">&gt;=</span> <span class="dv">0</span>]</span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a>        df_neg <span class="op">=</span> df[df[<span class="st">'spei'</span>] <span class="op">&lt;</span> <span class="dv">0</span>]</span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, df[<span class="st">'spei'</span>], linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'SPEI'</span>)</span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a>        plt.plot(df_pos.index, df_pos[<span class="st">'spei'</span>], marker<span class="op">=</span><span class="st">'o'</span>, linestyle<span class="op">=</span><span class="st">'None'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'SPEI ≥ 0'</span>)</span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a>        plt.plot(df_neg.index, df_neg[<span class="st">'spei'</span>], marker<span class="op">=</span><span class="st">'o'</span>, linestyle<span class="op">=</span><span class="st">'None'</span>, color<span class="op">=</span><span class="st">'gray'</span>, label<span class="op">=</span><span class="st">'SPEI &lt; 0'</span>)</span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a>        slope, intercept, r_value, p_value, std_err <span class="op">=</span> linregress(mdates.date2num(df.index), df[<span class="st">'spei'</span>])</span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, intercept <span class="op">+</span> slope <span class="op">*</span> mdates.date2num(df.index), linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Regression line'</span>)</span>
<span id="cb50-40"><a href="#cb50-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-41"><a href="#cb50-41" aria-hidden="true" tabindex="-1"></a>        plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb50-42"><a href="#cb50-42" aria-hidden="true" tabindex="-1"></a>        titulo <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>archivo<span class="sc">.</span>split(<span class="st">'_'</span>)[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> Station - SPEI compared to the last 24 months"</span></span>
<span id="cb50-43"><a href="#cb50-43" aria-hidden="true" tabindex="-1"></a>        <span class="co">#plt.title(titulo, fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb50-44"><a href="#cb50-44" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'Year'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb50-45"><a href="#cb50-45" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'SPEI'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb50-46"><a href="#cb50-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-47"><a href="#cb50-47" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_locator(mdates.YearLocator(<span class="dv">5</span>))</span>
<span id="cb50-48"><a href="#cb50-48" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_formatter(mdates.DateFormatter(<span class="st">'%Y'</span>))</span>
<span id="cb50-49"><a href="#cb50-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-50"><a href="#cb50-50" aria-hidden="true" tabindex="-1"></a>        plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, fontsize<span class="op">=</span><span class="dv">20</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb50-51"><a href="#cb50-51" aria-hidden="true" tabindex="-1"></a>        plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb50-52"><a href="#cb50-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-53"><a href="#cb50-53" aria-hidden="true" tabindex="-1"></a>        info_text <span class="op">=</span> (</span>
<span id="cb50-54"><a href="#cb50-54" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Slope: </span><span class="sc">{</span>slope<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb50-55"><a href="#cb50-55" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Confidence interval: [</span><span class="sc">{</span>intercept <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>intercept <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">]</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb50-56"><a href="#cb50-56" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"p-value: </span><span class="sc">{</span>p_value<span class="sc">:.3f}</span><span class="ss">"</span></span>
<span id="cb50-57"><a href="#cb50-57" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb50-58"><a href="#cb50-58" aria-hidden="true" tabindex="-1"></a>        plt.text(<span class="fl">1.1</span>, <span class="fl">0.65</span>, info_text, transform<span class="op">=</span>plt.gca().transAxes, fontsize<span class="op">=</span><span class="dv">14</span>, verticalalignment<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb50-59"><a href="#cb50-59" aria-hidden="true" tabindex="-1"></a>                 bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb50-60"><a href="#cb50-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-61"><a href="#cb50-61" aria-hidden="true" tabindex="-1"></a>        plt.grid(<span class="va">False</span>)</span>
<span id="cb50-62"><a href="#cb50-62" aria-hidden="true" tabindex="-1"></a>        plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.1</span>, <span class="fl">0.4</span>), fontsize<span class="op">=</span><span class="dv">14</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb50-63"><a href="#cb50-63" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb50-64"><a href="#cb50-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-65"><a href="#cb50-65" aria-hidden="true" tabindex="-1"></a>        estacion_codigo <span class="op">=</span> archivo.split(<span class="st">'_'</span>)[<span class="dv">0</span>]</span>
<span id="cb50-66"><a href="#cb50-66" aria-hidden="true" tabindex="-1"></a>        ruta_salida_estacion <span class="op">=</span> os.path.join(ruta_salida_base, estacion_codigo)</span>
<span id="cb50-67"><a href="#cb50-67" aria-hidden="true" tabindex="-1"></a>        os.makedirs(ruta_salida_estacion, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb50-68"><a href="#cb50-68" aria-hidden="true" tabindex="-1"></a>        ruta_salida <span class="op">=</span> os.path.join(ruta_salida_estacion, <span class="ss">f"</span><span class="sc">{</span>estacion_codigo<span class="sc">}</span><span class="ss">_spei24_MON_plot.png"</span>)</span>
<span id="cb50-69"><a href="#cb50-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-70"><a href="#cb50-70" aria-hidden="true" tabindex="-1"></a>        plt.savefig(ruta_salida)</span>
<span id="cb50-71"><a href="#cb50-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-72"><a href="#cb50-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb50-73"><a href="#cb50-73" aria-hidden="true" tabindex="-1"></a>            plt.show()</span>
<span id="cb50-74"><a href="#cb50-74" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb50-75"><a href="#cb50-75" aria-hidden="true" tabindex="-1"></a>            plt.close()</span>
<span id="cb50-76"><a href="#cb50-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-77"><a href="#cb50-77" aria-hidden="true" tabindex="-1"></a>        contador <span class="op">+=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-polar-6" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-polar-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="indicadores_files/figure-html/fig-polar-6-output-1.png" width="1078" height="717" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-polar-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Indicator of Standardised Precipitation Evapotrasnpiration Index at station 9423001
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="suggested-temperature-indicators-and-their-figures" class="level3" data-number="5.3">
<h3 data-number="5.3" class="anchored" data-anchor-id="suggested-temperature-indicators-and-their-figures"><span class="header-section-number">5.3</span> Suggested temperature indicators and their figures</h3>
<p>5.3.1. Annual mean daily minimum temperature (tnm).</p>
<div id="cell-fig-polar-7" class="cell" data-execution_count="39">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>ruta_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/5.Climpact'</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>ruta_salida_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/6.Figuras_Climpact/Temperature'</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>os.makedirs(ruta_salida_base, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>subcarpetas <span class="op">=</span> [os.path.join(ruta_base, carpeta) <span class="cf">for</span> carpeta <span class="kw">in</span> os.listdir(ruta_base) <span class="cf">if</span> os.path.isdir(os.path.join(ruta_base, carpeta))]</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> subcarpeta <span class="kw">in</span> subcarpetas:</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>    carpeta_indices <span class="op">=</span> os.path.join(subcarpeta, <span class="st">'indices'</span>)</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(carpeta_indices):</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>    archivos <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(carpeta_indices) <span class="cf">if</span> f.endswith(<span class="st">'_tnm_ANN.csv'</span>)]</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> archivo <span class="kw">in</span> archivos:</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>        ruta_archivo <span class="op">=</span> os.path.join(carpeta_indices, archivo)</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_csv(ruta_archivo, skiprows<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>        df.columns <span class="op">=</span> df.columns.<span class="bu">str</span>.strip()</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[[<span class="st">'time'</span>, <span class="st">'tnm'</span>]]</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'time'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'time'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">'%Y'</span>)</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[df[<span class="st">'tnm'</span>] <span class="op">!=</span> <span class="op">-</span><span class="fl">99.9</span>]</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>        df.set_index(<span class="st">'time'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, df[<span class="st">'tnm'</span>], marker<span class="op">=</span><span class="st">'D'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Temperature'</span>)</span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>        slope, intercept, r_value, p_value, std_err <span class="op">=</span> linregress(mdates.date2num(df.index), df[<span class="st">'tnm'</span>])</span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, intercept <span class="op">+</span> slope <span class="op">*</span> mdates.date2num(df.index), linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Regression line'</span>)</span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a>        plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a>        titulo <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>archivo<span class="sc">.</span>split(<span class="st">'_'</span>)[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> Station - Annual mean daily minimum temperature"</span></span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a>        <span class="co">#plt.title(titulo, fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'Year'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb51-35"><a href="#cb51-35" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Temperature (ºC)'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb51-36"><a href="#cb51-36" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_locator(mdates.YearLocator(<span class="dv">5</span>))</span>
<span id="cb51-37"><a href="#cb51-37" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_formatter(mdates.DateFormatter(<span class="st">'%Y'</span>))</span>
<span id="cb51-38"><a href="#cb51-38" aria-hidden="true" tabindex="-1"></a>        plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, fontsize<span class="op">=</span><span class="dv">20</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb51-39"><a href="#cb51-39" aria-hidden="true" tabindex="-1"></a>        plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb51-40"><a href="#cb51-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-41"><a href="#cb51-41" aria-hidden="true" tabindex="-1"></a>        info_text <span class="op">=</span> (</span>
<span id="cb51-42"><a href="#cb51-42" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Slope: </span><span class="sc">{</span>slope<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb51-43"><a href="#cb51-43" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Confidence interval: [</span><span class="sc">{</span>intercept <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>intercept <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">]</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb51-44"><a href="#cb51-44" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"p-value: </span><span class="sc">{</span>p_value<span class="sc">:.3f}</span><span class="ss">"</span></span>
<span id="cb51-45"><a href="#cb51-45" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb51-46"><a href="#cb51-46" aria-hidden="true" tabindex="-1"></a>        plt.text(<span class="fl">1.1</span>, <span class="fl">0.65</span>, info_text, transform<span class="op">=</span>plt.gca().transAxes, fontsize<span class="op">=</span><span class="dv">14</span>, verticalalignment<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb51-47"><a href="#cb51-47" aria-hidden="true" tabindex="-1"></a>                 bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb51-48"><a href="#cb51-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-49"><a href="#cb51-49" aria-hidden="true" tabindex="-1"></a>        plt.grid(<span class="va">False</span>)</span>
<span id="cb51-50"><a href="#cb51-50" aria-hidden="true" tabindex="-1"></a>        plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.4</span>, <span class="fl">0.4</span>), fontsize<span class="op">=</span><span class="dv">14</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb51-51"><a href="#cb51-51" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb51-52"><a href="#cb51-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-53"><a href="#cb51-53" aria-hidden="true" tabindex="-1"></a>        estacion_codigo <span class="op">=</span> archivo.split(<span class="st">'_'</span>)[<span class="dv">0</span>]</span>
<span id="cb51-54"><a href="#cb51-54" aria-hidden="true" tabindex="-1"></a>        ruta_salida_estacion <span class="op">=</span> os.path.join(ruta_salida_base, estacion_codigo)</span>
<span id="cb51-55"><a href="#cb51-55" aria-hidden="true" tabindex="-1"></a>        os.makedirs(ruta_salida_estacion, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb51-56"><a href="#cb51-56" aria-hidden="true" tabindex="-1"></a>        ruta_salida <span class="op">=</span> os.path.join(ruta_salida_estacion, <span class="ss">f"</span><span class="sc">{</span>estacion_codigo<span class="sc">}</span><span class="ss">_tnm_ANN_plot.png"</span>)</span>
<span id="cb51-57"><a href="#cb51-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-58"><a href="#cb51-58" aria-hidden="true" tabindex="-1"></a>        plt.savefig(ruta_salida)</span>
<span id="cb51-59"><a href="#cb51-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-60"><a href="#cb51-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb51-61"><a href="#cb51-61" aria-hidden="true" tabindex="-1"></a>            plt.show()</span>
<span id="cb51-62"><a href="#cb51-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb51-63"><a href="#cb51-63" aria-hidden="true" tabindex="-1"></a>            plt.close()</span>
<span id="cb51-64"><a href="#cb51-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-65"><a href="#cb51-65" aria-hidden="true" tabindex="-1"></a>        contador <span class="op">+=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-polar-7" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-polar-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="indicadores_files/figure-html/fig-polar-7-output-1.png" width="1064" height="717" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-polar-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Indicator of annual mean daily minimum temperature at station 9423001
</figcaption>
</figure>
</div>
</div>
</div>
<p>5.3.2. Annual mean daily maximum temperature (txm).</p>
<div id="cell-fig-polar-8" class="cell" data-execution_count="40">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>ruta_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/5.Climpact'</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>ruta_salida_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/6.Figuras_Climpact/Temperature'</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>os.makedirs(ruta_salida_base, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>subcarpetas <span class="op">=</span> [os.path.join(ruta_base, carpeta) <span class="cf">for</span> carpeta <span class="kw">in</span> os.listdir(ruta_base) <span class="cf">if</span> os.path.isdir(os.path.join(ruta_base, carpeta))]</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> subcarpeta <span class="kw">in</span> subcarpetas:</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    carpeta_indices <span class="op">=</span> os.path.join(subcarpeta, <span class="st">'indices'</span>)</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(carpeta_indices):</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>    archivos <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(carpeta_indices) <span class="cf">if</span> f.endswith(<span class="st">'_txm_ANN.csv'</span>)]</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> archivo <span class="kw">in</span> archivos:</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>        ruta_archivo <span class="op">=</span> os.path.join(carpeta_indices, archivo)</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_csv(ruta_archivo, skiprows<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>        df.columns <span class="op">=</span> df.columns.<span class="bu">str</span>.strip()</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[[<span class="st">'time'</span>, <span class="st">'txm'</span>]]</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'time'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'time'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">'%Y'</span>)</span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[df[<span class="st">'txm'</span>] <span class="op">!=</span> <span class="op">-</span><span class="fl">99.9</span>]</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>        df.set_index(<span class="st">'time'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, df[<span class="st">'txm'</span>], marker<span class="op">=</span><span class="st">'D'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Temperature'</span>)</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>        slope, intercept, r_value, p_value, std_err <span class="op">=</span> linregress(mdates.date2num(df.index), df[<span class="st">'txm'</span>])</span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, intercept <span class="op">+</span> slope <span class="op">*</span> mdates.date2num(df.index), linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Regression line'</span>)</span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>        plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>        titulo <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>archivo<span class="sc">.</span>split(<span class="st">'_'</span>)[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> Station - Annual mean daily maximum temperature"</span></span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>        <span class="co">#plt.title(titulo, fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'Year'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Temperature (ºC)'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_locator(mdates.YearLocator(<span class="dv">5</span>))</span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_formatter(mdates.DateFormatter(<span class="st">'%Y'</span>))</span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a>        plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, fontsize<span class="op">=</span><span class="dv">20</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a>        plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-41"><a href="#cb52-41" aria-hidden="true" tabindex="-1"></a>        info_text <span class="op">=</span> (</span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Slope: </span><span class="sc">{</span>slope<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Confidence interval: [</span><span class="sc">{</span>intercept <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>intercept <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">]</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"p-value: </span><span class="sc">{</span>p_value<span class="sc">:.3f}</span><span class="ss">"</span></span>
<span id="cb52-45"><a href="#cb52-45" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb52-46"><a href="#cb52-46" aria-hidden="true" tabindex="-1"></a>        plt.text(<span class="fl">1.1</span>, <span class="fl">0.65</span>, info_text, transform<span class="op">=</span>plt.gca().transAxes, fontsize<span class="op">=</span><span class="dv">14</span>, verticalalignment<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb52-47"><a href="#cb52-47" aria-hidden="true" tabindex="-1"></a>                 bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb52-48"><a href="#cb52-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-49"><a href="#cb52-49" aria-hidden="true" tabindex="-1"></a>        plt.grid(<span class="va">False</span>)</span>
<span id="cb52-50"><a href="#cb52-50" aria-hidden="true" tabindex="-1"></a>        plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.4</span>, <span class="fl">0.4</span>), fontsize<span class="op">=</span><span class="dv">14</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb52-51"><a href="#cb52-51" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb52-52"><a href="#cb52-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-53"><a href="#cb52-53" aria-hidden="true" tabindex="-1"></a>        estacion_codigo <span class="op">=</span> archivo.split(<span class="st">'_'</span>)[<span class="dv">0</span>]</span>
<span id="cb52-54"><a href="#cb52-54" aria-hidden="true" tabindex="-1"></a>        ruta_salida_estacion <span class="op">=</span> os.path.join(ruta_salida_base, estacion_codigo)</span>
<span id="cb52-55"><a href="#cb52-55" aria-hidden="true" tabindex="-1"></a>        os.makedirs(ruta_salida_estacion, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb52-56"><a href="#cb52-56" aria-hidden="true" tabindex="-1"></a>        ruta_salida <span class="op">=</span> os.path.join(ruta_salida_estacion, <span class="ss">f"</span><span class="sc">{</span>estacion_codigo<span class="sc">}</span><span class="ss">_txm_ANN_plot.png"</span>)</span>
<span id="cb52-57"><a href="#cb52-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-58"><a href="#cb52-58" aria-hidden="true" tabindex="-1"></a>        plt.savefig(ruta_salida)</span>
<span id="cb52-59"><a href="#cb52-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-60"><a href="#cb52-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb52-61"><a href="#cb52-61" aria-hidden="true" tabindex="-1"></a>            plt.show()</span>
<span id="cb52-62"><a href="#cb52-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb52-63"><a href="#cb52-63" aria-hidden="true" tabindex="-1"></a>            plt.close()</span>
<span id="cb52-64"><a href="#cb52-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-65"><a href="#cb52-65" aria-hidden="true" tabindex="-1"></a>        contador <span class="op">+=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-polar-8" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-polar-8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="indicadores_files/figure-html/fig-polar-8-output-1.png" width="1076" height="717" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-polar-8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Indicator of annual mean daily maximum temperature at station 9423001
</figcaption>
</figure>
</div>
</div>
</div>
<p>5.3.3. Annual warmest daily maximum temperature (txx).</p>
<div id="cell-fig-polar-9" class="cell" data-execution_count="41">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>ruta_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/5.Climpact'</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>ruta_salida_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/6.Figuras_Climpact/Temperature'</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>os.makedirs(ruta_salida_base, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>subcarpetas <span class="op">=</span> [os.path.join(ruta_base, carpeta) <span class="cf">for</span> carpeta <span class="kw">in</span> os.listdir(ruta_base) <span class="cf">if</span> os.path.isdir(os.path.join(ruta_base, carpeta))]</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> subcarpeta <span class="kw">in</span> subcarpetas:</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>    carpeta_indices <span class="op">=</span> os.path.join(subcarpeta, <span class="st">'indices'</span>)</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(carpeta_indices):</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>    archivos <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(carpeta_indices) <span class="cf">if</span> f.endswith(<span class="st">'_txx_ANN.csv'</span>)]</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> archivo <span class="kw">in</span> archivos:</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>        ruta_archivo <span class="op">=</span> os.path.join(carpeta_indices, archivo)</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_csv(ruta_archivo, skiprows<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>        df.columns <span class="op">=</span> df.columns.<span class="bu">str</span>.strip()</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[[<span class="st">'time'</span>, <span class="st">'txx'</span>]]</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'time'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'time'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">'%Y'</span>)</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[df[<span class="st">'txx'</span>] <span class="op">!=</span> <span class="op">-</span><span class="fl">99.9</span>]</span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>        df.set_index(<span class="st">'time'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, df[<span class="st">'txx'</span>], marker<span class="op">=</span><span class="st">'D'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Temperature'</span>)</span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a>        slope, intercept, r_value, p_value, std_err <span class="op">=</span> linregress(mdates.date2num(df.index), df[<span class="st">'txx'</span>])</span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, intercept <span class="op">+</span> slope <span class="op">*</span> mdates.date2num(df.index), linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Regression line'</span>)</span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a>        plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true" tabindex="-1"></a>        titulo <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>archivo<span class="sc">.</span>split(<span class="st">'_'</span>)[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> Station - Annual warmest daily maximum temperature"</span></span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true" tabindex="-1"></a>        <span class="co">#plt.title(titulo, fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb53-34"><a href="#cb53-34" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'Year'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb53-35"><a href="#cb53-35" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Temperature (ºC)'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb53-36"><a href="#cb53-36" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_locator(mdates.YearLocator(<span class="dv">5</span>))</span>
<span id="cb53-37"><a href="#cb53-37" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_formatter(mdates.DateFormatter(<span class="st">'%Y'</span>))</span>
<span id="cb53-38"><a href="#cb53-38" aria-hidden="true" tabindex="-1"></a>        plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, fontsize<span class="op">=</span><span class="dv">20</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb53-39"><a href="#cb53-39" aria-hidden="true" tabindex="-1"></a>        plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb53-40"><a href="#cb53-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-41"><a href="#cb53-41" aria-hidden="true" tabindex="-1"></a>        info_text <span class="op">=</span> (</span>
<span id="cb53-42"><a href="#cb53-42" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Slope: </span><span class="sc">{</span>slope<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb53-43"><a href="#cb53-43" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Confidence interval: [</span><span class="sc">{</span>intercept <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>intercept <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">]</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb53-44"><a href="#cb53-44" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"p-value: </span><span class="sc">{</span>p_value<span class="sc">:.3f}</span><span class="ss">"</span></span>
<span id="cb53-45"><a href="#cb53-45" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb53-46"><a href="#cb53-46" aria-hidden="true" tabindex="-1"></a>        plt.text(<span class="fl">1.1</span>, <span class="fl">0.65</span>, info_text, transform<span class="op">=</span>plt.gca().transAxes, fontsize<span class="op">=</span><span class="dv">14</span>, verticalalignment<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb53-47"><a href="#cb53-47" aria-hidden="true" tabindex="-1"></a>                 bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb53-48"><a href="#cb53-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-49"><a href="#cb53-49" aria-hidden="true" tabindex="-1"></a>        plt.grid(<span class="va">False</span>)</span>
<span id="cb53-50"><a href="#cb53-50" aria-hidden="true" tabindex="-1"></a>        plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.4</span>, <span class="fl">0.4</span>), fontsize<span class="op">=</span><span class="dv">14</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb53-51"><a href="#cb53-51" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb53-52"><a href="#cb53-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-53"><a href="#cb53-53" aria-hidden="true" tabindex="-1"></a>        estacion_codigo <span class="op">=</span> archivo.split(<span class="st">'_'</span>)[<span class="dv">0</span>]</span>
<span id="cb53-54"><a href="#cb53-54" aria-hidden="true" tabindex="-1"></a>        ruta_salida_estacion <span class="op">=</span> os.path.join(ruta_salida_base, estacion_codigo)</span>
<span id="cb53-55"><a href="#cb53-55" aria-hidden="true" tabindex="-1"></a>        os.makedirs(ruta_salida_estacion, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb53-56"><a href="#cb53-56" aria-hidden="true" tabindex="-1"></a>        ruta_salida <span class="op">=</span> os.path.join(ruta_salida_estacion, <span class="ss">f"</span><span class="sc">{</span>estacion_codigo<span class="sc">}</span><span class="ss">_txx_ANN_plot.png"</span>)</span>
<span id="cb53-57"><a href="#cb53-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-58"><a href="#cb53-58" aria-hidden="true" tabindex="-1"></a>        plt.savefig(ruta_salida)</span>
<span id="cb53-59"><a href="#cb53-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-60"><a href="#cb53-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb53-61"><a href="#cb53-61" aria-hidden="true" tabindex="-1"></a>            plt.show()</span>
<span id="cb53-62"><a href="#cb53-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb53-63"><a href="#cb53-63" aria-hidden="true" tabindex="-1"></a>            plt.close()</span>
<span id="cb53-64"><a href="#cb53-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-65"><a href="#cb53-65" aria-hidden="true" tabindex="-1"></a>        contador <span class="op">+=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-polar-9" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-polar-9-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="indicadores_files/figure-html/fig-polar-9-output-1.png" width="1079" height="717" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-polar-9-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: Indicator of annual warmest daily maximum temperature at station 9423001
</figcaption>
</figure>
</div>
</div>
</div>
<p>5.3.4. Annual number of days when minimum temperature &lt; 0ºC (id).</p>
<div id="cell-fig-polar-10" class="cell" data-execution_count="42">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>ruta_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/5.Climpact'</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>ruta_salida_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/6.Figuras_Climpact/Temperature'</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>os.makedirs(ruta_salida_base, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>subcarpetas <span class="op">=</span> [os.path.join(ruta_base, carpeta) <span class="cf">for</span> carpeta <span class="kw">in</span> os.listdir(ruta_base) <span class="cf">if</span> os.path.isdir(os.path.join(ruta_base, carpeta))]</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> subcarpeta <span class="kw">in</span> subcarpetas:</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>    carpeta_indices <span class="op">=</span> os.path.join(subcarpeta, <span class="st">'indices'</span>)</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(carpeta_indices):</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>    archivos <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(carpeta_indices) <span class="cf">if</span> f.endswith(<span class="st">'_fd_ANN.csv'</span>)]</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> archivo <span class="kw">in</span> archivos:</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>        ruta_archivo <span class="op">=</span> os.path.join(carpeta_indices, archivo)</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_csv(ruta_archivo, skiprows<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>        df.columns <span class="op">=</span> df.columns.<span class="bu">str</span>.strip()</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[[<span class="st">'time'</span>, <span class="st">'fd'</span>]]</span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'time'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'time'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">'%Y'</span>)</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[df[<span class="st">'fd'</span>] <span class="op">!=</span> <span class="op">-</span><span class="fl">99.9</span>]</span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>        df.set_index(<span class="st">'time'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, df[<span class="st">'fd'</span>], marker<span class="op">=</span><span class="st">'D'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Days T&lt;0ºC'</span>)</span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a>        slope, intercept, r_value, p_value, std_err <span class="op">=</span> linregress(mdates.date2num(df.index), df[<span class="st">'fd'</span>])</span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, intercept <span class="op">+</span> slope <span class="op">*</span> mdates.date2num(df.index), linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Regression line'</span>)</span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a>        plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a>        titulo <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>archivo<span class="sc">.</span>split(<span class="st">'_'</span>)[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> Station - Days when minimum temperature &lt; 0ºC"</span></span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a>        <span class="co">#plt.title(titulo, fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'Year'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb54-35"><a href="#cb54-35" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Days'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb54-36"><a href="#cb54-36" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_locator(mdates.YearLocator(<span class="dv">5</span>))</span>
<span id="cb54-37"><a href="#cb54-37" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_formatter(mdates.DateFormatter(<span class="st">'%Y'</span>))</span>
<span id="cb54-38"><a href="#cb54-38" aria-hidden="true" tabindex="-1"></a>        plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, fontsize<span class="op">=</span><span class="dv">20</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb54-39"><a href="#cb54-39" aria-hidden="true" tabindex="-1"></a>        plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb54-40"><a href="#cb54-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-41"><a href="#cb54-41" aria-hidden="true" tabindex="-1"></a>        info_text <span class="op">=</span> (</span>
<span id="cb54-42"><a href="#cb54-42" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Slope: </span><span class="sc">{</span>slope<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb54-43"><a href="#cb54-43" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Confidence interval: [</span><span class="sc">{</span>intercept <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>intercept <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">]</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb54-44"><a href="#cb54-44" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"p-value: </span><span class="sc">{</span>p_value<span class="sc">:.3f}</span><span class="ss">"</span></span>
<span id="cb54-45"><a href="#cb54-45" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb54-46"><a href="#cb54-46" aria-hidden="true" tabindex="-1"></a>        plt.text(<span class="fl">1.1</span>, <span class="fl">0.65</span>, info_text, transform<span class="op">=</span>plt.gca().transAxes, fontsize<span class="op">=</span><span class="dv">14</span>, verticalalignment<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb54-47"><a href="#cb54-47" aria-hidden="true" tabindex="-1"></a>                 bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb54-48"><a href="#cb54-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-49"><a href="#cb54-49" aria-hidden="true" tabindex="-1"></a>        plt.grid(<span class="va">False</span>)</span>
<span id="cb54-50"><a href="#cb54-50" aria-hidden="true" tabindex="-1"></a>        plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.4</span>, <span class="fl">0.4</span>), fontsize<span class="op">=</span><span class="dv">14</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb54-51"><a href="#cb54-51" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb54-52"><a href="#cb54-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-53"><a href="#cb54-53" aria-hidden="true" tabindex="-1"></a>        estacion_codigo <span class="op">=</span> archivo.split(<span class="st">'_'</span>)[<span class="dv">0</span>]</span>
<span id="cb54-54"><a href="#cb54-54" aria-hidden="true" tabindex="-1"></a>        ruta_salida_estacion <span class="op">=</span> os.path.join(ruta_salida_base, estacion_codigo)</span>
<span id="cb54-55"><a href="#cb54-55" aria-hidden="true" tabindex="-1"></a>        os.makedirs(ruta_salida_estacion, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb54-56"><a href="#cb54-56" aria-hidden="true" tabindex="-1"></a>        ruta_salida <span class="op">=</span> os.path.join(ruta_salida_estacion, <span class="ss">f"</span><span class="sc">{</span>estacion_codigo<span class="sc">}</span><span class="ss">_fd_ANN_plot.png"</span>)</span>
<span id="cb54-57"><a href="#cb54-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-58"><a href="#cb54-58" aria-hidden="true" tabindex="-1"></a>        plt.savefig(ruta_salida)</span>
<span id="cb54-59"><a href="#cb54-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-60"><a href="#cb54-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb54-61"><a href="#cb54-61" aria-hidden="true" tabindex="-1"></a>            plt.show()</span>
<span id="cb54-62"><a href="#cb54-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb54-63"><a href="#cb54-63" aria-hidden="true" tabindex="-1"></a>            plt.close()</span>
<span id="cb54-64"><a href="#cb54-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-65"><a href="#cb54-65" aria-hidden="true" tabindex="-1"></a>        contador <span class="op">+=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-polar-10" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-polar-10-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="indicadores_files/figure-html/fig-polar-10-output-1.png" width="1079" height="717" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-polar-10-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10: Indicator of annual numbery of days when minimum temperature is lower than 0ºC at station 9423001
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="generation-of-figures-for-hydrologic-indicators-script" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="generation-of-figures-for-hydrologic-indicators-script"><span class="header-section-number">6</span> Generation of figures for hydrologic indicators script</h2>
<section id="libraries-and-workspace." class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="libraries-and-workspace."><span class="header-section-number">6.1</span> Libraries and workspace.</h3>
<div id="fae230c0" class="cell" data-execution_count="43">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> csv</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>input_directory <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/9.IHA'</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>sheets_to_convert <span class="op">=</span> [<span class="st">'ann'</span>, <span class="st">'sco'</span>, <span class="st">'lsq'</span>, <span class="st">'pct'</span>, <span class="st">'daily efcs'</span>, <span class="st">'fdc'</span>]</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> filename <span class="kw">in</span> os.listdir(input_directory):</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> filename.endswith(<span class="st">'.xlsx'</span>) <span class="kw">or</span> filename.endswith(<span class="st">'.xls'</span>):</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>        filepath <span class="op">=</span> os.path.join(input_directory, filename)</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>        excel_file <span class="op">=</span> pd.ExcelFile(filepath)</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>        station_code <span class="op">=</span> os.path.splitext(filename)[<span class="dv">0</span>]</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>        station_output_directory <span class="op">=</span> os.path.join(input_directory, <span class="st">'csv'</span>, station_code)</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> os.path.exists(station_output_directory):</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>            os.makedirs(station_output_directory)</span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> sheet <span class="kw">in</span> sheets_to_convert:</span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> sheet <span class="kw">in</span> excel_file.sheet_names:</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>                df <span class="op">=</span> pd.read_excel(filepath, sheet_name<span class="op">=</span>sheet)</span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>                output_filename <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>sheet<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv"</span></span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>                output_filepath <span class="op">=</span> os.path.join(station_output_directory, output_filename)</span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a>                df.to_csv(output_filepath, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"ann, sco, fdc, pct, lsq and daily efcs files saved in its folder."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>ann, sco, fdc, pct, lsq and daily efcs files saved in its folder.</code></pre>
</div>
</div>
</section>
<section id="streamflow-figures" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="streamflow-figures"><span class="header-section-number">6.2</span> Streamflow figures</h3>
<p>6.2.1. Simple monthly median flow for each station</p>
<p>The order of the months in the <code>sco_</code> file may vary. If so, adjust the <code>meses_ingles</code> variable accordingly.</p>
<div id="cell-fig-polar-11" class="cell" data-execution_count="44">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>base_path <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/9.IHA/csv'</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>output_root_directory <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/10.Figuras_IHA/Caudal'</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>meses_ingles <span class="op">=</span> [<span class="st">'January'</span>, <span class="st">'February'</span>, <span class="st">'March'</span>, <span class="st">'April'</span>, <span class="st">'May'</span>, <span class="st">'June'</span>, <span class="st">'July'</span>, <span class="st">'August'</span>, <span class="st">'September'</span>, <span class="st">'October'</span>, <span class="st">'November'</span>, <span class="st">'December'</span>]</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> root, dirs, files <span class="kw">in</span> os.walk(base_path):</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files:</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">file</span>.startswith(<span class="st">"sco_"</span>) <span class="kw">and</span> <span class="bu">file</span>.endswith(<span class="st">".csv"</span>):</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>            sco_file <span class="op">=</span> os.path.join(root, <span class="bu">file</span>)</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>            df <span class="op">=</span> pd.read_csv(sco_file, skiprows<span class="op">=</span><span class="dv">17</span>, header<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>            df_mes <span class="op">=</span> df.iloc[:<span class="dv">12</span>, :<span class="dv">2</span>]</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>            df_mes.columns <span class="op">=</span> [<span class="st">'Month'</span>, <span class="st">'Median'</span>]</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>            df_mes[<span class="st">'Month'</span>] <span class="op">=</span> meses_ingles</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>            df_mes.set_index(<span class="st">'Month'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>            station_code <span class="op">=</span> <span class="bu">file</span>.split(<span class="st">'_'</span>)[<span class="dv">1</span>].split(<span class="st">'.'</span>)[<span class="dv">0</span>]</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>            output_dir <span class="op">=</span> os.path.join(output_root_directory, station_code)</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> os.path.exists(output_dir):</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>                os.makedirs(output_dir)</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>            plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>            plt.plot(df_mes.index, df_mes[<span class="st">'Median'</span>], marker<span class="op">=</span><span class="st">'.'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Median'</span>)</span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>            plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>            <span class="co">#plt.title(f'Median monthly flow - {station_code} Station', fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>            plt.xlabel(<span class="st">'Month'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>            plt.ylabel(<span class="st">'Flow (m3/s)'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>            plt.xticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a>            plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a>            plt.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, color<span class="op">=</span><span class="st">'lightgray'</span>)</span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a>            plt.legend(fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a>            plt.grid(<span class="va">False</span>)</span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a>            output_file <span class="op">=</span> os.path.join(output_dir, <span class="ss">f'Median_monthly_flow_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.png'</span>)</span>
<span id="cb57-38"><a href="#cb57-38" aria-hidden="true" tabindex="-1"></a>            plt.tight_layout()</span>
<span id="cb57-39"><a href="#cb57-39" aria-hidden="true" tabindex="-1"></a>            plt.savefig(output_file, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb57-40"><a href="#cb57-40" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb57-41"><a href="#cb57-41" aria-hidden="true" tabindex="-1"></a>            plt.savefig(ruta_salida)</span>
<span id="cb57-42"><a href="#cb57-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-43"><a href="#cb57-43" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb57-44"><a href="#cb57-44" aria-hidden="true" tabindex="-1"></a>                plt.show()</span>
<span id="cb57-45"><a href="#cb57-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb57-46"><a href="#cb57-46" aria-hidden="true" tabindex="-1"></a>                plt.close()</span>
<span id="cb57-47"><a href="#cb57-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-48"><a href="#cb57-48" aria-hidden="true" tabindex="-1"></a>            contador <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb57-49"><a href="#cb57-49" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Figure saved: </span><span class="sc">{</span>output_file<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-polar-11" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-polar-11-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="indicadores_files/figure-html/fig-polar-11-output-1.png" width="1098" height="717" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-polar-11-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11: Indicator of simple monthly median flow at station 9423001
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Figure saved: Hidroclima/Base de datos/10.Figuras_IHA/Caudal/9423001/Median_monthly_flow_9423001.png
Figure saved: Hidroclima/Base de datos/10.Figuras_IHA/Caudal/9433001/Median_monthly_flow_9433001.png
Figure saved: Hidroclima/Base de datos/10.Figuras_IHA/Caudal/9434001/Median_monthly_flow_9434001.png</code></pre>
</div>
</div>
<p>6.2.2. Boxplot flow for each month calculated from all recorded years for each station</p>
<p>The language of the months or even the way they are written in the <code>ann_</code> file may vary. If so, adjust the <code>columns</code> variable and <code>id_vars</code> accordingly.</p>
<div id="cell-fig-polar-12" class="cell" data-execution_count="45">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>base_directory <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/9.IHA/csv'</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>output_root_directory <span class="op">=</span> os.path.join(<span class="st">'Hidroclima/Base de datos/10.Figuras_IHA'</span>, <span class="st">'Caudal'</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(output_root_directory):</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    os.makedirs(output_root_directory)</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> station_folder <span class="kw">in</span> os.listdir(base_directory):</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>    station_path <span class="op">=</span> os.path.join(base_directory, station_folder)</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> os.path.isdir(station_path):</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>        station_output_directory <span class="op">=</span> os.path.join(output_root_directory, station_folder)</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> os.path.exists(station_output_directory):</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>            os.makedirs(station_output_directory)</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> filename <span class="kw">in</span> os.listdir(station_path):</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> filename.startswith(<span class="st">'ann_'</span>) <span class="kw">and</span> filename.endswith(<span class="st">'.csv'</span>):</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>                input_file <span class="op">=</span> os.path.join(station_path, filename)</span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>                df <span class="op">=</span> pd.read_csv(input_file, skiprows<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>                columns <span class="op">=</span> [<span class="st">'Year'</span>, <span class="st">'January'</span>, <span class="st">'February'</span>, <span class="st">'March'</span>, <span class="st">'April'</span>, <span class="st">'May'</span>, <span class="st">'June'</span>, <span class="st">'July'</span>, <span class="st">'August'</span>, <span class="st">'September'</span>, <span class="st">'October'</span>, <span class="st">'November'</span>, <span class="st">'December'</span>]</span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>                df <span class="op">=</span> df[columns]</span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>                df_melted <span class="op">=</span> df.melt(id_vars<span class="op">=</span>[<span class="st">'Year'</span>], var_name<span class="op">=</span><span class="st">'Month'</span>, value_name<span class="op">=</span><span class="st">'Value'</span>)</span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a>                month_translation <span class="op">=</span> {</span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'January'</span>: <span class="st">'January'</span>, <span class="st">'February'</span>: <span class="st">'February'</span>, <span class="st">'March'</span>: <span class="st">'March'</span>, <span class="st">'April'</span>: <span class="st">'April'</span>, </span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'May'</span>: <span class="st">'May'</span>, <span class="st">'June'</span>: <span class="st">'June'</span>, <span class="st">'July'</span>: <span class="st">'July'</span>, <span class="st">'August'</span>: <span class="st">'August'</span>, </span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'September'</span>: <span class="st">'September'</span>, <span class="st">'October'</span>: <span class="st">'October'</span>, <span class="st">'November'</span>: <span class="st">'November'</span>, </span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'December'</span>: <span class="st">'December'</span></span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a>                df_melted[<span class="st">'Month'</span>] <span class="op">=</span> df_melted[<span class="st">'Month'</span>].<span class="bu">map</span>(month_translation)</span>
<span id="cb59-34"><a href="#cb59-34" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb59-35"><a href="#cb59-35" aria-hidden="true" tabindex="-1"></a>                plt.rcParams[<span class="st">"font.family"</span>] <span class="op">=</span> <span class="st">"Times New Roman"</span></span>
<span id="cb59-36"><a href="#cb59-36" aria-hidden="true" tabindex="-1"></a>                plt.rcParams[<span class="st">"font.size"</span>] <span class="op">=</span> <span class="dv">12</span></span>
<span id="cb59-37"><a href="#cb59-37" aria-hidden="true" tabindex="-1"></a>                plt.rcParams[<span class="st">"axes.titlesize"</span>] <span class="op">=</span> plt.rcParams[<span class="st">"font.size"</span>] <span class="op">+</span> <span class="dv">4</span></span>
<span id="cb59-38"><a href="#cb59-38" aria-hidden="true" tabindex="-1"></a>                plt.rcParams[<span class="st">"axes.labelsize"</span>] <span class="op">=</span> plt.rcParams[<span class="st">"font.size"</span>] <span class="op">+</span> <span class="dv">4</span></span>
<span id="cb59-39"><a href="#cb59-39" aria-hidden="true" tabindex="-1"></a>                plt.rcParams[<span class="st">"xtick.labelsize"</span>] <span class="op">=</span> plt.rcParams[<span class="st">"font.size"</span>] <span class="op">+</span> <span class="dv">4</span></span>
<span id="cb59-40"><a href="#cb59-40" aria-hidden="true" tabindex="-1"></a>                plt.rcParams[<span class="st">"ytick.labelsize"</span>] <span class="op">=</span> plt.rcParams[<span class="st">"font.size"</span>] <span class="op">+</span> <span class="dv">4</span></span>
<span id="cb59-41"><a href="#cb59-41" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb59-42"><a href="#cb59-42" aria-hidden="true" tabindex="-1"></a>                plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb59-43"><a href="#cb59-43" aria-hidden="true" tabindex="-1"></a>                sns.boxplot(</span>
<span id="cb59-44"><a href="#cb59-44" aria-hidden="true" tabindex="-1"></a>                    x<span class="op">=</span><span class="st">'Month'</span>, y<span class="op">=</span><span class="st">'Value'</span>, data<span class="op">=</span>df_melted,</span>
<span id="cb59-45"><a href="#cb59-45" aria-hidden="true" tabindex="-1"></a>                    order<span class="op">=</span>[<span class="st">'January'</span>, <span class="st">'February'</span>, <span class="st">'March'</span>, <span class="st">'April'</span>, <span class="st">'May'</span>, <span class="st">'June'</span>, <span class="st">'July'</span>, </span>
<span id="cb59-46"><a href="#cb59-46" aria-hidden="true" tabindex="-1"></a>                           <span class="st">'August'</span>, <span class="st">'September'</span>, <span class="st">'October'</span>, <span class="st">'November'</span>, <span class="st">'December'</span>],</span>
<span id="cb59-47"><a href="#cb59-47" aria-hidden="true" tabindex="-1"></a>                    color<span class="op">=</span><span class="st">'gray'</span></span>
<span id="cb59-48"><a href="#cb59-48" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb59-49"><a href="#cb59-49" aria-hidden="true" tabindex="-1"></a>                <span class="co">#plt.title(f'Distribution of the median monthly flow - {station_folder} Station')</span></span>
<span id="cb59-50"><a href="#cb59-50" aria-hidden="true" tabindex="-1"></a>                plt.xlabel(<span class="st">'Month'</span>)</span>
<span id="cb59-51"><a href="#cb59-51" aria-hidden="true" tabindex="-1"></a>                plt.ylabel(<span class="st">'Flow (m3/s)'</span>)</span>
<span id="cb59-52"><a href="#cb59-52" aria-hidden="true" tabindex="-1"></a>                plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb59-53"><a href="#cb59-53" aria-hidden="true" tabindex="-1"></a>                plt.tight_layout()</span>
<span id="cb59-54"><a href="#cb59-54" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb59-55"><a href="#cb59-55" aria-hidden="true" tabindex="-1"></a>                output_plot_path <span class="op">=</span> os.path.join(station_output_directory, <span class="ss">f'BOXPLOT_</span><span class="sc">{</span>filename[:<span class="op">-</span><span class="dv">4</span>]<span class="sc">}</span><span class="ss">.png'</span>)</span>
<span id="cb59-56"><a href="#cb59-56" aria-hidden="true" tabindex="-1"></a>                plt.savefig(output_plot_path, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb59-57"><a href="#cb59-57" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb59-58"><a href="#cb59-58" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb59-59"><a href="#cb59-59" aria-hidden="true" tabindex="-1"></a>                    plt.show()</span>
<span id="cb59-60"><a href="#cb59-60" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb59-61"><a href="#cb59-61" aria-hidden="true" tabindex="-1"></a>                    plt.close()</span>
<span id="cb59-62"><a href="#cb59-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-63"><a href="#cb59-63" aria-hidden="true" tabindex="-1"></a>                contador <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb59-64"><a href="#cb59-64" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb59-65"><a href="#cb59-65" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f'Boxplot saved: </span><span class="sc">{</span>output_plot_path<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-polar-12" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-polar-12-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="indicadores_files/figure-html/fig-polar-12-output-1.png" width="1135" height="559" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-polar-12-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12: Boxplot of flow at station 9423001
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Boxplot saved: Hidroclima/Base de datos/10.Figuras_IHA/Caudal/9423001/BOXPLOT_ann_9423001.png
Boxplot saved: Hidroclima/Base de datos/10.Figuras_IHA/Caudal/9433001/BOXPLOT_ann_9433001.png
Boxplot saved: Hidroclima/Base de datos/10.Figuras_IHA/Caudal/9434001/BOXPLOT_ann_9434001.png</code></pre>
</div>
</div>
<p>6.2.3. Figure with the percentiles of monthly flows for all years evaluated by station.</p>
<p>The order of the months in the <code>pct_</code> file may vary. If so, adjust the <code>meses_ingles</code> variable accordingly.</p>
<div id="cell-fig-polar-13" class="cell" data-execution_count="46">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>base_path <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/9.IHA/csv'</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>output_root_directory <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/10.Figuras_IHA/Caudal'</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> root, dirs, files <span class="kw">in</span> os.walk(base_path):</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files:</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">file</span>.startswith(<span class="st">"pct_"</span>) <span class="kw">and</span> <span class="bu">file</span>.endswith(<span class="st">".csv"</span>):</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>            pct_file <span class="op">=</span> os.path.join(root, <span class="bu">file</span>)</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>            station_code <span class="op">=</span> os.path.basename(root)</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>            station_output_directory <span class="op">=</span> os.path.join(output_root_directory, station_code)</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> os.path.exists(station_output_directory):</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"Error: The output directory for station </span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss"> does not exist."</span>)</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>            df <span class="op">=</span> pd.read_csv(pct_file, skiprows<span class="op">=</span><span class="dv">8</span>, header<span class="op">=</span><span class="va">None</span>) </span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>            df_mes <span class="op">=</span> df.iloc[:<span class="dv">12</span>, :<span class="dv">6</span>]</span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>            df_mes.columns <span class="op">=</span> [<span class="st">'Month'</span>, <span class="st">'10%'</span>, <span class="st">'25%'</span>, <span class="st">'50%'</span>, <span class="st">'75%'</span>, <span class="st">'90%'</span>]</span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a>            meses_ingles <span class="op">=</span> [<span class="st">'January'</span>, <span class="st">'February'</span>, <span class="st">'March'</span>, <span class="st">'April'</span>, <span class="st">'May'</span>, <span class="st">'June'</span>, <span class="st">'July'</span>, <span class="st">'August'</span>, <span class="st">'September'</span>, <span class="st">'October'</span>, <span class="st">'November'</span>, <span class="st">'December'</span>]</span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a>            df_mes[<span class="st">'Month'</span>] <span class="op">=</span> meses_ingles</span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a>            df_mes.set_index(<span class="st">'Month'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a>            plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true" tabindex="-1"></a>            linestyles <span class="op">=</span> [<span class="st">'-'</span>, <span class="st">'--'</span>, <span class="st">'-.'</span>, <span class="st">':'</span>, (<span class="dv">0</span>, (<span class="dv">1</span>, <span class="dv">10</span>))]</span>
<span id="cb61-30"><a href="#cb61-30" aria-hidden="true" tabindex="-1"></a>            marcadores <span class="op">=</span> [<span class="st">'o'</span>, <span class="st">'s'</span>, <span class="st">'^'</span>, <span class="st">'D'</span>, <span class="st">'*'</span>]</span>
<span id="cb61-31"><a href="#cb61-31" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb61-32"><a href="#cb61-32" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> percentil, linestyle, marcador <span class="kw">in</span> <span class="bu">zip</span>([<span class="st">'10%'</span>, <span class="st">'25%'</span>, <span class="st">'50%'</span>, <span class="st">'75%'</span>, <span class="st">'90%'</span>], linestyles, marcadores):</span>
<span id="cb61-33"><a href="#cb61-33" aria-hidden="true" tabindex="-1"></a>                plt.plot(df_mes.index, df_mes[percentil], marker<span class="op">=</span>marcador, linestyle<span class="op">=</span>linestyle, label<span class="op">=</span>percentil, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb61-34"><a href="#cb61-34" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb61-35"><a href="#cb61-35" aria-hidden="true" tabindex="-1"></a>            plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb61-36"><a href="#cb61-36" aria-hidden="true" tabindex="-1"></a>            <span class="co">#plt.title(f'Percentiles of monthly flows for {station_code}', fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb61-37"><a href="#cb61-37" aria-hidden="true" tabindex="-1"></a>            plt.xlabel(<span class="st">'Month'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb61-38"><a href="#cb61-38" aria-hidden="true" tabindex="-1"></a>            plt.ylabel(<span class="st">'Flow (m3/s)'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb61-39"><a href="#cb61-39" aria-hidden="true" tabindex="-1"></a>            plt.xticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb61-40"><a href="#cb61-40" aria-hidden="true" tabindex="-1"></a>            plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb61-41"><a href="#cb61-41" aria-hidden="true" tabindex="-1"></a>            plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.35</span>, <span class="fl">0.95</span>), fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb61-42"><a href="#cb61-42" aria-hidden="true" tabindex="-1"></a>            plt.grid(<span class="va">False</span>)</span>
<span id="cb61-43"><a href="#cb61-43" aria-hidden="true" tabindex="-1"></a>            plt.tight_layout()</span>
<span id="cb61-44"><a href="#cb61-44" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb61-45"><a href="#cb61-45" aria-hidden="true" tabindex="-1"></a>            output_plot_path <span class="op">=</span> os.path.join(station_output_directory, <span class="ss">f'percentiles_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.png'</span>)</span>
<span id="cb61-46"><a href="#cb61-46" aria-hidden="true" tabindex="-1"></a>            plt.savefig(output_plot_path, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb61-47"><a href="#cb61-47" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb61-48"><a href="#cb61-48" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb61-49"><a href="#cb61-49" aria-hidden="true" tabindex="-1"></a>                plt.show()</span>
<span id="cb61-50"><a href="#cb61-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb61-51"><a href="#cb61-51" aria-hidden="true" tabindex="-1"></a>                plt.close()</span>
<span id="cb61-52"><a href="#cb61-52" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb61-53"><a href="#cb61-53" aria-hidden="true" tabindex="-1"></a>            contador <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb61-54"><a href="#cb61-54" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb61-55"><a href="#cb61-55" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Figure saved: </span><span class="sc">{</span>output_plot_path<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-polar-13" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-polar-13-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="indicadores_files/figure-html/fig-polar-13-output-1.png" width="1029" height="718" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-polar-13-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13: Percentiles of monthly flows at station 9423001
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Figure saved: Hidroclima/Base de datos/10.Figuras_IHA/Caudal/9423001/percentiles_9423001.png
Figure saved: Hidroclima/Base de datos/10.Figuras_IHA/Caudal/9433001/percentiles_9433001.png
Figure saved: Hidroclima/Base de datos/10.Figuras_IHA/Caudal/9434001/percentiles_9434001.png</code></pre>
</div>
</div>
<p>6.2.4. Graphs for each station with the probability of exceedance for each month and at an annual level.</p>
<p>The language of the months or even the way they are written in the <code>fdc_</code> file may vary. If so, adjust the <code>meses</code> variable accordingly.</p>
<div id="cell-fig-polar-14" class="cell" data-execution_count="47">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>base_path <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/9.IHA/csv'</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>output_root_directory <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/10.Figuras_IHA/Caudal'</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>meses <span class="op">=</span> {</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Annual'</span>: <span class="st">'Annual'</span>, <span class="st">'January'</span>: <span class="st">'January'</span>, <span class="st">'February'</span>: <span class="st">'February'</span>, <span class="st">'March'</span>: <span class="st">'March'</span>,</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'April'</span>: <span class="st">'April'</span>, <span class="st">'May'</span>: <span class="st">'May'</span>, <span class="st">'June'</span>: <span class="st">'June'</span>, <span class="st">'July'</span>: <span class="st">'July'</span>, </span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'August'</span>: <span class="st">'August'</span>, <span class="st">'September'</span>: <span class="st">'September'</span>, <span class="st">'October'</span>: <span class="st">'October'</span>, </span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'November'</span>: <span class="st">'November'</span>, <span class="st">'December'</span>: <span class="st">'December'</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> root, dirs, files <span class="kw">in</span> os.walk(base_path):</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files:</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">file</span>.startswith(<span class="st">"fdc_"</span>) <span class="kw">and</span> <span class="bu">file</span>.endswith(<span class="st">".csv"</span>):</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>            fdc_file <span class="op">=</span> os.path.join(root, <span class="bu">file</span>)</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>            df_headers <span class="op">=</span> pd.read_csv(fdc_file, skiprows<span class="op">=</span><span class="dv">9</span>, nrows<span class="op">=</span><span class="dv">1</span>, header<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>            df_data <span class="op">=</span> pd.read_csv(fdc_file, skiprows<span class="op">=</span><span class="dv">11</span>, header<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>            col_indices <span class="op">=</span> {}</span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> col_idx, col_name <span class="kw">in</span> <span class="bu">enumerate</span>(df_headers.iloc[<span class="dv">0</span>]):</span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">isinstance</span>(col_name, <span class="bu">str</span>) <span class="kw">and</span> col_name.strip() <span class="kw">in</span> meses:</span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a>                    col_indices[meses[col_name.strip()]] <span class="op">=</span> col_idx</span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a>            station_code <span class="op">=</span> <span class="bu">file</span>.split(<span class="st">'_'</span>)[<span class="dv">1</span>].split(<span class="st">'.'</span>)[<span class="dv">0</span>]</span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a>            output_dir <span class="op">=</span> os.path.join(output_root_directory, station_code)</span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> os.path.exists(output_dir):</span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a>                os.makedirs(output_dir)</span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> mes, mes_label <span class="kw">in</span> meses.items():</span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> mes_label <span class="kw">in</span> col_indices:</span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true" tabindex="-1"></a>                    x_col <span class="op">=</span> col_indices[mes_label] <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb63-34"><a href="#cb63-34" aria-hidden="true" tabindex="-1"></a>                    y_col <span class="op">=</span> col_indices[mes_label] </span>
<span id="cb63-35"><a href="#cb63-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-36"><a href="#cb63-36" aria-hidden="true" tabindex="-1"></a>                    data <span class="op">=</span> df_data.iloc[:, [y_col, x_col]].dropna()</span>
<span id="cb63-37"><a href="#cb63-37" aria-hidden="true" tabindex="-1"></a>                    data.columns <span class="op">=</span> [<span class="st">'Caudal'</span>, <span class="st">'Probabilidad'</span>]</span>
<span id="cb63-38"><a href="#cb63-38" aria-hidden="true" tabindex="-1"></a>                    data[<span class="st">'Probabilidad'</span>] <span class="op">=</span> data[<span class="st">'Probabilidad'</span>]</span>
<span id="cb63-39"><a href="#cb63-39" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb63-40"><a href="#cb63-40" aria-hidden="true" tabindex="-1"></a>                    plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb63-41"><a href="#cb63-41" aria-hidden="true" tabindex="-1"></a>                    plt.plot(data[<span class="st">'Probabilidad'</span>], data[<span class="st">'Caudal'</span>], marker<span class="op">=</span><span class="st">'o'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb63-42"><a href="#cb63-42" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#plt.title(f'Flow Duration Curve - {mes_label} ({station_code})', fontsize=16, fontname='Times New Roman')</span></span>
<span id="cb63-43"><a href="#cb63-43" aria-hidden="true" tabindex="-1"></a>                    plt.xlabel(<span class="st">'Probability of Exceedance (%)'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb63-44"><a href="#cb63-44" aria-hidden="true" tabindex="-1"></a>                    plt.ylabel(<span class="st">'Flow (m³/s)'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb63-45"><a href="#cb63-45" aria-hidden="true" tabindex="-1"></a>                    plt.grid(<span class="va">False</span>)</span>
<span id="cb63-46"><a href="#cb63-46" aria-hidden="true" tabindex="-1"></a>                    plt.tight_layout()</span>
<span id="cb63-47"><a href="#cb63-47" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb63-48"><a href="#cb63-48" aria-hidden="true" tabindex="-1"></a>                    output_file <span class="op">=</span> os.path.join(output_dir, <span class="ss">f'FDC_</span><span class="sc">{</span>mes_label<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.png'</span>)</span>
<span id="cb63-49"><a href="#cb63-49" aria-hidden="true" tabindex="-1"></a>                    plt.savefig(output_file, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb63-50"><a href="#cb63-50" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb63-51"><a href="#cb63-51" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb63-52"><a href="#cb63-52" aria-hidden="true" tabindex="-1"></a>                        plt.show()</span>
<span id="cb63-53"><a href="#cb63-53" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb63-54"><a href="#cb63-54" aria-hidden="true" tabindex="-1"></a>                        plt.close()</span>
<span id="cb63-55"><a href="#cb63-55" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb63-56"><a href="#cb63-56" aria-hidden="true" tabindex="-1"></a>                    contador <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb63-57"><a href="#cb63-57" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb63-58"><a href="#cb63-58" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Flow Duration Curve generated for each month of each station'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-polar-14" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-polar-14-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="indicadores_files/figure-html/fig-polar-14-output-1.png" width="1101" height="716" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-polar-14-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14: Flow Duration Curve for January at station 9423001
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Flow Duration Curve generated for each month of each station</code></pre>
</div>
</div>
<p>6.2.5. Figure of the streamflow of all stations present in the basin</p>
<p>The order of the months in the <code>sco_</code> file may vary. If so, adjust the <code>meses_ingles</code> variable accordingly.</p>
<div id="cell-fig-polar-15" class="cell" data-execution_count="48">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>base_path <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/9.IHA/csv'</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>save_path <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/10.Figuras_IHA/Caudal'</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>os.makedirs(save_path, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>linestyles <span class="op">=</span> [<span class="st">'-'</span>, <span class="st">'--'</span>, <span class="st">'-.'</span>, <span class="st">':'</span>, (<span class="dv">0</span>, (<span class="dv">1</span>, <span class="dv">10</span>)), (<span class="dv">0</span>, (<span class="dv">5</span>, <span class="dv">10</span>)), (<span class="dv">0</span>, (<span class="dv">3</span>, <span class="dv">5</span>)), (<span class="dv">0</span>, (<span class="dv">3</span>, <span class="dv">1</span>)), (<span class="dv">0</span>, (<span class="dv">5</span>, <span class="dv">3</span>)), (<span class="dv">0</span>, (<span class="dv">1</span>, <span class="dv">1</span>)), (<span class="dv">0</span>, (<span class="dv">5</span>, <span class="dv">1</span>)), (<span class="dv">0</span>, (<span class="dv">1</span>, <span class="dv">5</span>))]</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>colores <span class="op">=</span> [<span class="st">'black'</span>, <span class="st">'darkgray'</span>, <span class="st">'gray'</span>, <span class="st">'lightgray'</span>, <span class="st">'black'</span>, <span class="st">'dimgray'</span>, <span class="st">'gray'</span>, <span class="st">'dimgray'</span>, <span class="st">'darkgray'</span>, <span class="st">'black'</span>, <span class="st">'dimgray'</span>, <span class="st">'black'</span>]</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>line_counter <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> root, dirs, files <span class="kw">in</span> os.walk(base_path):</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files:</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">file</span>.startswith(<span class="st">"sco_"</span>) <span class="kw">and</span> <span class="bu">file</span>.endswith(<span class="st">".csv"</span>):</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>            sco_file <span class="op">=</span> os.path.join(root, <span class="bu">file</span>)</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>            nombre_archivo <span class="op">=</span> os.path.basename(sco_file)</span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>            codigo_estacion <span class="op">=</span> nombre_archivo.split(<span class="st">'_'</span>)[<span class="dv">1</span>].split(<span class="st">'.'</span>)[<span class="dv">0</span>]</span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>            df <span class="op">=</span> pd.read_csv(sco_file, skiprows<span class="op">=</span><span class="dv">17</span>, header<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>            df_mes <span class="op">=</span> df.iloc[:<span class="dv">12</span>, :<span class="dv">2</span>]</span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>            df_mes.columns <span class="op">=</span> [<span class="st">'Month'</span>, <span class="st">'Median'</span>]</span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>            meses_ingles <span class="op">=</span> [<span class="st">'January'</span>, <span class="st">'February'</span>, <span class="st">'March'</span>, <span class="st">'April'</span>, <span class="st">'May'</span>, <span class="st">'June'</span>, <span class="st">'July'</span>, <span class="st">'August'</span>, <span class="st">'September'</span>, <span class="st">'October'</span>, <span class="st">'November'</span>, <span class="st">'December'</span>]</span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>            df_mes[<span class="st">'Month'</span>] <span class="op">=</span> meses_ingles</span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>            df_mes.set_index(<span class="st">'Month'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a>            linestyle <span class="op">=</span> linestyles[line_counter <span class="op">%</span> <span class="bu">len</span>(linestyles)]</span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>            color <span class="op">=</span> colores[line_counter <span class="op">%</span> <span class="bu">len</span>(colores)]</span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a>            plt.plot(df_mes.index, df_mes[<span class="st">'Median'</span>], linestyle<span class="op">=</span>linestyle, color<span class="op">=</span>color, label<span class="op">=</span><span class="ss">f'Station </span><span class="sc">{</span>codigo_estacion<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a>            line_counter <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true" tabindex="-1"></a>plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb65-32"><a href="#cb65-32" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.title('Median monthly flow by station', fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb65-33"><a href="#cb65-33" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Month'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb65-34"><a href="#cb65-34" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Flow (m3/s)'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb65-35"><a href="#cb65-35" aria-hidden="true" tabindex="-1"></a>plt.xticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb65-36"><a href="#cb65-36" aria-hidden="true" tabindex="-1"></a>plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb65-37"><a href="#cb65-37" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb65-38"><a href="#cb65-38" aria-hidden="true" tabindex="-1"></a>plt.legend(fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb65-39"><a href="#cb65-39" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">False</span>)</span>
<span id="cb65-40"><a href="#cb65-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-41"><a href="#cb65-41" aria-hidden="true" tabindex="-1"></a>save_file <span class="op">=</span> os.path.join(save_path, <span class="st">'qmonthly_TOTstations.png'</span>)</span>
<span id="cb65-42"><a href="#cb65-42" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb65-43"><a href="#cb65-43" aria-hidden="true" tabindex="-1"></a>plt.savefig(save_file, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb65-44"><a href="#cb65-44" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-polar-15" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-polar-15-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="indicadores_files/figure-html/fig-polar-15-output-1.png" width="1098" height="717" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-polar-15-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;15: Median monthly flow by station
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="time-series-figures" class="level3" data-number="6.3">
<h3 data-number="6.3" class="anchored" data-anchor-id="time-series-figures"><span class="header-section-number">6.3</span> Time series figures</h3>
<p>The language of the months, indicator and column of “year” or even the way they are written in the <code>ann_</code> and <code>sco_</code> file may vary.</p>
<p>If so, adjust:</p>
<ul>
<li><p><code>indicator_names</code> variable</p></li>
<li><p>the names for the regression in row <code>lsq_selected = lsq_data.loc[indicator['lsq_row'], ['Slope', 'YInt', 'Sigma', 'Corr', 'PValue', 'FStat', 'R2']]</code></p></li>
<li><p>the <code>skiprows</code> variable in <code>sco_data</code> with the number of the row where the list of the respective indicator begins</p></li>
<li><p>the <code>slope</code>, <code>intercept</code> and <code>r_squared</code> variables</p></li>
</ul>
<p>6.3.1. Median flow in July over time.</p>
<p>In this case, the time series of the median flow in July was selected, as it corresponds to the month with the highest flow in the study basin.</p>
<p>6.3.1.1. Reading input files and extracting specific data related to the selected month.</p>
<div id="984a678b" class="cell" data-execution_count="49">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>base_folder_path <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/9.IHA/csv/'</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>output_folder_path <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/10.Figuras_IHA/IHA anuales/'</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>os.makedirs(output_folder_path, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>indicator_names <span class="op">=</span> {</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'lsq_row'</span>: <span class="st">'July'</span>,              </span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ann_column'</span>: <span class="st">'July'</span>,           </span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sco_row'</span>: <span class="st">'July'</span>,              </span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'plot_label'</span>: <span class="st">'July'</span>            </span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_data(lsq_file, ann_file, sco_file, indicator):</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>    lsq_data <span class="op">=</span> pd.read_csv(lsq_file, skiprows<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>    lsq_data.set_index(lsq_data.columns[<span class="dv">0</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>        lsq_selected <span class="op">=</span> lsq_data.loc[indicator[<span class="st">'lsq_row'</span>], [<span class="st">'Slope'</span>, <span class="st">'YInt'</span>, <span class="st">'Sigma'</span>, <span class="st">'Corr'</span>, <span class="st">'PValue'</span>, <span class="st">'FStat'</span>, <span class="st">'R2'</span>]]</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">KeyError</span>:</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Indicator '</span><span class="sc">{</span>indicator[<span class="st">'lsq_row'</span>]<span class="sc">}</span><span class="ss">' not found in lsq_file."</span>)</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>    ann_data <span class="op">=</span> pd.read_csv(ann_file, skiprows<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>    ann_data.columns <span class="op">=</span> ann_data.columns.<span class="bu">str</span>.strip()</span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> indicator[<span class="st">'ann_column'</span>] <span class="kw">not</span> <span class="kw">in</span> ann_data.columns:</span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Column '</span><span class="sc">{</span>indicator[<span class="st">'ann_column'</span>]<span class="sc">}</span><span class="ss">' not found in ann_file."</span>)</span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>    ann_data <span class="op">=</span> ann_data[[<span class="st">'Year'</span>, indicator[<span class="st">'ann_column'</span>]]].dropna()</span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>    sco_data <span class="op">=</span> pd.read_csv(sco_file, skiprows<span class="op">=</span><span class="dv">17</span>, nrows<span class="op">=</span><span class="dv">13</span>, header<span class="op">=</span><span class="va">None</span>, index_col<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a>    sco_data.index.name <span class="op">=</span> <span class="st">'Parameter'</span></span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a>    sco_data.columns <span class="op">=</span> [<span class="st">'Mediana'</span>, <span class="st">'Coef. Disper.'</span>]</span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> indicator[<span class="st">'sco_row'</span>] <span class="kw">not</span> <span class="kw">in</span> sco_data.index:</span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Indicator '</span><span class="sc">{</span>indicator[<span class="st">'sco_row'</span>]<span class="sc">}</span><span class="ss">' not found in sco_file."</span>)</span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb66-34"><a href="#cb66-34" aria-hidden="true" tabindex="-1"></a>    sco_selected <span class="op">=</span> sco_data.loc[[indicator[<span class="st">'sco_row'</span>]]]</span>
<span id="cb66-35"><a href="#cb66-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-36"><a href="#cb66-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> lsq_selected, ann_data, sco_selected</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>6.3.1.2. Saving the extracted data in a single <code>.csv</code> file.</p>
<div id="6abf05e9" class="cell" data-execution_count="50">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> save_to_csv(lsq_data, ann_data, sco_data, output_file):</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(output_file, <span class="st">'w'</span>, newline<span class="op">=</span><span class="st">''</span>) <span class="im">as</span> csvfile:</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>        writer <span class="op">=</span> csv.writer(csvfile)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Variable'</span>, <span class="st">'Valor'</span>])</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, value <span class="kw">in</span> lsq_data.items():</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>            writer.writerow([idx, value])</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Year'</span>, indicator_names[<span class="st">'ann_column'</span>]])</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _, row <span class="kw">in</span> ann_data.iterrows():</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>            writer.writerow([<span class="bu">int</span>(row[<span class="st">'Year'</span>]), row[indicator_names[<span class="st">'ann_column'</span>]]])</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Mediana'</span>, sco_data[<span class="st">'Mediana'</span>].values[<span class="dv">0</span>]])</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Coef. Disper.'</span>, sco_data[<span class="st">'Coef. Disper.'</span>].values[<span class="dv">0</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>6.3.1.3. Graph format.</p>
<div id="1912e005" class="cell" data-execution_count="51">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_data(df, slope, intercept, r_squared, station_code, plot_label):</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>    df_anios <span class="op">=</span> df[(df[<span class="st">'Variable'</span>].<span class="bu">str</span>.isnumeric()) <span class="op">&amp;</span> (df[<span class="st">'Valor'</span>].notna())].copy()</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    df_anios[<span class="st">'Variable'</span>] <span class="op">=</span> pd.to_numeric(df_anios[<span class="st">'Variable'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>    df_anios[<span class="st">'Valor'</span>] <span class="op">=</span> pd.to_numeric(df_anios[<span class="st">'Valor'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>    df_anios <span class="op">=</span> df_anios.dropna()</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>    plt.plot(df_anios[<span class="st">'Variable'</span>], df_anios[<span class="st">'Valor'</span>], marker<span class="op">=</span><span class="st">'o'</span>, linestyle<span class="op">=</span><span class="st">'None'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span>plot_label)</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(df_anios)):</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> df_anios[<span class="st">'Variable'</span>].iloc[i] <span class="op">-</span> df_anios[<span class="st">'Variable'</span>].iloc[i<span class="op">-</span><span class="dv">1</span>] <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>            plt.plot(df_anios[<span class="st">'Variable'</span>].iloc[i<span class="op">-</span><span class="dv">1</span>:i<span class="op">+</span><span class="dv">1</span>], df_anios[<span class="st">'Valor'</span>].iloc[i<span class="op">-</span><span class="dv">1</span>:i<span class="op">+</span><span class="dv">1</span>], linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>    line <span class="op">=</span> slope <span class="op">*</span> df_anios[<span class="st">'Variable'</span>] <span class="op">+</span> intercept</span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>    plt.plot(df_anios[<span class="st">'Variable'</span>], line, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Regression'</span>)</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>    plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">#plt.title(f'{plot_label} ({station_code})', fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Year'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Flow (m3/s)'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>    plt.xticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a>    plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>    plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.35</span>, <span class="fl">0.95</span>), fontsize<span class="op">=</span><span class="dv">14</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">False</span>)</span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a>    info_text <span class="op">=</span> <span class="ss">f'Slope: </span><span class="sc">{</span>slope<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">R-Squared: </span><span class="sc">{</span>r_squared<span class="sc">:.2f}</span><span class="ss">'</span></span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>    plt.text(<span class="fl">1.15</span>, <span class="fl">0.65</span>, info_text, transform<span class="op">=</span>plt.gca().transAxes, fontsize<span class="op">=</span><span class="dv">14</span>,</span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a>             verticalalignment<span class="op">=</span><span class="st">'top'</span>, horizontalalignment<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a>             bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, boxstyle<span class="op">=</span><span class="st">'round,pad=0.5'</span>))</span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a>    station_folder <span class="op">=</span> os.path.join(output_folder_path, station_code)</span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true" tabindex="-1"></a>    os.makedirs(station_folder, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb68-33"><a href="#cb68-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-34"><a href="#cb68-34" aria-hidden="true" tabindex="-1"></a>    graph_filename <span class="op">=</span> os.path.join(station_folder, <span class="ss">f"</span><span class="sc">{</span>plot_label<span class="sc">.</span>lower()<span class="sc">.</span>replace(<span class="st">' '</span>, <span class="st">'_'</span>)<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.png"</span>)</span>
<span id="cb68-35"><a href="#cb68-35" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb68-36"><a href="#cb68-36" aria-hidden="true" tabindex="-1"></a>    plt.savefig(graph_filename)</span>
<span id="cb68-37"><a href="#cb68-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-38"><a href="#cb68-38" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"The CSV file and figure for station </span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss"> has been saved in </span><span class="sc">{</span>graph_filename<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>6.3.1.4. Graph generation.</p>
<div id="cell-fig-polar-16" class="cell" data-execution_count="52">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_all_stations(base_folder_path, output_folder_path, indicator):</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>    station_folders <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(base_folder_path) <span class="cf">if</span> os.path.isdir(os.path.join(base_folder_path, f))]</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>    contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> station_code <span class="kw">in</span> station_folders:</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>        lsq_file <span class="op">=</span> os.path.join(base_folder_path, station_code, <span class="ss">f'lsq_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>        ann_file <span class="op">=</span> os.path.join(base_folder_path, station_code, <span class="ss">f'ann_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>        sco_file <span class="op">=</span> os.path.join(base_folder_path, station_code, <span class="ss">f'sco_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">all</span>(os.path.exists(f) <span class="cf">for</span> f <span class="kw">in</span> [lsq_file, ann_file, sco_file]):</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Missing files for station </span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">. Skipping station.'</span>)</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>        lsq_data, ann_data, sco_data <span class="op">=</span> extract_data(lsq_file, ann_file, sco_file, indicator)</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> lsq_data <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> ann_data <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> sco_data <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>        output_file <span class="op">=</span> os.path.join(output_folder_path, <span class="ss">f"</span><span class="sc">{</span>indicator[<span class="st">'ann_column'</span>]<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv"</span>)</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>        save_to_csv(lsq_data, ann_data, sco_data, output_file)</span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>            df <span class="op">=</span> pd.read_csv(output_file, names<span class="op">=</span>[<span class="st">'Variable'</span>, <span class="st">'Valor'</span>], skiprows<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">FileNotFoundError</span>:</span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'File not found: </span><span class="sc">{</span>output_file<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df.dropna()</span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a>            slope <span class="op">=</span> <span class="bu">float</span>(df[df[<span class="st">'Variable'</span>] <span class="op">==</span> <span class="st">'Slope'</span>][<span class="st">'Valor'</span>].values[<span class="dv">0</span>])</span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a>            intercept <span class="op">=</span> <span class="bu">float</span>(df[df[<span class="st">'Variable'</span>] <span class="op">==</span> <span class="st">'YInt'</span>][<span class="st">'Valor'</span>].values[<span class="dv">0</span>])</span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true" tabindex="-1"></a>            r_squared <span class="op">=</span> <span class="bu">float</span>(df[df[<span class="st">'Variable'</span>] <span class="op">==</span> <span class="st">'R2'</span>][<span class="st">'Valor'</span>].values[<span class="dv">0</span>])</span>
<span id="cb69-33"><a href="#cb69-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> (<span class="pp">IndexError</span>, <span class="pp">ValueError</span>) <span class="im">as</span> e:</span>
<span id="cb69-34"><a href="#cb69-34" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Error extracting regression values: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb69-35"><a href="#cb69-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb69-36"><a href="#cb69-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-37"><a href="#cb69-37" aria-hidden="true" tabindex="-1"></a>        plot_data(df, slope, intercept, r_squared, station_code, indicator[<span class="st">'plot_label'</span>])</span>
<span id="cb69-38"><a href="#cb69-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb69-39"><a href="#cb69-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb69-40"><a href="#cb69-40" aria-hidden="true" tabindex="-1"></a>           plt.show()</span>
<span id="cb69-41"><a href="#cb69-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb69-42"><a href="#cb69-42" aria-hidden="true" tabindex="-1"></a>            plt.close()</span>
<span id="cb69-43"><a href="#cb69-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb69-44"><a href="#cb69-44" aria-hidden="true" tabindex="-1"></a>        contador <span class="op">+=</span> <span class="dv">1</span> </span>
<span id="cb69-45"><a href="#cb69-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-46"><a href="#cb69-46" aria-hidden="true" tabindex="-1"></a>process_all_stations(base_folder_path, output_folder_path, indicator_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>The CSV file and figure for station 9423001 has been saved in Hidroclima/Base de datos/10.Figuras_IHA/IHA anuales/9423001/july_9423001.png</code></pre>
</div>
<div class="cell-output cell-output-display">
<div id="fig-polar-16" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-polar-16-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="indicadores_files/figure-html/fig-polar-16-output-2.png" width="1024" height="717" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-polar-16-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;16: Median flow in July over time at station 9423001
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>The CSV file and figure for station 9433001 has been saved in Hidroclima/Base de datos/10.Figuras_IHA/IHA anuales/9433001/july_9433001.png
The CSV file and figure for station 9434001 has been saved in Hidroclima/Base de datos/10.Figuras_IHA/IHA anuales/9434001/july_9434001.png</code></pre>
</div>
</div>
<p>6.3.2. High flow pulses duration by station</p>
<p>6.3.2.1. Reading input files and extracting specific data related to the selected indicator.</p>
<div id="eb0bfcf5" class="cell" data-execution_count="53">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>indicator_names <span class="op">=</span> {</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'lsq_row'</span>: <span class="st">'High pulse duration'</span>,              </span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ann_column'</span>: <span class="st">'Hi pulse L'</span>,           </span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sco_row'</span>: <span class="st">'High pulse duration'</span>,              </span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'plot_label'</span>: <span class="st">'High pulse duration'</span>            </span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_data(lsq_file, ann_file, sco_file, indicator):</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>    lsq_data <span class="op">=</span> pd.read_csv(lsq_file, skiprows<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>    lsq_data.set_index(lsq_data.columns[<span class="dv">0</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>        lsq_selected <span class="op">=</span> lsq_data.loc[indicator[<span class="st">'lsq_row'</span>], [<span class="st">'Slope'</span>, <span class="st">'YInt'</span>, <span class="st">'Sigma'</span>, <span class="st">'Corr'</span>, <span class="st">'PValue'</span>, <span class="st">'FStat'</span>, <span class="st">'R2'</span>]]</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">KeyError</span>:</span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Indicator '</span><span class="sc">{</span>indicator[<span class="st">'lsq_row'</span>]<span class="sc">}</span><span class="ss">' not found in lsq_file."</span>)</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>    ann_data <span class="op">=</span> pd.read_csv(ann_file, skiprows<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>    ann_data.columns <span class="op">=</span> ann_data.columns.<span class="bu">str</span>.strip()</span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> indicator[<span class="st">'ann_column'</span>] <span class="kw">not</span> <span class="kw">in</span> ann_data.columns:</span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Column '</span><span class="sc">{</span>indicator[<span class="st">'ann_column'</span>]<span class="sc">}</span><span class="ss">' not found in ann_file."</span>)</span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>    ann_data <span class="op">=</span> ann_data[[<span class="st">'Year'</span>, indicator[<span class="st">'ann_column'</span>]]].dropna()</span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a>    sco_data <span class="op">=</span> pd.read_csv(sco_file, skiprows<span class="op">=</span><span class="dv">48</span>, nrows<span class="op">=</span><span class="dv">13</span>, header<span class="op">=</span><span class="va">None</span>, index_col<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a>    sco_data.index.name <span class="op">=</span> <span class="st">'Parameter'</span></span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a>    sco_data.columns <span class="op">=</span> [<span class="st">'Mediana'</span>, <span class="st">'Coef. Disper.'</span>]</span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> indicator[<span class="st">'sco_row'</span>] <span class="kw">not</span> <span class="kw">in</span> sco_data.index:</span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Indicator '</span><span class="sc">{</span>indicator[<span class="st">'sco_row'</span>]<span class="sc">}</span><span class="ss">' not found in sco_file."</span>)</span>
<span id="cb72-29"><a href="#cb72-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb72-30"><a href="#cb72-30" aria-hidden="true" tabindex="-1"></a>    sco_selected <span class="op">=</span> sco_data.loc[[indicator[<span class="st">'sco_row'</span>]]]</span>
<span id="cb72-31"><a href="#cb72-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-32"><a href="#cb72-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> lsq_selected, ann_data, sco_selected</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>6.3.2.2. Saving the extracted data in a single <code>.csv</code> file.</p>
<div id="1678aeaa" class="cell" data-execution_count="54">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> save_to_csv(lsq_data, ann_data, sco_data, output_file):</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(output_file, <span class="st">'w'</span>, newline<span class="op">=</span><span class="st">''</span>) <span class="im">as</span> csvfile:</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>        writer <span class="op">=</span> csv.writer(csvfile)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Variable'</span>, <span class="st">'Valor'</span>])</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, value <span class="kw">in</span> lsq_data.items():</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>            writer.writerow([idx, value])</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Year'</span>, indicator_names[<span class="st">'ann_column'</span>]])</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _, row <span class="kw">in</span> ann_data.iterrows():</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>            writer.writerow([<span class="bu">int</span>(row[<span class="st">'Year'</span>]), row[indicator_names[<span class="st">'ann_column'</span>]]])</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Mediana'</span>, sco_data[<span class="st">'Mediana'</span>].values[<span class="dv">0</span>]])</span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Coef. Disper.'</span>, sco_data[<span class="st">'Coef. Disper.'</span>].values[<span class="dv">0</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>6.3.2.3. Graph format.</p>
<div id="c22749a0" class="cell" data-execution_count="55">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_data(df, slope, intercept, r_squared, station_code, plot_label):</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>    df_anios <span class="op">=</span> df[(df[<span class="st">'Variable'</span>].<span class="bu">str</span>.isnumeric()) <span class="op">&amp;</span> (df[<span class="st">'Valor'</span>].notna())].copy()</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>    df_anios[<span class="st">'Variable'</span>] <span class="op">=</span> pd.to_numeric(df_anios[<span class="st">'Variable'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>    df_anios[<span class="st">'Valor'</span>] <span class="op">=</span> pd.to_numeric(df_anios[<span class="st">'Valor'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>    df_anios <span class="op">=</span> df_anios.dropna()</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>    plt.plot(df_anios[<span class="st">'Variable'</span>], df_anios[<span class="st">'Valor'</span>], marker<span class="op">=</span><span class="st">'o'</span>, linestyle<span class="op">=</span><span class="st">'None'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span>plot_label)</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(df_anios)):</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> df_anios[<span class="st">'Variable'</span>].iloc[i] <span class="op">-</span> df_anios[<span class="st">'Variable'</span>].iloc[i<span class="op">-</span><span class="dv">1</span>] <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>            plt.plot(df_anios[<span class="st">'Variable'</span>].iloc[i<span class="op">-</span><span class="dv">1</span>:i<span class="op">+</span><span class="dv">1</span>], df_anios[<span class="st">'Valor'</span>].iloc[i<span class="op">-</span><span class="dv">1</span>:i<span class="op">+</span><span class="dv">1</span>], linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>    line <span class="op">=</span> slope <span class="op">*</span> df_anios[<span class="st">'Variable'</span>] <span class="op">+</span> intercept</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>    plt.plot(df_anios[<span class="st">'Variable'</span>], line, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Regression'</span>)</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>    plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">#plt.title(f'{plot_label} ({station_code})', fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Year'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Days'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a>    plt.xticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a>    plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a>    plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.35</span>, <span class="fl">0.95</span>), fontsize<span class="op">=</span><span class="dv">14</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">False</span>)</span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a>    info_text <span class="op">=</span> <span class="ss">f'Slope: </span><span class="sc">{</span>slope<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">R-Squared: </span><span class="sc">{</span>r_squared<span class="sc">:.2f}</span><span class="ss">'</span></span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a>    plt.text(<span class="fl">1.15</span>, <span class="fl">0.65</span>, info_text, transform<span class="op">=</span>plt.gca().transAxes, fontsize<span class="op">=</span><span class="dv">14</span>,</span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true" tabindex="-1"></a>             verticalalignment<span class="op">=</span><span class="st">'top'</span>, horizontalalignment<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb74-29"><a href="#cb74-29" aria-hidden="true" tabindex="-1"></a>             bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, boxstyle<span class="op">=</span><span class="st">'round,pad=0.5'</span>))</span>
<span id="cb74-30"><a href="#cb74-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-31"><a href="#cb74-31" aria-hidden="true" tabindex="-1"></a>    station_folder <span class="op">=</span> os.path.join(output_folder_path, station_code)</span>
<span id="cb74-32"><a href="#cb74-32" aria-hidden="true" tabindex="-1"></a>    os.makedirs(station_folder, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb74-33"><a href="#cb74-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-34"><a href="#cb74-34" aria-hidden="true" tabindex="-1"></a>    graph_filename <span class="op">=</span> os.path.join(station_folder, <span class="ss">f"</span><span class="sc">{</span>plot_label<span class="sc">.</span>lower()<span class="sc">.</span>replace(<span class="st">' '</span>, <span class="st">'_'</span>)<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.png"</span>)</span>
<span id="cb74-35"><a href="#cb74-35" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb74-36"><a href="#cb74-36" aria-hidden="true" tabindex="-1"></a>    plt.savefig(graph_filename)</span>
<span id="cb74-37"><a href="#cb74-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-38"><a href="#cb74-38" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"The CSV files and figure for station </span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss"> has been saved in </span><span class="sc">{</span>graph_filename<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>6.3.2.4. Graph generation.</p>
<div id="cell-fig-polar-17" class="cell" data-execution_count="56">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_all_stations(base_folder_path, output_folder_path, indicator):</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>    station_folders <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(base_folder_path) <span class="cf">if</span> os.path.isdir(os.path.join(base_folder_path, f))]</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>    contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> station_code <span class="kw">in</span> station_folders:</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>        lsq_file <span class="op">=</span> os.path.join(base_folder_path, station_code, <span class="ss">f'lsq_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>        ann_file <span class="op">=</span> os.path.join(base_folder_path, station_code, <span class="ss">f'ann_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>        sco_file <span class="op">=</span> os.path.join(base_folder_path, station_code, <span class="ss">f'sco_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">all</span>(os.path.exists(f) <span class="cf">for</span> f <span class="kw">in</span> [lsq_file, ann_file, sco_file]):</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Missing files for station </span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">. Skipping station.'</span>)</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>        lsq_data, ann_data, sco_data <span class="op">=</span> extract_data(lsq_file, ann_file, sco_file, indicator)</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> lsq_data <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> ann_data <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> sco_data <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>        output_file <span class="op">=</span> os.path.join(output_folder_path, <span class="ss">f"</span><span class="sc">{</span>indicator[<span class="st">'ann_column'</span>]<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv"</span>)</span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>        save_to_csv(lsq_data, ann_data, sco_data, output_file)</span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a>            df <span class="op">=</span> pd.read_csv(output_file, names<span class="op">=</span>[<span class="st">'Variable'</span>, <span class="st">'Valor'</span>], skiprows<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">FileNotFoundError</span>:</span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'File not found: </span><span class="sc">{</span>output_file<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb75-25"><a href="#cb75-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb75-26"><a href="#cb75-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-27"><a href="#cb75-27" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df.dropna()</span>
<span id="cb75-28"><a href="#cb75-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-29"><a href="#cb75-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb75-30"><a href="#cb75-30" aria-hidden="true" tabindex="-1"></a>            slope <span class="op">=</span> <span class="bu">float</span>(df[df[<span class="st">'Variable'</span>] <span class="op">==</span> <span class="st">'Slope'</span>][<span class="st">'Valor'</span>].values[<span class="dv">0</span>])</span>
<span id="cb75-31"><a href="#cb75-31" aria-hidden="true" tabindex="-1"></a>            intercept <span class="op">=</span> <span class="bu">float</span>(df[df[<span class="st">'Variable'</span>] <span class="op">==</span> <span class="st">'YInt'</span>][<span class="st">'Valor'</span>].values[<span class="dv">0</span>])</span>
<span id="cb75-32"><a href="#cb75-32" aria-hidden="true" tabindex="-1"></a>            r_squared <span class="op">=</span> <span class="bu">float</span>(df[df[<span class="st">'Variable'</span>] <span class="op">==</span> <span class="st">'R2'</span>][<span class="st">'Valor'</span>].values[<span class="dv">0</span>])</span>
<span id="cb75-33"><a href="#cb75-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> (<span class="pp">IndexError</span>, <span class="pp">ValueError</span>) <span class="im">as</span> e:</span>
<span id="cb75-34"><a href="#cb75-34" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Error extracting regression values: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb75-35"><a href="#cb75-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb75-36"><a href="#cb75-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-37"><a href="#cb75-37" aria-hidden="true" tabindex="-1"></a>        plot_data(df, slope, intercept, r_squared, station_code, indicator[<span class="st">'plot_label'</span>])</span>
<span id="cb75-38"><a href="#cb75-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb75-39"><a href="#cb75-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb75-40"><a href="#cb75-40" aria-hidden="true" tabindex="-1"></a>           plt.show()</span>
<span id="cb75-41"><a href="#cb75-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb75-42"><a href="#cb75-42" aria-hidden="true" tabindex="-1"></a>            plt.close()</span>
<span id="cb75-43"><a href="#cb75-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-44"><a href="#cb75-44" aria-hidden="true" tabindex="-1"></a>        contador <span class="op">+=</span> <span class="dv">1</span> </span>
<span id="cb75-45"><a href="#cb75-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-46"><a href="#cb75-46" aria-hidden="true" tabindex="-1"></a>process_all_stations(base_folder_path, output_folder_path, indicator_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>The CSV files and figure for station 9423001 has been saved in Hidroclima/Base de datos/10.Figuras_IHA/IHA anuales/9423001/high_pulse_duration_9423001.png</code></pre>
</div>
<div class="cell-output cell-output-display">
<div id="fig-polar-17" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-polar-17-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="indicadores_files/figure-html/fig-polar-17-output-2.png" width="1029" height="717" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-polar-17-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;17: High flow pulses duration over time at station 9423001
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>The CSV files and figure for station 9433001 has been saved in Hidroclima/Base de datos/10.Figuras_IHA/IHA anuales/9433001/high_pulse_duration_9433001.png
The CSV files and figure for station 9434001 has been saved in Hidroclima/Base de datos/10.Figuras_IHA/IHA anuales/9434001/high_pulse_duration_9434001.png</code></pre>
</div>
</div>
<p>6.3.3. Base Flow Index by station</p>
<p>6.3.3.1. Reading input files and extracting specific data related to the selected indicator.</p>
<div id="7f367082" class="cell" data-execution_count="57">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>indicator_names <span class="op">=</span> {</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'lsq_row'</span>: <span class="st">'Base flow index'</span>,              </span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ann_column'</span>: <span class="st">'Base flow'</span>,           </span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sco_row'</span>: <span class="st">'Base flow index'</span>,              </span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'plot_label'</span>: <span class="st">'Base flow index'</span>            </span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_data(lsq_file, ann_file, sco_file, indicator):</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>    lsq_data <span class="op">=</span> pd.read_csv(lsq_file, skiprows<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>    lsq_data.set_index(lsq_data.columns[<span class="dv">0</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>        lsq_selected <span class="op">=</span> lsq_data.loc[indicator[<span class="st">'lsq_row'</span>], [<span class="st">'Slope'</span>, <span class="st">'YInt'</span>, <span class="st">'Sigma'</span>, <span class="st">'Corr'</span>, <span class="st">'PValue'</span>, <span class="st">'FStat'</span>, <span class="st">'R2'</span>]]</span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">KeyError</span>:</span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Indicator '</span><span class="sc">{</span>indicator[<span class="st">'lsq_row'</span>]<span class="sc">}</span><span class="ss">' not found in lsq_file."</span>)</span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>    ann_data <span class="op">=</span> pd.read_csv(ann_file, skiprows<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a>    ann_data.columns <span class="op">=</span> ann_data.columns.<span class="bu">str</span>.strip()</span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> indicator[<span class="st">'ann_column'</span>] <span class="kw">not</span> <span class="kw">in</span> ann_data.columns:</span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Column '</span><span class="sc">{</span>indicator[<span class="st">'ann_column'</span>]<span class="sc">}</span><span class="ss">' not found in ann_file."</span>)</span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true" tabindex="-1"></a>    ann_data <span class="op">=</span> ann_data[[<span class="st">'Year'</span>, indicator[<span class="st">'ann_column'</span>]]].dropna()</span>
<span id="cb78-23"><a href="#cb78-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-24"><a href="#cb78-24" aria-hidden="true" tabindex="-1"></a>    sco_data <span class="op">=</span> pd.read_csv(sco_file, skiprows<span class="op">=</span><span class="dv">30</span>, nrows<span class="op">=</span><span class="dv">13</span>, header<span class="op">=</span><span class="va">None</span>, index_col<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb78-25"><a href="#cb78-25" aria-hidden="true" tabindex="-1"></a>    sco_data.index.name <span class="op">=</span> <span class="st">'Parameter'</span></span>
<span id="cb78-26"><a href="#cb78-26" aria-hidden="true" tabindex="-1"></a>    sco_data.columns <span class="op">=</span> [<span class="st">'Mediana'</span>, <span class="st">'Coef. Disper.'</span>]</span>
<span id="cb78-27"><a href="#cb78-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> indicator[<span class="st">'sco_row'</span>] <span class="kw">not</span> <span class="kw">in</span> sco_data.index:</span>
<span id="cb78-28"><a href="#cb78-28" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Indicator '</span><span class="sc">{</span>indicator[<span class="st">'sco_row'</span>]<span class="sc">}</span><span class="ss">' not found in sco_file."</span>)</span>
<span id="cb78-29"><a href="#cb78-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb78-30"><a href="#cb78-30" aria-hidden="true" tabindex="-1"></a>    sco_selected <span class="op">=</span> sco_data.loc[[indicator[<span class="st">'sco_row'</span>]]]</span>
<span id="cb78-31"><a href="#cb78-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-32"><a href="#cb78-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> lsq_selected, ann_data, sco_selected</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>6.3.3.2. Saving the extracted data in a single <code>.csv</code> file.</p>
<div id="47be051f" class="cell" data-execution_count="58">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> save_to_csv(lsq_data, ann_data, sco_data, output_file):</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(output_file, <span class="st">'w'</span>, newline<span class="op">=</span><span class="st">''</span>) <span class="im">as</span> csvfile:</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>        writer <span class="op">=</span> csv.writer(csvfile)</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Variable'</span>, <span class="st">'Valor'</span>])</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, value <span class="kw">in</span> lsq_data.items():</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>            writer.writerow([idx, value])</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Year'</span>, indicator_names[<span class="st">'ann_column'</span>]])</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _, row <span class="kw">in</span> ann_data.iterrows():</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>            writer.writerow([<span class="bu">int</span>(row[<span class="st">'Year'</span>]), row[indicator_names[<span class="st">'ann_column'</span>]]])</span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Mediana'</span>, sco_data[<span class="st">'Mediana'</span>].values[<span class="dv">0</span>]])</span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Coef. Disper.'</span>, sco_data[<span class="st">'Coef. Disper.'</span>].values[<span class="dv">0</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>6.3.3.3. Graph format.</p>
<div id="51986a42" class="cell" data-execution_count="59">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_data(df, slope, intercept, r_squared, station_code, plot_label):</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>    df_anios <span class="op">=</span> df[(df[<span class="st">'Variable'</span>].<span class="bu">str</span>.isnumeric()) <span class="op">&amp;</span> (df[<span class="st">'Valor'</span>].notna())].copy()</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>    df_anios[<span class="st">'Variable'</span>] <span class="op">=</span> pd.to_numeric(df_anios[<span class="st">'Variable'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>    df_anios[<span class="st">'Valor'</span>] <span class="op">=</span> pd.to_numeric(df_anios[<span class="st">'Valor'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>    df_anios <span class="op">=</span> df_anios.dropna()</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>    plt.plot(df_anios[<span class="st">'Variable'</span>], df_anios[<span class="st">'Valor'</span>], marker<span class="op">=</span><span class="st">'o'</span>, linestyle<span class="op">=</span><span class="st">'None'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span>plot_label)</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(df_anios)):</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> df_anios[<span class="st">'Variable'</span>].iloc[i] <span class="op">-</span> df_anios[<span class="st">'Variable'</span>].iloc[i<span class="op">-</span><span class="dv">1</span>] <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>            plt.plot(df_anios[<span class="st">'Variable'</span>].iloc[i<span class="op">-</span><span class="dv">1</span>:i<span class="op">+</span><span class="dv">1</span>], df_anios[<span class="st">'Valor'</span>].iloc[i<span class="op">-</span><span class="dv">1</span>:i<span class="op">+</span><span class="dv">1</span>], linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>    line <span class="op">=</span> slope <span class="op">*</span> df_anios[<span class="st">'Variable'</span>] <span class="op">+</span> intercept</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>    plt.plot(df_anios[<span class="st">'Variable'</span>], line, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Regression'</span>)</span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>    plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">#plt.title(f'{plot_label} ({station_code})', fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Year'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'BFI'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>    plt.xticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a>    plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>    plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.35</span>, <span class="fl">0.95</span>), fontsize<span class="op">=</span><span class="dv">14</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">False</span>)</span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a>    info_text <span class="op">=</span> <span class="ss">f'Slope: </span><span class="sc">{</span>slope<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">R-Squared: </span><span class="sc">{</span>r_squared<span class="sc">:.2f}</span><span class="ss">'</span></span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a>    plt.text(<span class="fl">1.15</span>, <span class="fl">0.65</span>, info_text, transform<span class="op">=</span>plt.gca().transAxes, fontsize<span class="op">=</span><span class="dv">14</span>,</span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a>             verticalalignment<span class="op">=</span><span class="st">'top'</span>, horizontalalignment<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a>             bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, boxstyle<span class="op">=</span><span class="st">'round,pad=0.5'</span>))</span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a>    station_folder <span class="op">=</span> os.path.join(output_folder_path, station_code)</span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a>    os.makedirs(station_folder, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-34"><a href="#cb80-34" aria-hidden="true" tabindex="-1"></a>    graph_filename <span class="op">=</span> os.path.join(station_folder, <span class="ss">f"</span><span class="sc">{</span>plot_label<span class="sc">.</span>lower()<span class="sc">.</span>replace(<span class="st">' '</span>, <span class="st">'_'</span>)<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.png"</span>)</span>
<span id="cb80-35"><a href="#cb80-35" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb80-36"><a href="#cb80-36" aria-hidden="true" tabindex="-1"></a>    plt.savefig(graph_filename)</span>
<span id="cb80-37"><a href="#cb80-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-38"><a href="#cb80-38" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"The CSV files and figure for station </span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss"> has been saved in </span><span class="sc">{</span>graph_filename<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>6.3.3.4. Graph generation.</p>
<div id="cell-fig-polar-18" class="cell" data-execution_count="60">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_all_stations(base_folder_path, output_folder_path, indicator):</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>    station_folders <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(base_folder_path) <span class="cf">if</span> os.path.isdir(os.path.join(base_folder_path, f))]</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>    contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> station_code <span class="kw">in</span> station_folders:</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>        lsq_file <span class="op">=</span> os.path.join(base_folder_path, station_code, <span class="ss">f'lsq_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>        ann_file <span class="op">=</span> os.path.join(base_folder_path, station_code, <span class="ss">f'ann_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>        sco_file <span class="op">=</span> os.path.join(base_folder_path, station_code, <span class="ss">f'sco_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">all</span>(os.path.exists(f) <span class="cf">for</span> f <span class="kw">in</span> [lsq_file, ann_file, sco_file]):</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Missing files for station </span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">. Skipping station.'</span>)</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>        lsq_data, ann_data, sco_data <span class="op">=</span> extract_data(lsq_file, ann_file, sco_file, indicator)</span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> lsq_data <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> ann_data <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> sco_data <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>        output_file <span class="op">=</span> os.path.join(output_folder_path, <span class="ss">f"</span><span class="sc">{</span>indicator[<span class="st">'ann_column'</span>]<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv"</span>)</span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>        save_to_csv(lsq_data, ann_data, sco_data, output_file)</span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>            df <span class="op">=</span> pd.read_csv(output_file, names<span class="op">=</span>[<span class="st">'Variable'</span>, <span class="st">'Valor'</span>], skiprows<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">FileNotFoundError</span>:</span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'File not found: </span><span class="sc">{</span>output_file<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df.dropna()</span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a>            slope <span class="op">=</span> <span class="bu">float</span>(df[df[<span class="st">'Variable'</span>] <span class="op">==</span> <span class="st">'Slope'</span>][<span class="st">'Valor'</span>].values[<span class="dv">0</span>])</span>
<span id="cb81-31"><a href="#cb81-31" aria-hidden="true" tabindex="-1"></a>            intercept <span class="op">=</span> <span class="bu">float</span>(df[df[<span class="st">'Variable'</span>] <span class="op">==</span> <span class="st">'YInt'</span>][<span class="st">'Valor'</span>].values[<span class="dv">0</span>])</span>
<span id="cb81-32"><a href="#cb81-32" aria-hidden="true" tabindex="-1"></a>            r_squared <span class="op">=</span> <span class="bu">float</span>(df[df[<span class="st">'Variable'</span>] <span class="op">==</span> <span class="st">'R2'</span>][<span class="st">'Valor'</span>].values[<span class="dv">0</span>])</span>
<span id="cb81-33"><a href="#cb81-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> (<span class="pp">IndexError</span>, <span class="pp">ValueError</span>) <span class="im">as</span> e:</span>
<span id="cb81-34"><a href="#cb81-34" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Error extracting regression values: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb81-35"><a href="#cb81-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb81-36"><a href="#cb81-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-37"><a href="#cb81-37" aria-hidden="true" tabindex="-1"></a>        plot_data(df, slope, intercept, r_squared, station_code, indicator[<span class="st">'plot_label'</span>])</span>
<span id="cb81-38"><a href="#cb81-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb81-39"><a href="#cb81-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb81-40"><a href="#cb81-40" aria-hidden="true" tabindex="-1"></a>           plt.show()</span>
<span id="cb81-41"><a href="#cb81-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb81-42"><a href="#cb81-42" aria-hidden="true" tabindex="-1"></a>            plt.close()</span>
<span id="cb81-43"><a href="#cb81-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb81-44"><a href="#cb81-44" aria-hidden="true" tabindex="-1"></a>        contador <span class="op">+=</span> <span class="dv">1</span> </span>
<span id="cb81-45"><a href="#cb81-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-46"><a href="#cb81-46" aria-hidden="true" tabindex="-1"></a>process_all_stations(base_folder_path, output_folder_path, indicator_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>The CSV files and figure for station 9423001 has been saved in Hidroclima/Base de datos/10.Figuras_IHA/IHA anuales/9423001/base_flow_index_9423001.png</code></pre>
</div>
<div class="cell-output cell-output-display">
<div id="fig-polar-18" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-polar-18-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="indicadores_files/figure-html/fig-polar-18-output-2.png" width="1032" height="717" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-polar-18-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;18: Base Flow Index over time at station 9423001
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>The CSV files and figure for station 9433001 has been saved in Hidroclima/Base de datos/10.Figuras_IHA/IHA anuales/9433001/base_flow_index_9433001.png
The CSV files and figure for station 9434001 has been saved in Hidroclima/Base de datos/10.Figuras_IHA/IHA anuales/9434001/base_flow_index_9434001.png</code></pre>
</div>
</div>
<p>6.3.4. Small Floods Peaks over time</p>
<p>The same process is repeated, adjusted to the specific indicator.</p>
<div id="cell-fig-polar-19" class="cell" data-execution_count="61">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>indicator_names <span class="op">=</span> {</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'lsq_row'</span>: <span class="st">'Small Flood peak'</span>,              </span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ann_column'</span>: <span class="st">'Sfld1 peak'</span>,           </span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sco_row'</span>: <span class="st">'Small Flood peak'</span>,              </span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'plot_label'</span>: <span class="st">'Small Flood peak'</span>            </span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_data(lsq_file, ann_file, sco_file, indicator):</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>    lsq_data <span class="op">=</span> pd.read_csv(lsq_file, skiprows<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>    lsq_data.set_index(lsq_data.columns[<span class="dv">0</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>        lsq_selected <span class="op">=</span> lsq_data.loc[indicator[<span class="st">'lsq_row'</span>], [<span class="st">'Slope'</span>, <span class="st">'YInt'</span>, <span class="st">'Sigma'</span>, <span class="st">'Corr'</span>, <span class="st">'PValue'</span>, <span class="st">'FStat'</span>, <span class="st">'R2'</span>]]</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">KeyError</span>:</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Indicator '</span><span class="sc">{</span>indicator[<span class="st">'lsq_row'</span>]<span class="sc">}</span><span class="ss">' not found in lsq_file."</span>)</span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a>    ann_data <span class="op">=</span> pd.read_csv(ann_file, skiprows<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a>    ann_data.columns <span class="op">=</span> ann_data.columns.<span class="bu">str</span>.strip()</span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> indicator[<span class="st">'ann_column'</span>] <span class="kw">not</span> <span class="kw">in</span> ann_data.columns:</span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Column '</span><span class="sc">{</span>indicator[<span class="st">'ann_column'</span>]<span class="sc">}</span><span class="ss">' not found in ann_file."</span>)</span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a>    ann_data <span class="op">=</span> ann_data[[<span class="st">'Year'</span>, indicator[<span class="st">'ann_column'</span>]]].dropna()</span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a>    sco_data <span class="op">=</span> pd.read_csv(sco_file, skiprows<span class="op">=</span><span class="dv">80</span>, nrows<span class="op">=</span><span class="dv">13</span>, header<span class="op">=</span><span class="va">None</span>, index_col<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a>    sco_data.index.name <span class="op">=</span> <span class="st">'Parameter'</span></span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a>    sco_data.columns <span class="op">=</span> [<span class="st">'Mediana'</span>, <span class="st">'Coef. Disper.'</span>]</span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> indicator[<span class="st">'sco_row'</span>] <span class="kw">not</span> <span class="kw">in</span> sco_data.index:</span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Indicator '</span><span class="sc">{</span>indicator[<span class="st">'sco_row'</span>]<span class="sc">}</span><span class="ss">' not found in sco_file."</span>)</span>
<span id="cb84-29"><a href="#cb84-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb84-30"><a href="#cb84-30" aria-hidden="true" tabindex="-1"></a>    sco_selected <span class="op">=</span> sco_data.loc[[indicator[<span class="st">'sco_row'</span>]]]</span>
<span id="cb84-31"><a href="#cb84-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-32"><a href="#cb84-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> lsq_selected, ann_data, sco_selected</span>
<span id="cb84-33"><a href="#cb84-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-34"><a href="#cb84-34" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> save_to_csv(lsq_data, ann_data, sco_data, output_file):</span>
<span id="cb84-35"><a href="#cb84-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(output_file, <span class="st">'w'</span>, newline<span class="op">=</span><span class="st">''</span>) <span class="im">as</span> csvfile:</span>
<span id="cb84-36"><a href="#cb84-36" aria-hidden="true" tabindex="-1"></a>        writer <span class="op">=</span> csv.writer(csvfile)</span>
<span id="cb84-37"><a href="#cb84-37" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb84-38"><a href="#cb84-38" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Variable'</span>, <span class="st">'Valor'</span>])</span>
<span id="cb84-39"><a href="#cb84-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, value <span class="kw">in</span> lsq_data.items():</span>
<span id="cb84-40"><a href="#cb84-40" aria-hidden="true" tabindex="-1"></a>            writer.writerow([idx, value])</span>
<span id="cb84-41"><a href="#cb84-41" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb84-42"><a href="#cb84-42" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Year'</span>, indicator_names[<span class="st">'ann_column'</span>]])</span>
<span id="cb84-43"><a href="#cb84-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _, row <span class="kw">in</span> ann_data.iterrows():</span>
<span id="cb84-44"><a href="#cb84-44" aria-hidden="true" tabindex="-1"></a>            writer.writerow([<span class="bu">int</span>(row[<span class="st">'Year'</span>]), row[indicator_names[<span class="st">'ann_column'</span>]]])</span>
<span id="cb84-45"><a href="#cb84-45" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb84-46"><a href="#cb84-46" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Mediana'</span>, sco_data[<span class="st">'Mediana'</span>].values[<span class="dv">0</span>]])</span>
<span id="cb84-47"><a href="#cb84-47" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Coef. Disper.'</span>, sco_data[<span class="st">'Coef. Disper.'</span>].values[<span class="dv">0</span>]])</span>
<span id="cb84-48"><a href="#cb84-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-49"><a href="#cb84-49" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_data(df, slope, intercept, r_squared, station_code, plot_label):</span>
<span id="cb84-50"><a href="#cb84-50" aria-hidden="true" tabindex="-1"></a>    df_anios <span class="op">=</span> df[(df[<span class="st">'Variable'</span>].<span class="bu">str</span>.isnumeric()) <span class="op">&amp;</span> (df[<span class="st">'Valor'</span>].notna())].copy()</span>
<span id="cb84-51"><a href="#cb84-51" aria-hidden="true" tabindex="-1"></a>    df_anios[<span class="st">'Variable'</span>] <span class="op">=</span> pd.to_numeric(df_anios[<span class="st">'Variable'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb84-52"><a href="#cb84-52" aria-hidden="true" tabindex="-1"></a>    df_anios[<span class="st">'Valor'</span>] <span class="op">=</span> pd.to_numeric(df_anios[<span class="st">'Valor'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb84-53"><a href="#cb84-53" aria-hidden="true" tabindex="-1"></a>    df_anios <span class="op">=</span> df_anios.dropna()</span>
<span id="cb84-54"><a href="#cb84-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-55"><a href="#cb84-55" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb84-56"><a href="#cb84-56" aria-hidden="true" tabindex="-1"></a>    plt.plot(df_anios[<span class="st">'Variable'</span>], df_anios[<span class="st">'Valor'</span>], marker<span class="op">=</span><span class="st">'o'</span>, linestyle<span class="op">=</span><span class="st">'None'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span>plot_label)</span>
<span id="cb84-57"><a href="#cb84-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb84-58"><a href="#cb84-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(df_anios)):</span>
<span id="cb84-59"><a href="#cb84-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> df_anios[<span class="st">'Variable'</span>].iloc[i] <span class="op">-</span> df_anios[<span class="st">'Variable'</span>].iloc[i<span class="op">-</span><span class="dv">1</span>] <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb84-60"><a href="#cb84-60" aria-hidden="true" tabindex="-1"></a>            plt.plot(df_anios[<span class="st">'Variable'</span>].iloc[i<span class="op">-</span><span class="dv">1</span>:i<span class="op">+</span><span class="dv">1</span>], df_anios[<span class="st">'Valor'</span>].iloc[i<span class="op">-</span><span class="dv">1</span>:i<span class="op">+</span><span class="dv">1</span>], linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb84-61"><a href="#cb84-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-62"><a href="#cb84-62" aria-hidden="true" tabindex="-1"></a>    line <span class="op">=</span> slope <span class="op">*</span> df_anios[<span class="st">'Variable'</span>] <span class="op">+</span> intercept</span>
<span id="cb84-63"><a href="#cb84-63" aria-hidden="true" tabindex="-1"></a>    plt.plot(df_anios[<span class="st">'Variable'</span>], line, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Regression'</span>)</span>
<span id="cb84-64"><a href="#cb84-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-65"><a href="#cb84-65" aria-hidden="true" tabindex="-1"></a>    plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb84-66"><a href="#cb84-66" aria-hidden="true" tabindex="-1"></a>    <span class="co">#plt.title(f'{plot_label} ({station_code})', fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb84-67"><a href="#cb84-67" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Year'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb84-68"><a href="#cb84-68" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Flow (m3/s)'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb84-69"><a href="#cb84-69" aria-hidden="true" tabindex="-1"></a>    plt.xticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb84-70"><a href="#cb84-70" aria-hidden="true" tabindex="-1"></a>    plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb84-71"><a href="#cb84-71" aria-hidden="true" tabindex="-1"></a>    plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.35</span>, <span class="fl">0.95</span>), fontsize<span class="op">=</span><span class="dv">14</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb84-72"><a href="#cb84-72" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">False</span>)</span>
<span id="cb84-73"><a href="#cb84-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-74"><a href="#cb84-74" aria-hidden="true" tabindex="-1"></a>    info_text <span class="op">=</span> <span class="ss">f'Slope: </span><span class="sc">{</span>slope<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">R-Squared: </span><span class="sc">{</span>r_squared<span class="sc">:.2f}</span><span class="ss">'</span></span>
<span id="cb84-75"><a href="#cb84-75" aria-hidden="true" tabindex="-1"></a>    plt.text(<span class="fl">1.15</span>, <span class="fl">0.65</span>, info_text, transform<span class="op">=</span>plt.gca().transAxes, fontsize<span class="op">=</span><span class="dv">14</span>,</span>
<span id="cb84-76"><a href="#cb84-76" aria-hidden="true" tabindex="-1"></a>             verticalalignment<span class="op">=</span><span class="st">'top'</span>, horizontalalignment<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb84-77"><a href="#cb84-77" aria-hidden="true" tabindex="-1"></a>             bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, boxstyle<span class="op">=</span><span class="st">'round,pad=0.5'</span>))</span>
<span id="cb84-78"><a href="#cb84-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-79"><a href="#cb84-79" aria-hidden="true" tabindex="-1"></a>    station_folder <span class="op">=</span> os.path.join(output_folder_path, station_code)</span>
<span id="cb84-80"><a href="#cb84-80" aria-hidden="true" tabindex="-1"></a>    os.makedirs(station_folder, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb84-81"><a href="#cb84-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-82"><a href="#cb84-82" aria-hidden="true" tabindex="-1"></a>    graph_filename <span class="op">=</span> os.path.join(station_folder, <span class="ss">f"</span><span class="sc">{</span>plot_label<span class="sc">.</span>lower()<span class="sc">.</span>replace(<span class="st">' '</span>, <span class="st">'_'</span>)<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.png"</span>)</span>
<span id="cb84-83"><a href="#cb84-83" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb84-84"><a href="#cb84-84" aria-hidden="true" tabindex="-1"></a>    plt.savefig(graph_filename)</span>
<span id="cb84-85"><a href="#cb84-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-86"><a href="#cb84-86" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"The CSV files and figure for station </span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss"> has been saved in </span><span class="sc">{</span>graph_filename<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb84-87"><a href="#cb84-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-88"><a href="#cb84-88" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_all_stations(base_folder_path, output_folder_path, indicator):</span>
<span id="cb84-89"><a href="#cb84-89" aria-hidden="true" tabindex="-1"></a>    station_folders <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(base_folder_path) <span class="cf">if</span> os.path.isdir(os.path.join(base_folder_path, f))]</span>
<span id="cb84-90"><a href="#cb84-90" aria-hidden="true" tabindex="-1"></a>    contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb84-91"><a href="#cb84-91" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb84-92"><a href="#cb84-92" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> station_code <span class="kw">in</span> station_folders:</span>
<span id="cb84-93"><a href="#cb84-93" aria-hidden="true" tabindex="-1"></a>        lsq_file <span class="op">=</span> os.path.join(base_folder_path, station_code, <span class="ss">f'lsq_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb84-94"><a href="#cb84-94" aria-hidden="true" tabindex="-1"></a>        ann_file <span class="op">=</span> os.path.join(base_folder_path, station_code, <span class="ss">f'ann_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb84-95"><a href="#cb84-95" aria-hidden="true" tabindex="-1"></a>        sco_file <span class="op">=</span> os.path.join(base_folder_path, station_code, <span class="ss">f'sco_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb84-96"><a href="#cb84-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-97"><a href="#cb84-97" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">all</span>(os.path.exists(f) <span class="cf">for</span> f <span class="kw">in</span> [lsq_file, ann_file, sco_file]):</span>
<span id="cb84-98"><a href="#cb84-98" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Missing files for station </span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">. Skipping station.'</span>)</span>
<span id="cb84-99"><a href="#cb84-99" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb84-100"><a href="#cb84-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-101"><a href="#cb84-101" aria-hidden="true" tabindex="-1"></a>        lsq_data, ann_data, sco_data <span class="op">=</span> extract_data(lsq_file, ann_file, sco_file, indicator)</span>
<span id="cb84-102"><a href="#cb84-102" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> lsq_data <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> ann_data <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> sco_data <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb84-103"><a href="#cb84-103" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb84-104"><a href="#cb84-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-105"><a href="#cb84-105" aria-hidden="true" tabindex="-1"></a>        output_file <span class="op">=</span> os.path.join(output_folder_path, <span class="ss">f"</span><span class="sc">{</span>indicator[<span class="st">'ann_column'</span>]<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv"</span>)</span>
<span id="cb84-106"><a href="#cb84-106" aria-hidden="true" tabindex="-1"></a>        save_to_csv(lsq_data, ann_data, sco_data, output_file)</span>
<span id="cb84-107"><a href="#cb84-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-108"><a href="#cb84-108" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb84-109"><a href="#cb84-109" aria-hidden="true" tabindex="-1"></a>            df <span class="op">=</span> pd.read_csv(output_file, names<span class="op">=</span>[<span class="st">'Variable'</span>, <span class="st">'Valor'</span>], skiprows<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb84-110"><a href="#cb84-110" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">FileNotFoundError</span>:</span>
<span id="cb84-111"><a href="#cb84-111" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'File not found: </span><span class="sc">{</span>output_file<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb84-112"><a href="#cb84-112" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb84-113"><a href="#cb84-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-114"><a href="#cb84-114" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df.dropna()</span>
<span id="cb84-115"><a href="#cb84-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-116"><a href="#cb84-116" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb84-117"><a href="#cb84-117" aria-hidden="true" tabindex="-1"></a>            slope <span class="op">=</span> <span class="bu">float</span>(df[df[<span class="st">'Variable'</span>] <span class="op">==</span> <span class="st">'Slope'</span>][<span class="st">'Valor'</span>].values[<span class="dv">0</span>])</span>
<span id="cb84-118"><a href="#cb84-118" aria-hidden="true" tabindex="-1"></a>            intercept <span class="op">=</span> <span class="bu">float</span>(df[df[<span class="st">'Variable'</span>] <span class="op">==</span> <span class="st">'YInt'</span>][<span class="st">'Valor'</span>].values[<span class="dv">0</span>])</span>
<span id="cb84-119"><a href="#cb84-119" aria-hidden="true" tabindex="-1"></a>            r_squared <span class="op">=</span> <span class="bu">float</span>(df[df[<span class="st">'Variable'</span>] <span class="op">==</span> <span class="st">'R2'</span>][<span class="st">'Valor'</span>].values[<span class="dv">0</span>])</span>
<span id="cb84-120"><a href="#cb84-120" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> (<span class="pp">IndexError</span>, <span class="pp">ValueError</span>) <span class="im">as</span> e:</span>
<span id="cb84-121"><a href="#cb84-121" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Error extracting regression values: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb84-122"><a href="#cb84-122" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb84-123"><a href="#cb84-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-124"><a href="#cb84-124" aria-hidden="true" tabindex="-1"></a>        plot_data(df, slope, intercept, r_squared, station_code, indicator[<span class="st">'plot_label'</span>])</span>
<span id="cb84-125"><a href="#cb84-125" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb84-126"><a href="#cb84-126" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb84-127"><a href="#cb84-127" aria-hidden="true" tabindex="-1"></a>           plt.show()</span>
<span id="cb84-128"><a href="#cb84-128" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb84-129"><a href="#cb84-129" aria-hidden="true" tabindex="-1"></a>            plt.close()</span>
<span id="cb84-130"><a href="#cb84-130" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb84-131"><a href="#cb84-131" aria-hidden="true" tabindex="-1"></a>        contador <span class="op">+=</span> <span class="dv">1</span> </span>
<span id="cb84-132"><a href="#cb84-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-133"><a href="#cb84-133" aria-hidden="true" tabindex="-1"></a>process_all_stations(base_folder_path, output_folder_path, indicator_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>The CSV files and figure for station 9423001 has been saved in Hidroclima/Base de datos/10.Figuras_IHA/IHA anuales/9423001/small_flood_peak_9423001.png</code></pre>
</div>
<div class="cell-output cell-output-display">
<div id="fig-polar-19" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-polar-19-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="indicadores_files/figure-html/fig-polar-19-output-2.png" width="1024" height="717" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-polar-19-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;19: Small Floods Peaks over time at station 9423001
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>The CSV files and figure for station 9433001 has been saved in Hidroclima/Base de datos/10.Figuras_IHA/IHA anuales/9433001/small_flood_peak_9433001.png
The CSV files and figure for station 9434001 has been saved in Hidroclima/Base de datos/10.Figuras_IHA/IHA anuales/9434001/small_flood_peak_9434001.png</code></pre>
</div>
</div>
<p>6.3.4. Large Floods Peaks over time</p>
<p>The same process is repeated, adjusted to the specific indicator.</p>
<div id="cell-fig-polar-20" class="cell" data-execution_count="62">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>indicator_names <span class="op">=</span> {</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'lsq_row'</span>: <span class="st">'Large flood peak'</span>,              </span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ann_column'</span>: <span class="st">'Lfld1 peak'</span>,           </span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sco_row'</span>: <span class="st">'Large flood peak'</span>,              </span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'plot_label'</span>: <span class="st">'Large flood peak'</span>            </span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_data(lsq_file, ann_file, sco_file, indicator):</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>    lsq_data <span class="op">=</span> pd.read_csv(lsq_file, skiprows<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>    lsq_data.set_index(lsq_data.columns[<span class="dv">0</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>        lsq_selected <span class="op">=</span> lsq_data.loc[indicator[<span class="st">'lsq_row'</span>], [<span class="st">'Slope'</span>, <span class="st">'YInt'</span>, <span class="st">'Sigma'</span>, <span class="st">'Corr'</span>, <span class="st">'PValue'</span>, <span class="st">'FStat'</span>, <span class="st">'R2'</span>]]</span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">KeyError</span>:</span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Indicator '</span><span class="sc">{</span>indicator[<span class="st">'lsq_row'</span>]<span class="sc">}</span><span class="ss">' not found in lsq_file."</span>)</span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>    ann_data <span class="op">=</span> pd.read_csv(ann_file, skiprows<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a>    ann_data.columns <span class="op">=</span> ann_data.columns.<span class="bu">str</span>.strip()</span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> indicator[<span class="st">'ann_column'</span>] <span class="kw">not</span> <span class="kw">in</span> ann_data.columns:</span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Column '</span><span class="sc">{</span>indicator[<span class="st">'ann_column'</span>]<span class="sc">}</span><span class="ss">' not found in ann_file."</span>)</span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a>    ann_data <span class="op">=</span> ann_data[[<span class="st">'Year'</span>, indicator[<span class="st">'ann_column'</span>]]].dropna()</span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-24"><a href="#cb87-24" aria-hidden="true" tabindex="-1"></a>    sco_data <span class="op">=</span> pd.read_csv(sco_file, skiprows<span class="op">=</span><span class="dv">85</span>, nrows<span class="op">=</span><span class="dv">13</span>, header<span class="op">=</span><span class="va">None</span>, index_col<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb87-25"><a href="#cb87-25" aria-hidden="true" tabindex="-1"></a>    sco_data.index.name <span class="op">=</span> <span class="st">'Parameter'</span></span>
<span id="cb87-26"><a href="#cb87-26" aria-hidden="true" tabindex="-1"></a>    sco_data.columns <span class="op">=</span> [<span class="st">'Mediana'</span>, <span class="st">'Coef. Disper.'</span>]</span>
<span id="cb87-27"><a href="#cb87-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> indicator[<span class="st">'sco_row'</span>] <span class="kw">not</span> <span class="kw">in</span> sco_data.index:</span>
<span id="cb87-28"><a href="#cb87-28" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Indicator '</span><span class="sc">{</span>indicator[<span class="st">'sco_row'</span>]<span class="sc">}</span><span class="ss">' not found in sco_file."</span>)</span>
<span id="cb87-29"><a href="#cb87-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb87-30"><a href="#cb87-30" aria-hidden="true" tabindex="-1"></a>    sco_selected <span class="op">=</span> sco_data.loc[[indicator[<span class="st">'sco_row'</span>]]]</span>
<span id="cb87-31"><a href="#cb87-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-32"><a href="#cb87-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> lsq_selected, ann_data, sco_selected</span>
<span id="cb87-33"><a href="#cb87-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-34"><a href="#cb87-34" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> save_to_csv(lsq_data, ann_data, sco_data, output_file):</span>
<span id="cb87-35"><a href="#cb87-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(output_file, <span class="st">'w'</span>, newline<span class="op">=</span><span class="st">''</span>) <span class="im">as</span> csvfile:</span>
<span id="cb87-36"><a href="#cb87-36" aria-hidden="true" tabindex="-1"></a>        writer <span class="op">=</span> csv.writer(csvfile)</span>
<span id="cb87-37"><a href="#cb87-37" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb87-38"><a href="#cb87-38" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Variable'</span>, <span class="st">'Valor'</span>])</span>
<span id="cb87-39"><a href="#cb87-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, value <span class="kw">in</span> lsq_data.items():</span>
<span id="cb87-40"><a href="#cb87-40" aria-hidden="true" tabindex="-1"></a>            writer.writerow([idx, value])</span>
<span id="cb87-41"><a href="#cb87-41" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb87-42"><a href="#cb87-42" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Year'</span>, indicator_names[<span class="st">'ann_column'</span>]])</span>
<span id="cb87-43"><a href="#cb87-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _, row <span class="kw">in</span> ann_data.iterrows():</span>
<span id="cb87-44"><a href="#cb87-44" aria-hidden="true" tabindex="-1"></a>            writer.writerow([<span class="bu">int</span>(row[<span class="st">'Year'</span>]), row[indicator_names[<span class="st">'ann_column'</span>]]])</span>
<span id="cb87-45"><a href="#cb87-45" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb87-46"><a href="#cb87-46" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Mediana'</span>, sco_data[<span class="st">'Mediana'</span>].values[<span class="dv">0</span>]])</span>
<span id="cb87-47"><a href="#cb87-47" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Coef. Disper.'</span>, sco_data[<span class="st">'Coef. Disper.'</span>].values[<span class="dv">0</span>]])</span>
<span id="cb87-48"><a href="#cb87-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-49"><a href="#cb87-49" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_data(df, slope, intercept, r_squared, station_code, plot_label):</span>
<span id="cb87-50"><a href="#cb87-50" aria-hidden="true" tabindex="-1"></a>    df_anios <span class="op">=</span> df[(df[<span class="st">'Variable'</span>].<span class="bu">str</span>.isnumeric()) <span class="op">&amp;</span> (df[<span class="st">'Valor'</span>].notna())].copy()</span>
<span id="cb87-51"><a href="#cb87-51" aria-hidden="true" tabindex="-1"></a>    df_anios[<span class="st">'Variable'</span>] <span class="op">=</span> pd.to_numeric(df_anios[<span class="st">'Variable'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb87-52"><a href="#cb87-52" aria-hidden="true" tabindex="-1"></a>    df_anios[<span class="st">'Valor'</span>] <span class="op">=</span> pd.to_numeric(df_anios[<span class="st">'Valor'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb87-53"><a href="#cb87-53" aria-hidden="true" tabindex="-1"></a>    df_anios <span class="op">=</span> df_anios.dropna()</span>
<span id="cb87-54"><a href="#cb87-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-55"><a href="#cb87-55" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb87-56"><a href="#cb87-56" aria-hidden="true" tabindex="-1"></a>    plt.plot(df_anios[<span class="st">'Variable'</span>], df_anios[<span class="st">'Valor'</span>], marker<span class="op">=</span><span class="st">'o'</span>, linestyle<span class="op">=</span><span class="st">'None'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span>plot_label)</span>
<span id="cb87-57"><a href="#cb87-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-58"><a href="#cb87-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(df_anios)):</span>
<span id="cb87-59"><a href="#cb87-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> df_anios[<span class="st">'Variable'</span>].iloc[i] <span class="op">-</span> df_anios[<span class="st">'Variable'</span>].iloc[i<span class="op">-</span><span class="dv">1</span>] <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb87-60"><a href="#cb87-60" aria-hidden="true" tabindex="-1"></a>            plt.plot(df_anios[<span class="st">'Variable'</span>].iloc[i<span class="op">-</span><span class="dv">1</span>:i<span class="op">+</span><span class="dv">1</span>], df_anios[<span class="st">'Valor'</span>].iloc[i<span class="op">-</span><span class="dv">1</span>:i<span class="op">+</span><span class="dv">1</span>], linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb87-61"><a href="#cb87-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-62"><a href="#cb87-62" aria-hidden="true" tabindex="-1"></a>    line <span class="op">=</span> slope <span class="op">*</span> df_anios[<span class="st">'Variable'</span>] <span class="op">+</span> intercept</span>
<span id="cb87-63"><a href="#cb87-63" aria-hidden="true" tabindex="-1"></a>    plt.plot(df_anios[<span class="st">'Variable'</span>], line, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Regression'</span>)</span>
<span id="cb87-64"><a href="#cb87-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-65"><a href="#cb87-65" aria-hidden="true" tabindex="-1"></a>    plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb87-66"><a href="#cb87-66" aria-hidden="true" tabindex="-1"></a>    <span class="co">#plt.title(f'{plot_label} ({station_code})', fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb87-67"><a href="#cb87-67" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Year'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb87-68"><a href="#cb87-68" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Flow (m3/s)'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb87-69"><a href="#cb87-69" aria-hidden="true" tabindex="-1"></a>    plt.xticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb87-70"><a href="#cb87-70" aria-hidden="true" tabindex="-1"></a>    plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb87-71"><a href="#cb87-71" aria-hidden="true" tabindex="-1"></a>    plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.35</span>, <span class="fl">0.95</span>), fontsize<span class="op">=</span><span class="dv">14</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb87-72"><a href="#cb87-72" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">False</span>)</span>
<span id="cb87-73"><a href="#cb87-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-74"><a href="#cb87-74" aria-hidden="true" tabindex="-1"></a>    info_text <span class="op">=</span> <span class="ss">f'Slope: </span><span class="sc">{</span>slope<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">R-Squared: </span><span class="sc">{</span>r_squared<span class="sc">:.2f}</span><span class="ss">'</span></span>
<span id="cb87-75"><a href="#cb87-75" aria-hidden="true" tabindex="-1"></a>    plt.text(<span class="fl">1.15</span>, <span class="fl">0.65</span>, info_text, transform<span class="op">=</span>plt.gca().transAxes, fontsize<span class="op">=</span><span class="dv">14</span>,</span>
<span id="cb87-76"><a href="#cb87-76" aria-hidden="true" tabindex="-1"></a>             verticalalignment<span class="op">=</span><span class="st">'top'</span>, horizontalalignment<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb87-77"><a href="#cb87-77" aria-hidden="true" tabindex="-1"></a>             bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, boxstyle<span class="op">=</span><span class="st">'round,pad=0.5'</span>))</span>
<span id="cb87-78"><a href="#cb87-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-79"><a href="#cb87-79" aria-hidden="true" tabindex="-1"></a>    station_folder <span class="op">=</span> os.path.join(output_folder_path, station_code)</span>
<span id="cb87-80"><a href="#cb87-80" aria-hidden="true" tabindex="-1"></a>    os.makedirs(station_folder, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb87-81"><a href="#cb87-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-82"><a href="#cb87-82" aria-hidden="true" tabindex="-1"></a>    graph_filename <span class="op">=</span> os.path.join(station_folder, <span class="ss">f"</span><span class="sc">{</span>plot_label<span class="sc">.</span>lower()<span class="sc">.</span>replace(<span class="st">' '</span>, <span class="st">'_'</span>)<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.png"</span>)</span>
<span id="cb87-83"><a href="#cb87-83" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb87-84"><a href="#cb87-84" aria-hidden="true" tabindex="-1"></a>    plt.savefig(graph_filename)</span>
<span id="cb87-85"><a href="#cb87-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-86"><a href="#cb87-86" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"The CSV files and figure for station </span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss"> has been saved in </span><span class="sc">{</span>graph_filename<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb87-87"><a href="#cb87-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-88"><a href="#cb87-88" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_all_stations(base_folder_path, output_folder_path, indicator):</span>
<span id="cb87-89"><a href="#cb87-89" aria-hidden="true" tabindex="-1"></a>    station_folders <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(base_folder_path) <span class="cf">if</span> os.path.isdir(os.path.join(base_folder_path, f))]</span>
<span id="cb87-90"><a href="#cb87-90" aria-hidden="true" tabindex="-1"></a>    contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb87-91"><a href="#cb87-91" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-92"><a href="#cb87-92" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> station_code <span class="kw">in</span> station_folders:</span>
<span id="cb87-93"><a href="#cb87-93" aria-hidden="true" tabindex="-1"></a>        lsq_file <span class="op">=</span> os.path.join(base_folder_path, station_code, <span class="ss">f'lsq_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb87-94"><a href="#cb87-94" aria-hidden="true" tabindex="-1"></a>        ann_file <span class="op">=</span> os.path.join(base_folder_path, station_code, <span class="ss">f'ann_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb87-95"><a href="#cb87-95" aria-hidden="true" tabindex="-1"></a>        sco_file <span class="op">=</span> os.path.join(base_folder_path, station_code, <span class="ss">f'sco_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb87-96"><a href="#cb87-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-97"><a href="#cb87-97" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">all</span>(os.path.exists(f) <span class="cf">for</span> f <span class="kw">in</span> [lsq_file, ann_file, sco_file]):</span>
<span id="cb87-98"><a href="#cb87-98" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Missing files for station </span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">. Skipping station.'</span>)</span>
<span id="cb87-99"><a href="#cb87-99" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb87-100"><a href="#cb87-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-101"><a href="#cb87-101" aria-hidden="true" tabindex="-1"></a>        lsq_data, ann_data, sco_data <span class="op">=</span> extract_data(lsq_file, ann_file, sco_file, indicator)</span>
<span id="cb87-102"><a href="#cb87-102" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> lsq_data <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> ann_data <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> sco_data <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb87-103"><a href="#cb87-103" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb87-104"><a href="#cb87-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-105"><a href="#cb87-105" aria-hidden="true" tabindex="-1"></a>        output_file <span class="op">=</span> os.path.join(output_folder_path, <span class="ss">f"</span><span class="sc">{</span>indicator[<span class="st">'ann_column'</span>]<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv"</span>)</span>
<span id="cb87-106"><a href="#cb87-106" aria-hidden="true" tabindex="-1"></a>        save_to_csv(lsq_data, ann_data, sco_data, output_file)</span>
<span id="cb87-107"><a href="#cb87-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-108"><a href="#cb87-108" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb87-109"><a href="#cb87-109" aria-hidden="true" tabindex="-1"></a>            df <span class="op">=</span> pd.read_csv(output_file, names<span class="op">=</span>[<span class="st">'Variable'</span>, <span class="st">'Valor'</span>], skiprows<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb87-110"><a href="#cb87-110" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">FileNotFoundError</span>:</span>
<span id="cb87-111"><a href="#cb87-111" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'File not found: </span><span class="sc">{</span>output_file<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb87-112"><a href="#cb87-112" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb87-113"><a href="#cb87-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-114"><a href="#cb87-114" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df.dropna()</span>
<span id="cb87-115"><a href="#cb87-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-116"><a href="#cb87-116" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb87-117"><a href="#cb87-117" aria-hidden="true" tabindex="-1"></a>            slope <span class="op">=</span> <span class="bu">float</span>(df[df[<span class="st">'Variable'</span>] <span class="op">==</span> <span class="st">'Slope'</span>][<span class="st">'Valor'</span>].values[<span class="dv">0</span>])</span>
<span id="cb87-118"><a href="#cb87-118" aria-hidden="true" tabindex="-1"></a>            intercept <span class="op">=</span> <span class="bu">float</span>(df[df[<span class="st">'Variable'</span>] <span class="op">==</span> <span class="st">'YInt'</span>][<span class="st">'Valor'</span>].values[<span class="dv">0</span>])</span>
<span id="cb87-119"><a href="#cb87-119" aria-hidden="true" tabindex="-1"></a>            r_squared <span class="op">=</span> <span class="bu">float</span>(df[df[<span class="st">'Variable'</span>] <span class="op">==</span> <span class="st">'R2'</span>][<span class="st">'Valor'</span>].values[<span class="dv">0</span>])</span>
<span id="cb87-120"><a href="#cb87-120" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> (<span class="pp">IndexError</span>, <span class="pp">ValueError</span>) <span class="im">as</span> e:</span>
<span id="cb87-121"><a href="#cb87-121" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Error extracting regression values: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb87-122"><a href="#cb87-122" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb87-123"><a href="#cb87-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-124"><a href="#cb87-124" aria-hidden="true" tabindex="-1"></a>        plot_data(df, slope, intercept, r_squared, station_code, indicator[<span class="st">'plot_label'</span>])</span>
<span id="cb87-125"><a href="#cb87-125" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb87-126"><a href="#cb87-126" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb87-127"><a href="#cb87-127" aria-hidden="true" tabindex="-1"></a>           plt.show()</span>
<span id="cb87-128"><a href="#cb87-128" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb87-129"><a href="#cb87-129" aria-hidden="true" tabindex="-1"></a>            plt.close()</span>
<span id="cb87-130"><a href="#cb87-130" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb87-131"><a href="#cb87-131" aria-hidden="true" tabindex="-1"></a>        contador <span class="op">+=</span> <span class="dv">1</span> </span>
<span id="cb87-132"><a href="#cb87-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-133"><a href="#cb87-133" aria-hidden="true" tabindex="-1"></a>process_all_stations(base_folder_path, output_folder_path, indicator_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>The CSV files and figure for station 9423001 has been saved in Hidroclima/Base de datos/10.Figuras_IHA/IHA anuales/9423001/large_flood_peak_9423001.png
The CSV files and figure for station 9433001 has been saved in Hidroclima/Base de datos/10.Figuras_IHA/IHA anuales/9433001/large_flood_peak_9433001.png
The CSV files and figure for station 9434001 has been saved in Hidroclima/Base de datos/10.Figuras_IHA/IHA anuales/9434001/large_flood_peak_9434001.png</code></pre>
</div>
<div class="cell-output cell-output-display">
<div id="fig-polar-20" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-polar-20-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="indicadores_files/figure-html/fig-polar-20-output-2.png" width="1030" height="717" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-polar-20-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;20: Large Floods Peaks over time at station 9423001
</figcaption>
</figure>
</div>
</div>
</div>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb89" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> Automated generation of hydroclimatic indicators</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Andrea Redel"</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: sandstone</span></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a><span class="an">jupyter:</span><span class="co"> python3</span></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a>The following workflow was developed as part of an academic residency for the undergraduate Forestry Engineering program under the supervision of Dr. Isabel Rojas.</span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a>This repository contains Python scripts designed to filter, organize, and prepare daily hydrometeorological data from the *CAMELS-CL* dataset for further analysis, such as with *Climpact* and *Indicators of Hydrologic Alteration (IHA)* tools. Climpact generates **33 climate indicators** to assess climate change at each meteorological station. IHA (Indicators of Hydrologic Alteration) provides **33 indicators of hydrologic alteration** and **34 indicators related to components of ecological flow**, for each streamflow (hydrometric) station. This script allows for the **systematic preparation of results** from each station within a watershed into selected graphical figures.</span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a>Some variable names and code comments are in Spanish as the original dataset and workflow were developed using Chilean climatic and hydrological data. However, all documentation, figures, and explanations are provided in English for international use. The code can be easily adapted to other languages or datasets. Variable names in Spanish follow the structure of the national dataset (Chile), but can be replaced as needed.</span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a><span class="fu">## Overview</span></span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-23"><a href="#cb89-23" aria-hidden="true" tabindex="-1"></a>The scripts perform the following main tasks:</span>
<span id="cb89-24"><a href="#cb89-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-25"><a href="#cb89-25" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Filter CAMELS-CL data** (<span class="in">`tmax`</span>, <span class="in">`tmin`</span>, <span class="in">`precip`</span>, and <span class="in">`q`</span>) for specific stations based on station codes</span>
<span id="cb89-26"><a href="#cb89-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-27"><a href="#cb89-27" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Create CSV files** with <span class="in">`year`</span>, <span class="in">`month`</span>, and <span class="in">`day`</span> columns plus values for each station.</span>
<span id="cb89-28"><a href="#cb89-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-29"><a href="#cb89-29" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Split data by station**, saving individual files per station for each variable.</span>
<span id="cb89-30"><a href="#cb89-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-31"><a href="#cb89-31" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>**Format data** for compatibility with Climpact and IHA:</span>
<span id="cb89-32"><a href="#cb89-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-33"><a href="#cb89-33" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Remove <span class="in">`NA`</span> and <span class="in">`inf`</span>/<span class="in">`-inf`</span> values.</span>
<span id="cb89-34"><a href="#cb89-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-35"><a href="#cb89-35" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Remove column headers.</span>
<span id="cb89-36"><a href="#cb89-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-37"><a href="#cb89-37" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Format output into required directory structure.</span>
<span id="cb89-38"><a href="#cb89-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-39"><a href="#cb89-39" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>Generate **custom climate indicator figures** from the output files generated by the Climpact tool.</span>
<span id="cb89-40"><a href="#cb89-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-41"><a href="#cb89-41" aria-hidden="true" tabindex="-1"></a><span class="ss">6.  </span>Generate **custom hydrologic indicator figures** from the output files generated by the IHA tool.</span>
<span id="cb89-42"><a href="#cb89-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-43"><a href="#cb89-43" aria-hidden="true" tabindex="-1"></a><span class="fu">## How to use</span></span>
<span id="cb89-44"><a href="#cb89-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-45"><a href="#cb89-45" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Clone this repository and open it in a Python-capable editor (recommended: Visual Studio Code).</span>
<span id="cb89-46"><a href="#cb89-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-47"><a href="#cb89-47" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Download here the working directory.</span>
<span id="cb89-48"><a href="#cb89-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-49"><a href="#cb89-49" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Run the Preprocessing Data script.</span>
<span id="cb89-50"><a href="#cb89-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-51"><a href="#cb89-51" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Use the generated products to import them into Climpact and IHA software.</span>
<span id="cb89-52"><a href="#cb89-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-53"><a href="#cb89-53" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>Run the script for automated generation of figures for climate and fluvial indicators</span>
<span id="cb89-54"><a href="#cb89-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-55"><a href="#cb89-55" aria-hidden="true" tabindex="-1"></a><span class="fu">## Indicators</span></span>
<span id="cb89-56"><a href="#cb89-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-57"><a href="#cb89-57" aria-hidden="true" tabindex="-1"></a>In the presentation of figures in this work, a selection of climatic and hydrological indicators was made based on their ability to assess climate change and their ecological relevance.</span>
<span id="cb89-58"><a href="#cb89-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-59"><a href="#cb89-59" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Climatic indicators</span>
<span id="cb89-60"><a href="#cb89-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-61"><a href="#cb89-61" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Precipitation intensity (@fig-polar-2)</span>
<span id="cb89-62"><a href="#cb89-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-63"><a href="#cb89-63" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Annual precipitation (@fig-polar-3)</span>
<span id="cb89-64"><a href="#cb89-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-65"><a href="#cb89-65" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Consecutive dry days (@fig-polar-4)</span>
<span id="cb89-66"><a href="#cb89-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-67"><a href="#cb89-67" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Days with precipitation <span class="sc">\&gt;</span>= 30 mm (@fig-polar-5)</span>
<span id="cb89-68"><a href="#cb89-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-69"><a href="#cb89-69" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Standardised Precipitation Evapostranspiration Index (@fig-polar-6)</span>
<span id="cb89-70"><a href="#cb89-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-71"><a href="#cb89-71" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Annual mean daily minimum temperature (@fig-polar-7)</span>
<span id="cb89-72"><a href="#cb89-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-73"><a href="#cb89-73" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Annual mean daily maximum temperature (@fig-polar-8)</span>
<span id="cb89-74"><a href="#cb89-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-75"><a href="#cb89-75" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Annual warmest daily maximum temperature (@fig-polar-9)</span>
<span id="cb89-76"><a href="#cb89-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-77"><a href="#cb89-77" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Days when minimum temperature <span class="sc">\&lt;</span> 0ºC (@fig-polar-10)</span>
<span id="cb89-78"><a href="#cb89-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-79"><a href="#cb89-79" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Statistical analysis of flow rates</span>
<span id="cb89-80"><a href="#cb89-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-81"><a href="#cb89-81" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Flow hydrograph (@fig-polar-11)</span>
<span id="cb89-82"><a href="#cb89-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-83"><a href="#cb89-83" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Boxplot of median monthly flow (@fig-polar-12)</span>
<span id="cb89-84"><a href="#cb89-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-85"><a href="#cb89-85" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Percentiles of monthly flow (@fig-polar-13)</span>
<span id="cb89-86"><a href="#cb89-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-87"><a href="#cb89-87" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Flow Duration Curve (@fig-polar-14)</span>
<span id="cb89-88"><a href="#cb89-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-89"><a href="#cb89-89" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Median monthly flow of the entire basin (@fig-polar-15)</span>
<span id="cb89-90"><a href="#cb89-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-91"><a href="#cb89-91" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Time series of hydrological indicators</span>
<span id="cb89-92"><a href="#cb89-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-93"><a href="#cb89-93" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Median flow in July (@fig-polar-16)</span>
<span id="cb89-94"><a href="#cb89-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-95"><a href="#cb89-95" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>High pulse duration (@fig-polar-17)</span>
<span id="cb89-96"><a href="#cb89-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-97"><a href="#cb89-97" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Base flow index (@fig-polar-18)</span>
<span id="cb89-98"><a href="#cb89-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-99"><a href="#cb89-99" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Small flood peak (@fig-polar-19)</span>
<span id="cb89-100"><a href="#cb89-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-101"><a href="#cb89-101" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Large flood peak (@fig-polar-20)</span>
<span id="cb89-102"><a href="#cb89-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-103"><a href="#cb89-103" aria-hidden="true" tabindex="-1"></a><span class="fu">## Hydroclimatic Data Preprocessing Script</span></span>
<span id="cb89-104"><a href="#cb89-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-105"><a href="#cb89-105" aria-hidden="true" tabindex="-1"></a><span class="fu">### Filter CAMELS-CL data</span></span>
<span id="cb89-106"><a href="#cb89-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-107"><a href="#cb89-107" aria-hidden="true" tabindex="-1"></a>4.1.1. Dependencies and workspace</span>
<span id="cb89-108"><a href="#cb89-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-109"><a href="#cb89-109" aria-hidden="true" tabindex="-1"></a>4.1.1.1 Import libraries</span>
<span id="cb89-110"><a href="#cb89-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-113"><a href="#cb89-113" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-114"><a href="#cb89-114" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb89-115"><a href="#cb89-115" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb89-116"><a href="#cb89-116" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb89-117"><a href="#cb89-117" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>, category<span class="op">=</span><span class="pp">FutureWarning</span>)</span>
<span id="cb89-118"><a href="#cb89-118" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-119"><a href="#cb89-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-120"><a href="#cb89-120" aria-hidden="true" tabindex="-1"></a>4.1.1.2. Make sure the directory exists</span>
<span id="cb89-121"><a href="#cb89-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-124"><a href="#cb89-124" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-125"><a href="#cb89-125" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> asegurar_directorio(ruta):</span>
<span id="cb89-126"><a href="#cb89-126" aria-hidden="true" tabindex="-1"></a>    os.makedirs(ruta, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-127"><a href="#cb89-127" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-128"><a href="#cb89-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-129"><a href="#cb89-129" aria-hidden="true" tabindex="-1"></a>4.1.1.3. Define folder paths</span>
<span id="cb89-130"><a href="#cb89-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-133"><a href="#cb89-133" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-134"><a href="#cb89-134" aria-hidden="true" tabindex="-1"></a>ruta_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos'</span></span>
<span id="cb89-135"><a href="#cb89-135" aria-hidden="true" tabindex="-1"></a>ruta_guardado <span class="op">=</span> os.path.join(ruta_base, <span class="st">'0.filtrado_estaciones'</span>)</span>
<span id="cb89-136"><a href="#cb89-136" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-137"><a href="#cb89-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-138"><a href="#cb89-138" aria-hidden="true" tabindex="-1"></a>4.1.1.4. Create the directory if it doesn't exist</span>
<span id="cb89-139"><a href="#cb89-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-142"><a href="#cb89-142" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-143"><a href="#cb89-143" aria-hidden="true" tabindex="-1"></a>asegurar_directorio(ruta_guardado)</span>
<span id="cb89-144"><a href="#cb89-144" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-145"><a href="#cb89-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-146"><a href="#cb89-146" aria-hidden="true" tabindex="-1"></a>4.1.1.5. Additional columns</span>
<span id="cb89-147"><a href="#cb89-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-150"><a href="#cb89-150" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-151"><a href="#cb89-151" aria-hidden="true" tabindex="-1"></a>columnas_adicionales <span class="op">=</span> [<span class="st">'year'</span>, <span class="st">'month'</span>, <span class="st">'day'</span>]</span>
<span id="cb89-152"><a href="#cb89-152" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-153"><a href="#cb89-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-154"><a href="#cb89-154" aria-hidden="true" tabindex="-1"></a>4.1.2. Maximum temperature filter 4.1.2.1. Read the CSV file</span>
<span id="cb89-155"><a href="#cb89-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-158"><a href="#cb89-158" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-159"><a href="#cb89-159" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(os.path.join(ruta_base, <span class="st">'CAMELS_CL_v202201/tmax_cr2met_C_day.csv'</span>))</span>
<span id="cb89-160"><a href="#cb89-160" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-161"><a href="#cb89-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-162"><a href="#cb89-162" aria-hidden="true" tabindex="-1"></a>4.1.2.2. Filter columns based on River Basin</span>
<span id="cb89-163"><a href="#cb89-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-164"><a href="#cb89-164" aria-hidden="true" tabindex="-1"></a><span class="in">```{python eval=false}</span></span>
<span id="cb89-165"><a href="#cb89-165" aria-hidden="true" tabindex="-1"></a>columnas_filtradas <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> df.columns <span class="cf">if</span> col.isdigit() <span class="kw">and</span> <span class="dv">9100000</span> <span class="op">&lt;=</span> <span class="bu">int</span>(col) <span class="op">&lt;=</span> <span class="dv">9199999</span>]</span>
<span id="cb89-166"><a href="#cb89-166" aria-hidden="true" tabindex="-1"></a>columnas_filtradas <span class="op">+=</span> [col <span class="cf">for</span> col <span class="kw">in</span> columnas_adicionales <span class="cf">if</span> col <span class="kw">in</span> df.columns]</span>
<span id="cb89-167"><a href="#cb89-167" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-168"><a href="#cb89-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-169"><a href="#cb89-169" aria-hidden="true" tabindex="-1"></a>In this article, we will use the Toltén River Basin, Chile, identified by the code <span class="in">`94`</span>, as a case study.</span>
<span id="cb89-170"><a href="#cb89-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-171"><a href="#cb89-171" aria-hidden="true" tabindex="-1"></a>To analyze a different basin:</span>
<span id="cb89-172"><a href="#cb89-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-173"><a href="#cb89-173" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Change the station code range, for example, the Imperial River Basin, identified by the code <span class="in">`91`</span>.</span>
<span id="cb89-174"><a href="#cb89-174" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Update all relevant parts of the script accordingly.</span>
<span id="cb89-175"><a href="#cb89-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-178"><a href="#cb89-178" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-179"><a href="#cb89-179" aria-hidden="true" tabindex="-1"></a>columnas_filtradas <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> df.columns <span class="cf">if</span> col.isdigit() <span class="kw">and</span> <span class="dv">9400000</span> <span class="op">&lt;=</span> <span class="bu">int</span>(col) <span class="op">&lt;=</span> <span class="dv">9499999</span>]</span>
<span id="cb89-180"><a href="#cb89-180" aria-hidden="true" tabindex="-1"></a>columnas_filtradas <span class="op">+=</span> [col <span class="cf">for</span> col <span class="kw">in</span> columnas_adicionales <span class="cf">if</span> col <span class="kw">in</span> df.columns]</span>
<span id="cb89-181"><a href="#cb89-181" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-182"><a href="#cb89-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-183"><a href="#cb89-183" aria-hidden="true" tabindex="-1"></a>4.1.2.3. Create a new Data Frame with the filtered columns</span>
<span id="cb89-184"><a href="#cb89-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-187"><a href="#cb89-187" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-188"><a href="#cb89-188" aria-hidden="true" tabindex="-1"></a>df_filtrado <span class="op">=</span> df[columnas_filtradas]</span>
<span id="cb89-189"><a href="#cb89-189" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-190"><a href="#cb89-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-191"><a href="#cb89-191" aria-hidden="true" tabindex="-1"></a>4.1.2.4. Save the new Data Frame to a CSV file</span>
<span id="cb89-192"><a href="#cb89-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-195"><a href="#cb89-195" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-196"><a href="#cb89-196" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-polar-1</span></span>
<span id="cb89-197"><a href="#cb89-197" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Maximum temperature filter for the stations in each basin"</span></span>
<span id="cb89-198"><a href="#cb89-198" aria-hidden="true" tabindex="-1"></a>df_filtrado.to_csv(os.path.join(ruta_guardado, <span class="st">'tmax.csv'</span>), index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb89-199"><a href="#cb89-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-200"><a href="#cb89-200" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Filtered columns and new file of maximum temperatures for the basin's stations saved."</span>)</span>
<span id="cb89-201"><a href="#cb89-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-202"><a href="#cb89-202" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Preview:"</span>)</span>
<span id="cb89-203"><a href="#cb89-203" aria-hidden="true" tabindex="-1"></a>df.iloc[:<span class="dv">5</span>, :<span class="dv">10</span>]</span>
<span id="cb89-204"><a href="#cb89-204" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-205"><a href="#cb89-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-206"><a href="#cb89-206" aria-hidden="true" tabindex="-1"></a>4.1.3. Minimum Temperature filter The same process is repeated as with the maximum temperature.</span>
<span id="cb89-207"><a href="#cb89-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-210"><a href="#cb89-210" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-211"><a href="#cb89-211" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-polar-2</span></span>
<span id="cb89-212"><a href="#cb89-212" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Minimum temperature filter for the stations in each basin"</span></span>
<span id="cb89-213"><a href="#cb89-213" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(os.path.join(ruta_base, <span class="st">'CAMELS_CL_v202201/tmin_cr2met_C_day.csv'</span>))</span>
<span id="cb89-214"><a href="#cb89-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-215"><a href="#cb89-215" aria-hidden="true" tabindex="-1"></a>columnas_filtradas <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> df.columns <span class="cf">if</span> col.isdigit() <span class="kw">and</span> <span class="dv">9400000</span> <span class="op">&lt;=</span> <span class="bu">int</span>(col) <span class="op">&lt;=</span> <span class="dv">9499999</span>]</span>
<span id="cb89-216"><a href="#cb89-216" aria-hidden="true" tabindex="-1"></a>columnas_filtradas <span class="op">+=</span> [col <span class="cf">for</span> col <span class="kw">in</span> columnas_adicionales <span class="cf">if</span> col <span class="kw">in</span> df.columns]</span>
<span id="cb89-217"><a href="#cb89-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-218"><a href="#cb89-218" aria-hidden="true" tabindex="-1"></a>df_filtrado <span class="op">=</span> df[columnas_filtradas]</span>
<span id="cb89-219"><a href="#cb89-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-220"><a href="#cb89-220" aria-hidden="true" tabindex="-1"></a>df_filtrado.to_csv(os.path.join(ruta_guardado, <span class="st">'tmin.csv'</span>), index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb89-221"><a href="#cb89-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-222"><a href="#cb89-222" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Filtered columns and new file of minimum temperatures for the basin's stations saved."</span>)</span>
<span id="cb89-223"><a href="#cb89-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-224"><a href="#cb89-224" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Preview:"</span>)</span>
<span id="cb89-225"><a href="#cb89-225" aria-hidden="true" tabindex="-1"></a>df.iloc[:<span class="dv">5</span>, :<span class="dv">10</span>]</span>
<span id="cb89-226"><a href="#cb89-226" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-227"><a href="#cb89-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-228"><a href="#cb89-228" aria-hidden="true" tabindex="-1"></a>4.1.4. Precipitation filter The same process is repeated.</span>
<span id="cb89-229"><a href="#cb89-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-232"><a href="#cb89-232" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-233"><a href="#cb89-233" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-polar-3</span></span>
<span id="cb89-234"><a href="#cb89-234" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Precipitation filter for the stations in each basin"</span></span>
<span id="cb89-235"><a href="#cb89-235" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(os.path.join(ruta_base, <span class="st">'CAMELS_CL_v202201/precip_cr2met_mm_day.csv'</span>))</span>
<span id="cb89-236"><a href="#cb89-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-237"><a href="#cb89-237" aria-hidden="true" tabindex="-1"></a>columnas_filtradas <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> df.columns <span class="cf">if</span> col.isdigit() <span class="kw">and</span> <span class="dv">9400000</span> <span class="op">&lt;=</span> <span class="bu">int</span>(col) <span class="op">&lt;=</span> <span class="dv">9499999</span>]</span>
<span id="cb89-238"><a href="#cb89-238" aria-hidden="true" tabindex="-1"></a>columnas_filtradas <span class="op">+=</span> [col <span class="cf">for</span> col <span class="kw">in</span> columnas_adicionales <span class="cf">if</span> col <span class="kw">in</span> df.columns]</span>
<span id="cb89-239"><a href="#cb89-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-240"><a href="#cb89-240" aria-hidden="true" tabindex="-1"></a>df_filtrado <span class="op">=</span> df[columnas_filtradas]</span>
<span id="cb89-241"><a href="#cb89-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-242"><a href="#cb89-242" aria-hidden="true" tabindex="-1"></a>df_filtrado.to_csv(os.path.join(ruta_guardado, <span class="st">'pp.csv'</span>), index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb89-243"><a href="#cb89-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-244"><a href="#cb89-244" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Filtered columns and new file of precipitation for the basin's stations saved."</span>)</span>
<span id="cb89-245"><a href="#cb89-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-246"><a href="#cb89-246" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Preview:"</span>)</span>
<span id="cb89-247"><a href="#cb89-247" aria-hidden="true" tabindex="-1"></a>df.iloc[:<span class="dv">5</span>, :<span class="dv">10</span>]</span>
<span id="cb89-248"><a href="#cb89-248" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-249"><a href="#cb89-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-250"><a href="#cb89-250" aria-hidden="true" tabindex="-1"></a>4.1.5. Streamflow filter The same process is repeated.</span>
<span id="cb89-251"><a href="#cb89-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-254"><a href="#cb89-254" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-255"><a href="#cb89-255" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-polar-4</span></span>
<span id="cb89-256"><a href="#cb89-256" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Streamflow filter for the stations in each basin"</span></span>
<span id="cb89-257"><a href="#cb89-257" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(os.path.join(ruta_base, <span class="st">'CAMELS_CL_v202201/q_m3s_day.csv'</span>))</span>
<span id="cb89-258"><a href="#cb89-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-259"><a href="#cb89-259" aria-hidden="true" tabindex="-1"></a>columnas_filtradas <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> df.columns <span class="cf">if</span> col.isdigit() <span class="kw">and</span> <span class="dv">9400000</span> <span class="op">&lt;=</span> <span class="bu">int</span>(col) <span class="op">&lt;=</span> <span class="dv">9499999</span>]</span>
<span id="cb89-260"><a href="#cb89-260" aria-hidden="true" tabindex="-1"></a>columnas_filtradas <span class="op">+=</span> [col <span class="cf">for</span> col <span class="kw">in</span> columnas_adicionales <span class="cf">if</span> col <span class="kw">in</span> df.columns]</span>
<span id="cb89-261"><a href="#cb89-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-262"><a href="#cb89-262" aria-hidden="true" tabindex="-1"></a>df_filtrado <span class="op">=</span> df[columnas_filtradas]</span>
<span id="cb89-263"><a href="#cb89-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-264"><a href="#cb89-264" aria-hidden="true" tabindex="-1"></a>df_filtrado.to_csv(os.path.join(ruta_guardado, <span class="st">'q.csv'</span>), index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb89-265"><a href="#cb89-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-266"><a href="#cb89-266" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Filtered columns and new file of streamflow for the basin's stations saved."</span>)</span>
<span id="cb89-267"><a href="#cb89-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-268"><a href="#cb89-268" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Preview:"</span>)</span>
<span id="cb89-269"><a href="#cb89-269" aria-hidden="true" tabindex="-1"></a>df.iloc[:<span class="dv">5</span>, :<span class="dv">10</span>]</span>
<span id="cb89-270"><a href="#cb89-270" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-271"><a href="#cb89-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-272"><a href="#cb89-272" aria-hidden="true" tabindex="-1"></a><span class="fu">### Create separate CSV files for each station and variable</span></span>
<span id="cb89-273"><a href="#cb89-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-274"><a href="#cb89-274" aria-hidden="true" tabindex="-1"></a>4.2.1. Minimum Temperature 4.2.1.1. CSV file path</span>
<span id="cb89-275"><a href="#cb89-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-278"><a href="#cb89-278" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-279"><a href="#cb89-279" aria-hidden="true" tabindex="-1"></a>archivo_csv <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/0.filtrado_estaciones/tmin.csv'</span></span>
<span id="cb89-280"><a href="#cb89-280" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-281"><a href="#cb89-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-282"><a href="#cb89-282" aria-hidden="true" tabindex="-1"></a>4.2.1.2. Read CSV file</span>
<span id="cb89-283"><a href="#cb89-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-286"><a href="#cb89-286" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-287"><a href="#cb89-287" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(archivo_csv)</span>
<span id="cb89-288"><a href="#cb89-288" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-289"><a href="#cb89-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-290"><a href="#cb89-290" aria-hidden="true" tabindex="-1"></a>4.2.1.3. Get the Data Frame columns</span>
<span id="cb89-291"><a href="#cb89-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-294"><a href="#cb89-294" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-295"><a href="#cb89-295" aria-hidden="true" tabindex="-1"></a>columnas <span class="op">=</span> df.columns</span>
<span id="cb89-296"><a href="#cb89-296" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-297"><a href="#cb89-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-298"><a href="#cb89-298" aria-hidden="true" tabindex="-1"></a>4.2.1.4. Create a directory to save files by column</span>
<span id="cb89-299"><a href="#cb89-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-302"><a href="#cb89-302" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-303"><a href="#cb89-303" aria-hidden="true" tabindex="-1"></a>output_dir <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/1.temperaturas_min'</span></span>
<span id="cb89-304"><a href="#cb89-304" aria-hidden="true" tabindex="-1"></a>os.makedirs(output_dir, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-305"><a href="#cb89-305" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-306"><a href="#cb89-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-307"><a href="#cb89-307" aria-hidden="true" tabindex="-1"></a>4.2.1.5. Iterate over the columns and save the data for <span class="in">`year`</span>, <span class="in">`month,`</span> and <span class="in">`day`</span></span>
<span id="cb89-308"><a href="#cb89-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-311"><a href="#cb89-311" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-312"><a href="#cb89-312" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-polar-5</span></span>
<span id="cb89-313"><a href="#cb89-313" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Daily minimum temperature for station 9437002"</span></span>
<span id="cb89-314"><a href="#cb89-314" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> columnas:</span>
<span id="cb89-315"><a href="#cb89-315" aria-hidden="true" tabindex="-1"></a>    df_col <span class="op">=</span> df[[<span class="st">'year'</span>, <span class="st">'month'</span>, <span class="st">'day'</span>, col]].copy()</span>
<span id="cb89-316"><a href="#cb89-316" aria-hidden="true" tabindex="-1"></a>    df_col <span class="op">=</span> df_col.rename(columns<span class="op">=</span>{col: <span class="st">'tmin'</span>})</span>
<span id="cb89-317"><a href="#cb89-317" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-318"><a href="#cb89-318" aria-hidden="true" tabindex="-1"></a>    output_path <span class="op">=</span> os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb89-319"><a href="#cb89-319" aria-hidden="true" tabindex="-1"></a>    df_col.to_csv(output_path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb89-320"><a href="#cb89-320" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-321"><a href="#cb89-321" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Files of minimum temperature (tmin) separated by station were successfully generated."</span>)</span>
<span id="cb89-322"><a href="#cb89-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-323"><a href="#cb89-323" aria-hidden="true" tabindex="-1"></a>archivos_generados <span class="op">=</span> os.listdir(output_dir)</span>
<span id="cb89-324"><a href="#cb89-324" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Generated_files:"</span>)</span>
<span id="cb89-325"><a href="#cb89-325" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(archivos_generados)</span>
<span id="cb89-326"><a href="#cb89-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-327"><a href="#cb89-327" aria-hidden="true" tabindex="-1"></a>primer_archivo <span class="op">=</span> archivos_generados[<span class="dv">1</span>]</span>
<span id="cb89-328"><a href="#cb89-328" aria-hidden="true" tabindex="-1"></a>ruta_primero <span class="op">=</span> os.path.join(output_dir, primer_archivo)</span>
<span id="cb89-329"><a href="#cb89-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-330"><a href="#cb89-330" aria-hidden="true" tabindex="-1"></a>df_primero <span class="op">=</span> pd.read_csv(ruta_primero)</span>
<span id="cb89-331"><a href="#cb89-331" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"First file: station </span><span class="sc">{</span>primer_archivo<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb89-332"><a href="#cb89-332" aria-hidden="true" tabindex="-1"></a>display(df_primero.head())</span>
<span id="cb89-333"><a href="#cb89-333" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-334"><a href="#cb89-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-335"><a href="#cb89-335" aria-hidden="true" tabindex="-1"></a>4.2.2. Maximum Temperature The same process is repeated</span>
<span id="cb89-336"><a href="#cb89-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-339"><a href="#cb89-339" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-340"><a href="#cb89-340" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-polar-6</span></span>
<span id="cb89-341"><a href="#cb89-341" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Daily maximum temperature for station 9437002"</span></span>
<span id="cb89-342"><a href="#cb89-342" aria-hidden="true" tabindex="-1"></a>archivo_csv <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/0.filtrado_estaciones/tmax.csv'</span></span>
<span id="cb89-343"><a href="#cb89-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-344"><a href="#cb89-344" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(archivo_csv)</span>
<span id="cb89-345"><a href="#cb89-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-346"><a href="#cb89-346" aria-hidden="true" tabindex="-1"></a>columnas <span class="op">=</span> df.columns</span>
<span id="cb89-347"><a href="#cb89-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-348"><a href="#cb89-348" aria-hidden="true" tabindex="-1"></a>output_dir <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/2.temperaturas_max'</span></span>
<span id="cb89-349"><a href="#cb89-349" aria-hidden="true" tabindex="-1"></a>os.makedirs(output_dir, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-350"><a href="#cb89-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-351"><a href="#cb89-351" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> columnas:</span>
<span id="cb89-352"><a href="#cb89-352" aria-hidden="true" tabindex="-1"></a>    df_col <span class="op">=</span> df[[<span class="st">'year'</span>, <span class="st">'month'</span>, <span class="st">'day'</span>, col]].copy()</span>
<span id="cb89-353"><a href="#cb89-353" aria-hidden="true" tabindex="-1"></a>    df_col <span class="op">=</span> df_col.rename(columns<span class="op">=</span>{col: <span class="st">'tmax'</span>})</span>
<span id="cb89-354"><a href="#cb89-354" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-355"><a href="#cb89-355" aria-hidden="true" tabindex="-1"></a>    output_path <span class="op">=</span> os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb89-356"><a href="#cb89-356" aria-hidden="true" tabindex="-1"></a>    df_col.to_csv(output_path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb89-357"><a href="#cb89-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-358"><a href="#cb89-358" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Files of maximum temperature (tmax) separated by station were successfully generated."</span>)</span>
<span id="cb89-359"><a href="#cb89-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-360"><a href="#cb89-360" aria-hidden="true" tabindex="-1"></a>archivos_generados <span class="op">=</span> os.listdir(output_dir)</span>
<span id="cb89-361"><a href="#cb89-361" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Generated_files:"</span>)</span>
<span id="cb89-362"><a href="#cb89-362" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(archivos_generados)</span>
<span id="cb89-363"><a href="#cb89-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-364"><a href="#cb89-364" aria-hidden="true" tabindex="-1"></a>primer_archivo <span class="op">=</span> archivos_generados[<span class="dv">1</span>]</span>
<span id="cb89-365"><a href="#cb89-365" aria-hidden="true" tabindex="-1"></a>ruta_primero <span class="op">=</span> os.path.join(output_dir, primer_archivo)</span>
<span id="cb89-366"><a href="#cb89-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-367"><a href="#cb89-367" aria-hidden="true" tabindex="-1"></a>df_primero <span class="op">=</span> pd.read_csv(ruta_primero)</span>
<span id="cb89-368"><a href="#cb89-368" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"First file: station </span><span class="sc">{</span>primer_archivo<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb89-369"><a href="#cb89-369" aria-hidden="true" tabindex="-1"></a>display(df_primero.head())</span>
<span id="cb89-370"><a href="#cb89-370" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-371"><a href="#cb89-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-372"><a href="#cb89-372" aria-hidden="true" tabindex="-1"></a>4.2.3. Precipitation The same process is repeated</span>
<span id="cb89-373"><a href="#cb89-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-376"><a href="#cb89-376" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-377"><a href="#cb89-377" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-polar-7</span></span>
<span id="cb89-378"><a href="#cb89-378" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Daily precipitation for station 9437002"</span></span>
<span id="cb89-379"><a href="#cb89-379" aria-hidden="true" tabindex="-1"></a>archivo_csv <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/0.filtrado_estaciones/pp.csv'</span></span>
<span id="cb89-380"><a href="#cb89-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-381"><a href="#cb89-381" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(archivo_csv)</span>
<span id="cb89-382"><a href="#cb89-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-383"><a href="#cb89-383" aria-hidden="true" tabindex="-1"></a>columnas <span class="op">=</span> df.columns</span>
<span id="cb89-384"><a href="#cb89-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-385"><a href="#cb89-385" aria-hidden="true" tabindex="-1"></a>output_dir <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/3.precipitaciones'</span></span>
<span id="cb89-386"><a href="#cb89-386" aria-hidden="true" tabindex="-1"></a>os.makedirs(output_dir, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-387"><a href="#cb89-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-388"><a href="#cb89-388" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> columnas:</span>
<span id="cb89-389"><a href="#cb89-389" aria-hidden="true" tabindex="-1"></a>    df_col <span class="op">=</span> df[[<span class="st">'year'</span>, <span class="st">'month'</span>, <span class="st">'day'</span>, col]].copy()</span>
<span id="cb89-390"><a href="#cb89-390" aria-hidden="true" tabindex="-1"></a>    df_col <span class="op">=</span> df_col.rename(columns<span class="op">=</span>{col: <span class="st">'pp'</span>})</span>
<span id="cb89-391"><a href="#cb89-391" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-392"><a href="#cb89-392" aria-hidden="true" tabindex="-1"></a>    output_path <span class="op">=</span> os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb89-393"><a href="#cb89-393" aria-hidden="true" tabindex="-1"></a>    df_col.to_csv(output_path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb89-394"><a href="#cb89-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-395"><a href="#cb89-395" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Files of precipitation (pp) separated by station were successfully generated."</span>)</span>
<span id="cb89-396"><a href="#cb89-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-397"><a href="#cb89-397" aria-hidden="true" tabindex="-1"></a>archivos_generados <span class="op">=</span> os.listdir(output_dir)</span>
<span id="cb89-398"><a href="#cb89-398" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Generated_files:"</span>)</span>
<span id="cb89-399"><a href="#cb89-399" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(archivos_generados)</span>
<span id="cb89-400"><a href="#cb89-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-401"><a href="#cb89-401" aria-hidden="true" tabindex="-1"></a>primer_archivo <span class="op">=</span> archivos_generados[<span class="dv">1</span>]</span>
<span id="cb89-402"><a href="#cb89-402" aria-hidden="true" tabindex="-1"></a>ruta_primero <span class="op">=</span> os.path.join(output_dir, primer_archivo)</span>
<span id="cb89-403"><a href="#cb89-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-404"><a href="#cb89-404" aria-hidden="true" tabindex="-1"></a>df_primero <span class="op">=</span> pd.read_csv(ruta_primero)</span>
<span id="cb89-405"><a href="#cb89-405" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"First file: station </span><span class="sc">{</span>primer_archivo<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb89-406"><a href="#cb89-406" aria-hidden="true" tabindex="-1"></a>display(df_primero.head())</span>
<span id="cb89-407"><a href="#cb89-407" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-408"><a href="#cb89-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-409"><a href="#cb89-409" aria-hidden="true" tabindex="-1"></a>4.2.4. Streamflow The same process is repeated</span>
<span id="cb89-410"><a href="#cb89-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-413"><a href="#cb89-413" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-414"><a href="#cb89-414" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-polar-8</span></span>
<span id="cb89-415"><a href="#cb89-415" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Daily streamflow for station 9437002"</span></span>
<span id="cb89-416"><a href="#cb89-416" aria-hidden="true" tabindex="-1"></a>archivo_csv <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/0.filtrado_estaciones/q.csv'</span></span>
<span id="cb89-417"><a href="#cb89-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-418"><a href="#cb89-418" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(archivo_csv)</span>
<span id="cb89-419"><a href="#cb89-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-420"><a href="#cb89-420" aria-hidden="true" tabindex="-1"></a>columnas <span class="op">=</span> df.columns</span>
<span id="cb89-421"><a href="#cb89-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-422"><a href="#cb89-422" aria-hidden="true" tabindex="-1"></a>output_dir <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/7.caudales'</span></span>
<span id="cb89-423"><a href="#cb89-423" aria-hidden="true" tabindex="-1"></a>os.makedirs(output_dir, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-424"><a href="#cb89-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-425"><a href="#cb89-425" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> columnas:</span>
<span id="cb89-426"><a href="#cb89-426" aria-hidden="true" tabindex="-1"></a>    df_col <span class="op">=</span> df[[<span class="st">'year'</span>, <span class="st">'month'</span>, <span class="st">'day'</span>, col]].copy()</span>
<span id="cb89-427"><a href="#cb89-427" aria-hidden="true" tabindex="-1"></a>    df_col <span class="op">=</span> df_col.rename(columns<span class="op">=</span>{col: <span class="st">'q'</span>})</span>
<span id="cb89-428"><a href="#cb89-428" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-429"><a href="#cb89-429" aria-hidden="true" tabindex="-1"></a>    output_path <span class="op">=</span> os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb89-430"><a href="#cb89-430" aria-hidden="true" tabindex="-1"></a>    df_col.to_csv(output_path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb89-431"><a href="#cb89-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-432"><a href="#cb89-432" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Files of streamflow (q) separated by station were successfully generated."</span>)</span>
<span id="cb89-433"><a href="#cb89-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-434"><a href="#cb89-434" aria-hidden="true" tabindex="-1"></a>archivos_generados <span class="op">=</span> os.listdir(output_dir)</span>
<span id="cb89-435"><a href="#cb89-435" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Generated_files:"</span>)</span>
<span id="cb89-436"><a href="#cb89-436" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(archivos_generados)</span>
<span id="cb89-437"><a href="#cb89-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-438"><a href="#cb89-438" aria-hidden="true" tabindex="-1"></a>primer_archivo <span class="op">=</span> archivos_generados[<span class="dv">1</span>]</span>
<span id="cb89-439"><a href="#cb89-439" aria-hidden="true" tabindex="-1"></a>ruta_primero <span class="op">=</span> os.path.join(output_dir, primer_archivo)</span>
<span id="cb89-440"><a href="#cb89-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-441"><a href="#cb89-441" aria-hidden="true" tabindex="-1"></a>df_primero <span class="op">=</span> pd.read_csv(ruta_primero)</span>
<span id="cb89-442"><a href="#cb89-442" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"First file: station </span><span class="sc">{</span>primer_archivo<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb89-443"><a href="#cb89-443" aria-hidden="true" tabindex="-1"></a>display(df_primero.head())</span>
<span id="cb89-444"><a href="#cb89-444" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-445"><a href="#cb89-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-446"><a href="#cb89-446" aria-hidden="true" tabindex="-1"></a><span class="fu">### Split data by station</span></span>
<span id="cb89-447"><a href="#cb89-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-448"><a href="#cb89-448" aria-hidden="true" tabindex="-1"></a>4.3.1. Format data for compability with Climpact 4.3.1.1. Mapping precipitation, minimum and maximum temperature based on filename and file path</span>
<span id="cb89-449"><a href="#cb89-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-452"><a href="#cb89-452" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-453"><a href="#cb89-453" aria-hidden="true" tabindex="-1"></a>dir_principal <span class="op">=</span> <span class="st">'Hidroclima/Base de datos'</span></span>
<span id="cb89-454"><a href="#cb89-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-455"><a href="#cb89-455" aria-hidden="true" tabindex="-1"></a>subcarpetas <span class="op">=</span> [<span class="st">'1.temperaturas_min'</span>, <span class="st">'2.temperaturas_max'</span>, <span class="st">'3.precipitaciones'</span>]</span>
<span id="cb89-456"><a href="#cb89-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-457"><a href="#cb89-457" aria-hidden="true" tabindex="-1"></a>columna_map <span class="op">=</span> {</span>
<span id="cb89-458"><a href="#cb89-458" aria-hidden="true" tabindex="-1"></a>    <span class="st">'1.temperaturas_min'</span>: <span class="st">'tmin'</span>,</span>
<span id="cb89-459"><a href="#cb89-459" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2.temperaturas_max'</span>: <span class="st">'tmax'</span>,</span>
<span id="cb89-460"><a href="#cb89-460" aria-hidden="true" tabindex="-1"></a>    <span class="st">'3.precipitaciones'</span>: <span class="st">'prcp'</span></span>
<span id="cb89-461"><a href="#cb89-461" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb89-462"><a href="#cb89-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-463"><a href="#cb89-463" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> obtener_archivos(subcarpeta):</span>
<span id="cb89-464"><a href="#cb89-464" aria-hidden="true" tabindex="-1"></a>    ruta_subcarpeta <span class="op">=</span> os.path.join(dir_principal, subcarpeta)</span>
<span id="cb89-465"><a href="#cb89-465" aria-hidden="true" tabindex="-1"></a>    archivos <span class="op">=</span> [archivo <span class="cf">for</span> archivo <span class="kw">in</span> os.listdir(ruta_subcarpeta) <span class="cf">if</span> archivo.endswith(<span class="st">'.csv'</span>) <span class="kw">and</span> archivo <span class="kw">not</span> <span class="kw">in</span> [<span class="st">'year.csv'</span>, <span class="st">'month.csv'</span>, <span class="st">'day.csv'</span>]]</span>
<span id="cb89-466"><a href="#cb89-466" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> archivos</span>
<span id="cb89-467"><a href="#cb89-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-468"><a href="#cb89-468" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> leer_archivo(ruta, columna):</span>
<span id="cb89-469"><a href="#cb89-469" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_csv(ruta)</span>
<span id="cb89-470"><a href="#cb89-470" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.rename(columns<span class="op">=</span>{df.columns[<span class="op">-</span><span class="dv">1</span>]: columna})</span>
<span id="cb89-471"><a href="#cb89-471" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb89-472"><a href="#cb89-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-473"><a href="#cb89-473" aria-hidden="true" tabindex="-1"></a>estaciones_data <span class="op">=</span> {}</span>
<span id="cb89-474"><a href="#cb89-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-475"><a href="#cb89-475" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> subcarpeta <span class="kw">in</span> subcarpetas:</span>
<span id="cb89-476"><a href="#cb89-476" aria-hidden="true" tabindex="-1"></a>    columna <span class="op">=</span> columna_map[subcarpeta]</span>
<span id="cb89-477"><a href="#cb89-477" aria-hidden="true" tabindex="-1"></a>    archivos <span class="op">=</span> obtener_archivos(subcarpeta)</span>
<span id="cb89-478"><a href="#cb89-478" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-479"><a href="#cb89-479" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> archivo <span class="kw">in</span> archivos:</span>
<span id="cb89-480"><a href="#cb89-480" aria-hidden="true" tabindex="-1"></a>        estacion <span class="op">=</span> os.path.splitext(archivo)[<span class="dv">0</span>]</span>
<span id="cb89-481"><a href="#cb89-481" aria-hidden="true" tabindex="-1"></a>        ruta_archivo <span class="op">=</span> os.path.join(dir_principal, subcarpeta, archivo)</span>
<span id="cb89-482"><a href="#cb89-482" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-483"><a href="#cb89-483" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> leer_archivo(ruta_archivo, columna)</span>
<span id="cb89-484"><a href="#cb89-484" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-485"><a href="#cb89-485" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> estacion <span class="kw">not</span> <span class="kw">in</span> estaciones_data:</span>
<span id="cb89-486"><a href="#cb89-486" aria-hidden="true" tabindex="-1"></a>            estaciones_data[estacion] <span class="op">=</span> df[[<span class="st">'year'</span>, <span class="st">'month'</span>, <span class="st">'day'</span>, columna]]</span>
<span id="cb89-487"><a href="#cb89-487" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb89-488"><a href="#cb89-488" aria-hidden="true" tabindex="-1"></a>            estaciones_data[estacion] <span class="op">=</span> estaciones_data[estacion].merge(df[[<span class="st">'year'</span>, <span class="st">'month'</span>, <span class="st">'day'</span>, columna]], on<span class="op">=</span>[<span class="st">'year'</span>, <span class="st">'month'</span>, <span class="st">'day'</span>], how<span class="op">=</span><span class="st">'outer'</span>)</span>
<span id="cb89-489"><a href="#cb89-489" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-490"><a href="#cb89-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-491"><a href="#cb89-491" aria-hidden="true" tabindex="-1"></a>4.3.1.2. Save files by station</span>
<span id="cb89-492"><a href="#cb89-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-495"><a href="#cb89-495" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-496"><a href="#cb89-496" aria-hidden="true" tabindex="-1"></a>output_dir <span class="op">=</span> os.path.join(dir_principal, <span class="st">'4.pre_Climpact'</span>)</span>
<span id="cb89-497"><a href="#cb89-497" aria-hidden="true" tabindex="-1"></a>os.makedirs(output_dir, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-498"><a href="#cb89-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-499"><a href="#cb89-499" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> estacion, df <span class="kw">in</span> estaciones_data.items():</span>
<span id="cb89-500"><a href="#cb89-500" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> columna <span class="kw">in</span> [<span class="st">'prcp'</span>, <span class="st">'tmax'</span>, <span class="st">'tmin'</span>]:</span>
<span id="cb89-501"><a href="#cb89-501" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> columna <span class="kw">not</span> <span class="kw">in</span> df.columns:</span>
<span id="cb89-502"><a href="#cb89-502" aria-hidden="true" tabindex="-1"></a>            df[columna] <span class="op">=</span> pd.NA</span>
<span id="cb89-503"><a href="#cb89-503" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-504"><a href="#cb89-504" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[[<span class="st">'year'</span>, <span class="st">'month'</span>, <span class="st">'day'</span>, <span class="st">'prcp'</span>, <span class="st">'tmax'</span>, <span class="st">'tmin'</span>]]</span>
<span id="cb89-505"><a href="#cb89-505" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-506"><a href="#cb89-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-507"><a href="#cb89-507" aria-hidden="true" tabindex="-1"></a>4.3.1.3. Format:</span>
<span id="cb89-508"><a href="#cb89-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-509"><a href="#cb89-509" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Approximate variable values to 1 decimal place</span>
<span id="cb89-510"><a href="#cb89-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-511"><a href="#cb89-511" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Convert <span class="in">`day`</span>and <span class="in">`month`</span> values to 2 digits</span>
<span id="cb89-512"><a href="#cb89-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-513"><a href="#cb89-513" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Combine <span class="in">`year`</span>, <span class="in">`month`</span> and <span class="in">`day`</span> into a single 'date' column</span>
<span id="cb89-514"><a href="#cb89-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-515"><a href="#cb89-515" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Replace <span class="in">`inf`</span>, <span class="in">`-inf`</span> and <span class="in">`NaN`</span> values ​​with <span class="in">`-99.9`</span></span>
<span id="cb89-516"><a href="#cb89-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-517"><a href="#cb89-517" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Export as a <span class="in">`.txt`</span> file</span>
<span id="cb89-518"><a href="#cb89-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-519"><a href="#cb89-519" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Correct order of columns</span>
<span id="cb89-520"><a href="#cb89-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-523"><a href="#cb89-523" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-524"><a href="#cb89-524" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-polar-9</span></span>
<span id="cb89-525"><a href="#cb89-525" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "List of the generated files in the output directory"</span></span>
<span id="cb89-526"><a href="#cb89-526" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb89-527"><a href="#cb89-527" aria-hidden="true" tabindex="-1"></a>    df[[<span class="st">'prcp'</span>, <span class="st">'tmax'</span>, <span class="st">'tmin'</span>]] <span class="op">=</span> df[[<span class="st">'prcp'</span>, <span class="st">'tmax'</span>, <span class="st">'tmin'</span>]].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">round</span>(x, <span class="dv">1</span>))</span>
<span id="cb89-528"><a href="#cb89-528" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-529"><a href="#cb89-529" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'month'</span>] <span class="op">=</span> df[<span class="st">'month'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="ss">f'</span><span class="sc">{</span>x<span class="sc">:02}</span><span class="ss">'</span>)</span>
<span id="cb89-530"><a href="#cb89-530" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'day'</span>] <span class="op">=</span> df[<span class="st">'day'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="ss">f'</span><span class="sc">{</span>x<span class="sc">:02}</span><span class="ss">'</span>)</span>
<span id="cb89-531"><a href="#cb89-531" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-532"><a href="#cb89-532" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'fecha'</span>] <span class="op">=</span> df.<span class="bu">apply</span>(<span class="kw">lambda</span> row: <span class="ss">f"</span><span class="sc">{</span><span class="bu">int</span>(row[<span class="st">'year'</span>])<span class="sc">:4d}</span><span class="ss"> </span><span class="sc">{</span>row[<span class="st">'month'</span>]<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>row[<span class="st">'day'</span>]<span class="sc">}</span><span class="ss">"</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb89-533"><a href="#cb89-533" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-534"><a href="#cb89-534" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.replace([<span class="bu">float</span>(<span class="st">'inf'</span>), <span class="bu">float</span>(<span class="st">'-inf'</span>)], <span class="op">-</span><span class="fl">99.9</span>).fillna(<span class="op">-</span><span class="fl">99.9</span>)</span>
<span id="cb89-535"><a href="#cb89-535" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-536"><a href="#cb89-536" aria-hidden="true" tabindex="-1"></a>    ruta_salida <span class="op">=</span> os.path.join(output_dir, <span class="ss">f'</span><span class="sc">{</span>estacion<span class="sc">}</span><span class="ss">.txt'</span>)</span>
<span id="cb89-537"><a href="#cb89-537" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-538"><a href="#cb89-538" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(ruta_salida, <span class="st">'w'</span>) <span class="im">as</span> f:</span>
<span id="cb89-539"><a href="#cb89-539" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _, row <span class="kw">in</span> df.iterrows():</span>
<span id="cb89-540"><a href="#cb89-540" aria-hidden="true" tabindex="-1"></a>            f.write(<span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'fecha'</span>]<span class="sc">}</span><span class="ss">    </span><span class="sc">{</span>row[<span class="st">'prcp'</span>]<span class="sc">:5.1f}</span><span class="ss">     </span><span class="sc">{</span>row[<span class="st">'tmax'</span>]<span class="sc">:4.1f}</span><span class="ss">     </span><span class="sc">{</span>row[<span class="st">'tmin'</span>]<span class="sc">:4.1f}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb89-541"><a href="#cb89-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-542"><a href="#cb89-542" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Files for Climpact generated successfully."</span>)</span>
<span id="cb89-543"><a href="#cb89-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-544"><a href="#cb89-544" aria-hidden="true" tabindex="-1"></a>archivos_generados <span class="op">=</span> <span class="bu">sorted</span>(os.listdir(output_dir))</span>
<span id="cb89-545"><a href="#cb89-545" aria-hidden="true" tabindex="-1"></a>df_archivos <span class="op">=</span> pd.DataFrame(archivos_generados, columns<span class="op">=</span>[<span class="st">'Generated files'</span>])</span>
<span id="cb89-546"><a href="#cb89-546" aria-hidden="true" tabindex="-1"></a>display(df_archivos)</span>
<span id="cb89-547"><a href="#cb89-547" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-548"><a href="#cb89-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-551"><a href="#cb89-551" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-552"><a href="#cb89-552" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-polar-10</span></span>
<span id="cb89-553"><a href="#cb89-553" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Station 9437002 file with information on each variable"</span></span>
<span id="cb89-554"><a href="#cb89-554" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb89-555"><a href="#cb89-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-556"><a href="#cb89-556" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> HTML</span>
<span id="cb89-557"><a href="#cb89-557" aria-hidden="true" tabindex="-1"></a>html <span class="op">=</span> df_primero.head().to_html(index<span class="op">=</span><span class="va">False</span>, header<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb89-558"><a href="#cb89-558" aria-hidden="true" tabindex="-1"></a>display(HTML(html))</span>
<span id="cb89-559"><a href="#cb89-559" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-560"><a href="#cb89-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-561"><a href="#cb89-561" aria-hidden="true" tabindex="-1"></a>4.3.2. Format data for compability with IHA 4.3.2.1. The same process is repeated, now for the streamflow.</span>
<span id="cb89-562"><a href="#cb89-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-565"><a href="#cb89-565" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-566"><a href="#cb89-566" aria-hidden="true" tabindex="-1"></a>dir_entrada <span class="op">=</span> os.path.join(<span class="st">'Hidroclima'</span>, <span class="st">'Base de datos'</span>, <span class="st">'7.caudales'</span>)</span>
<span id="cb89-567"><a href="#cb89-567" aria-hidden="true" tabindex="-1"></a>dir_salida <span class="op">=</span> os.path.join(<span class="st">'Hidroclima'</span>, <span class="st">'Base de datos'</span>, <span class="st">'8.pre_IHA'</span>)</span>
<span id="cb89-568"><a href="#cb89-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-569"><a href="#cb89-569" aria-hidden="true" tabindex="-1"></a>os.makedirs(dir_salida, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-570"><a href="#cb89-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-571"><a href="#cb89-571" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> archivo <span class="kw">in</span> os.listdir(dir_entrada):</span>
<span id="cb89-572"><a href="#cb89-572" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> archivo.endswith(<span class="st">'.csv'</span>):</span>
<span id="cb89-573"><a href="#cb89-573" aria-hidden="true" tabindex="-1"></a>        ruta_entrada <span class="op">=</span> os.path.join(dir_entrada, archivo)</span>
<span id="cb89-574"><a href="#cb89-574" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-575"><a href="#cb89-575" aria-hidden="true" tabindex="-1"></a>        archivo_salida <span class="op">=</span> os.path.splitext(archivo)[<span class="dv">0</span>] <span class="op">+</span> <span class="st">'.txt'</span></span>
<span id="cb89-576"><a href="#cb89-576" aria-hidden="true" tabindex="-1"></a>        ruta_salida <span class="op">=</span> os.path.join(dir_salida, archivo_salida)</span>
<span id="cb89-577"><a href="#cb89-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-578"><a href="#cb89-578" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_csv(ruta_entrada)</span>
<span id="cb89-579"><a href="#cb89-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-580"><a href="#cb89-580" aria-hidden="true" tabindex="-1"></a>        columnas_requeridas <span class="op">=</span> {<span class="st">'year'</span>, <span class="st">'month'</span>, <span class="st">'day'</span>, <span class="st">'q'</span>}</span>
<span id="cb89-581"><a href="#cb89-581" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> columnas_requeridas.issubset(df.columns):</span>
<span id="cb89-582"><a href="#cb89-582" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"The </span><span class="sc">{</span>archivo<span class="sc">}</span><span class="ss"> file does not contain the required columns: </span><span class="sc">{</span>columnas_requeridas<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb89-583"><a href="#cb89-583" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb89-584"><a href="#cb89-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-585"><a href="#cb89-585" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[[<span class="st">'year'</span>, <span class="st">'month'</span>, <span class="st">'day'</span>, <span class="st">'q'</span>]]</span>
<span id="cb89-586"><a href="#cb89-586" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-587"><a href="#cb89-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-588"><a href="#cb89-588" aria-hidden="true" tabindex="-1"></a>4.3.2.2. Format:</span>
<span id="cb89-589"><a href="#cb89-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-590"><a href="#cb89-590" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Aproximate streamflow values to 1 decimal place</span>
<span id="cb89-591"><a href="#cb89-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-592"><a href="#cb89-592" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Date column in **YYYY-MM-DD** format</span>
<span id="cb89-593"><a href="#cb89-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-594"><a href="#cb89-594" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Replace <span class="in">`inf`</span>, <span class="in">`-inf`</span>, and <span class="in">`NaN`</span> values ​​with <span class="in">`-1.0`</span></span>
<span id="cb89-595"><a href="#cb89-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-596"><a href="#cb89-596" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Delete leading rows where 'q' equals -1.0</span>
<span id="cb89-597"><a href="#cb89-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-598"><a href="#cb89-598" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Streamflow column named <span class="in">`flow`</span></span>
<span id="cb89-599"><a href="#cb89-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-600"><a href="#cb89-600" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Export as <span class="in">`.txt`</span>file</span>
<span id="cb89-601"><a href="#cb89-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-604"><a href="#cb89-604" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-605"><a href="#cb89-605" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df.replace([<span class="bu">float</span>(<span class="st">'inf'</span>), <span class="bu">float</span>(<span class="st">'-inf'</span>)], <span class="op">-</span><span class="fl">1.0</span>).fillna(<span class="op">-</span><span class="fl">1.0</span>)</span>
<span id="cb89-606"><a href="#cb89-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-607"><a href="#cb89-607" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df.loc[df[<span class="st">'q'</span>] <span class="op">!=</span> <span class="op">-</span><span class="fl">1.0</span>].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-608"><a href="#cb89-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-609"><a href="#cb89-609" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'q'</span>] <span class="op">=</span> df[<span class="st">'q'</span>].<span class="bu">round</span>(<span class="dv">1</span>)</span>
<span id="cb89-610"><a href="#cb89-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-611"><a href="#cb89-611" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'date'</span>] <span class="op">=</span> pd.to_datetime(df[[<span class="st">'year'</span>, <span class="st">'month'</span>, <span class="st">'day'</span>]])</span>
<span id="cb89-612"><a href="#cb89-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-613"><a href="#cb89-613" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[[<span class="st">'date'</span>, <span class="st">'q'</span>]].rename(columns<span class="op">=</span>{<span class="st">'q'</span>: <span class="st">'flow'</span>})</span>
<span id="cb89-614"><a href="#cb89-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-615"><a href="#cb89-615" aria-hidden="true" tabindex="-1"></a>        df.to_csv(ruta_salida, index<span class="op">=</span><span class="va">False</span>, header<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-616"><a href="#cb89-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-617"><a href="#cb89-617" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"IHA files processed successfully."</span>)</span>
<span id="cb89-618"><a href="#cb89-618" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-619"><a href="#cb89-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-620"><a href="#cb89-620" aria-hidden="true" tabindex="-1"></a><span class="fu">### Extra files and folders for sorting results</span></span>
<span id="cb89-621"><a href="#cb89-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-622"><a href="#cb89-622" aria-hidden="true" tabindex="-1"></a>4.4.1. List of folders to create:</span>
<span id="cb89-623"><a href="#cb89-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-624"><a href="#cb89-624" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Folder 5 stores the station-specific folders generated by Climpact.</span>
<span id="cb89-625"><a href="#cb89-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-626"><a href="#cb89-626" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Folder 6 contains customized plots based on Climpact results.</span>
<span id="cb89-627"><a href="#cb89-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-628"><a href="#cb89-628" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Folder 9 stores the Excel files generated by IHA for each station, along with their processed CSV versions.</span>
<span id="cb89-629"><a href="#cb89-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-630"><a href="#cb89-630" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Folder 10 includes the figures created from IHA data.</span>
<span id="cb89-631"><a href="#cb89-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-632"><a href="#cb89-632" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Folder 11 contains text files intended to be imported into QGIS for georeferencing.</span>
<span id="cb89-633"><a href="#cb89-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-636"><a href="#cb89-636" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-637"><a href="#cb89-637" aria-hidden="true" tabindex="-1"></a>ruta_base <span class="op">=</span> os.path.join(<span class="st">'Hidroclima'</span>, <span class="st">'Base de datos'</span>)</span>
<span id="cb89-638"><a href="#cb89-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-639"><a href="#cb89-639" aria-hidden="true" tabindex="-1"></a>carpetas <span class="op">=</span> [</span>
<span id="cb89-640"><a href="#cb89-640" aria-hidden="true" tabindex="-1"></a>    <span class="st">'5.Climpact'</span>,</span>
<span id="cb89-641"><a href="#cb89-641" aria-hidden="true" tabindex="-1"></a>    <span class="st">'6.Figuras_Climpact'</span>,</span>
<span id="cb89-642"><a href="#cb89-642" aria-hidden="true" tabindex="-1"></a>    <span class="st">'9.IHA'</span>,</span>
<span id="cb89-643"><a href="#cb89-643" aria-hidden="true" tabindex="-1"></a>    <span class="st">'10.Figuras_IHA'</span>,</span>
<span id="cb89-644"><a href="#cb89-644" aria-hidden="true" tabindex="-1"></a>    <span class="st">'11.Georreferenciación'</span></span>
<span id="cb89-645"><a href="#cb89-645" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb89-646"><a href="#cb89-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-647"><a href="#cb89-647" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> carpeta <span class="kw">in</span> carpetas:</span>
<span id="cb89-648"><a href="#cb89-648" aria-hidden="true" tabindex="-1"></a>    ruta_carpeta <span class="op">=</span> os.path.join(ruta_base, carpeta)</span>
<span id="cb89-649"><a href="#cb89-649" aria-hidden="true" tabindex="-1"></a>    os.makedirs(ruta_carpeta, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-650"><a href="#cb89-650" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Folder created: </span><span class="sc">{</span>ruta_carpeta<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb89-651"><a href="#cb89-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-652"><a href="#cb89-652" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"All necessary folders for the results have been created successfully."</span>)</span>
<span id="cb89-653"><a href="#cb89-653" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-654"><a href="#cb89-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-655"><a href="#cb89-655" aria-hidden="true" tabindex="-1"></a>4.4.2. Georeference the stations in the study basin</span>
<span id="cb89-656"><a href="#cb89-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-659"><a href="#cb89-659" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-660"><a href="#cb89-660" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-polar-11</span></span>
<span id="cb89-661"><a href="#cb89-661" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Information by georeferenced station"</span></span>
<span id="cb89-662"><a href="#cb89-662" aria-hidden="true" tabindex="-1"></a>archivo_entrada <span class="op">=</span> <span class="st">"Hidroclima/Base de datos/CAMELS_CL_v202201/catchment_attributes.csv"</span></span>
<span id="cb89-663"><a href="#cb89-663" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(archivo_entrada)</span>
<span id="cb89-664"><a href="#cb89-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-665"><a href="#cb89-665" aria-hidden="true" tabindex="-1"></a>df_filtrado <span class="op">=</span> df[(df[<span class="st">'gauge_id'</span>] <span class="op">&gt;=</span> <span class="dv">9400000</span>) <span class="op">&amp;</span> (df[<span class="st">'gauge_id'</span>] <span class="op">&lt;=</span> <span class="dv">9499999</span>)]</span>
<span id="cb89-666"><a href="#cb89-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-667"><a href="#cb89-667" aria-hidden="true" tabindex="-1"></a>df_filtrado <span class="op">=</span> df_filtrado[[<span class="st">'gauge_id'</span>, <span class="st">'gauge_name'</span>, <span class="st">'gauge_lat'</span>, <span class="st">'gauge_lon'</span>, <span class="st">'record_period_start'</span>, <span class="st">'record_period_end'</span>]]</span>
<span id="cb89-668"><a href="#cb89-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-669"><a href="#cb89-669" aria-hidden="true" tabindex="-1"></a>directorio_salida <span class="op">=</span> <span class="st">"Hidroclima/Base de datos/11.Georreferenciación/Estaciones.csv"</span></span>
<span id="cb89-670"><a href="#cb89-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-671"><a href="#cb89-671" aria-hidden="true" tabindex="-1"></a>df_filtrado.to_csv(directorio_salida, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb89-672"><a href="#cb89-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-673"><a href="#cb89-673" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Filtered file saved as:"</span>, directorio_salida)</span>
<span id="cb89-674"><a href="#cb89-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-675"><a href="#cb89-675" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display</span>
<span id="cb89-676"><a href="#cb89-676" aria-hidden="true" tabindex="-1"></a>display(df_filtrado)</span>
<span id="cb89-677"><a href="#cb89-677" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-678"><a href="#cb89-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-679"><a href="#cb89-679" aria-hidden="true" tabindex="-1"></a><span class="fu">## Generation of figures for climate indicators script</span></span>
<span id="cb89-680"><a href="#cb89-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-681"><a href="#cb89-681" aria-hidden="true" tabindex="-1"></a>By default, Climpact generates figures for each calculated indicator at each station. However, the following script provides a general framework for creating customized figures.</span>
<span id="cb89-682"><a href="#cb89-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-683"><a href="#cb89-683" aria-hidden="true" tabindex="-1"></a><span class="fu">### General framework for customized figures</span></span>
<span id="cb89-684"><a href="#cb89-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-685"><a href="#cb89-685" aria-hidden="true" tabindex="-1"></a>5.1.1. Libraries.</span>
<span id="cb89-686"><a href="#cb89-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-687"><a href="#cb89-687" aria-hidden="true" tabindex="-1"></a><span class="in">```{python eval=false}</span></span>
<span id="cb89-688"><a href="#cb89-688" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb89-689"><a href="#cb89-689" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb89-690"><a href="#cb89-690" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb89-691"><a href="#cb89-691" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.dates <span class="im">as</span> mdates</span>
<span id="cb89-692"><a href="#cb89-692" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> linregress</span>
<span id="cb89-693"><a href="#cb89-693" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-694"><a href="#cb89-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-695"><a href="#cb89-695" aria-hidden="true" tabindex="-1"></a>5.1.2. Base route and output route.</span>
<span id="cb89-696"><a href="#cb89-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-697"><a href="#cb89-697" aria-hidden="true" tabindex="-1"></a>In this case, the figure of the annual accumulated precipitation indicator is generated.</span>
<span id="cb89-698"><a href="#cb89-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-699"><a href="#cb89-699" aria-hidden="true" tabindex="-1"></a><span class="in">```{python eval=false}</span></span>
<span id="cb89-700"><a href="#cb89-700" aria-hidden="true" tabindex="-1"></a>ruta_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/5.Climpact'</span></span>
<span id="cb89-701"><a href="#cb89-701" aria-hidden="true" tabindex="-1"></a>ruta_salida_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/6.Figuras_Climpact/Precipitation'</span></span>
<span id="cb89-702"><a href="#cb89-702" aria-hidden="true" tabindex="-1"></a>os.makedirs(ruta_salida_base, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-703"><a href="#cb89-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-704"><a href="#cb89-704" aria-hidden="true" tabindex="-1"></a>contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb89-705"><a href="#cb89-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-706"><a href="#cb89-706" aria-hidden="true" tabindex="-1"></a>subcarpetas <span class="op">=</span> [os.path.join(ruta_base, carpeta) <span class="cf">for</span> carpeta <span class="kw">in</span> os.listdir(ruta_base) <span class="cf">if</span> os.path.isdir(os.path.join(ruta_base, carpeta))]</span>
<span id="cb89-707"><a href="#cb89-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-708"><a href="#cb89-708" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> subcarpeta <span class="kw">in</span> subcarpetas:</span>
<span id="cb89-709"><a href="#cb89-709" aria-hidden="true" tabindex="-1"></a>    carpeta_indices <span class="op">=</span> os.path.join(subcarpeta, <span class="st">'indices'</span>)</span>
<span id="cb89-710"><a href="#cb89-710" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(carpeta_indices):</span>
<span id="cb89-711"><a href="#cb89-711" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb89-712"><a href="#cb89-712" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-713"><a href="#cb89-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-714"><a href="#cb89-714" aria-hidden="true" tabindex="-1"></a>5.1.3. Selecting the indicator to be graphed.</span>
<span id="cb89-715"><a href="#cb89-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-716"><a href="#cb89-716" aria-hidden="true" tabindex="-1"></a>In this case, the annual total precipitation indicator is used, identified as <span class="in">`prcptot`</span> in the dataset and therefore with its corresponding station code followed by <span class="in">`_prcptot_ANN.csv`</span> in its file name. To select a different indicator, simply use the name of the corresponding file that contains the desired variable, for example, <span class="in">`_txx_ANN.csv`</span> and the <span class="in">`txx`</span> variable for monthly maximum daily temperature.</span>
<span id="cb89-717"><a href="#cb89-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-718"><a href="#cb89-718" aria-hidden="true" tabindex="-1"></a><span class="in">```{python eval=false}</span></span>
<span id="cb89-719"><a href="#cb89-719" aria-hidden="true" tabindex="-1"></a>    archivos <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(carpeta_indices) <span class="cf">if</span> f.endswith(<span class="st">'_prcptot_ANN.csv'</span>)]</span>
<span id="cb89-720"><a href="#cb89-720" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> archivo <span class="kw">in</span> archivos:</span>
<span id="cb89-721"><a href="#cb89-721" aria-hidden="true" tabindex="-1"></a>        ruta_archivo <span class="op">=</span> os.path.join(carpeta_indices, archivo)</span>
<span id="cb89-722"><a href="#cb89-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-723"><a href="#cb89-723" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_csv(ruta_archivo, skiprows<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb89-724"><a href="#cb89-724" aria-hidden="true" tabindex="-1"></a>        df.columns <span class="op">=</span> df.columns.<span class="bu">str</span>.strip()</span>
<span id="cb89-725"><a href="#cb89-725" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[[<span class="st">'time'</span>, <span class="st">'prcptot'</span>]]</span>
<span id="cb89-726"><a href="#cb89-726" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'time'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'time'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">'%Y'</span>)</span>
<span id="cb89-727"><a href="#cb89-727" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[df[<span class="st">'prcptot'</span>] <span class="op">!=</span> <span class="op">-</span><span class="fl">99.9</span>]</span>
<span id="cb89-728"><a href="#cb89-728" aria-hidden="true" tabindex="-1"></a>        df.set_index(<span class="st">'time'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-729"><a href="#cb89-729" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-730"><a href="#cb89-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-731"><a href="#cb89-731" aria-hidden="true" tabindex="-1"></a>5.1.4. Create the figure.</span>
<span id="cb89-732"><a href="#cb89-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-733"><a href="#cb89-733" aria-hidden="true" tabindex="-1"></a>The use of Sen's slope, the regression line, and the statistical values calculated by the Climpact software have not yet been systematically included in the figure.</span>
<span id="cb89-734"><a href="#cb89-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-735"><a href="#cb89-735" aria-hidden="true" tabindex="-1"></a><span class="in">```{python eval=false}</span></span>
<span id="cb89-736"><a href="#cb89-736" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-polar-1</span></span>
<span id="cb89-737"><a href="#cb89-737" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Indicator of total accumulated precipitation at station 9434001"</span></span>
<span id="cb89-738"><a href="#cb89-738" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb89-739"><a href="#cb89-739" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, df[<span class="st">'prcptot'</span>], marker<span class="op">=</span><span class="st">'D'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Annual precipitation'</span>)</span>
<span id="cb89-740"><a href="#cb89-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-741"><a href="#cb89-741" aria-hidden="true" tabindex="-1"></a>        slope, intercept, r_value, p_value, std_err <span class="op">=</span> linregress(mdates.date2num(df.index), df[<span class="st">'prcptot'</span>])</span>
<span id="cb89-742"><a href="#cb89-742" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, intercept <span class="op">+</span> slope <span class="op">*</span> mdates.date2num(df.index), linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Regression line'</span>)</span>
<span id="cb89-743"><a href="#cb89-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-744"><a href="#cb89-744" aria-hidden="true" tabindex="-1"></a>        plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb89-745"><a href="#cb89-745" aria-hidden="true" tabindex="-1"></a>        titulo <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>archivo<span class="sc">.</span>split(<span class="st">'_'</span>)[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> Station - Annual precipitation"</span></span>
<span id="cb89-746"><a href="#cb89-746" aria-hidden="true" tabindex="-1"></a>        <span class="co">#plt.title(titulo, fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb89-747"><a href="#cb89-747" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'Year'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-748"><a href="#cb89-748" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Precipitation (mm)'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-749"><a href="#cb89-749" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_locator(mdates.YearLocator(<span class="dv">5</span>))</span>
<span id="cb89-750"><a href="#cb89-750" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_formatter(mdates.DateFormatter(<span class="st">'%Y'</span>))</span>
<span id="cb89-751"><a href="#cb89-751" aria-hidden="true" tabindex="-1"></a>        plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, fontsize<span class="op">=</span><span class="dv">20</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-752"><a href="#cb89-752" aria-hidden="true" tabindex="-1"></a>        plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-753"><a href="#cb89-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-754"><a href="#cb89-754" aria-hidden="true" tabindex="-1"></a>        info_text <span class="op">=</span> (</span>
<span id="cb89-755"><a href="#cb89-755" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Slope: </span><span class="sc">{</span>slope<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb89-756"><a href="#cb89-756" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Confidence interval: [</span><span class="sc">{</span>intercept <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>intercept <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">]</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb89-757"><a href="#cb89-757" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"p-value: </span><span class="sc">{</span>p_value<span class="sc">:.3f}</span><span class="ss">"</span></span>
<span id="cb89-758"><a href="#cb89-758" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb89-759"><a href="#cb89-759" aria-hidden="true" tabindex="-1"></a>        plt.text(<span class="fl">1.1</span>, <span class="fl">0.65</span>, info_text, transform<span class="op">=</span>plt.gca().transAxes, fontsize<span class="op">=</span><span class="dv">14</span>, verticalalignment<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb89-760"><a href="#cb89-760" aria-hidden="true" tabindex="-1"></a>                 bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb89-761"><a href="#cb89-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-762"><a href="#cb89-762" aria-hidden="true" tabindex="-1"></a>        plt.grid(<span class="va">False</span>)</span>
<span id="cb89-763"><a href="#cb89-763" aria-hidden="true" tabindex="-1"></a>        plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.1</span>, <span class="fl">0.4</span>), fontsize<span class="op">=</span><span class="dv">14</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb89-764"><a href="#cb89-764" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb89-765"><a href="#cb89-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-766"><a href="#cb89-766" aria-hidden="true" tabindex="-1"></a>        estacion_codigo <span class="op">=</span> archivo.split(<span class="st">'_'</span>)[<span class="dv">0</span>]</span>
<span id="cb89-767"><a href="#cb89-767" aria-hidden="true" tabindex="-1"></a>        ruta_salida_estacion <span class="op">=</span> os.path.join(ruta_salida_base, estacion_codigo)</span>
<span id="cb89-768"><a href="#cb89-768" aria-hidden="true" tabindex="-1"></a>        os.makedirs(ruta_salida_estacion, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-769"><a href="#cb89-769" aria-hidden="true" tabindex="-1"></a>        ruta_salida <span class="op">=</span> os.path.join(ruta_salida_estacion, <span class="ss">f"</span><span class="sc">{</span>estacion_codigo<span class="sc">}</span><span class="ss">_prcptot_ANN_plot.png"</span>)</span>
<span id="cb89-770"><a href="#cb89-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-771"><a href="#cb89-771" aria-hidden="true" tabindex="-1"></a>        plt.savefig(ruta_salida)</span>
<span id="cb89-772"><a href="#cb89-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-773"><a href="#cb89-773" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb89-774"><a href="#cb89-774" aria-hidden="true" tabindex="-1"></a>            plt.show()</span>
<span id="cb89-775"><a href="#cb89-775" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb89-776"><a href="#cb89-776" aria-hidden="true" tabindex="-1"></a>            plt.close()</span>
<span id="cb89-777"><a href="#cb89-777" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-778"><a href="#cb89-778" aria-hidden="true" tabindex="-1"></a>        contador <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb89-779"><a href="#cb89-779" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-780"><a href="#cb89-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-781"><a href="#cb89-781" aria-hidden="true" tabindex="-1"></a><span class="fu">### Suggested precipitation indicators and their figures</span></span>
<span id="cb89-782"><a href="#cb89-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-783"><a href="#cb89-783" aria-hidden="true" tabindex="-1"></a>5.2.1. Precipitation intensity (sdii).</span>
<span id="cb89-784"><a href="#cb89-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-785"><a href="#cb89-785" aria-hidden="true" tabindex="-1"></a>Annual total precipitation divided by the number of wet days (when total precipitation <span class="sc">\&gt;</span>= 1.0 mm) is now graphed for each station.</span>
<span id="cb89-786"><a href="#cb89-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-789"><a href="#cb89-789" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-790"><a href="#cb89-790" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-polar-2</span></span>
<span id="cb89-791"><a href="#cb89-791" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Indicator of precipitation intensity at station 9423001"</span></span>
<span id="cb89-792"><a href="#cb89-792" aria-hidden="true" tabindex="-1"></a>ruta_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/5.Climpact'</span></span>
<span id="cb89-793"><a href="#cb89-793" aria-hidden="true" tabindex="-1"></a>ruta_salida_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/6.Figuras_Climpact/Precipitation'</span></span>
<span id="cb89-794"><a href="#cb89-794" aria-hidden="true" tabindex="-1"></a>os.makedirs(ruta_salida_base, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-795"><a href="#cb89-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-796"><a href="#cb89-796" aria-hidden="true" tabindex="-1"></a>contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb89-797"><a href="#cb89-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-798"><a href="#cb89-798" aria-hidden="true" tabindex="-1"></a>subcarpetas <span class="op">=</span> [os.path.join(ruta_base, carpeta) <span class="cf">for</span> carpeta <span class="kw">in</span> os.listdir(ruta_base) <span class="cf">if</span> os.path.isdir(os.path.join(ruta_base, carpeta))]</span>
<span id="cb89-799"><a href="#cb89-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-800"><a href="#cb89-800" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> subcarpeta <span class="kw">in</span> subcarpetas:</span>
<span id="cb89-801"><a href="#cb89-801" aria-hidden="true" tabindex="-1"></a>    carpeta_indices <span class="op">=</span> os.path.join(subcarpeta, <span class="st">'indices'</span>)</span>
<span id="cb89-802"><a href="#cb89-802" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(carpeta_indices):</span>
<span id="cb89-803"><a href="#cb89-803" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb89-804"><a href="#cb89-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-805"><a href="#cb89-805" aria-hidden="true" tabindex="-1"></a>    archivos <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(carpeta_indices) <span class="cf">if</span> f.endswith(<span class="st">'_sdii_ANN.csv'</span>)]</span>
<span id="cb89-806"><a href="#cb89-806" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> archivo <span class="kw">in</span> archivos:</span>
<span id="cb89-807"><a href="#cb89-807" aria-hidden="true" tabindex="-1"></a>        ruta_archivo <span class="op">=</span> os.path.join(carpeta_indices, archivo)</span>
<span id="cb89-808"><a href="#cb89-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-809"><a href="#cb89-809" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_csv(ruta_archivo, skiprows<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb89-810"><a href="#cb89-810" aria-hidden="true" tabindex="-1"></a>        df.columns <span class="op">=</span> df.columns.<span class="bu">str</span>.strip()</span>
<span id="cb89-811"><a href="#cb89-811" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[[<span class="st">'time'</span>, <span class="st">'sdii'</span>]]</span>
<span id="cb89-812"><a href="#cb89-812" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'time'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'time'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">'%Y'</span>)</span>
<span id="cb89-813"><a href="#cb89-813" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[df[<span class="st">'sdii'</span>] <span class="op">!=</span> <span class="op">-</span><span class="fl">99.9</span>]</span>
<span id="cb89-814"><a href="#cb89-814" aria-hidden="true" tabindex="-1"></a>        df.set_index(<span class="st">'time'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-815"><a href="#cb89-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-816"><a href="#cb89-816" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb89-817"><a href="#cb89-817" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, df[<span class="st">'sdii'</span>], marker<span class="op">=</span><span class="st">'D'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Precipitation intensity'</span>)</span>
<span id="cb89-818"><a href="#cb89-818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-819"><a href="#cb89-819" aria-hidden="true" tabindex="-1"></a>        slope, intercept, r_value, p_value, std_err <span class="op">=</span> linregress(mdates.date2num(df.index), df[<span class="st">'sdii'</span>])</span>
<span id="cb89-820"><a href="#cb89-820" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, intercept <span class="op">+</span> slope <span class="op">*</span> mdates.date2num(df.index), linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Regression line'</span>)</span>
<span id="cb89-821"><a href="#cb89-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-822"><a href="#cb89-822" aria-hidden="true" tabindex="-1"></a>        plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb89-823"><a href="#cb89-823" aria-hidden="true" tabindex="-1"></a>        titulo <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>archivo<span class="sc">.</span>split(<span class="st">'_'</span>)[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> Station - Precipitation intensity"</span></span>
<span id="cb89-824"><a href="#cb89-824" aria-hidden="true" tabindex="-1"></a>        <span class="co">#plt.title(titulo, fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb89-825"><a href="#cb89-825" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'Year'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-826"><a href="#cb89-826" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Precipitation (mm)'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-827"><a href="#cb89-827" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_locator(mdates.YearLocator(<span class="dv">5</span>))</span>
<span id="cb89-828"><a href="#cb89-828" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_formatter(mdates.DateFormatter(<span class="st">'%Y'</span>))</span>
<span id="cb89-829"><a href="#cb89-829" aria-hidden="true" tabindex="-1"></a>        plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, fontsize<span class="op">=</span><span class="dv">20</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-830"><a href="#cb89-830" aria-hidden="true" tabindex="-1"></a>        plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-831"><a href="#cb89-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-832"><a href="#cb89-832" aria-hidden="true" tabindex="-1"></a>        info_text <span class="op">=</span> (</span>
<span id="cb89-833"><a href="#cb89-833" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Slope: </span><span class="sc">{</span>slope<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb89-834"><a href="#cb89-834" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Confidence interval: [</span><span class="sc">{</span>intercept <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>intercept <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">]</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb89-835"><a href="#cb89-835" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"p-value: </span><span class="sc">{</span>p_value<span class="sc">:.3f}</span><span class="ss">"</span></span>
<span id="cb89-836"><a href="#cb89-836" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb89-837"><a href="#cb89-837" aria-hidden="true" tabindex="-1"></a>        plt.text(<span class="fl">1.1</span>, <span class="fl">0.65</span>, info_text, transform<span class="op">=</span>plt.gca().transAxes, fontsize<span class="op">=</span><span class="dv">14</span>, verticalalignment<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb89-838"><a href="#cb89-838" aria-hidden="true" tabindex="-1"></a>                 bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb89-839"><a href="#cb89-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-840"><a href="#cb89-840" aria-hidden="true" tabindex="-1"></a>        plt.grid(<span class="va">False</span>)</span>
<span id="cb89-841"><a href="#cb89-841" aria-hidden="true" tabindex="-1"></a>        plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.1</span>, <span class="fl">0.4</span>), fontsize<span class="op">=</span><span class="dv">14</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb89-842"><a href="#cb89-842" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb89-843"><a href="#cb89-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-844"><a href="#cb89-844" aria-hidden="true" tabindex="-1"></a>        estacion_codigo <span class="op">=</span> archivo.split(<span class="st">'_'</span>)[<span class="dv">0</span>]</span>
<span id="cb89-845"><a href="#cb89-845" aria-hidden="true" tabindex="-1"></a>        ruta_salida_estacion <span class="op">=</span> os.path.join(ruta_salida_base, estacion_codigo)</span>
<span id="cb89-846"><a href="#cb89-846" aria-hidden="true" tabindex="-1"></a>        os.makedirs(ruta_salida_estacion, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-847"><a href="#cb89-847" aria-hidden="true" tabindex="-1"></a>        ruta_salida <span class="op">=</span> os.path.join(ruta_salida_estacion, <span class="ss">f"</span><span class="sc">{</span>estacion_codigo<span class="sc">}</span><span class="ss">_sdii_ANN_plot.png"</span>)</span>
<span id="cb89-848"><a href="#cb89-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-849"><a href="#cb89-849" aria-hidden="true" tabindex="-1"></a>        plt.savefig(ruta_salida)</span>
<span id="cb89-850"><a href="#cb89-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-851"><a href="#cb89-851" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb89-852"><a href="#cb89-852" aria-hidden="true" tabindex="-1"></a>            plt.show()</span>
<span id="cb89-853"><a href="#cb89-853" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb89-854"><a href="#cb89-854" aria-hidden="true" tabindex="-1"></a>            plt.close()</span>
<span id="cb89-855"><a href="#cb89-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-856"><a href="#cb89-856" aria-hidden="true" tabindex="-1"></a>        contador <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb89-857"><a href="#cb89-857" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-858"><a href="#cb89-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-859"><a href="#cb89-859" aria-hidden="true" tabindex="-1"></a>5.2.2. Anual accumulated precipitation (prcptot).</span>
<span id="cb89-860"><a href="#cb89-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-861"><a href="#cb89-861" aria-hidden="true" tabindex="-1"></a>Annual sum of daily precipitation <span class="sc">\&gt;</span>= 1.0 mm is now graphed for each station. This was already calculated above.</span>
<span id="cb89-862"><a href="#cb89-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-865"><a href="#cb89-865" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-866"><a href="#cb89-866" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-polar-3</span></span>
<span id="cb89-867"><a href="#cb89-867" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Indicator of total accumulated precipitation at station 9423001"</span></span>
<span id="cb89-868"><a href="#cb89-868" aria-hidden="true" tabindex="-1"></a>ruta_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/5.Climpact'</span></span>
<span id="cb89-869"><a href="#cb89-869" aria-hidden="true" tabindex="-1"></a>ruta_salida_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/6.Figuras_Climpact/Precipitation'</span></span>
<span id="cb89-870"><a href="#cb89-870" aria-hidden="true" tabindex="-1"></a>os.makedirs(ruta_salida_base, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-871"><a href="#cb89-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-872"><a href="#cb89-872" aria-hidden="true" tabindex="-1"></a>contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb89-873"><a href="#cb89-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-874"><a href="#cb89-874" aria-hidden="true" tabindex="-1"></a>subcarpetas <span class="op">=</span> [os.path.join(ruta_base, carpeta) <span class="cf">for</span> carpeta <span class="kw">in</span> os.listdir(ruta_base) <span class="cf">if</span> os.path.isdir(os.path.join(ruta_base, carpeta))]</span>
<span id="cb89-875"><a href="#cb89-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-876"><a href="#cb89-876" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> subcarpeta <span class="kw">in</span> subcarpetas:</span>
<span id="cb89-877"><a href="#cb89-877" aria-hidden="true" tabindex="-1"></a>    carpeta_indices <span class="op">=</span> os.path.join(subcarpeta, <span class="st">'indices'</span>)</span>
<span id="cb89-878"><a href="#cb89-878" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(carpeta_indices):</span>
<span id="cb89-879"><a href="#cb89-879" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb89-880"><a href="#cb89-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-881"><a href="#cb89-881" aria-hidden="true" tabindex="-1"></a>    archivos <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(carpeta_indices) <span class="cf">if</span> f.endswith(<span class="st">'_prcptot_ANN.csv'</span>)]</span>
<span id="cb89-882"><a href="#cb89-882" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> archivo <span class="kw">in</span> archivos:</span>
<span id="cb89-883"><a href="#cb89-883" aria-hidden="true" tabindex="-1"></a>        ruta_archivo <span class="op">=</span> os.path.join(carpeta_indices, archivo)</span>
<span id="cb89-884"><a href="#cb89-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-885"><a href="#cb89-885" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_csv(ruta_archivo, skiprows<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb89-886"><a href="#cb89-886" aria-hidden="true" tabindex="-1"></a>        df.columns <span class="op">=</span> df.columns.<span class="bu">str</span>.strip()</span>
<span id="cb89-887"><a href="#cb89-887" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[[<span class="st">'time'</span>, <span class="st">'prcptot'</span>]]</span>
<span id="cb89-888"><a href="#cb89-888" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'time'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'time'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">'%Y'</span>)</span>
<span id="cb89-889"><a href="#cb89-889" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[df[<span class="st">'prcptot'</span>] <span class="op">!=</span> <span class="op">-</span><span class="fl">99.9</span>]</span>
<span id="cb89-890"><a href="#cb89-890" aria-hidden="true" tabindex="-1"></a>        df.set_index(<span class="st">'time'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-891"><a href="#cb89-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-892"><a href="#cb89-892" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb89-893"><a href="#cb89-893" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, df[<span class="st">'prcptot'</span>], marker<span class="op">=</span><span class="st">'D'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Total Precipitation'</span>)</span>
<span id="cb89-894"><a href="#cb89-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-895"><a href="#cb89-895" aria-hidden="true" tabindex="-1"></a>        slope, intercept, r_value, p_value, std_err <span class="op">=</span> linregress(mdates.date2num(df.index), df[<span class="st">'prcptot'</span>])</span>
<span id="cb89-896"><a href="#cb89-896" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, intercept <span class="op">+</span> slope <span class="op">*</span> mdates.date2num(df.index), linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Regression line'</span>)</span>
<span id="cb89-897"><a href="#cb89-897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-898"><a href="#cb89-898" aria-hidden="true" tabindex="-1"></a>        plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb89-899"><a href="#cb89-899" aria-hidden="true" tabindex="-1"></a>        titulo <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>archivo<span class="sc">.</span>split(<span class="st">'_'</span>)[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> Station - Anual precipitation"</span></span>
<span id="cb89-900"><a href="#cb89-900" aria-hidden="true" tabindex="-1"></a>        <span class="co">#plt.title(titulo, fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb89-901"><a href="#cb89-901" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'Year'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-902"><a href="#cb89-902" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Precipitation (mm)'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-903"><a href="#cb89-903" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_locator(mdates.YearLocator(<span class="dv">5</span>))</span>
<span id="cb89-904"><a href="#cb89-904" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_formatter(mdates.DateFormatter(<span class="st">'%Y'</span>))</span>
<span id="cb89-905"><a href="#cb89-905" aria-hidden="true" tabindex="-1"></a>        plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, fontsize<span class="op">=</span><span class="dv">20</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-906"><a href="#cb89-906" aria-hidden="true" tabindex="-1"></a>        plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-907"><a href="#cb89-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-908"><a href="#cb89-908" aria-hidden="true" tabindex="-1"></a>        info_text <span class="op">=</span> (</span>
<span id="cb89-909"><a href="#cb89-909" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Slope: </span><span class="sc">{</span>slope<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb89-910"><a href="#cb89-910" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Confidence interval: [</span><span class="sc">{</span>intercept <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>intercept <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">]</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb89-911"><a href="#cb89-911" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"p-value: </span><span class="sc">{</span>p_value<span class="sc">:.3f}</span><span class="ss">"</span></span>
<span id="cb89-912"><a href="#cb89-912" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb89-913"><a href="#cb89-913" aria-hidden="true" tabindex="-1"></a>        plt.text(<span class="fl">1.1</span>, <span class="fl">0.65</span>, info_text, transform<span class="op">=</span>plt.gca().transAxes, fontsize<span class="op">=</span><span class="dv">14</span>, verticalalignment<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb89-914"><a href="#cb89-914" aria-hidden="true" tabindex="-1"></a>                 bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb89-915"><a href="#cb89-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-916"><a href="#cb89-916" aria-hidden="true" tabindex="-1"></a>        plt.grid(<span class="va">False</span>)</span>
<span id="cb89-917"><a href="#cb89-917" aria-hidden="true" tabindex="-1"></a>        plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.1</span>, <span class="fl">0.4</span>), fontsize<span class="op">=</span><span class="dv">14</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb89-918"><a href="#cb89-918" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb89-919"><a href="#cb89-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-920"><a href="#cb89-920" aria-hidden="true" tabindex="-1"></a>        estacion_codigo <span class="op">=</span> archivo.split(<span class="st">'_'</span>)[<span class="dv">0</span>]</span>
<span id="cb89-921"><a href="#cb89-921" aria-hidden="true" tabindex="-1"></a>        ruta_salida_estacion <span class="op">=</span> os.path.join(ruta_salida_base, estacion_codigo)</span>
<span id="cb89-922"><a href="#cb89-922" aria-hidden="true" tabindex="-1"></a>        os.makedirs(ruta_salida_estacion, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-923"><a href="#cb89-923" aria-hidden="true" tabindex="-1"></a>        ruta_salida <span class="op">=</span> os.path.join(ruta_salida_estacion, <span class="ss">f"</span><span class="sc">{</span>estacion_codigo<span class="sc">}</span><span class="ss">_prcptot_ANN_plot.png"</span>)</span>
<span id="cb89-924"><a href="#cb89-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-925"><a href="#cb89-925" aria-hidden="true" tabindex="-1"></a>        plt.savefig(ruta_salida)</span>
<span id="cb89-926"><a href="#cb89-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-927"><a href="#cb89-927" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb89-928"><a href="#cb89-928" aria-hidden="true" tabindex="-1"></a>            plt.show()</span>
<span id="cb89-929"><a href="#cb89-929" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb89-930"><a href="#cb89-930" aria-hidden="true" tabindex="-1"></a>            plt.close()</span>
<span id="cb89-931"><a href="#cb89-931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-932"><a href="#cb89-932" aria-hidden="true" tabindex="-1"></a>        contador <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb89-933"><a href="#cb89-933" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-934"><a href="#cb89-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-935"><a href="#cb89-935" aria-hidden="true" tabindex="-1"></a>5.2.3. Consecutive dry days (cdd).</span>
<span id="cb89-936"><a href="#cb89-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-937"><a href="#cb89-937" aria-hidden="true" tabindex="-1"></a>Maximum annual number of consecutive dry days (when precipitation <span class="sc">\&lt;</span> 1.0 mm).</span>
<span id="cb89-938"><a href="#cb89-938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-941"><a href="#cb89-941" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-942"><a href="#cb89-942" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-polar-4</span></span>
<span id="cb89-943"><a href="#cb89-943" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Indicator of consecutive dry days at station 9423001"</span></span>
<span id="cb89-944"><a href="#cb89-944" aria-hidden="true" tabindex="-1"></a>ruta_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/5.Climpact'</span></span>
<span id="cb89-945"><a href="#cb89-945" aria-hidden="true" tabindex="-1"></a>ruta_salida_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/6.Figuras_Climpact/Precipitation'</span></span>
<span id="cb89-946"><a href="#cb89-946" aria-hidden="true" tabindex="-1"></a>os.makedirs(ruta_salida_base, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-947"><a href="#cb89-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-948"><a href="#cb89-948" aria-hidden="true" tabindex="-1"></a>subcarpetas <span class="op">=</span> [os.path.join(ruta_base, carpeta) <span class="cf">for</span> carpeta <span class="kw">in</span> os.listdir(ruta_base) <span class="cf">if</span> os.path.isdir(os.path.join(ruta_base, carpeta))]</span>
<span id="cb89-949"><a href="#cb89-949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-950"><a href="#cb89-950" aria-hidden="true" tabindex="-1"></a>contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb89-951"><a href="#cb89-951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-952"><a href="#cb89-952" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> subcarpeta <span class="kw">in</span> subcarpetas:</span>
<span id="cb89-953"><a href="#cb89-953" aria-hidden="true" tabindex="-1"></a>    carpeta_indices <span class="op">=</span> os.path.join(subcarpeta, <span class="st">'indices'</span>)</span>
<span id="cb89-954"><a href="#cb89-954" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(carpeta_indices):</span>
<span id="cb89-955"><a href="#cb89-955" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb89-956"><a href="#cb89-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-957"><a href="#cb89-957" aria-hidden="true" tabindex="-1"></a>    archivos <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(carpeta_indices) <span class="cf">if</span> f.endswith(<span class="st">'_cdd_ANN.csv'</span>)]</span>
<span id="cb89-958"><a href="#cb89-958" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> archivo <span class="kw">in</span> archivos:</span>
<span id="cb89-959"><a href="#cb89-959" aria-hidden="true" tabindex="-1"></a>        ruta_archivo <span class="op">=</span> os.path.join(carpeta_indices, archivo)</span>
<span id="cb89-960"><a href="#cb89-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-961"><a href="#cb89-961" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_csv(ruta_archivo, skiprows<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb89-962"><a href="#cb89-962" aria-hidden="true" tabindex="-1"></a>        df.columns <span class="op">=</span> df.columns.<span class="bu">str</span>.strip()</span>
<span id="cb89-963"><a href="#cb89-963" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[[<span class="st">'time'</span>, <span class="st">'cdd'</span>]]</span>
<span id="cb89-964"><a href="#cb89-964" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'time'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'time'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">'%Y'</span>)</span>
<span id="cb89-965"><a href="#cb89-965" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[df[<span class="st">'cdd'</span>] <span class="op">!=</span> <span class="op">-</span><span class="fl">99.9</span>]</span>
<span id="cb89-966"><a href="#cb89-966" aria-hidden="true" tabindex="-1"></a>        df.set_index(<span class="st">'time'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-967"><a href="#cb89-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-968"><a href="#cb89-968" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb89-969"><a href="#cb89-969" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, df[<span class="st">'cdd'</span>], marker<span class="op">=</span><span class="st">'D'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Dry days'</span>)</span>
<span id="cb89-970"><a href="#cb89-970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-971"><a href="#cb89-971" aria-hidden="true" tabindex="-1"></a>        slope, intercept, r_value, p_value, std_err <span class="op">=</span> linregress(mdates.date2num(df.index), df[<span class="st">'cdd'</span>])</span>
<span id="cb89-972"><a href="#cb89-972" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, intercept <span class="op">+</span> slope <span class="op">*</span> mdates.date2num(df.index), linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Regression line'</span>)</span>
<span id="cb89-973"><a href="#cb89-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-974"><a href="#cb89-974" aria-hidden="true" tabindex="-1"></a>        plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb89-975"><a href="#cb89-975" aria-hidden="true" tabindex="-1"></a>        titulo <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>archivo<span class="sc">.</span>split(<span class="st">'_'</span>)[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> Station - Consecutive dry days"</span></span>
<span id="cb89-976"><a href="#cb89-976" aria-hidden="true" tabindex="-1"></a>        <span class="co">#plt.title(titulo, fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb89-977"><a href="#cb89-977" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'Year'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-978"><a href="#cb89-978" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Days'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-979"><a href="#cb89-979" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_locator(mdates.YearLocator(<span class="dv">5</span>))</span>
<span id="cb89-980"><a href="#cb89-980" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_formatter(mdates.DateFormatter(<span class="st">'%Y'</span>))</span>
<span id="cb89-981"><a href="#cb89-981" aria-hidden="true" tabindex="-1"></a>        plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, fontsize<span class="op">=</span><span class="dv">20</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-982"><a href="#cb89-982" aria-hidden="true" tabindex="-1"></a>        plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-983"><a href="#cb89-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-984"><a href="#cb89-984" aria-hidden="true" tabindex="-1"></a>        info_text <span class="op">=</span> (</span>
<span id="cb89-985"><a href="#cb89-985" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Slope: </span><span class="sc">{</span>slope<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb89-986"><a href="#cb89-986" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Confidence interval: [</span><span class="sc">{</span>intercept <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>intercept <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">]</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb89-987"><a href="#cb89-987" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"p-value: </span><span class="sc">{</span>p_value<span class="sc">:.3f}</span><span class="ss">"</span></span>
<span id="cb89-988"><a href="#cb89-988" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb89-989"><a href="#cb89-989" aria-hidden="true" tabindex="-1"></a>        plt.text(<span class="fl">1.1</span>, <span class="fl">0.65</span>, info_text, transform<span class="op">=</span>plt.gca().transAxes, fontsize<span class="op">=</span><span class="dv">14</span>, verticalalignment<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb89-990"><a href="#cb89-990" aria-hidden="true" tabindex="-1"></a>                 bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb89-991"><a href="#cb89-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-992"><a href="#cb89-992" aria-hidden="true" tabindex="-1"></a>        plt.grid(<span class="va">False</span>)</span>
<span id="cb89-993"><a href="#cb89-993" aria-hidden="true" tabindex="-1"></a>        plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.1</span>, <span class="fl">0.4</span>), fontsize<span class="op">=</span><span class="dv">14</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb89-994"><a href="#cb89-994" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb89-995"><a href="#cb89-995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-996"><a href="#cb89-996" aria-hidden="true" tabindex="-1"></a>        estacion_codigo <span class="op">=</span> archivo.split(<span class="st">'_'</span>)[<span class="dv">0</span>]</span>
<span id="cb89-997"><a href="#cb89-997" aria-hidden="true" tabindex="-1"></a>        ruta_salida_estacion <span class="op">=</span> os.path.join(ruta_salida_base, estacion_codigo)</span>
<span id="cb89-998"><a href="#cb89-998" aria-hidden="true" tabindex="-1"></a>        os.makedirs(ruta_salida_estacion, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-999"><a href="#cb89-999" aria-hidden="true" tabindex="-1"></a>        ruta_salida <span class="op">=</span> os.path.join(ruta_salida_estacion, <span class="ss">f"</span><span class="sc">{</span>estacion_codigo<span class="sc">}</span><span class="ss">_cdd_ANN_plot.png"</span>)</span>
<span id="cb89-1000"><a href="#cb89-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1001"><a href="#cb89-1001" aria-hidden="true" tabindex="-1"></a>        plt.savefig(ruta_salida)</span>
<span id="cb89-1002"><a href="#cb89-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1003"><a href="#cb89-1003" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb89-1004"><a href="#cb89-1004" aria-hidden="true" tabindex="-1"></a>            plt.show()</span>
<span id="cb89-1005"><a href="#cb89-1005" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb89-1006"><a href="#cb89-1006" aria-hidden="true" tabindex="-1"></a>            plt.close()</span>
<span id="cb89-1007"><a href="#cb89-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1008"><a href="#cb89-1008" aria-hidden="true" tabindex="-1"></a>        contador <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb89-1009"><a href="#cb89-1009" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-1010"><a href="#cb89-1010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1011"><a href="#cb89-1011" aria-hidden="true" tabindex="-1"></a>5.2.4. Days with precipitation greater than 30mm (r30mm).</span>
<span id="cb89-1012"><a href="#cb89-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1013"><a href="#cb89-1013" aria-hidden="true" tabindex="-1"></a>Number of days when precipitation <span class="sc">\&gt;</span>= 30mm.</span>
<span id="cb89-1014"><a href="#cb89-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1017"><a href="#cb89-1017" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-1018"><a href="#cb89-1018" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-polar-5</span></span>
<span id="cb89-1019"><a href="#cb89-1019" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Indicator of days with precipitation greater than 30 mm at station 9423001"</span></span>
<span id="cb89-1020"><a href="#cb89-1020" aria-hidden="true" tabindex="-1"></a>ruta_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/5.Climpact'</span></span>
<span id="cb89-1021"><a href="#cb89-1021" aria-hidden="true" tabindex="-1"></a>ruta_salida_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/6.Figuras_Climpact/Precipitation'</span></span>
<span id="cb89-1022"><a href="#cb89-1022" aria-hidden="true" tabindex="-1"></a>os.makedirs(ruta_salida_base, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-1023"><a href="#cb89-1023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1024"><a href="#cb89-1024" aria-hidden="true" tabindex="-1"></a>subcarpetas <span class="op">=</span> [os.path.join(ruta_base, carpeta) <span class="cf">for</span> carpeta <span class="kw">in</span> os.listdir(ruta_base) <span class="cf">if</span> os.path.isdir(os.path.join(ruta_base, carpeta))]</span>
<span id="cb89-1025"><a href="#cb89-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1026"><a href="#cb89-1026" aria-hidden="true" tabindex="-1"></a>contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb89-1027"><a href="#cb89-1027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1028"><a href="#cb89-1028" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> subcarpeta <span class="kw">in</span> subcarpetas:</span>
<span id="cb89-1029"><a href="#cb89-1029" aria-hidden="true" tabindex="-1"></a>    carpeta_indices <span class="op">=</span> os.path.join(subcarpeta, <span class="st">'indices'</span>)</span>
<span id="cb89-1030"><a href="#cb89-1030" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(carpeta_indices):</span>
<span id="cb89-1031"><a href="#cb89-1031" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb89-1032"><a href="#cb89-1032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1033"><a href="#cb89-1033" aria-hidden="true" tabindex="-1"></a>    archivos <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(carpeta_indices) <span class="cf">if</span> f.endswith(<span class="st">'_r30mm_ANN.csv'</span>)]</span>
<span id="cb89-1034"><a href="#cb89-1034" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> archivo <span class="kw">in</span> archivos:</span>
<span id="cb89-1035"><a href="#cb89-1035" aria-hidden="true" tabindex="-1"></a>        ruta_archivo <span class="op">=</span> os.path.join(carpeta_indices, archivo)</span>
<span id="cb89-1036"><a href="#cb89-1036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1037"><a href="#cb89-1037" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_csv(ruta_archivo, skiprows<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb89-1038"><a href="#cb89-1038" aria-hidden="true" tabindex="-1"></a>        df.columns <span class="op">=</span> df.columns.<span class="bu">str</span>.strip()</span>
<span id="cb89-1039"><a href="#cb89-1039" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[[<span class="st">'time'</span>, <span class="st">'r30mm'</span>]]</span>
<span id="cb89-1040"><a href="#cb89-1040" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'time'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'time'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">'%Y'</span>)</span>
<span id="cb89-1041"><a href="#cb89-1041" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[df[<span class="st">'r30mm'</span>] <span class="op">!=</span> <span class="op">-</span><span class="fl">99.9</span>]</span>
<span id="cb89-1042"><a href="#cb89-1042" aria-hidden="true" tabindex="-1"></a>        df.set_index(<span class="st">'time'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-1043"><a href="#cb89-1043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1044"><a href="#cb89-1044" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb89-1045"><a href="#cb89-1045" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, df[<span class="st">'r30mm'</span>], marker<span class="op">=</span><span class="st">'D'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Dry days'</span>)</span>
<span id="cb89-1046"><a href="#cb89-1046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1047"><a href="#cb89-1047" aria-hidden="true" tabindex="-1"></a>        slope, intercept, r_value, p_value, std_err <span class="op">=</span> linregress(mdates.date2num(df.index), df[<span class="st">'r30mm'</span>])</span>
<span id="cb89-1048"><a href="#cb89-1048" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, intercept <span class="op">+</span> slope <span class="op">*</span> mdates.date2num(df.index), linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Regression line'</span>)</span>
<span id="cb89-1049"><a href="#cb89-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1050"><a href="#cb89-1050" aria-hidden="true" tabindex="-1"></a>        plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb89-1051"><a href="#cb89-1051" aria-hidden="true" tabindex="-1"></a>        titulo <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>archivo<span class="sc">.</span>split(<span class="st">'_'</span>)[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> Station - Precipitation &gt;= 30mm"</span></span>
<span id="cb89-1052"><a href="#cb89-1052" aria-hidden="true" tabindex="-1"></a>        <span class="co">#plt.title(titulo, fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb89-1053"><a href="#cb89-1053" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'Year'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1054"><a href="#cb89-1054" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Days'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1055"><a href="#cb89-1055" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_locator(mdates.YearLocator(<span class="dv">5</span>))</span>
<span id="cb89-1056"><a href="#cb89-1056" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_formatter(mdates.DateFormatter(<span class="st">'%Y'</span>))</span>
<span id="cb89-1057"><a href="#cb89-1057" aria-hidden="true" tabindex="-1"></a>        plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, fontsize<span class="op">=</span><span class="dv">20</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1058"><a href="#cb89-1058" aria-hidden="true" tabindex="-1"></a>        plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1059"><a href="#cb89-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1060"><a href="#cb89-1060" aria-hidden="true" tabindex="-1"></a>        info_text <span class="op">=</span> (</span>
<span id="cb89-1061"><a href="#cb89-1061" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Slope: </span><span class="sc">{</span>slope<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb89-1062"><a href="#cb89-1062" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Confidence interval: [</span><span class="sc">{</span>intercept <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>intercept <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">]</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb89-1063"><a href="#cb89-1063" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"p-value: </span><span class="sc">{</span>p_value<span class="sc">:.3f}</span><span class="ss">"</span></span>
<span id="cb89-1064"><a href="#cb89-1064" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb89-1065"><a href="#cb89-1065" aria-hidden="true" tabindex="-1"></a>        plt.text(<span class="fl">1.1</span>, <span class="fl">0.65</span>, info_text, transform<span class="op">=</span>plt.gca().transAxes, fontsize<span class="op">=</span><span class="dv">14</span>, verticalalignment<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb89-1066"><a href="#cb89-1066" aria-hidden="true" tabindex="-1"></a>                 bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb89-1067"><a href="#cb89-1067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1068"><a href="#cb89-1068" aria-hidden="true" tabindex="-1"></a>        plt.grid(<span class="va">False</span>)</span>
<span id="cb89-1069"><a href="#cb89-1069" aria-hidden="true" tabindex="-1"></a>        plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.1</span>, <span class="fl">0.4</span>), fontsize<span class="op">=</span><span class="dv">14</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb89-1070"><a href="#cb89-1070" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb89-1071"><a href="#cb89-1071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1072"><a href="#cb89-1072" aria-hidden="true" tabindex="-1"></a>        estacion_codigo <span class="op">=</span> archivo.split(<span class="st">'_'</span>)[<span class="dv">0</span>]</span>
<span id="cb89-1073"><a href="#cb89-1073" aria-hidden="true" tabindex="-1"></a>        ruta_salida_estacion <span class="op">=</span> os.path.join(ruta_salida_base, estacion_codigo)</span>
<span id="cb89-1074"><a href="#cb89-1074" aria-hidden="true" tabindex="-1"></a>        os.makedirs(ruta_salida_estacion, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-1075"><a href="#cb89-1075" aria-hidden="true" tabindex="-1"></a>        ruta_salida <span class="op">=</span> os.path.join(ruta_salida_estacion, <span class="ss">f"</span><span class="sc">{</span>estacion_codigo<span class="sc">}</span><span class="ss">_r30mm_ANN_plot.png"</span>)</span>
<span id="cb89-1076"><a href="#cb89-1076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1077"><a href="#cb89-1077" aria-hidden="true" tabindex="-1"></a>        plt.savefig(ruta_salida)</span>
<span id="cb89-1078"><a href="#cb89-1078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1079"><a href="#cb89-1079" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb89-1080"><a href="#cb89-1080" aria-hidden="true" tabindex="-1"></a>            plt.show()</span>
<span id="cb89-1081"><a href="#cb89-1081" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb89-1082"><a href="#cb89-1082" aria-hidden="true" tabindex="-1"></a>            plt.close()</span>
<span id="cb89-1083"><a href="#cb89-1083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1084"><a href="#cb89-1084" aria-hidden="true" tabindex="-1"></a>        contador <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb89-1085"><a href="#cb89-1085" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-1086"><a href="#cb89-1086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1087"><a href="#cb89-1087" aria-hidden="true" tabindex="-1"></a>5.2.5. Standardised Precipitation Evapotranspiration Index (SPEI)</span>
<span id="cb89-1088"><a href="#cb89-1088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1089"><a href="#cb89-1089" aria-hidden="true" tabindex="-1"></a>This indicator estimates water balance using precipitation and temperature information. It provides a drought indicator. In this case, it is graphed on a 24-month scale. Due to the monthly scale of the indicator, the code has slight adjustments.</span>
<span id="cb89-1090"><a href="#cb89-1090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1093"><a href="#cb89-1093" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-1094"><a href="#cb89-1094" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-polar-6</span></span>
<span id="cb89-1095"><a href="#cb89-1095" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Indicator of Standardised Precipitation Evapotrasnpiration Index at station 9423001"</span></span>
<span id="cb89-1096"><a href="#cb89-1096" aria-hidden="true" tabindex="-1"></a>ruta_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/5.Climpact'</span></span>
<span id="cb89-1097"><a href="#cb89-1097" aria-hidden="true" tabindex="-1"></a>ruta_salida_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/6.Figuras_Climpact/Precipitation'</span></span>
<span id="cb89-1098"><a href="#cb89-1098" aria-hidden="true" tabindex="-1"></a>os.makedirs(ruta_salida_base, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-1099"><a href="#cb89-1099" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1100"><a href="#cb89-1100" aria-hidden="true" tabindex="-1"></a>subcarpetas <span class="op">=</span> [os.path.join(ruta_base, carpeta) <span class="cf">for</span> carpeta <span class="kw">in</span> os.listdir(ruta_base) <span class="cf">if</span> os.path.isdir(os.path.join(ruta_base, carpeta))]</span>
<span id="cb89-1101"><a href="#cb89-1101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1102"><a href="#cb89-1102" aria-hidden="true" tabindex="-1"></a>contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb89-1103"><a href="#cb89-1103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1104"><a href="#cb89-1104" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> subcarpeta <span class="kw">in</span> subcarpetas:</span>
<span id="cb89-1105"><a href="#cb89-1105" aria-hidden="true" tabindex="-1"></a>    carpeta_indices <span class="op">=</span> os.path.join(subcarpeta, <span class="st">'indices'</span>)</span>
<span id="cb89-1106"><a href="#cb89-1106" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(carpeta_indices):</span>
<span id="cb89-1107"><a href="#cb89-1107" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb89-1108"><a href="#cb89-1108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1109"><a href="#cb89-1109" aria-hidden="true" tabindex="-1"></a>    archivos <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(carpeta_indices) <span class="cf">if</span> f.endswith(<span class="st">'_24month_spei_MON.csv'</span>)]</span>
<span id="cb89-1110"><a href="#cb89-1110" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> archivo <span class="kw">in</span> archivos:</span>
<span id="cb89-1111"><a href="#cb89-1111" aria-hidden="true" tabindex="-1"></a>        ruta_archivo <span class="op">=</span> os.path.join(carpeta_indices, archivo)</span>
<span id="cb89-1112"><a href="#cb89-1112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1113"><a href="#cb89-1113" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_csv(ruta_archivo, skiprows<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb89-1114"><a href="#cb89-1114" aria-hidden="true" tabindex="-1"></a>        df.columns <span class="op">=</span> df.columns.<span class="bu">str</span>.strip()</span>
<span id="cb89-1115"><a href="#cb89-1115" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[[<span class="st">'time'</span>, <span class="st">'spei'</span>]]</span>
<span id="cb89-1116"><a href="#cb89-1116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1117"><a href="#cb89-1117" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'time'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'time'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">'%Y-%m'</span>)</span>
<span id="cb89-1118"><a href="#cb89-1118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1119"><a href="#cb89-1119" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[df[<span class="st">'spei'</span>] <span class="op">!=</span> <span class="op">-</span><span class="fl">99.9</span>]</span>
<span id="cb89-1120"><a href="#cb89-1120" aria-hidden="true" tabindex="-1"></a>        df.set_index(<span class="st">'time'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-1121"><a href="#cb89-1121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1122"><a href="#cb89-1122" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb89-1123"><a href="#cb89-1123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1124"><a href="#cb89-1124" aria-hidden="true" tabindex="-1"></a>        df_pos <span class="op">=</span> df[df[<span class="st">'spei'</span>] <span class="op">&gt;=</span> <span class="dv">0</span>]</span>
<span id="cb89-1125"><a href="#cb89-1125" aria-hidden="true" tabindex="-1"></a>        df_neg <span class="op">=</span> df[df[<span class="st">'spei'</span>] <span class="op">&lt;</span> <span class="dv">0</span>]</span>
<span id="cb89-1126"><a href="#cb89-1126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1127"><a href="#cb89-1127" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, df[<span class="st">'spei'</span>], linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'SPEI'</span>)</span>
<span id="cb89-1128"><a href="#cb89-1128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1129"><a href="#cb89-1129" aria-hidden="true" tabindex="-1"></a>        plt.plot(df_pos.index, df_pos[<span class="st">'spei'</span>], marker<span class="op">=</span><span class="st">'o'</span>, linestyle<span class="op">=</span><span class="st">'None'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'SPEI ≥ 0'</span>)</span>
<span id="cb89-1130"><a href="#cb89-1130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1131"><a href="#cb89-1131" aria-hidden="true" tabindex="-1"></a>        plt.plot(df_neg.index, df_neg[<span class="st">'spei'</span>], marker<span class="op">=</span><span class="st">'o'</span>, linestyle<span class="op">=</span><span class="st">'None'</span>, color<span class="op">=</span><span class="st">'gray'</span>, label<span class="op">=</span><span class="st">'SPEI &lt; 0'</span>)</span>
<span id="cb89-1132"><a href="#cb89-1132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1133"><a href="#cb89-1133" aria-hidden="true" tabindex="-1"></a>        slope, intercept, r_value, p_value, std_err <span class="op">=</span> linregress(mdates.date2num(df.index), df[<span class="st">'spei'</span>])</span>
<span id="cb89-1134"><a href="#cb89-1134" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, intercept <span class="op">+</span> slope <span class="op">*</span> mdates.date2num(df.index), linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Regression line'</span>)</span>
<span id="cb89-1135"><a href="#cb89-1135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1136"><a href="#cb89-1136" aria-hidden="true" tabindex="-1"></a>        plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb89-1137"><a href="#cb89-1137" aria-hidden="true" tabindex="-1"></a>        titulo <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>archivo<span class="sc">.</span>split(<span class="st">'_'</span>)[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> Station - SPEI compared to the last 24 months"</span></span>
<span id="cb89-1138"><a href="#cb89-1138" aria-hidden="true" tabindex="-1"></a>        <span class="co">#plt.title(titulo, fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb89-1139"><a href="#cb89-1139" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'Year'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1140"><a href="#cb89-1140" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'SPEI'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1141"><a href="#cb89-1141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1142"><a href="#cb89-1142" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_locator(mdates.YearLocator(<span class="dv">5</span>))</span>
<span id="cb89-1143"><a href="#cb89-1143" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_formatter(mdates.DateFormatter(<span class="st">'%Y'</span>))</span>
<span id="cb89-1144"><a href="#cb89-1144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1145"><a href="#cb89-1145" aria-hidden="true" tabindex="-1"></a>        plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, fontsize<span class="op">=</span><span class="dv">20</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1146"><a href="#cb89-1146" aria-hidden="true" tabindex="-1"></a>        plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1147"><a href="#cb89-1147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1148"><a href="#cb89-1148" aria-hidden="true" tabindex="-1"></a>        info_text <span class="op">=</span> (</span>
<span id="cb89-1149"><a href="#cb89-1149" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Slope: </span><span class="sc">{</span>slope<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb89-1150"><a href="#cb89-1150" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Confidence interval: [</span><span class="sc">{</span>intercept <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>intercept <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">]</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb89-1151"><a href="#cb89-1151" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"p-value: </span><span class="sc">{</span>p_value<span class="sc">:.3f}</span><span class="ss">"</span></span>
<span id="cb89-1152"><a href="#cb89-1152" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb89-1153"><a href="#cb89-1153" aria-hidden="true" tabindex="-1"></a>        plt.text(<span class="fl">1.1</span>, <span class="fl">0.65</span>, info_text, transform<span class="op">=</span>plt.gca().transAxes, fontsize<span class="op">=</span><span class="dv">14</span>, verticalalignment<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb89-1154"><a href="#cb89-1154" aria-hidden="true" tabindex="-1"></a>                 bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb89-1155"><a href="#cb89-1155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1156"><a href="#cb89-1156" aria-hidden="true" tabindex="-1"></a>        plt.grid(<span class="va">False</span>)</span>
<span id="cb89-1157"><a href="#cb89-1157" aria-hidden="true" tabindex="-1"></a>        plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.1</span>, <span class="fl">0.4</span>), fontsize<span class="op">=</span><span class="dv">14</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb89-1158"><a href="#cb89-1158" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb89-1159"><a href="#cb89-1159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1160"><a href="#cb89-1160" aria-hidden="true" tabindex="-1"></a>        estacion_codigo <span class="op">=</span> archivo.split(<span class="st">'_'</span>)[<span class="dv">0</span>]</span>
<span id="cb89-1161"><a href="#cb89-1161" aria-hidden="true" tabindex="-1"></a>        ruta_salida_estacion <span class="op">=</span> os.path.join(ruta_salida_base, estacion_codigo)</span>
<span id="cb89-1162"><a href="#cb89-1162" aria-hidden="true" tabindex="-1"></a>        os.makedirs(ruta_salida_estacion, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-1163"><a href="#cb89-1163" aria-hidden="true" tabindex="-1"></a>        ruta_salida <span class="op">=</span> os.path.join(ruta_salida_estacion, <span class="ss">f"</span><span class="sc">{</span>estacion_codigo<span class="sc">}</span><span class="ss">_spei24_MON_plot.png"</span>)</span>
<span id="cb89-1164"><a href="#cb89-1164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1165"><a href="#cb89-1165" aria-hidden="true" tabindex="-1"></a>        plt.savefig(ruta_salida)</span>
<span id="cb89-1166"><a href="#cb89-1166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1167"><a href="#cb89-1167" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb89-1168"><a href="#cb89-1168" aria-hidden="true" tabindex="-1"></a>            plt.show()</span>
<span id="cb89-1169"><a href="#cb89-1169" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb89-1170"><a href="#cb89-1170" aria-hidden="true" tabindex="-1"></a>            plt.close()</span>
<span id="cb89-1171"><a href="#cb89-1171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1172"><a href="#cb89-1172" aria-hidden="true" tabindex="-1"></a>        contador <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb89-1173"><a href="#cb89-1173" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-1174"><a href="#cb89-1174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1175"><a href="#cb89-1175" aria-hidden="true" tabindex="-1"></a><span class="fu">### Suggested temperature indicators and their figures</span></span>
<span id="cb89-1176"><a href="#cb89-1176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1177"><a href="#cb89-1177" aria-hidden="true" tabindex="-1"></a>5.3.1. Annual mean daily minimum temperature (tnm).</span>
<span id="cb89-1178"><a href="#cb89-1178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1181"><a href="#cb89-1181" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-1182"><a href="#cb89-1182" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-polar-7</span></span>
<span id="cb89-1183"><a href="#cb89-1183" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Indicator of annual mean daily minimum temperature at station 9423001"</span></span>
<span id="cb89-1184"><a href="#cb89-1184" aria-hidden="true" tabindex="-1"></a>ruta_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/5.Climpact'</span></span>
<span id="cb89-1185"><a href="#cb89-1185" aria-hidden="true" tabindex="-1"></a>ruta_salida_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/6.Figuras_Climpact/Temperature'</span></span>
<span id="cb89-1186"><a href="#cb89-1186" aria-hidden="true" tabindex="-1"></a>os.makedirs(ruta_salida_base, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-1187"><a href="#cb89-1187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1188"><a href="#cb89-1188" aria-hidden="true" tabindex="-1"></a>subcarpetas <span class="op">=</span> [os.path.join(ruta_base, carpeta) <span class="cf">for</span> carpeta <span class="kw">in</span> os.listdir(ruta_base) <span class="cf">if</span> os.path.isdir(os.path.join(ruta_base, carpeta))]</span>
<span id="cb89-1189"><a href="#cb89-1189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1190"><a href="#cb89-1190" aria-hidden="true" tabindex="-1"></a>contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb89-1191"><a href="#cb89-1191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1192"><a href="#cb89-1192" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> subcarpeta <span class="kw">in</span> subcarpetas:</span>
<span id="cb89-1193"><a href="#cb89-1193" aria-hidden="true" tabindex="-1"></a>    carpeta_indices <span class="op">=</span> os.path.join(subcarpeta, <span class="st">'indices'</span>)</span>
<span id="cb89-1194"><a href="#cb89-1194" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(carpeta_indices):</span>
<span id="cb89-1195"><a href="#cb89-1195" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb89-1196"><a href="#cb89-1196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1197"><a href="#cb89-1197" aria-hidden="true" tabindex="-1"></a>    archivos <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(carpeta_indices) <span class="cf">if</span> f.endswith(<span class="st">'_tnm_ANN.csv'</span>)]</span>
<span id="cb89-1198"><a href="#cb89-1198" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> archivo <span class="kw">in</span> archivos:</span>
<span id="cb89-1199"><a href="#cb89-1199" aria-hidden="true" tabindex="-1"></a>        ruta_archivo <span class="op">=</span> os.path.join(carpeta_indices, archivo)</span>
<span id="cb89-1200"><a href="#cb89-1200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1201"><a href="#cb89-1201" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_csv(ruta_archivo, skiprows<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb89-1202"><a href="#cb89-1202" aria-hidden="true" tabindex="-1"></a>        df.columns <span class="op">=</span> df.columns.<span class="bu">str</span>.strip()</span>
<span id="cb89-1203"><a href="#cb89-1203" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[[<span class="st">'time'</span>, <span class="st">'tnm'</span>]]</span>
<span id="cb89-1204"><a href="#cb89-1204" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'time'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'time'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">'%Y'</span>)</span>
<span id="cb89-1205"><a href="#cb89-1205" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[df[<span class="st">'tnm'</span>] <span class="op">!=</span> <span class="op">-</span><span class="fl">99.9</span>]</span>
<span id="cb89-1206"><a href="#cb89-1206" aria-hidden="true" tabindex="-1"></a>        df.set_index(<span class="st">'time'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-1207"><a href="#cb89-1207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1208"><a href="#cb89-1208" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb89-1209"><a href="#cb89-1209" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, df[<span class="st">'tnm'</span>], marker<span class="op">=</span><span class="st">'D'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Temperature'</span>)</span>
<span id="cb89-1210"><a href="#cb89-1210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1211"><a href="#cb89-1211" aria-hidden="true" tabindex="-1"></a>        slope, intercept, r_value, p_value, std_err <span class="op">=</span> linregress(mdates.date2num(df.index), df[<span class="st">'tnm'</span>])</span>
<span id="cb89-1212"><a href="#cb89-1212" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, intercept <span class="op">+</span> slope <span class="op">*</span> mdates.date2num(df.index), linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Regression line'</span>)</span>
<span id="cb89-1213"><a href="#cb89-1213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1214"><a href="#cb89-1214" aria-hidden="true" tabindex="-1"></a>        plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb89-1215"><a href="#cb89-1215" aria-hidden="true" tabindex="-1"></a>        titulo <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>archivo<span class="sc">.</span>split(<span class="st">'_'</span>)[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> Station - Annual mean daily minimum temperature"</span></span>
<span id="cb89-1216"><a href="#cb89-1216" aria-hidden="true" tabindex="-1"></a>        <span class="co">#plt.title(titulo, fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb89-1217"><a href="#cb89-1217" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'Year'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1218"><a href="#cb89-1218" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Temperature (ºC)'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1219"><a href="#cb89-1219" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_locator(mdates.YearLocator(<span class="dv">5</span>))</span>
<span id="cb89-1220"><a href="#cb89-1220" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_formatter(mdates.DateFormatter(<span class="st">'%Y'</span>))</span>
<span id="cb89-1221"><a href="#cb89-1221" aria-hidden="true" tabindex="-1"></a>        plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, fontsize<span class="op">=</span><span class="dv">20</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1222"><a href="#cb89-1222" aria-hidden="true" tabindex="-1"></a>        plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1223"><a href="#cb89-1223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1224"><a href="#cb89-1224" aria-hidden="true" tabindex="-1"></a>        info_text <span class="op">=</span> (</span>
<span id="cb89-1225"><a href="#cb89-1225" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Slope: </span><span class="sc">{</span>slope<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb89-1226"><a href="#cb89-1226" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Confidence interval: [</span><span class="sc">{</span>intercept <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>intercept <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">]</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb89-1227"><a href="#cb89-1227" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"p-value: </span><span class="sc">{</span>p_value<span class="sc">:.3f}</span><span class="ss">"</span></span>
<span id="cb89-1228"><a href="#cb89-1228" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb89-1229"><a href="#cb89-1229" aria-hidden="true" tabindex="-1"></a>        plt.text(<span class="fl">1.1</span>, <span class="fl">0.65</span>, info_text, transform<span class="op">=</span>plt.gca().transAxes, fontsize<span class="op">=</span><span class="dv">14</span>, verticalalignment<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb89-1230"><a href="#cb89-1230" aria-hidden="true" tabindex="-1"></a>                 bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb89-1231"><a href="#cb89-1231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1232"><a href="#cb89-1232" aria-hidden="true" tabindex="-1"></a>        plt.grid(<span class="va">False</span>)</span>
<span id="cb89-1233"><a href="#cb89-1233" aria-hidden="true" tabindex="-1"></a>        plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.4</span>, <span class="fl">0.4</span>), fontsize<span class="op">=</span><span class="dv">14</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb89-1234"><a href="#cb89-1234" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb89-1235"><a href="#cb89-1235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1236"><a href="#cb89-1236" aria-hidden="true" tabindex="-1"></a>        estacion_codigo <span class="op">=</span> archivo.split(<span class="st">'_'</span>)[<span class="dv">0</span>]</span>
<span id="cb89-1237"><a href="#cb89-1237" aria-hidden="true" tabindex="-1"></a>        ruta_salida_estacion <span class="op">=</span> os.path.join(ruta_salida_base, estacion_codigo)</span>
<span id="cb89-1238"><a href="#cb89-1238" aria-hidden="true" tabindex="-1"></a>        os.makedirs(ruta_salida_estacion, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-1239"><a href="#cb89-1239" aria-hidden="true" tabindex="-1"></a>        ruta_salida <span class="op">=</span> os.path.join(ruta_salida_estacion, <span class="ss">f"</span><span class="sc">{</span>estacion_codigo<span class="sc">}</span><span class="ss">_tnm_ANN_plot.png"</span>)</span>
<span id="cb89-1240"><a href="#cb89-1240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1241"><a href="#cb89-1241" aria-hidden="true" tabindex="-1"></a>        plt.savefig(ruta_salida)</span>
<span id="cb89-1242"><a href="#cb89-1242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1243"><a href="#cb89-1243" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb89-1244"><a href="#cb89-1244" aria-hidden="true" tabindex="-1"></a>            plt.show()</span>
<span id="cb89-1245"><a href="#cb89-1245" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb89-1246"><a href="#cb89-1246" aria-hidden="true" tabindex="-1"></a>            plt.close()</span>
<span id="cb89-1247"><a href="#cb89-1247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1248"><a href="#cb89-1248" aria-hidden="true" tabindex="-1"></a>        contador <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb89-1249"><a href="#cb89-1249" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-1250"><a href="#cb89-1250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1251"><a href="#cb89-1251" aria-hidden="true" tabindex="-1"></a>5.3.2. Annual mean daily maximum temperature (txm).</span>
<span id="cb89-1252"><a href="#cb89-1252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1255"><a href="#cb89-1255" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-1256"><a href="#cb89-1256" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-polar-8</span></span>
<span id="cb89-1257"><a href="#cb89-1257" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Indicator of annual mean daily maximum temperature at station 9423001"</span></span>
<span id="cb89-1258"><a href="#cb89-1258" aria-hidden="true" tabindex="-1"></a>ruta_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/5.Climpact'</span></span>
<span id="cb89-1259"><a href="#cb89-1259" aria-hidden="true" tabindex="-1"></a>ruta_salida_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/6.Figuras_Climpact/Temperature'</span></span>
<span id="cb89-1260"><a href="#cb89-1260" aria-hidden="true" tabindex="-1"></a>os.makedirs(ruta_salida_base, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-1261"><a href="#cb89-1261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1262"><a href="#cb89-1262" aria-hidden="true" tabindex="-1"></a>subcarpetas <span class="op">=</span> [os.path.join(ruta_base, carpeta) <span class="cf">for</span> carpeta <span class="kw">in</span> os.listdir(ruta_base) <span class="cf">if</span> os.path.isdir(os.path.join(ruta_base, carpeta))]</span>
<span id="cb89-1263"><a href="#cb89-1263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1264"><a href="#cb89-1264" aria-hidden="true" tabindex="-1"></a>contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb89-1265"><a href="#cb89-1265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1266"><a href="#cb89-1266" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> subcarpeta <span class="kw">in</span> subcarpetas:</span>
<span id="cb89-1267"><a href="#cb89-1267" aria-hidden="true" tabindex="-1"></a>    carpeta_indices <span class="op">=</span> os.path.join(subcarpeta, <span class="st">'indices'</span>)</span>
<span id="cb89-1268"><a href="#cb89-1268" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(carpeta_indices):</span>
<span id="cb89-1269"><a href="#cb89-1269" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb89-1270"><a href="#cb89-1270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1271"><a href="#cb89-1271" aria-hidden="true" tabindex="-1"></a>    archivos <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(carpeta_indices) <span class="cf">if</span> f.endswith(<span class="st">'_txm_ANN.csv'</span>)]</span>
<span id="cb89-1272"><a href="#cb89-1272" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> archivo <span class="kw">in</span> archivos:</span>
<span id="cb89-1273"><a href="#cb89-1273" aria-hidden="true" tabindex="-1"></a>        ruta_archivo <span class="op">=</span> os.path.join(carpeta_indices, archivo)</span>
<span id="cb89-1274"><a href="#cb89-1274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1275"><a href="#cb89-1275" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_csv(ruta_archivo, skiprows<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb89-1276"><a href="#cb89-1276" aria-hidden="true" tabindex="-1"></a>        df.columns <span class="op">=</span> df.columns.<span class="bu">str</span>.strip()</span>
<span id="cb89-1277"><a href="#cb89-1277" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[[<span class="st">'time'</span>, <span class="st">'txm'</span>]]</span>
<span id="cb89-1278"><a href="#cb89-1278" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'time'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'time'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">'%Y'</span>)</span>
<span id="cb89-1279"><a href="#cb89-1279" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[df[<span class="st">'txm'</span>] <span class="op">!=</span> <span class="op">-</span><span class="fl">99.9</span>]</span>
<span id="cb89-1280"><a href="#cb89-1280" aria-hidden="true" tabindex="-1"></a>        df.set_index(<span class="st">'time'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-1281"><a href="#cb89-1281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1282"><a href="#cb89-1282" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb89-1283"><a href="#cb89-1283" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, df[<span class="st">'txm'</span>], marker<span class="op">=</span><span class="st">'D'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Temperature'</span>)</span>
<span id="cb89-1284"><a href="#cb89-1284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1285"><a href="#cb89-1285" aria-hidden="true" tabindex="-1"></a>        slope, intercept, r_value, p_value, std_err <span class="op">=</span> linregress(mdates.date2num(df.index), df[<span class="st">'txm'</span>])</span>
<span id="cb89-1286"><a href="#cb89-1286" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, intercept <span class="op">+</span> slope <span class="op">*</span> mdates.date2num(df.index), linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Regression line'</span>)</span>
<span id="cb89-1287"><a href="#cb89-1287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1288"><a href="#cb89-1288" aria-hidden="true" tabindex="-1"></a>        plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb89-1289"><a href="#cb89-1289" aria-hidden="true" tabindex="-1"></a>        titulo <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>archivo<span class="sc">.</span>split(<span class="st">'_'</span>)[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> Station - Annual mean daily maximum temperature"</span></span>
<span id="cb89-1290"><a href="#cb89-1290" aria-hidden="true" tabindex="-1"></a>        <span class="co">#plt.title(titulo, fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb89-1291"><a href="#cb89-1291" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'Year'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1292"><a href="#cb89-1292" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Temperature (ºC)'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1293"><a href="#cb89-1293" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_locator(mdates.YearLocator(<span class="dv">5</span>))</span>
<span id="cb89-1294"><a href="#cb89-1294" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_formatter(mdates.DateFormatter(<span class="st">'%Y'</span>))</span>
<span id="cb89-1295"><a href="#cb89-1295" aria-hidden="true" tabindex="-1"></a>        plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, fontsize<span class="op">=</span><span class="dv">20</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1296"><a href="#cb89-1296" aria-hidden="true" tabindex="-1"></a>        plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1297"><a href="#cb89-1297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1298"><a href="#cb89-1298" aria-hidden="true" tabindex="-1"></a>        info_text <span class="op">=</span> (</span>
<span id="cb89-1299"><a href="#cb89-1299" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Slope: </span><span class="sc">{</span>slope<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb89-1300"><a href="#cb89-1300" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Confidence interval: [</span><span class="sc">{</span>intercept <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>intercept <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">]</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb89-1301"><a href="#cb89-1301" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"p-value: </span><span class="sc">{</span>p_value<span class="sc">:.3f}</span><span class="ss">"</span></span>
<span id="cb89-1302"><a href="#cb89-1302" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb89-1303"><a href="#cb89-1303" aria-hidden="true" tabindex="-1"></a>        plt.text(<span class="fl">1.1</span>, <span class="fl">0.65</span>, info_text, transform<span class="op">=</span>plt.gca().transAxes, fontsize<span class="op">=</span><span class="dv">14</span>, verticalalignment<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb89-1304"><a href="#cb89-1304" aria-hidden="true" tabindex="-1"></a>                 bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb89-1305"><a href="#cb89-1305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1306"><a href="#cb89-1306" aria-hidden="true" tabindex="-1"></a>        plt.grid(<span class="va">False</span>)</span>
<span id="cb89-1307"><a href="#cb89-1307" aria-hidden="true" tabindex="-1"></a>        plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.4</span>, <span class="fl">0.4</span>), fontsize<span class="op">=</span><span class="dv">14</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb89-1308"><a href="#cb89-1308" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb89-1309"><a href="#cb89-1309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1310"><a href="#cb89-1310" aria-hidden="true" tabindex="-1"></a>        estacion_codigo <span class="op">=</span> archivo.split(<span class="st">'_'</span>)[<span class="dv">0</span>]</span>
<span id="cb89-1311"><a href="#cb89-1311" aria-hidden="true" tabindex="-1"></a>        ruta_salida_estacion <span class="op">=</span> os.path.join(ruta_salida_base, estacion_codigo)</span>
<span id="cb89-1312"><a href="#cb89-1312" aria-hidden="true" tabindex="-1"></a>        os.makedirs(ruta_salida_estacion, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-1313"><a href="#cb89-1313" aria-hidden="true" tabindex="-1"></a>        ruta_salida <span class="op">=</span> os.path.join(ruta_salida_estacion, <span class="ss">f"</span><span class="sc">{</span>estacion_codigo<span class="sc">}</span><span class="ss">_txm_ANN_plot.png"</span>)</span>
<span id="cb89-1314"><a href="#cb89-1314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1315"><a href="#cb89-1315" aria-hidden="true" tabindex="-1"></a>        plt.savefig(ruta_salida)</span>
<span id="cb89-1316"><a href="#cb89-1316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1317"><a href="#cb89-1317" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb89-1318"><a href="#cb89-1318" aria-hidden="true" tabindex="-1"></a>            plt.show()</span>
<span id="cb89-1319"><a href="#cb89-1319" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb89-1320"><a href="#cb89-1320" aria-hidden="true" tabindex="-1"></a>            plt.close()</span>
<span id="cb89-1321"><a href="#cb89-1321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1322"><a href="#cb89-1322" aria-hidden="true" tabindex="-1"></a>        contador <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb89-1323"><a href="#cb89-1323" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-1324"><a href="#cb89-1324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1325"><a href="#cb89-1325" aria-hidden="true" tabindex="-1"></a>5.3.3. Annual warmest daily maximum temperature (txx).</span>
<span id="cb89-1326"><a href="#cb89-1326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1329"><a href="#cb89-1329" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-1330"><a href="#cb89-1330" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-polar-9</span></span>
<span id="cb89-1331"><a href="#cb89-1331" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Indicator of annual warmest daily maximum temperature at station 9423001"</span></span>
<span id="cb89-1332"><a href="#cb89-1332" aria-hidden="true" tabindex="-1"></a>ruta_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/5.Climpact'</span></span>
<span id="cb89-1333"><a href="#cb89-1333" aria-hidden="true" tabindex="-1"></a>ruta_salida_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/6.Figuras_Climpact/Temperature'</span></span>
<span id="cb89-1334"><a href="#cb89-1334" aria-hidden="true" tabindex="-1"></a>os.makedirs(ruta_salida_base, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-1335"><a href="#cb89-1335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1336"><a href="#cb89-1336" aria-hidden="true" tabindex="-1"></a>subcarpetas <span class="op">=</span> [os.path.join(ruta_base, carpeta) <span class="cf">for</span> carpeta <span class="kw">in</span> os.listdir(ruta_base) <span class="cf">if</span> os.path.isdir(os.path.join(ruta_base, carpeta))]</span>
<span id="cb89-1337"><a href="#cb89-1337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1338"><a href="#cb89-1338" aria-hidden="true" tabindex="-1"></a>contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb89-1339"><a href="#cb89-1339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1340"><a href="#cb89-1340" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> subcarpeta <span class="kw">in</span> subcarpetas:</span>
<span id="cb89-1341"><a href="#cb89-1341" aria-hidden="true" tabindex="-1"></a>    carpeta_indices <span class="op">=</span> os.path.join(subcarpeta, <span class="st">'indices'</span>)</span>
<span id="cb89-1342"><a href="#cb89-1342" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(carpeta_indices):</span>
<span id="cb89-1343"><a href="#cb89-1343" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb89-1344"><a href="#cb89-1344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1345"><a href="#cb89-1345" aria-hidden="true" tabindex="-1"></a>    archivos <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(carpeta_indices) <span class="cf">if</span> f.endswith(<span class="st">'_txx_ANN.csv'</span>)]</span>
<span id="cb89-1346"><a href="#cb89-1346" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> archivo <span class="kw">in</span> archivos:</span>
<span id="cb89-1347"><a href="#cb89-1347" aria-hidden="true" tabindex="-1"></a>        ruta_archivo <span class="op">=</span> os.path.join(carpeta_indices, archivo)</span>
<span id="cb89-1348"><a href="#cb89-1348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1349"><a href="#cb89-1349" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_csv(ruta_archivo, skiprows<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb89-1350"><a href="#cb89-1350" aria-hidden="true" tabindex="-1"></a>        df.columns <span class="op">=</span> df.columns.<span class="bu">str</span>.strip()</span>
<span id="cb89-1351"><a href="#cb89-1351" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[[<span class="st">'time'</span>, <span class="st">'txx'</span>]]</span>
<span id="cb89-1352"><a href="#cb89-1352" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'time'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'time'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">'%Y'</span>)</span>
<span id="cb89-1353"><a href="#cb89-1353" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[df[<span class="st">'txx'</span>] <span class="op">!=</span> <span class="op">-</span><span class="fl">99.9</span>]</span>
<span id="cb89-1354"><a href="#cb89-1354" aria-hidden="true" tabindex="-1"></a>        df.set_index(<span class="st">'time'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-1355"><a href="#cb89-1355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1356"><a href="#cb89-1356" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb89-1357"><a href="#cb89-1357" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, df[<span class="st">'txx'</span>], marker<span class="op">=</span><span class="st">'D'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Temperature'</span>)</span>
<span id="cb89-1358"><a href="#cb89-1358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1359"><a href="#cb89-1359" aria-hidden="true" tabindex="-1"></a>        slope, intercept, r_value, p_value, std_err <span class="op">=</span> linregress(mdates.date2num(df.index), df[<span class="st">'txx'</span>])</span>
<span id="cb89-1360"><a href="#cb89-1360" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, intercept <span class="op">+</span> slope <span class="op">*</span> mdates.date2num(df.index), linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Regression line'</span>)</span>
<span id="cb89-1361"><a href="#cb89-1361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1362"><a href="#cb89-1362" aria-hidden="true" tabindex="-1"></a>        plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb89-1363"><a href="#cb89-1363" aria-hidden="true" tabindex="-1"></a>        titulo <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>archivo<span class="sc">.</span>split(<span class="st">'_'</span>)[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> Station - Annual warmest daily maximum temperature"</span></span>
<span id="cb89-1364"><a href="#cb89-1364" aria-hidden="true" tabindex="-1"></a>        <span class="co">#plt.title(titulo, fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb89-1365"><a href="#cb89-1365" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'Year'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1366"><a href="#cb89-1366" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Temperature (ºC)'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1367"><a href="#cb89-1367" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_locator(mdates.YearLocator(<span class="dv">5</span>))</span>
<span id="cb89-1368"><a href="#cb89-1368" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_formatter(mdates.DateFormatter(<span class="st">'%Y'</span>))</span>
<span id="cb89-1369"><a href="#cb89-1369" aria-hidden="true" tabindex="-1"></a>        plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, fontsize<span class="op">=</span><span class="dv">20</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1370"><a href="#cb89-1370" aria-hidden="true" tabindex="-1"></a>        plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1371"><a href="#cb89-1371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1372"><a href="#cb89-1372" aria-hidden="true" tabindex="-1"></a>        info_text <span class="op">=</span> (</span>
<span id="cb89-1373"><a href="#cb89-1373" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Slope: </span><span class="sc">{</span>slope<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb89-1374"><a href="#cb89-1374" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Confidence interval: [</span><span class="sc">{</span>intercept <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>intercept <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">]</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb89-1375"><a href="#cb89-1375" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"p-value: </span><span class="sc">{</span>p_value<span class="sc">:.3f}</span><span class="ss">"</span></span>
<span id="cb89-1376"><a href="#cb89-1376" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb89-1377"><a href="#cb89-1377" aria-hidden="true" tabindex="-1"></a>        plt.text(<span class="fl">1.1</span>, <span class="fl">0.65</span>, info_text, transform<span class="op">=</span>plt.gca().transAxes, fontsize<span class="op">=</span><span class="dv">14</span>, verticalalignment<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb89-1378"><a href="#cb89-1378" aria-hidden="true" tabindex="-1"></a>                 bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb89-1379"><a href="#cb89-1379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1380"><a href="#cb89-1380" aria-hidden="true" tabindex="-1"></a>        plt.grid(<span class="va">False</span>)</span>
<span id="cb89-1381"><a href="#cb89-1381" aria-hidden="true" tabindex="-1"></a>        plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.4</span>, <span class="fl">0.4</span>), fontsize<span class="op">=</span><span class="dv">14</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb89-1382"><a href="#cb89-1382" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb89-1383"><a href="#cb89-1383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1384"><a href="#cb89-1384" aria-hidden="true" tabindex="-1"></a>        estacion_codigo <span class="op">=</span> archivo.split(<span class="st">'_'</span>)[<span class="dv">0</span>]</span>
<span id="cb89-1385"><a href="#cb89-1385" aria-hidden="true" tabindex="-1"></a>        ruta_salida_estacion <span class="op">=</span> os.path.join(ruta_salida_base, estacion_codigo)</span>
<span id="cb89-1386"><a href="#cb89-1386" aria-hidden="true" tabindex="-1"></a>        os.makedirs(ruta_salida_estacion, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-1387"><a href="#cb89-1387" aria-hidden="true" tabindex="-1"></a>        ruta_salida <span class="op">=</span> os.path.join(ruta_salida_estacion, <span class="ss">f"</span><span class="sc">{</span>estacion_codigo<span class="sc">}</span><span class="ss">_txx_ANN_plot.png"</span>)</span>
<span id="cb89-1388"><a href="#cb89-1388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1389"><a href="#cb89-1389" aria-hidden="true" tabindex="-1"></a>        plt.savefig(ruta_salida)</span>
<span id="cb89-1390"><a href="#cb89-1390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1391"><a href="#cb89-1391" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb89-1392"><a href="#cb89-1392" aria-hidden="true" tabindex="-1"></a>            plt.show()</span>
<span id="cb89-1393"><a href="#cb89-1393" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb89-1394"><a href="#cb89-1394" aria-hidden="true" tabindex="-1"></a>            plt.close()</span>
<span id="cb89-1395"><a href="#cb89-1395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1396"><a href="#cb89-1396" aria-hidden="true" tabindex="-1"></a>        contador <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb89-1397"><a href="#cb89-1397" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-1398"><a href="#cb89-1398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1399"><a href="#cb89-1399" aria-hidden="true" tabindex="-1"></a>5.3.4. Annual number of days when minimum temperature <span class="sc">\&lt;</span> 0ºC (id).</span>
<span id="cb89-1400"><a href="#cb89-1400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1403"><a href="#cb89-1403" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-1404"><a href="#cb89-1404" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-polar-10</span></span>
<span id="cb89-1405"><a href="#cb89-1405" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Indicator of annual numbery of days when minimum temperature is lower than 0ºC at station 9423001"</span></span>
<span id="cb89-1406"><a href="#cb89-1406" aria-hidden="true" tabindex="-1"></a>ruta_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/5.Climpact'</span></span>
<span id="cb89-1407"><a href="#cb89-1407" aria-hidden="true" tabindex="-1"></a>ruta_salida_base <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/6.Figuras_Climpact/Temperature'</span></span>
<span id="cb89-1408"><a href="#cb89-1408" aria-hidden="true" tabindex="-1"></a>os.makedirs(ruta_salida_base, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-1409"><a href="#cb89-1409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1410"><a href="#cb89-1410" aria-hidden="true" tabindex="-1"></a>subcarpetas <span class="op">=</span> [os.path.join(ruta_base, carpeta) <span class="cf">for</span> carpeta <span class="kw">in</span> os.listdir(ruta_base) <span class="cf">if</span> os.path.isdir(os.path.join(ruta_base, carpeta))]</span>
<span id="cb89-1411"><a href="#cb89-1411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1412"><a href="#cb89-1412" aria-hidden="true" tabindex="-1"></a>contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb89-1413"><a href="#cb89-1413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1414"><a href="#cb89-1414" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> subcarpeta <span class="kw">in</span> subcarpetas:</span>
<span id="cb89-1415"><a href="#cb89-1415" aria-hidden="true" tabindex="-1"></a>    carpeta_indices <span class="op">=</span> os.path.join(subcarpeta, <span class="st">'indices'</span>)</span>
<span id="cb89-1416"><a href="#cb89-1416" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(carpeta_indices):</span>
<span id="cb89-1417"><a href="#cb89-1417" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb89-1418"><a href="#cb89-1418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1419"><a href="#cb89-1419" aria-hidden="true" tabindex="-1"></a>    archivos <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(carpeta_indices) <span class="cf">if</span> f.endswith(<span class="st">'_fd_ANN.csv'</span>)]</span>
<span id="cb89-1420"><a href="#cb89-1420" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> archivo <span class="kw">in</span> archivos:</span>
<span id="cb89-1421"><a href="#cb89-1421" aria-hidden="true" tabindex="-1"></a>        ruta_archivo <span class="op">=</span> os.path.join(carpeta_indices, archivo)</span>
<span id="cb89-1422"><a href="#cb89-1422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1423"><a href="#cb89-1423" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_csv(ruta_archivo, skiprows<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb89-1424"><a href="#cb89-1424" aria-hidden="true" tabindex="-1"></a>        df.columns <span class="op">=</span> df.columns.<span class="bu">str</span>.strip()</span>
<span id="cb89-1425"><a href="#cb89-1425" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[[<span class="st">'time'</span>, <span class="st">'fd'</span>]]</span>
<span id="cb89-1426"><a href="#cb89-1426" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'time'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'time'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">'%Y'</span>)</span>
<span id="cb89-1427"><a href="#cb89-1427" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[df[<span class="st">'fd'</span>] <span class="op">!=</span> <span class="op">-</span><span class="fl">99.9</span>]</span>
<span id="cb89-1428"><a href="#cb89-1428" aria-hidden="true" tabindex="-1"></a>        df.set_index(<span class="st">'time'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-1429"><a href="#cb89-1429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1430"><a href="#cb89-1430" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb89-1431"><a href="#cb89-1431" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, df[<span class="st">'fd'</span>], marker<span class="op">=</span><span class="st">'D'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Days T&lt;0ºC'</span>)</span>
<span id="cb89-1432"><a href="#cb89-1432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1433"><a href="#cb89-1433" aria-hidden="true" tabindex="-1"></a>        slope, intercept, r_value, p_value, std_err <span class="op">=</span> linregress(mdates.date2num(df.index), df[<span class="st">'fd'</span>])</span>
<span id="cb89-1434"><a href="#cb89-1434" aria-hidden="true" tabindex="-1"></a>        plt.plot(df.index, intercept <span class="op">+</span> slope <span class="op">*</span> mdates.date2num(df.index), linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Regression line'</span>)</span>
<span id="cb89-1435"><a href="#cb89-1435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1436"><a href="#cb89-1436" aria-hidden="true" tabindex="-1"></a>        plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb89-1437"><a href="#cb89-1437" aria-hidden="true" tabindex="-1"></a>        titulo <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>archivo<span class="sc">.</span>split(<span class="st">'_'</span>)[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> Station - Days when minimum temperature &lt; 0ºC"</span></span>
<span id="cb89-1438"><a href="#cb89-1438" aria-hidden="true" tabindex="-1"></a>        <span class="co">#plt.title(titulo, fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb89-1439"><a href="#cb89-1439" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'Year'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1440"><a href="#cb89-1440" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Days'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1441"><a href="#cb89-1441" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_locator(mdates.YearLocator(<span class="dv">5</span>))</span>
<span id="cb89-1442"><a href="#cb89-1442" aria-hidden="true" tabindex="-1"></a>        plt.gca().xaxis.set_major_formatter(mdates.DateFormatter(<span class="st">'%Y'</span>))</span>
<span id="cb89-1443"><a href="#cb89-1443" aria-hidden="true" tabindex="-1"></a>        plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, fontsize<span class="op">=</span><span class="dv">20</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1444"><a href="#cb89-1444" aria-hidden="true" tabindex="-1"></a>        plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1445"><a href="#cb89-1445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1446"><a href="#cb89-1446" aria-hidden="true" tabindex="-1"></a>        info_text <span class="op">=</span> (</span>
<span id="cb89-1447"><a href="#cb89-1447" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Slope: </span><span class="sc">{</span>slope<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb89-1448"><a href="#cb89-1448" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"Confidence interval: [</span><span class="sc">{</span>intercept <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span>intercept <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> std_err<span class="sc">:.2f}</span><span class="ss">]</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb89-1449"><a href="#cb89-1449" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f"p-value: </span><span class="sc">{</span>p_value<span class="sc">:.3f}</span><span class="ss">"</span></span>
<span id="cb89-1450"><a href="#cb89-1450" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb89-1451"><a href="#cb89-1451" aria-hidden="true" tabindex="-1"></a>        plt.text(<span class="fl">1.1</span>, <span class="fl">0.65</span>, info_text, transform<span class="op">=</span>plt.gca().transAxes, fontsize<span class="op">=</span><span class="dv">14</span>, verticalalignment<span class="op">=</span><span class="st">'top'</span>,</span>
<span id="cb89-1452"><a href="#cb89-1452" aria-hidden="true" tabindex="-1"></a>                 bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>))</span>
<span id="cb89-1453"><a href="#cb89-1453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1454"><a href="#cb89-1454" aria-hidden="true" tabindex="-1"></a>        plt.grid(<span class="va">False</span>)</span>
<span id="cb89-1455"><a href="#cb89-1455" aria-hidden="true" tabindex="-1"></a>        plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.4</span>, <span class="fl">0.4</span>), fontsize<span class="op">=</span><span class="dv">14</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb89-1456"><a href="#cb89-1456" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span>
<span id="cb89-1457"><a href="#cb89-1457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1458"><a href="#cb89-1458" aria-hidden="true" tabindex="-1"></a>        estacion_codigo <span class="op">=</span> archivo.split(<span class="st">'_'</span>)[<span class="dv">0</span>]</span>
<span id="cb89-1459"><a href="#cb89-1459" aria-hidden="true" tabindex="-1"></a>        ruta_salida_estacion <span class="op">=</span> os.path.join(ruta_salida_base, estacion_codigo)</span>
<span id="cb89-1460"><a href="#cb89-1460" aria-hidden="true" tabindex="-1"></a>        os.makedirs(ruta_salida_estacion, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-1461"><a href="#cb89-1461" aria-hidden="true" tabindex="-1"></a>        ruta_salida <span class="op">=</span> os.path.join(ruta_salida_estacion, <span class="ss">f"</span><span class="sc">{</span>estacion_codigo<span class="sc">}</span><span class="ss">_fd_ANN_plot.png"</span>)</span>
<span id="cb89-1462"><a href="#cb89-1462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1463"><a href="#cb89-1463" aria-hidden="true" tabindex="-1"></a>        plt.savefig(ruta_salida)</span>
<span id="cb89-1464"><a href="#cb89-1464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1465"><a href="#cb89-1465" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb89-1466"><a href="#cb89-1466" aria-hidden="true" tabindex="-1"></a>            plt.show()</span>
<span id="cb89-1467"><a href="#cb89-1467" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb89-1468"><a href="#cb89-1468" aria-hidden="true" tabindex="-1"></a>            plt.close()</span>
<span id="cb89-1469"><a href="#cb89-1469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1470"><a href="#cb89-1470" aria-hidden="true" tabindex="-1"></a>        contador <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb89-1471"><a href="#cb89-1471" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-1472"><a href="#cb89-1472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1473"><a href="#cb89-1473" aria-hidden="true" tabindex="-1"></a><span class="fu">## Generation of figures for hydrologic indicators script</span></span>
<span id="cb89-1474"><a href="#cb89-1474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1475"><a href="#cb89-1475" aria-hidden="true" tabindex="-1"></a><span class="fu">### Libraries and workspace.</span></span>
<span id="cb89-1476"><a href="#cb89-1476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1479"><a href="#cb89-1479" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-1480"><a href="#cb89-1480" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb89-1481"><a href="#cb89-1481" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb89-1482"><a href="#cb89-1482" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb89-1483"><a href="#cb89-1483" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb89-1484"><a href="#cb89-1484" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> csv</span>
<span id="cb89-1485"><a href="#cb89-1485" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb89-1486"><a href="#cb89-1486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1487"><a href="#cb89-1487" aria-hidden="true" tabindex="-1"></a>input_directory <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/9.IHA'</span></span>
<span id="cb89-1488"><a href="#cb89-1488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1489"><a href="#cb89-1489" aria-hidden="true" tabindex="-1"></a>sheets_to_convert <span class="op">=</span> [<span class="st">'ann'</span>, <span class="st">'sco'</span>, <span class="st">'lsq'</span>, <span class="st">'pct'</span>, <span class="st">'daily efcs'</span>, <span class="st">'fdc'</span>]</span>
<span id="cb89-1490"><a href="#cb89-1490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1491"><a href="#cb89-1491" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> filename <span class="kw">in</span> os.listdir(input_directory):</span>
<span id="cb89-1492"><a href="#cb89-1492" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> filename.endswith(<span class="st">'.xlsx'</span>) <span class="kw">or</span> filename.endswith(<span class="st">'.xls'</span>):</span>
<span id="cb89-1493"><a href="#cb89-1493" aria-hidden="true" tabindex="-1"></a>        filepath <span class="op">=</span> os.path.join(input_directory, filename)</span>
<span id="cb89-1494"><a href="#cb89-1494" aria-hidden="true" tabindex="-1"></a>        excel_file <span class="op">=</span> pd.ExcelFile(filepath)</span>
<span id="cb89-1495"><a href="#cb89-1495" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-1496"><a href="#cb89-1496" aria-hidden="true" tabindex="-1"></a>        station_code <span class="op">=</span> os.path.splitext(filename)[<span class="dv">0</span>]</span>
<span id="cb89-1497"><a href="#cb89-1497" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-1498"><a href="#cb89-1498" aria-hidden="true" tabindex="-1"></a>        station_output_directory <span class="op">=</span> os.path.join(input_directory, <span class="st">'csv'</span>, station_code)</span>
<span id="cb89-1499"><a href="#cb89-1499" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-1500"><a href="#cb89-1500" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> os.path.exists(station_output_directory):</span>
<span id="cb89-1501"><a href="#cb89-1501" aria-hidden="true" tabindex="-1"></a>            os.makedirs(station_output_directory)</span>
<span id="cb89-1502"><a href="#cb89-1502" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-1503"><a href="#cb89-1503" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> sheet <span class="kw">in</span> sheets_to_convert:</span>
<span id="cb89-1504"><a href="#cb89-1504" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> sheet <span class="kw">in</span> excel_file.sheet_names:</span>
<span id="cb89-1505"><a href="#cb89-1505" aria-hidden="true" tabindex="-1"></a>                df <span class="op">=</span> pd.read_excel(filepath, sheet_name<span class="op">=</span>sheet)</span>
<span id="cb89-1506"><a href="#cb89-1506" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb89-1507"><a href="#cb89-1507" aria-hidden="true" tabindex="-1"></a>                output_filename <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>sheet<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv"</span></span>
<span id="cb89-1508"><a href="#cb89-1508" aria-hidden="true" tabindex="-1"></a>                output_filepath <span class="op">=</span> os.path.join(station_output_directory, output_filename)</span>
<span id="cb89-1509"><a href="#cb89-1509" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb89-1510"><a href="#cb89-1510" aria-hidden="true" tabindex="-1"></a>                df.to_csv(output_filepath, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb89-1511"><a href="#cb89-1511" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb89-1512"><a href="#cb89-1512" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"ann, sco, fdc, pct, lsq and daily efcs files saved in its folder."</span>)</span>
<span id="cb89-1513"><a href="#cb89-1513" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-1514"><a href="#cb89-1514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1515"><a href="#cb89-1515" aria-hidden="true" tabindex="-1"></a><span class="fu">### Streamflow figures</span></span>
<span id="cb89-1516"><a href="#cb89-1516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1517"><a href="#cb89-1517" aria-hidden="true" tabindex="-1"></a>6.2.1. Simple monthly median flow for each station</span>
<span id="cb89-1518"><a href="#cb89-1518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1519"><a href="#cb89-1519" aria-hidden="true" tabindex="-1"></a>The order of the months in the <span class="in">`sco_`</span> file may vary. If so, adjust the <span class="in">`meses_ingles`</span> variable accordingly.</span>
<span id="cb89-1520"><a href="#cb89-1520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1523"><a href="#cb89-1523" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-1524"><a href="#cb89-1524" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-polar-11</span></span>
<span id="cb89-1525"><a href="#cb89-1525" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Indicator of simple monthly median flow at station 9423001"</span></span>
<span id="cb89-1526"><a href="#cb89-1526" aria-hidden="true" tabindex="-1"></a>base_path <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/9.IHA/csv'</span></span>
<span id="cb89-1527"><a href="#cb89-1527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1528"><a href="#cb89-1528" aria-hidden="true" tabindex="-1"></a>output_root_directory <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/10.Figuras_IHA/Caudal'</span></span>
<span id="cb89-1529"><a href="#cb89-1529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1530"><a href="#cb89-1530" aria-hidden="true" tabindex="-1"></a>meses_ingles <span class="op">=</span> [<span class="st">'January'</span>, <span class="st">'February'</span>, <span class="st">'March'</span>, <span class="st">'April'</span>, <span class="st">'May'</span>, <span class="st">'June'</span>, <span class="st">'July'</span>, <span class="st">'August'</span>, <span class="st">'September'</span>, <span class="st">'October'</span>, <span class="st">'November'</span>, <span class="st">'December'</span>]</span>
<span id="cb89-1531"><a href="#cb89-1531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1532"><a href="#cb89-1532" aria-hidden="true" tabindex="-1"></a>contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb89-1533"><a href="#cb89-1533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1534"><a href="#cb89-1534" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> root, dirs, files <span class="kw">in</span> os.walk(base_path):</span>
<span id="cb89-1535"><a href="#cb89-1535" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files:</span>
<span id="cb89-1536"><a href="#cb89-1536" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">file</span>.startswith(<span class="st">"sco_"</span>) <span class="kw">and</span> <span class="bu">file</span>.endswith(<span class="st">".csv"</span>):</span>
<span id="cb89-1537"><a href="#cb89-1537" aria-hidden="true" tabindex="-1"></a>            sco_file <span class="op">=</span> os.path.join(root, <span class="bu">file</span>)</span>
<span id="cb89-1538"><a href="#cb89-1538" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb89-1539"><a href="#cb89-1539" aria-hidden="true" tabindex="-1"></a>            df <span class="op">=</span> pd.read_csv(sco_file, skiprows<span class="op">=</span><span class="dv">17</span>, header<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb89-1540"><a href="#cb89-1540" aria-hidden="true" tabindex="-1"></a>            df_mes <span class="op">=</span> df.iloc[:<span class="dv">12</span>, :<span class="dv">2</span>]</span>
<span id="cb89-1541"><a href="#cb89-1541" aria-hidden="true" tabindex="-1"></a>            df_mes.columns <span class="op">=</span> [<span class="st">'Month'</span>, <span class="st">'Median'</span>]</span>
<span id="cb89-1542"><a href="#cb89-1542" aria-hidden="true" tabindex="-1"></a>            df_mes[<span class="st">'Month'</span>] <span class="op">=</span> meses_ingles</span>
<span id="cb89-1543"><a href="#cb89-1543" aria-hidden="true" tabindex="-1"></a>            df_mes.set_index(<span class="st">'Month'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-1544"><a href="#cb89-1544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1545"><a href="#cb89-1545" aria-hidden="true" tabindex="-1"></a>            station_code <span class="op">=</span> <span class="bu">file</span>.split(<span class="st">'_'</span>)[<span class="dv">1</span>].split(<span class="st">'.'</span>)[<span class="dv">0</span>]</span>
<span id="cb89-1546"><a href="#cb89-1546" aria-hidden="true" tabindex="-1"></a>            output_dir <span class="op">=</span> os.path.join(output_root_directory, station_code)</span>
<span id="cb89-1547"><a href="#cb89-1547" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> os.path.exists(output_dir):</span>
<span id="cb89-1548"><a href="#cb89-1548" aria-hidden="true" tabindex="-1"></a>                os.makedirs(output_dir)</span>
<span id="cb89-1549"><a href="#cb89-1549" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb89-1550"><a href="#cb89-1550" aria-hidden="true" tabindex="-1"></a>            plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb89-1551"><a href="#cb89-1551" aria-hidden="true" tabindex="-1"></a>            plt.plot(df_mes.index, df_mes[<span class="st">'Median'</span>], marker<span class="op">=</span><span class="st">'.'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Median'</span>)</span>
<span id="cb89-1552"><a href="#cb89-1552" aria-hidden="true" tabindex="-1"></a>            plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb89-1553"><a href="#cb89-1553" aria-hidden="true" tabindex="-1"></a>            <span class="co">#plt.title(f'Median monthly flow - {station_code} Station', fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb89-1554"><a href="#cb89-1554" aria-hidden="true" tabindex="-1"></a>            plt.xlabel(<span class="st">'Month'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1555"><a href="#cb89-1555" aria-hidden="true" tabindex="-1"></a>            plt.ylabel(<span class="st">'Flow (m3/s)'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1556"><a href="#cb89-1556" aria-hidden="true" tabindex="-1"></a>            plt.xticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb89-1557"><a href="#cb89-1557" aria-hidden="true" tabindex="-1"></a>            plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1558"><a href="#cb89-1558" aria-hidden="true" tabindex="-1"></a>            plt.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, color<span class="op">=</span><span class="st">'lightgray'</span>)</span>
<span id="cb89-1559"><a href="#cb89-1559" aria-hidden="true" tabindex="-1"></a>            plt.legend(fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb89-1560"><a href="#cb89-1560" aria-hidden="true" tabindex="-1"></a>            plt.grid(<span class="va">False</span>)</span>
<span id="cb89-1561"><a href="#cb89-1561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1562"><a href="#cb89-1562" aria-hidden="true" tabindex="-1"></a>            output_file <span class="op">=</span> os.path.join(output_dir, <span class="ss">f'Median_monthly_flow_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.png'</span>)</span>
<span id="cb89-1563"><a href="#cb89-1563" aria-hidden="true" tabindex="-1"></a>            plt.tight_layout()</span>
<span id="cb89-1564"><a href="#cb89-1564" aria-hidden="true" tabindex="-1"></a>            plt.savefig(output_file, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb89-1565"><a href="#cb89-1565" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb89-1566"><a href="#cb89-1566" aria-hidden="true" tabindex="-1"></a>            plt.savefig(ruta_salida)</span>
<span id="cb89-1567"><a href="#cb89-1567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1568"><a href="#cb89-1568" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb89-1569"><a href="#cb89-1569" aria-hidden="true" tabindex="-1"></a>                plt.show()</span>
<span id="cb89-1570"><a href="#cb89-1570" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb89-1571"><a href="#cb89-1571" aria-hidden="true" tabindex="-1"></a>                plt.close()</span>
<span id="cb89-1572"><a href="#cb89-1572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1573"><a href="#cb89-1573" aria-hidden="true" tabindex="-1"></a>            contador <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb89-1574"><a href="#cb89-1574" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Figure saved: </span><span class="sc">{</span>output_file<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb89-1575"><a href="#cb89-1575" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-1576"><a href="#cb89-1576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1577"><a href="#cb89-1577" aria-hidden="true" tabindex="-1"></a>6.2.2. Boxplot flow for each month calculated from all recorded years for each station</span>
<span id="cb89-1578"><a href="#cb89-1578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1579"><a href="#cb89-1579" aria-hidden="true" tabindex="-1"></a>The language of the months or even the way they are written in the <span class="in">`ann_`</span> file may vary. If so, adjust the <span class="in">`columns`</span> variable and <span class="in">`id_vars`</span> accordingly.</span>
<span id="cb89-1580"><a href="#cb89-1580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1583"><a href="#cb89-1583" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-1584"><a href="#cb89-1584" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-polar-12</span></span>
<span id="cb89-1585"><a href="#cb89-1585" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Boxplot of flow at station 9423001"</span></span>
<span id="cb89-1586"><a href="#cb89-1586" aria-hidden="true" tabindex="-1"></a>base_directory <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/9.IHA/csv'</span></span>
<span id="cb89-1587"><a href="#cb89-1587" aria-hidden="true" tabindex="-1"></a>output_root_directory <span class="op">=</span> os.path.join(<span class="st">'Hidroclima/Base de datos/10.Figuras_IHA'</span>, <span class="st">'Caudal'</span>)</span>
<span id="cb89-1588"><a href="#cb89-1588" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(output_root_directory):</span>
<span id="cb89-1589"><a href="#cb89-1589" aria-hidden="true" tabindex="-1"></a>    os.makedirs(output_root_directory)</span>
<span id="cb89-1590"><a href="#cb89-1590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1591"><a href="#cb89-1591" aria-hidden="true" tabindex="-1"></a>contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb89-1592"><a href="#cb89-1592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1593"><a href="#cb89-1593" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> station_folder <span class="kw">in</span> os.listdir(base_directory):</span>
<span id="cb89-1594"><a href="#cb89-1594" aria-hidden="true" tabindex="-1"></a>    station_path <span class="op">=</span> os.path.join(base_directory, station_folder)</span>
<span id="cb89-1595"><a href="#cb89-1595" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> os.path.isdir(station_path):</span>
<span id="cb89-1596"><a href="#cb89-1596" aria-hidden="true" tabindex="-1"></a>        station_output_directory <span class="op">=</span> os.path.join(output_root_directory, station_folder)</span>
<span id="cb89-1597"><a href="#cb89-1597" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> os.path.exists(station_output_directory):</span>
<span id="cb89-1598"><a href="#cb89-1598" aria-hidden="true" tabindex="-1"></a>            os.makedirs(station_output_directory)</span>
<span id="cb89-1599"><a href="#cb89-1599" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-1600"><a href="#cb89-1600" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> filename <span class="kw">in</span> os.listdir(station_path):</span>
<span id="cb89-1601"><a href="#cb89-1601" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> filename.startswith(<span class="st">'ann_'</span>) <span class="kw">and</span> filename.endswith(<span class="st">'.csv'</span>):</span>
<span id="cb89-1602"><a href="#cb89-1602" aria-hidden="true" tabindex="-1"></a>                input_file <span class="op">=</span> os.path.join(station_path, filename)</span>
<span id="cb89-1603"><a href="#cb89-1603" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb89-1604"><a href="#cb89-1604" aria-hidden="true" tabindex="-1"></a>                df <span class="op">=</span> pd.read_csv(input_file, skiprows<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb89-1605"><a href="#cb89-1605" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb89-1606"><a href="#cb89-1606" aria-hidden="true" tabindex="-1"></a>                columns <span class="op">=</span> [<span class="st">'Year'</span>, <span class="st">'January'</span>, <span class="st">'February'</span>, <span class="st">'March'</span>, <span class="st">'April'</span>, <span class="st">'May'</span>, <span class="st">'June'</span>, <span class="st">'July'</span>, <span class="st">'August'</span>, <span class="st">'September'</span>, <span class="st">'October'</span>, <span class="st">'November'</span>, <span class="st">'December'</span>]</span>
<span id="cb89-1607"><a href="#cb89-1607" aria-hidden="true" tabindex="-1"></a>                df <span class="op">=</span> df[columns]</span>
<span id="cb89-1608"><a href="#cb89-1608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1609"><a href="#cb89-1609" aria-hidden="true" tabindex="-1"></a>                df_melted <span class="op">=</span> df.melt(id_vars<span class="op">=</span>[<span class="st">'Year'</span>], var_name<span class="op">=</span><span class="st">'Month'</span>, value_name<span class="op">=</span><span class="st">'Value'</span>)</span>
<span id="cb89-1610"><a href="#cb89-1610" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb89-1611"><a href="#cb89-1611" aria-hidden="true" tabindex="-1"></a>                month_translation <span class="op">=</span> {</span>
<span id="cb89-1612"><a href="#cb89-1612" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'January'</span>: <span class="st">'January'</span>, <span class="st">'February'</span>: <span class="st">'February'</span>, <span class="st">'March'</span>: <span class="st">'March'</span>, <span class="st">'April'</span>: <span class="st">'April'</span>, </span>
<span id="cb89-1613"><a href="#cb89-1613" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'May'</span>: <span class="st">'May'</span>, <span class="st">'June'</span>: <span class="st">'June'</span>, <span class="st">'July'</span>: <span class="st">'July'</span>, <span class="st">'August'</span>: <span class="st">'August'</span>, </span>
<span id="cb89-1614"><a href="#cb89-1614" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'September'</span>: <span class="st">'September'</span>, <span class="st">'October'</span>: <span class="st">'October'</span>, <span class="st">'November'</span>: <span class="st">'November'</span>, </span>
<span id="cb89-1615"><a href="#cb89-1615" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'December'</span>: <span class="st">'December'</span></span>
<span id="cb89-1616"><a href="#cb89-1616" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb89-1617"><a href="#cb89-1617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1618"><a href="#cb89-1618" aria-hidden="true" tabindex="-1"></a>                df_melted[<span class="st">'Month'</span>] <span class="op">=</span> df_melted[<span class="st">'Month'</span>].<span class="bu">map</span>(month_translation)</span>
<span id="cb89-1619"><a href="#cb89-1619" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb89-1620"><a href="#cb89-1620" aria-hidden="true" tabindex="-1"></a>                plt.rcParams[<span class="st">"font.family"</span>] <span class="op">=</span> <span class="st">"Times New Roman"</span></span>
<span id="cb89-1621"><a href="#cb89-1621" aria-hidden="true" tabindex="-1"></a>                plt.rcParams[<span class="st">"font.size"</span>] <span class="op">=</span> <span class="dv">12</span></span>
<span id="cb89-1622"><a href="#cb89-1622" aria-hidden="true" tabindex="-1"></a>                plt.rcParams[<span class="st">"axes.titlesize"</span>] <span class="op">=</span> plt.rcParams[<span class="st">"font.size"</span>] <span class="op">+</span> <span class="dv">4</span></span>
<span id="cb89-1623"><a href="#cb89-1623" aria-hidden="true" tabindex="-1"></a>                plt.rcParams[<span class="st">"axes.labelsize"</span>] <span class="op">=</span> plt.rcParams[<span class="st">"font.size"</span>] <span class="op">+</span> <span class="dv">4</span></span>
<span id="cb89-1624"><a href="#cb89-1624" aria-hidden="true" tabindex="-1"></a>                plt.rcParams[<span class="st">"xtick.labelsize"</span>] <span class="op">=</span> plt.rcParams[<span class="st">"font.size"</span>] <span class="op">+</span> <span class="dv">4</span></span>
<span id="cb89-1625"><a href="#cb89-1625" aria-hidden="true" tabindex="-1"></a>                plt.rcParams[<span class="st">"ytick.labelsize"</span>] <span class="op">=</span> plt.rcParams[<span class="st">"font.size"</span>] <span class="op">+</span> <span class="dv">4</span></span>
<span id="cb89-1626"><a href="#cb89-1626" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb89-1627"><a href="#cb89-1627" aria-hidden="true" tabindex="-1"></a>                plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb89-1628"><a href="#cb89-1628" aria-hidden="true" tabindex="-1"></a>                sns.boxplot(</span>
<span id="cb89-1629"><a href="#cb89-1629" aria-hidden="true" tabindex="-1"></a>                    x<span class="op">=</span><span class="st">'Month'</span>, y<span class="op">=</span><span class="st">'Value'</span>, data<span class="op">=</span>df_melted,</span>
<span id="cb89-1630"><a href="#cb89-1630" aria-hidden="true" tabindex="-1"></a>                    order<span class="op">=</span>[<span class="st">'January'</span>, <span class="st">'February'</span>, <span class="st">'March'</span>, <span class="st">'April'</span>, <span class="st">'May'</span>, <span class="st">'June'</span>, <span class="st">'July'</span>, </span>
<span id="cb89-1631"><a href="#cb89-1631" aria-hidden="true" tabindex="-1"></a>                           <span class="st">'August'</span>, <span class="st">'September'</span>, <span class="st">'October'</span>, <span class="st">'November'</span>, <span class="st">'December'</span>],</span>
<span id="cb89-1632"><a href="#cb89-1632" aria-hidden="true" tabindex="-1"></a>                    color<span class="op">=</span><span class="st">'gray'</span></span>
<span id="cb89-1633"><a href="#cb89-1633" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb89-1634"><a href="#cb89-1634" aria-hidden="true" tabindex="-1"></a>                <span class="co">#plt.title(f'Distribution of the median monthly flow - {station_folder} Station')</span></span>
<span id="cb89-1635"><a href="#cb89-1635" aria-hidden="true" tabindex="-1"></a>                plt.xlabel(<span class="st">'Month'</span>)</span>
<span id="cb89-1636"><a href="#cb89-1636" aria-hidden="true" tabindex="-1"></a>                plt.ylabel(<span class="st">'Flow (m3/s)'</span>)</span>
<span id="cb89-1637"><a href="#cb89-1637" aria-hidden="true" tabindex="-1"></a>                plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb89-1638"><a href="#cb89-1638" aria-hidden="true" tabindex="-1"></a>                plt.tight_layout()</span>
<span id="cb89-1639"><a href="#cb89-1639" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb89-1640"><a href="#cb89-1640" aria-hidden="true" tabindex="-1"></a>                output_plot_path <span class="op">=</span> os.path.join(station_output_directory, <span class="ss">f'BOXPLOT_</span><span class="sc">{</span>filename[:<span class="op">-</span><span class="dv">4</span>]<span class="sc">}</span><span class="ss">.png'</span>)</span>
<span id="cb89-1641"><a href="#cb89-1641" aria-hidden="true" tabindex="-1"></a>                plt.savefig(output_plot_path, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb89-1642"><a href="#cb89-1642" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb89-1643"><a href="#cb89-1643" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb89-1644"><a href="#cb89-1644" aria-hidden="true" tabindex="-1"></a>                    plt.show()</span>
<span id="cb89-1645"><a href="#cb89-1645" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb89-1646"><a href="#cb89-1646" aria-hidden="true" tabindex="-1"></a>                    plt.close()</span>
<span id="cb89-1647"><a href="#cb89-1647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1648"><a href="#cb89-1648" aria-hidden="true" tabindex="-1"></a>                contador <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb89-1649"><a href="#cb89-1649" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb89-1650"><a href="#cb89-1650" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f'Boxplot saved: </span><span class="sc">{</span>output_plot_path<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb89-1651"><a href="#cb89-1651" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-1652"><a href="#cb89-1652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1653"><a href="#cb89-1653" aria-hidden="true" tabindex="-1"></a>6.2.3. Figure with the percentiles of monthly flows for all years evaluated by station.</span>
<span id="cb89-1654"><a href="#cb89-1654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1655"><a href="#cb89-1655" aria-hidden="true" tabindex="-1"></a>The order of the months in the <span class="in">`pct_`</span> file may vary. If so, adjust the <span class="in">`meses_ingles`</span> variable accordingly.</span>
<span id="cb89-1656"><a href="#cb89-1656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1659"><a href="#cb89-1659" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-1660"><a href="#cb89-1660" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-polar-13</span></span>
<span id="cb89-1661"><a href="#cb89-1661" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Percentiles of monthly flows at station 9423001"</span></span>
<span id="cb89-1662"><a href="#cb89-1662" aria-hidden="true" tabindex="-1"></a>base_path <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/9.IHA/csv'</span></span>
<span id="cb89-1663"><a href="#cb89-1663" aria-hidden="true" tabindex="-1"></a>output_root_directory <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/10.Figuras_IHA/Caudal'</span></span>
<span id="cb89-1664"><a href="#cb89-1664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1665"><a href="#cb89-1665" aria-hidden="true" tabindex="-1"></a>contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb89-1666"><a href="#cb89-1666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1667"><a href="#cb89-1667" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> root, dirs, files <span class="kw">in</span> os.walk(base_path):</span>
<span id="cb89-1668"><a href="#cb89-1668" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files:</span>
<span id="cb89-1669"><a href="#cb89-1669" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">file</span>.startswith(<span class="st">"pct_"</span>) <span class="kw">and</span> <span class="bu">file</span>.endswith(<span class="st">".csv"</span>):</span>
<span id="cb89-1670"><a href="#cb89-1670" aria-hidden="true" tabindex="-1"></a>            pct_file <span class="op">=</span> os.path.join(root, <span class="bu">file</span>)</span>
<span id="cb89-1671"><a href="#cb89-1671" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb89-1672"><a href="#cb89-1672" aria-hidden="true" tabindex="-1"></a>            station_code <span class="op">=</span> os.path.basename(root)</span>
<span id="cb89-1673"><a href="#cb89-1673" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb89-1674"><a href="#cb89-1674" aria-hidden="true" tabindex="-1"></a>            station_output_directory <span class="op">=</span> os.path.join(output_root_directory, station_code)</span>
<span id="cb89-1675"><a href="#cb89-1675" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb89-1676"><a href="#cb89-1676" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> os.path.exists(station_output_directory):</span>
<span id="cb89-1677"><a href="#cb89-1677" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"Error: The output directory for station </span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss"> does not exist."</span>)</span>
<span id="cb89-1678"><a href="#cb89-1678" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb89-1679"><a href="#cb89-1679" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb89-1680"><a href="#cb89-1680" aria-hidden="true" tabindex="-1"></a>            df <span class="op">=</span> pd.read_csv(pct_file, skiprows<span class="op">=</span><span class="dv">8</span>, header<span class="op">=</span><span class="va">None</span>) </span>
<span id="cb89-1681"><a href="#cb89-1681" aria-hidden="true" tabindex="-1"></a>            df_mes <span class="op">=</span> df.iloc[:<span class="dv">12</span>, :<span class="dv">6</span>]</span>
<span id="cb89-1682"><a href="#cb89-1682" aria-hidden="true" tabindex="-1"></a>            df_mes.columns <span class="op">=</span> [<span class="st">'Month'</span>, <span class="st">'10%'</span>, <span class="st">'25%'</span>, <span class="st">'50%'</span>, <span class="st">'75%'</span>, <span class="st">'90%'</span>]</span>
<span id="cb89-1683"><a href="#cb89-1683" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb89-1684"><a href="#cb89-1684" aria-hidden="true" tabindex="-1"></a>            meses_ingles <span class="op">=</span> [<span class="st">'January'</span>, <span class="st">'February'</span>, <span class="st">'March'</span>, <span class="st">'April'</span>, <span class="st">'May'</span>, <span class="st">'June'</span>, <span class="st">'July'</span>, <span class="st">'August'</span>, <span class="st">'September'</span>, <span class="st">'October'</span>, <span class="st">'November'</span>, <span class="st">'December'</span>]</span>
<span id="cb89-1685"><a href="#cb89-1685" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb89-1686"><a href="#cb89-1686" aria-hidden="true" tabindex="-1"></a>            df_mes[<span class="st">'Month'</span>] <span class="op">=</span> meses_ingles</span>
<span id="cb89-1687"><a href="#cb89-1687" aria-hidden="true" tabindex="-1"></a>            df_mes.set_index(<span class="st">'Month'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-1688"><a href="#cb89-1688" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb89-1689"><a href="#cb89-1689" aria-hidden="true" tabindex="-1"></a>            plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb89-1690"><a href="#cb89-1690" aria-hidden="true" tabindex="-1"></a>            linestyles <span class="op">=</span> [<span class="st">'-'</span>, <span class="st">'--'</span>, <span class="st">'-.'</span>, <span class="st">':'</span>, (<span class="dv">0</span>, (<span class="dv">1</span>, <span class="dv">10</span>))]</span>
<span id="cb89-1691"><a href="#cb89-1691" aria-hidden="true" tabindex="-1"></a>            marcadores <span class="op">=</span> [<span class="st">'o'</span>, <span class="st">'s'</span>, <span class="st">'^'</span>, <span class="st">'D'</span>, <span class="st">'*'</span>]</span>
<span id="cb89-1692"><a href="#cb89-1692" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb89-1693"><a href="#cb89-1693" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> percentil, linestyle, marcador <span class="kw">in</span> <span class="bu">zip</span>([<span class="st">'10%'</span>, <span class="st">'25%'</span>, <span class="st">'50%'</span>, <span class="st">'75%'</span>, <span class="st">'90%'</span>], linestyles, marcadores):</span>
<span id="cb89-1694"><a href="#cb89-1694" aria-hidden="true" tabindex="-1"></a>                plt.plot(df_mes.index, df_mes[percentil], marker<span class="op">=</span>marcador, linestyle<span class="op">=</span>linestyle, label<span class="op">=</span>percentil, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb89-1695"><a href="#cb89-1695" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb89-1696"><a href="#cb89-1696" aria-hidden="true" tabindex="-1"></a>            plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb89-1697"><a href="#cb89-1697" aria-hidden="true" tabindex="-1"></a>            <span class="co">#plt.title(f'Percentiles of monthly flows for {station_code}', fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb89-1698"><a href="#cb89-1698" aria-hidden="true" tabindex="-1"></a>            plt.xlabel(<span class="st">'Month'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1699"><a href="#cb89-1699" aria-hidden="true" tabindex="-1"></a>            plt.ylabel(<span class="st">'Flow (m3/s)'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1700"><a href="#cb89-1700" aria-hidden="true" tabindex="-1"></a>            plt.xticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb89-1701"><a href="#cb89-1701" aria-hidden="true" tabindex="-1"></a>            plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1702"><a href="#cb89-1702" aria-hidden="true" tabindex="-1"></a>            plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.35</span>, <span class="fl">0.95</span>), fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb89-1703"><a href="#cb89-1703" aria-hidden="true" tabindex="-1"></a>            plt.grid(<span class="va">False</span>)</span>
<span id="cb89-1704"><a href="#cb89-1704" aria-hidden="true" tabindex="-1"></a>            plt.tight_layout()</span>
<span id="cb89-1705"><a href="#cb89-1705" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb89-1706"><a href="#cb89-1706" aria-hidden="true" tabindex="-1"></a>            output_plot_path <span class="op">=</span> os.path.join(station_output_directory, <span class="ss">f'percentiles_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.png'</span>)</span>
<span id="cb89-1707"><a href="#cb89-1707" aria-hidden="true" tabindex="-1"></a>            plt.savefig(output_plot_path, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb89-1708"><a href="#cb89-1708" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb89-1709"><a href="#cb89-1709" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb89-1710"><a href="#cb89-1710" aria-hidden="true" tabindex="-1"></a>                plt.show()</span>
<span id="cb89-1711"><a href="#cb89-1711" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb89-1712"><a href="#cb89-1712" aria-hidden="true" tabindex="-1"></a>                plt.close()</span>
<span id="cb89-1713"><a href="#cb89-1713" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb89-1714"><a href="#cb89-1714" aria-hidden="true" tabindex="-1"></a>            contador <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb89-1715"><a href="#cb89-1715" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb89-1716"><a href="#cb89-1716" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Figure saved: </span><span class="sc">{</span>output_plot_path<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb89-1717"><a href="#cb89-1717" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-1718"><a href="#cb89-1718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1719"><a href="#cb89-1719" aria-hidden="true" tabindex="-1"></a>6.2.4. Graphs for each station with the probability of exceedance for each month and at an annual level.</span>
<span id="cb89-1720"><a href="#cb89-1720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1721"><a href="#cb89-1721" aria-hidden="true" tabindex="-1"></a>The language of the months or even the way they are written in the <span class="in">`fdc_`</span> file may vary. If so, adjust the <span class="in">`meses`</span> variable accordingly.</span>
<span id="cb89-1722"><a href="#cb89-1722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1725"><a href="#cb89-1725" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-1726"><a href="#cb89-1726" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-polar-14</span></span>
<span id="cb89-1727"><a href="#cb89-1727" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Flow Duration Curve for January at station 9423001"</span></span>
<span id="cb89-1728"><a href="#cb89-1728" aria-hidden="true" tabindex="-1"></a>base_path <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/9.IHA/csv'</span></span>
<span id="cb89-1729"><a href="#cb89-1729" aria-hidden="true" tabindex="-1"></a>output_root_directory <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/10.Figuras_IHA/Caudal'</span></span>
<span id="cb89-1730"><a href="#cb89-1730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1731"><a href="#cb89-1731" aria-hidden="true" tabindex="-1"></a>contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb89-1732"><a href="#cb89-1732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1733"><a href="#cb89-1733" aria-hidden="true" tabindex="-1"></a>meses <span class="op">=</span> {</span>
<span id="cb89-1734"><a href="#cb89-1734" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Annual'</span>: <span class="st">'Annual'</span>, <span class="st">'January'</span>: <span class="st">'January'</span>, <span class="st">'February'</span>: <span class="st">'February'</span>, <span class="st">'March'</span>: <span class="st">'March'</span>,</span>
<span id="cb89-1735"><a href="#cb89-1735" aria-hidden="true" tabindex="-1"></a>    <span class="st">'April'</span>: <span class="st">'April'</span>, <span class="st">'May'</span>: <span class="st">'May'</span>, <span class="st">'June'</span>: <span class="st">'June'</span>, <span class="st">'July'</span>: <span class="st">'July'</span>, </span>
<span id="cb89-1736"><a href="#cb89-1736" aria-hidden="true" tabindex="-1"></a>    <span class="st">'August'</span>: <span class="st">'August'</span>, <span class="st">'September'</span>: <span class="st">'September'</span>, <span class="st">'October'</span>: <span class="st">'October'</span>, </span>
<span id="cb89-1737"><a href="#cb89-1737" aria-hidden="true" tabindex="-1"></a>    <span class="st">'November'</span>: <span class="st">'November'</span>, <span class="st">'December'</span>: <span class="st">'December'</span></span>
<span id="cb89-1738"><a href="#cb89-1738" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb89-1739"><a href="#cb89-1739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1740"><a href="#cb89-1740" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> root, dirs, files <span class="kw">in</span> os.walk(base_path):</span>
<span id="cb89-1741"><a href="#cb89-1741" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files:</span>
<span id="cb89-1742"><a href="#cb89-1742" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">file</span>.startswith(<span class="st">"fdc_"</span>) <span class="kw">and</span> <span class="bu">file</span>.endswith(<span class="st">".csv"</span>):</span>
<span id="cb89-1743"><a href="#cb89-1743" aria-hidden="true" tabindex="-1"></a>            fdc_file <span class="op">=</span> os.path.join(root, <span class="bu">file</span>)</span>
<span id="cb89-1744"><a href="#cb89-1744" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb89-1745"><a href="#cb89-1745" aria-hidden="true" tabindex="-1"></a>            df_headers <span class="op">=</span> pd.read_csv(fdc_file, skiprows<span class="op">=</span><span class="dv">9</span>, nrows<span class="op">=</span><span class="dv">1</span>, header<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb89-1746"><a href="#cb89-1746" aria-hidden="true" tabindex="-1"></a>            df_data <span class="op">=</span> pd.read_csv(fdc_file, skiprows<span class="op">=</span><span class="dv">11</span>, header<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb89-1747"><a href="#cb89-1747" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb89-1748"><a href="#cb89-1748" aria-hidden="true" tabindex="-1"></a>            col_indices <span class="op">=</span> {}</span>
<span id="cb89-1749"><a href="#cb89-1749" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> col_idx, col_name <span class="kw">in</span> <span class="bu">enumerate</span>(df_headers.iloc[<span class="dv">0</span>]):</span>
<span id="cb89-1750"><a href="#cb89-1750" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="bu">isinstance</span>(col_name, <span class="bu">str</span>) <span class="kw">and</span> col_name.strip() <span class="kw">in</span> meses:</span>
<span id="cb89-1751"><a href="#cb89-1751" aria-hidden="true" tabindex="-1"></a>                    col_indices[meses[col_name.strip()]] <span class="op">=</span> col_idx</span>
<span id="cb89-1752"><a href="#cb89-1752" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb89-1753"><a href="#cb89-1753" aria-hidden="true" tabindex="-1"></a>            station_code <span class="op">=</span> <span class="bu">file</span>.split(<span class="st">'_'</span>)[<span class="dv">1</span>].split(<span class="st">'.'</span>)[<span class="dv">0</span>]</span>
<span id="cb89-1754"><a href="#cb89-1754" aria-hidden="true" tabindex="-1"></a>            output_dir <span class="op">=</span> os.path.join(output_root_directory, station_code)</span>
<span id="cb89-1755"><a href="#cb89-1755" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> os.path.exists(output_dir):</span>
<span id="cb89-1756"><a href="#cb89-1756" aria-hidden="true" tabindex="-1"></a>                os.makedirs(output_dir)</span>
<span id="cb89-1757"><a href="#cb89-1757" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb89-1758"><a href="#cb89-1758" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> mes, mes_label <span class="kw">in</span> meses.items():</span>
<span id="cb89-1759"><a href="#cb89-1759" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> mes_label <span class="kw">in</span> col_indices:</span>
<span id="cb89-1760"><a href="#cb89-1760" aria-hidden="true" tabindex="-1"></a>                    x_col <span class="op">=</span> col_indices[mes_label] <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb89-1761"><a href="#cb89-1761" aria-hidden="true" tabindex="-1"></a>                    y_col <span class="op">=</span> col_indices[mes_label] </span>
<span id="cb89-1762"><a href="#cb89-1762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1763"><a href="#cb89-1763" aria-hidden="true" tabindex="-1"></a>                    data <span class="op">=</span> df_data.iloc[:, [y_col, x_col]].dropna()</span>
<span id="cb89-1764"><a href="#cb89-1764" aria-hidden="true" tabindex="-1"></a>                    data.columns <span class="op">=</span> [<span class="st">'Caudal'</span>, <span class="st">'Probabilidad'</span>]</span>
<span id="cb89-1765"><a href="#cb89-1765" aria-hidden="true" tabindex="-1"></a>                    data[<span class="st">'Probabilidad'</span>] <span class="op">=</span> data[<span class="st">'Probabilidad'</span>]</span>
<span id="cb89-1766"><a href="#cb89-1766" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb89-1767"><a href="#cb89-1767" aria-hidden="true" tabindex="-1"></a>                    plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb89-1768"><a href="#cb89-1768" aria-hidden="true" tabindex="-1"></a>                    plt.plot(data[<span class="st">'Probabilidad'</span>], data[<span class="st">'Caudal'</span>], marker<span class="op">=</span><span class="st">'o'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb89-1769"><a href="#cb89-1769" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#plt.title(f'Flow Duration Curve - {mes_label} ({station_code})', fontsize=16, fontname='Times New Roman')</span></span>
<span id="cb89-1770"><a href="#cb89-1770" aria-hidden="true" tabindex="-1"></a>                    plt.xlabel(<span class="st">'Probability of Exceedance (%)'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1771"><a href="#cb89-1771" aria-hidden="true" tabindex="-1"></a>                    plt.ylabel(<span class="st">'Flow (m³/s)'</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1772"><a href="#cb89-1772" aria-hidden="true" tabindex="-1"></a>                    plt.grid(<span class="va">False</span>)</span>
<span id="cb89-1773"><a href="#cb89-1773" aria-hidden="true" tabindex="-1"></a>                    plt.tight_layout()</span>
<span id="cb89-1774"><a href="#cb89-1774" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb89-1775"><a href="#cb89-1775" aria-hidden="true" tabindex="-1"></a>                    output_file <span class="op">=</span> os.path.join(output_dir, <span class="ss">f'FDC_</span><span class="sc">{</span>mes_label<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.png'</span>)</span>
<span id="cb89-1776"><a href="#cb89-1776" aria-hidden="true" tabindex="-1"></a>                    plt.savefig(output_file, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb89-1777"><a href="#cb89-1777" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb89-1778"><a href="#cb89-1778" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb89-1779"><a href="#cb89-1779" aria-hidden="true" tabindex="-1"></a>                        plt.show()</span>
<span id="cb89-1780"><a href="#cb89-1780" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span>:</span>
<span id="cb89-1781"><a href="#cb89-1781" aria-hidden="true" tabindex="-1"></a>                        plt.close()</span>
<span id="cb89-1782"><a href="#cb89-1782" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb89-1783"><a href="#cb89-1783" aria-hidden="true" tabindex="-1"></a>                    contador <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb89-1784"><a href="#cb89-1784" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb89-1785"><a href="#cb89-1785" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Flow Duration Curve generated for each month of each station'</span>)</span>
<span id="cb89-1786"><a href="#cb89-1786" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-1787"><a href="#cb89-1787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1788"><a href="#cb89-1788" aria-hidden="true" tabindex="-1"></a>6.2.5. Figure of the streamflow of all stations present in the basin</span>
<span id="cb89-1789"><a href="#cb89-1789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1790"><a href="#cb89-1790" aria-hidden="true" tabindex="-1"></a>The order of the months in the <span class="in">`sco_`</span> file may vary. If so, adjust the <span class="in">`meses_ingles`</span> variable accordingly.</span>
<span id="cb89-1791"><a href="#cb89-1791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1794"><a href="#cb89-1794" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-1795"><a href="#cb89-1795" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-polar-15</span></span>
<span id="cb89-1796"><a href="#cb89-1796" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Median monthly flow by station"</span></span>
<span id="cb89-1797"><a href="#cb89-1797" aria-hidden="true" tabindex="-1"></a>base_path <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/9.IHA/csv'</span></span>
<span id="cb89-1798"><a href="#cb89-1798" aria-hidden="true" tabindex="-1"></a>save_path <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/10.Figuras_IHA/Caudal'</span></span>
<span id="cb89-1799"><a href="#cb89-1799" aria-hidden="true" tabindex="-1"></a>os.makedirs(save_path, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-1800"><a href="#cb89-1800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1801"><a href="#cb89-1801" aria-hidden="true" tabindex="-1"></a>linestyles <span class="op">=</span> [<span class="st">'-'</span>, <span class="st">'--'</span>, <span class="st">'-.'</span>, <span class="st">':'</span>, (<span class="dv">0</span>, (<span class="dv">1</span>, <span class="dv">10</span>)), (<span class="dv">0</span>, (<span class="dv">5</span>, <span class="dv">10</span>)), (<span class="dv">0</span>, (<span class="dv">3</span>, <span class="dv">5</span>)), (<span class="dv">0</span>, (<span class="dv">3</span>, <span class="dv">1</span>)), (<span class="dv">0</span>, (<span class="dv">5</span>, <span class="dv">3</span>)), (<span class="dv">0</span>, (<span class="dv">1</span>, <span class="dv">1</span>)), (<span class="dv">0</span>, (<span class="dv">5</span>, <span class="dv">1</span>)), (<span class="dv">0</span>, (<span class="dv">1</span>, <span class="dv">5</span>))]</span>
<span id="cb89-1802"><a href="#cb89-1802" aria-hidden="true" tabindex="-1"></a>colores <span class="op">=</span> [<span class="st">'black'</span>, <span class="st">'darkgray'</span>, <span class="st">'gray'</span>, <span class="st">'lightgray'</span>, <span class="st">'black'</span>, <span class="st">'dimgray'</span>, <span class="st">'gray'</span>, <span class="st">'dimgray'</span>, <span class="st">'darkgray'</span>, <span class="st">'black'</span>, <span class="st">'dimgray'</span>, <span class="st">'black'</span>]</span>
<span id="cb89-1803"><a href="#cb89-1803" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb89-1804"><a href="#cb89-1804" aria-hidden="true" tabindex="-1"></a>line_counter <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb89-1805"><a href="#cb89-1805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1806"><a href="#cb89-1806" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> root, dirs, files <span class="kw">in</span> os.walk(base_path):</span>
<span id="cb89-1807"><a href="#cb89-1807" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files:</span>
<span id="cb89-1808"><a href="#cb89-1808" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">file</span>.startswith(<span class="st">"sco_"</span>) <span class="kw">and</span> <span class="bu">file</span>.endswith(<span class="st">".csv"</span>):</span>
<span id="cb89-1809"><a href="#cb89-1809" aria-hidden="true" tabindex="-1"></a>            sco_file <span class="op">=</span> os.path.join(root, <span class="bu">file</span>)</span>
<span id="cb89-1810"><a href="#cb89-1810" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb89-1811"><a href="#cb89-1811" aria-hidden="true" tabindex="-1"></a>            nombre_archivo <span class="op">=</span> os.path.basename(sco_file)</span>
<span id="cb89-1812"><a href="#cb89-1812" aria-hidden="true" tabindex="-1"></a>            codigo_estacion <span class="op">=</span> nombre_archivo.split(<span class="st">'_'</span>)[<span class="dv">1</span>].split(<span class="st">'.'</span>)[<span class="dv">0</span>]</span>
<span id="cb89-1813"><a href="#cb89-1813" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb89-1814"><a href="#cb89-1814" aria-hidden="true" tabindex="-1"></a>            df <span class="op">=</span> pd.read_csv(sco_file, skiprows<span class="op">=</span><span class="dv">17</span>, header<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb89-1815"><a href="#cb89-1815" aria-hidden="true" tabindex="-1"></a>            df_mes <span class="op">=</span> df.iloc[:<span class="dv">12</span>, :<span class="dv">2</span>]</span>
<span id="cb89-1816"><a href="#cb89-1816" aria-hidden="true" tabindex="-1"></a>            df_mes.columns <span class="op">=</span> [<span class="st">'Month'</span>, <span class="st">'Median'</span>]</span>
<span id="cb89-1817"><a href="#cb89-1817" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb89-1818"><a href="#cb89-1818" aria-hidden="true" tabindex="-1"></a>            meses_ingles <span class="op">=</span> [<span class="st">'January'</span>, <span class="st">'February'</span>, <span class="st">'March'</span>, <span class="st">'April'</span>, <span class="st">'May'</span>, <span class="st">'June'</span>, <span class="st">'July'</span>, <span class="st">'August'</span>, <span class="st">'September'</span>, <span class="st">'October'</span>, <span class="st">'November'</span>, <span class="st">'December'</span>]</span>
<span id="cb89-1819"><a href="#cb89-1819" aria-hidden="true" tabindex="-1"></a>            df_mes[<span class="st">'Month'</span>] <span class="op">=</span> meses_ingles</span>
<span id="cb89-1820"><a href="#cb89-1820" aria-hidden="true" tabindex="-1"></a>            df_mes.set_index(<span class="st">'Month'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-1821"><a href="#cb89-1821" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb89-1822"><a href="#cb89-1822" aria-hidden="true" tabindex="-1"></a>            linestyle <span class="op">=</span> linestyles[line_counter <span class="op">%</span> <span class="bu">len</span>(linestyles)]</span>
<span id="cb89-1823"><a href="#cb89-1823" aria-hidden="true" tabindex="-1"></a>            color <span class="op">=</span> colores[line_counter <span class="op">%</span> <span class="bu">len</span>(colores)]</span>
<span id="cb89-1824"><a href="#cb89-1824" aria-hidden="true" tabindex="-1"></a>            plt.plot(df_mes.index, df_mes[<span class="st">'Median'</span>], linestyle<span class="op">=</span>linestyle, color<span class="op">=</span>color, label<span class="op">=</span><span class="ss">f'Station </span><span class="sc">{</span>codigo_estacion<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb89-1825"><a href="#cb89-1825" aria-hidden="true" tabindex="-1"></a>            line_counter <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb89-1826"><a href="#cb89-1826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1827"><a href="#cb89-1827" aria-hidden="true" tabindex="-1"></a>plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb89-1828"><a href="#cb89-1828" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.title('Median monthly flow by station', fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb89-1829"><a href="#cb89-1829" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Month'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1830"><a href="#cb89-1830" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Flow (m3/s)'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1831"><a href="#cb89-1831" aria-hidden="true" tabindex="-1"></a>plt.xticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb89-1832"><a href="#cb89-1832" aria-hidden="true" tabindex="-1"></a>plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1833"><a href="#cb89-1833" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb89-1834"><a href="#cb89-1834" aria-hidden="true" tabindex="-1"></a>plt.legend(fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb89-1835"><a href="#cb89-1835" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">False</span>)</span>
<span id="cb89-1836"><a href="#cb89-1836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1837"><a href="#cb89-1837" aria-hidden="true" tabindex="-1"></a>save_file <span class="op">=</span> os.path.join(save_path, <span class="st">'qmonthly_TOTstations.png'</span>)</span>
<span id="cb89-1838"><a href="#cb89-1838" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb89-1839"><a href="#cb89-1839" aria-hidden="true" tabindex="-1"></a>plt.savefig(save_file, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb89-1840"><a href="#cb89-1840" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb89-1841"><a href="#cb89-1841" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-1842"><a href="#cb89-1842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1843"><a href="#cb89-1843" aria-hidden="true" tabindex="-1"></a><span class="fu">### Time series figures</span></span>
<span id="cb89-1844"><a href="#cb89-1844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1845"><a href="#cb89-1845" aria-hidden="true" tabindex="-1"></a>The language of the months, indicator and column of "year" or even the way they are written in the <span class="in">`ann_`</span> and <span class="in">`sco_`</span> file may vary.</span>
<span id="cb89-1846"><a href="#cb89-1846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1847"><a href="#cb89-1847" aria-hidden="true" tabindex="-1"></a>If so, adjust:</span>
<span id="cb89-1848"><a href="#cb89-1848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1849"><a href="#cb89-1849" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`indicator_names`</span> variable</span>
<span id="cb89-1850"><a href="#cb89-1850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1851"><a href="#cb89-1851" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>the names for the regression in row <span class="in">`lsq_selected = lsq_data.loc[indicator['lsq_row'], ['Slope', 'YInt', 'Sigma', 'Corr', 'PValue', 'FStat', 'R2']]`</span></span>
<span id="cb89-1852"><a href="#cb89-1852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1853"><a href="#cb89-1853" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>the <span class="in">`skiprows`</span> variable in <span class="in">`sco_data`</span> with the number of the row where the list of the respective indicator begins</span>
<span id="cb89-1854"><a href="#cb89-1854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1855"><a href="#cb89-1855" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>the <span class="in">`slope`</span>, <span class="in">`intercept`</span> and <span class="in">`r_squared`</span> variables</span>
<span id="cb89-1856"><a href="#cb89-1856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1857"><a href="#cb89-1857" aria-hidden="true" tabindex="-1"></a>6.3.1. Median flow in July over time.</span>
<span id="cb89-1858"><a href="#cb89-1858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1859"><a href="#cb89-1859" aria-hidden="true" tabindex="-1"></a>In this case, the time series of the median flow in July was selected, as it corresponds to the month with the highest flow in the study basin.</span>
<span id="cb89-1860"><a href="#cb89-1860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1861"><a href="#cb89-1861" aria-hidden="true" tabindex="-1"></a>6.3.1.1. Reading input files and extracting specific data related to the selected month.</span>
<span id="cb89-1862"><a href="#cb89-1862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1865"><a href="#cb89-1865" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-1866"><a href="#cb89-1866" aria-hidden="true" tabindex="-1"></a>base_folder_path <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/9.IHA/csv/'</span></span>
<span id="cb89-1867"><a href="#cb89-1867" aria-hidden="true" tabindex="-1"></a>output_folder_path <span class="op">=</span> <span class="st">'Hidroclima/Base de datos/10.Figuras_IHA/IHA anuales/'</span></span>
<span id="cb89-1868"><a href="#cb89-1868" aria-hidden="true" tabindex="-1"></a>os.makedirs(output_folder_path, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-1869"><a href="#cb89-1869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1870"><a href="#cb89-1870" aria-hidden="true" tabindex="-1"></a>indicator_names <span class="op">=</span> {</span>
<span id="cb89-1871"><a href="#cb89-1871" aria-hidden="true" tabindex="-1"></a>    <span class="st">'lsq_row'</span>: <span class="st">'July'</span>,              </span>
<span id="cb89-1872"><a href="#cb89-1872" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ann_column'</span>: <span class="st">'July'</span>,           </span>
<span id="cb89-1873"><a href="#cb89-1873" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sco_row'</span>: <span class="st">'July'</span>,              </span>
<span id="cb89-1874"><a href="#cb89-1874" aria-hidden="true" tabindex="-1"></a>    <span class="st">'plot_label'</span>: <span class="st">'July'</span>            </span>
<span id="cb89-1875"><a href="#cb89-1875" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb89-1876"><a href="#cb89-1876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1877"><a href="#cb89-1877" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_data(lsq_file, ann_file, sco_file, indicator):</span>
<span id="cb89-1878"><a href="#cb89-1878" aria-hidden="true" tabindex="-1"></a>    lsq_data <span class="op">=</span> pd.read_csv(lsq_file, skiprows<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb89-1879"><a href="#cb89-1879" aria-hidden="true" tabindex="-1"></a>    lsq_data.set_index(lsq_data.columns[<span class="dv">0</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-1880"><a href="#cb89-1880" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb89-1881"><a href="#cb89-1881" aria-hidden="true" tabindex="-1"></a>        lsq_selected <span class="op">=</span> lsq_data.loc[indicator[<span class="st">'lsq_row'</span>], [<span class="st">'Slope'</span>, <span class="st">'YInt'</span>, <span class="st">'Sigma'</span>, <span class="st">'Corr'</span>, <span class="st">'PValue'</span>, <span class="st">'FStat'</span>, <span class="st">'R2'</span>]]</span>
<span id="cb89-1882"><a href="#cb89-1882" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">KeyError</span>:</span>
<span id="cb89-1883"><a href="#cb89-1883" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Indicator '</span><span class="sc">{</span>indicator[<span class="st">'lsq_row'</span>]<span class="sc">}</span><span class="ss">' not found in lsq_file."</span>)</span>
<span id="cb89-1884"><a href="#cb89-1884" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb89-1885"><a href="#cb89-1885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1886"><a href="#cb89-1886" aria-hidden="true" tabindex="-1"></a>    ann_data <span class="op">=</span> pd.read_csv(ann_file, skiprows<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb89-1887"><a href="#cb89-1887" aria-hidden="true" tabindex="-1"></a>    ann_data.columns <span class="op">=</span> ann_data.columns.<span class="bu">str</span>.strip()</span>
<span id="cb89-1888"><a href="#cb89-1888" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> indicator[<span class="st">'ann_column'</span>] <span class="kw">not</span> <span class="kw">in</span> ann_data.columns:</span>
<span id="cb89-1889"><a href="#cb89-1889" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Column '</span><span class="sc">{</span>indicator[<span class="st">'ann_column'</span>]<span class="sc">}</span><span class="ss">' not found in ann_file."</span>)</span>
<span id="cb89-1890"><a href="#cb89-1890" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb89-1891"><a href="#cb89-1891" aria-hidden="true" tabindex="-1"></a>    ann_data <span class="op">=</span> ann_data[[<span class="st">'Year'</span>, indicator[<span class="st">'ann_column'</span>]]].dropna()</span>
<span id="cb89-1892"><a href="#cb89-1892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1893"><a href="#cb89-1893" aria-hidden="true" tabindex="-1"></a>    sco_data <span class="op">=</span> pd.read_csv(sco_file, skiprows<span class="op">=</span><span class="dv">17</span>, nrows<span class="op">=</span><span class="dv">13</span>, header<span class="op">=</span><span class="va">None</span>, index_col<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb89-1894"><a href="#cb89-1894" aria-hidden="true" tabindex="-1"></a>    sco_data.index.name <span class="op">=</span> <span class="st">'Parameter'</span></span>
<span id="cb89-1895"><a href="#cb89-1895" aria-hidden="true" tabindex="-1"></a>    sco_data.columns <span class="op">=</span> [<span class="st">'Mediana'</span>, <span class="st">'Coef. Disper.'</span>]</span>
<span id="cb89-1896"><a href="#cb89-1896" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> indicator[<span class="st">'sco_row'</span>] <span class="kw">not</span> <span class="kw">in</span> sco_data.index:</span>
<span id="cb89-1897"><a href="#cb89-1897" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Indicator '</span><span class="sc">{</span>indicator[<span class="st">'sco_row'</span>]<span class="sc">}</span><span class="ss">' not found in sco_file."</span>)</span>
<span id="cb89-1898"><a href="#cb89-1898" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb89-1899"><a href="#cb89-1899" aria-hidden="true" tabindex="-1"></a>    sco_selected <span class="op">=</span> sco_data.loc[[indicator[<span class="st">'sco_row'</span>]]]</span>
<span id="cb89-1900"><a href="#cb89-1900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1901"><a href="#cb89-1901" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> lsq_selected, ann_data, sco_selected</span>
<span id="cb89-1902"><a href="#cb89-1902" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-1903"><a href="#cb89-1903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1904"><a href="#cb89-1904" aria-hidden="true" tabindex="-1"></a>6.3.1.2. Saving the extracted data in a single <span class="in">`.csv`</span> file.</span>
<span id="cb89-1905"><a href="#cb89-1905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1908"><a href="#cb89-1908" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-1909"><a href="#cb89-1909" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> save_to_csv(lsq_data, ann_data, sco_data, output_file):</span>
<span id="cb89-1910"><a href="#cb89-1910" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(output_file, <span class="st">'w'</span>, newline<span class="op">=</span><span class="st">''</span>) <span class="im">as</span> csvfile:</span>
<span id="cb89-1911"><a href="#cb89-1911" aria-hidden="true" tabindex="-1"></a>        writer <span class="op">=</span> csv.writer(csvfile)</span>
<span id="cb89-1912"><a href="#cb89-1912" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-1913"><a href="#cb89-1913" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Variable'</span>, <span class="st">'Valor'</span>])</span>
<span id="cb89-1914"><a href="#cb89-1914" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, value <span class="kw">in</span> lsq_data.items():</span>
<span id="cb89-1915"><a href="#cb89-1915" aria-hidden="true" tabindex="-1"></a>            writer.writerow([idx, value])</span>
<span id="cb89-1916"><a href="#cb89-1916" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-1917"><a href="#cb89-1917" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Year'</span>, indicator_names[<span class="st">'ann_column'</span>]])</span>
<span id="cb89-1918"><a href="#cb89-1918" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _, row <span class="kw">in</span> ann_data.iterrows():</span>
<span id="cb89-1919"><a href="#cb89-1919" aria-hidden="true" tabindex="-1"></a>            writer.writerow([<span class="bu">int</span>(row[<span class="st">'Year'</span>]), row[indicator_names[<span class="st">'ann_column'</span>]]])</span>
<span id="cb89-1920"><a href="#cb89-1920" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-1921"><a href="#cb89-1921" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Mediana'</span>, sco_data[<span class="st">'Mediana'</span>].values[<span class="dv">0</span>]])</span>
<span id="cb89-1922"><a href="#cb89-1922" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Coef. Disper.'</span>, sco_data[<span class="st">'Coef. Disper.'</span>].values[<span class="dv">0</span>]])</span>
<span id="cb89-1923"><a href="#cb89-1923" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-1924"><a href="#cb89-1924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1925"><a href="#cb89-1925" aria-hidden="true" tabindex="-1"></a>6.3.1.3. Graph format.</span>
<span id="cb89-1926"><a href="#cb89-1926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1929"><a href="#cb89-1929" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-1930"><a href="#cb89-1930" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_data(df, slope, intercept, r_squared, station_code, plot_label):</span>
<span id="cb89-1931"><a href="#cb89-1931" aria-hidden="true" tabindex="-1"></a>    df_anios <span class="op">=</span> df[(df[<span class="st">'Variable'</span>].<span class="bu">str</span>.isnumeric()) <span class="op">&amp;</span> (df[<span class="st">'Valor'</span>].notna())].copy()</span>
<span id="cb89-1932"><a href="#cb89-1932" aria-hidden="true" tabindex="-1"></a>    df_anios[<span class="st">'Variable'</span>] <span class="op">=</span> pd.to_numeric(df_anios[<span class="st">'Variable'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb89-1933"><a href="#cb89-1933" aria-hidden="true" tabindex="-1"></a>    df_anios[<span class="st">'Valor'</span>] <span class="op">=</span> pd.to_numeric(df_anios[<span class="st">'Valor'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb89-1934"><a href="#cb89-1934" aria-hidden="true" tabindex="-1"></a>    df_anios <span class="op">=</span> df_anios.dropna()</span>
<span id="cb89-1935"><a href="#cb89-1935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1936"><a href="#cb89-1936" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb89-1937"><a href="#cb89-1937" aria-hidden="true" tabindex="-1"></a>    plt.plot(df_anios[<span class="st">'Variable'</span>], df_anios[<span class="st">'Valor'</span>], marker<span class="op">=</span><span class="st">'o'</span>, linestyle<span class="op">=</span><span class="st">'None'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span>plot_label)</span>
<span id="cb89-1938"><a href="#cb89-1938" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-1939"><a href="#cb89-1939" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(df_anios)):</span>
<span id="cb89-1940"><a href="#cb89-1940" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> df_anios[<span class="st">'Variable'</span>].iloc[i] <span class="op">-</span> df_anios[<span class="st">'Variable'</span>].iloc[i<span class="op">-</span><span class="dv">1</span>] <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb89-1941"><a href="#cb89-1941" aria-hidden="true" tabindex="-1"></a>            plt.plot(df_anios[<span class="st">'Variable'</span>].iloc[i<span class="op">-</span><span class="dv">1</span>:i<span class="op">+</span><span class="dv">1</span>], df_anios[<span class="st">'Valor'</span>].iloc[i<span class="op">-</span><span class="dv">1</span>:i<span class="op">+</span><span class="dv">1</span>], linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb89-1942"><a href="#cb89-1942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1943"><a href="#cb89-1943" aria-hidden="true" tabindex="-1"></a>    line <span class="op">=</span> slope <span class="op">*</span> df_anios[<span class="st">'Variable'</span>] <span class="op">+</span> intercept</span>
<span id="cb89-1944"><a href="#cb89-1944" aria-hidden="true" tabindex="-1"></a>    plt.plot(df_anios[<span class="st">'Variable'</span>], line, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Regression'</span>)</span>
<span id="cb89-1945"><a href="#cb89-1945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1946"><a href="#cb89-1946" aria-hidden="true" tabindex="-1"></a>    plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb89-1947"><a href="#cb89-1947" aria-hidden="true" tabindex="-1"></a>    <span class="co">#plt.title(f'{plot_label} ({station_code})', fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb89-1948"><a href="#cb89-1948" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Year'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1949"><a href="#cb89-1949" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Flow (m3/s)'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1950"><a href="#cb89-1950" aria-hidden="true" tabindex="-1"></a>    plt.xticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1951"><a href="#cb89-1951" aria-hidden="true" tabindex="-1"></a>    plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-1952"><a href="#cb89-1952" aria-hidden="true" tabindex="-1"></a>    plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.35</span>, <span class="fl">0.95</span>), fontsize<span class="op">=</span><span class="dv">14</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb89-1953"><a href="#cb89-1953" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">False</span>)</span>
<span id="cb89-1954"><a href="#cb89-1954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1955"><a href="#cb89-1955" aria-hidden="true" tabindex="-1"></a>    info_text <span class="op">=</span> <span class="ss">f'Slope: </span><span class="sc">{</span>slope<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">R-Squared: </span><span class="sc">{</span>r_squared<span class="sc">:.2f}</span><span class="ss">'</span></span>
<span id="cb89-1956"><a href="#cb89-1956" aria-hidden="true" tabindex="-1"></a>    plt.text(<span class="fl">1.15</span>, <span class="fl">0.65</span>, info_text, transform<span class="op">=</span>plt.gca().transAxes, fontsize<span class="op">=</span><span class="dv">14</span>,</span>
<span id="cb89-1957"><a href="#cb89-1957" aria-hidden="true" tabindex="-1"></a>             verticalalignment<span class="op">=</span><span class="st">'top'</span>, horizontalalignment<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb89-1958"><a href="#cb89-1958" aria-hidden="true" tabindex="-1"></a>             bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, boxstyle<span class="op">=</span><span class="st">'round,pad=0.5'</span>))</span>
<span id="cb89-1959"><a href="#cb89-1959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1960"><a href="#cb89-1960" aria-hidden="true" tabindex="-1"></a>    station_folder <span class="op">=</span> os.path.join(output_folder_path, station_code)</span>
<span id="cb89-1961"><a href="#cb89-1961" aria-hidden="true" tabindex="-1"></a>    os.makedirs(station_folder, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-1962"><a href="#cb89-1962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1963"><a href="#cb89-1963" aria-hidden="true" tabindex="-1"></a>    graph_filename <span class="op">=</span> os.path.join(station_folder, <span class="ss">f"</span><span class="sc">{</span>plot_label<span class="sc">.</span>lower()<span class="sc">.</span>replace(<span class="st">' '</span>, <span class="st">'_'</span>)<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.png"</span>)</span>
<span id="cb89-1964"><a href="#cb89-1964" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb89-1965"><a href="#cb89-1965" aria-hidden="true" tabindex="-1"></a>    plt.savefig(graph_filename)</span>
<span id="cb89-1966"><a href="#cb89-1966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1967"><a href="#cb89-1967" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"The CSV file and figure for station </span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss"> has been saved in </span><span class="sc">{</span>graph_filename<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb89-1968"><a href="#cb89-1968" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-1969"><a href="#cb89-1969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1970"><a href="#cb89-1970" aria-hidden="true" tabindex="-1"></a>6.3.1.4. Graph generation.</span>
<span id="cb89-1971"><a href="#cb89-1971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1974"><a href="#cb89-1974" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-1975"><a href="#cb89-1975" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-polar-16</span></span>
<span id="cb89-1976"><a href="#cb89-1976" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Median flow in July over time at station 9423001"</span></span>
<span id="cb89-1977"><a href="#cb89-1977" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_all_stations(base_folder_path, output_folder_path, indicator):</span>
<span id="cb89-1978"><a href="#cb89-1978" aria-hidden="true" tabindex="-1"></a>    station_folders <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(base_folder_path) <span class="cf">if</span> os.path.isdir(os.path.join(base_folder_path, f))]</span>
<span id="cb89-1979"><a href="#cb89-1979" aria-hidden="true" tabindex="-1"></a>    contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb89-1980"><a href="#cb89-1980" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-1981"><a href="#cb89-1981" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> station_code <span class="kw">in</span> station_folders:</span>
<span id="cb89-1982"><a href="#cb89-1982" aria-hidden="true" tabindex="-1"></a>        lsq_file <span class="op">=</span> os.path.join(base_folder_path, station_code, <span class="ss">f'lsq_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb89-1983"><a href="#cb89-1983" aria-hidden="true" tabindex="-1"></a>        ann_file <span class="op">=</span> os.path.join(base_folder_path, station_code, <span class="ss">f'ann_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb89-1984"><a href="#cb89-1984" aria-hidden="true" tabindex="-1"></a>        sco_file <span class="op">=</span> os.path.join(base_folder_path, station_code, <span class="ss">f'sco_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb89-1985"><a href="#cb89-1985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1986"><a href="#cb89-1986" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">all</span>(os.path.exists(f) <span class="cf">for</span> f <span class="kw">in</span> [lsq_file, ann_file, sco_file]):</span>
<span id="cb89-1987"><a href="#cb89-1987" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Missing files for station </span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">. Skipping station.'</span>)</span>
<span id="cb89-1988"><a href="#cb89-1988" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb89-1989"><a href="#cb89-1989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1990"><a href="#cb89-1990" aria-hidden="true" tabindex="-1"></a>        lsq_data, ann_data, sco_data <span class="op">=</span> extract_data(lsq_file, ann_file, sco_file, indicator)</span>
<span id="cb89-1991"><a href="#cb89-1991" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> lsq_data <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> ann_data <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> sco_data <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb89-1992"><a href="#cb89-1992" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb89-1993"><a href="#cb89-1993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1994"><a href="#cb89-1994" aria-hidden="true" tabindex="-1"></a>        output_file <span class="op">=</span> os.path.join(output_folder_path, <span class="ss">f"</span><span class="sc">{</span>indicator[<span class="st">'ann_column'</span>]<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv"</span>)</span>
<span id="cb89-1995"><a href="#cb89-1995" aria-hidden="true" tabindex="-1"></a>        save_to_csv(lsq_data, ann_data, sco_data, output_file)</span>
<span id="cb89-1996"><a href="#cb89-1996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-1997"><a href="#cb89-1997" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb89-1998"><a href="#cb89-1998" aria-hidden="true" tabindex="-1"></a>            df <span class="op">=</span> pd.read_csv(output_file, names<span class="op">=</span>[<span class="st">'Variable'</span>, <span class="st">'Valor'</span>], skiprows<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb89-1999"><a href="#cb89-1999" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">FileNotFoundError</span>:</span>
<span id="cb89-2000"><a href="#cb89-2000" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'File not found: </span><span class="sc">{</span>output_file<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb89-2001"><a href="#cb89-2001" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb89-2002"><a href="#cb89-2002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2003"><a href="#cb89-2003" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df.dropna()</span>
<span id="cb89-2004"><a href="#cb89-2004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2005"><a href="#cb89-2005" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb89-2006"><a href="#cb89-2006" aria-hidden="true" tabindex="-1"></a>            slope <span class="op">=</span> <span class="bu">float</span>(df[df[<span class="st">'Variable'</span>] <span class="op">==</span> <span class="st">'Slope'</span>][<span class="st">'Valor'</span>].values[<span class="dv">0</span>])</span>
<span id="cb89-2007"><a href="#cb89-2007" aria-hidden="true" tabindex="-1"></a>            intercept <span class="op">=</span> <span class="bu">float</span>(df[df[<span class="st">'Variable'</span>] <span class="op">==</span> <span class="st">'YInt'</span>][<span class="st">'Valor'</span>].values[<span class="dv">0</span>])</span>
<span id="cb89-2008"><a href="#cb89-2008" aria-hidden="true" tabindex="-1"></a>            r_squared <span class="op">=</span> <span class="bu">float</span>(df[df[<span class="st">'Variable'</span>] <span class="op">==</span> <span class="st">'R2'</span>][<span class="st">'Valor'</span>].values[<span class="dv">0</span>])</span>
<span id="cb89-2009"><a href="#cb89-2009" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> (<span class="pp">IndexError</span>, <span class="pp">ValueError</span>) <span class="im">as</span> e:</span>
<span id="cb89-2010"><a href="#cb89-2010" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Error extracting regression values: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb89-2011"><a href="#cb89-2011" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb89-2012"><a href="#cb89-2012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2013"><a href="#cb89-2013" aria-hidden="true" tabindex="-1"></a>        plot_data(df, slope, intercept, r_squared, station_code, indicator[<span class="st">'plot_label'</span>])</span>
<span id="cb89-2014"><a href="#cb89-2014" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-2015"><a href="#cb89-2015" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb89-2016"><a href="#cb89-2016" aria-hidden="true" tabindex="-1"></a>           plt.show()</span>
<span id="cb89-2017"><a href="#cb89-2017" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb89-2018"><a href="#cb89-2018" aria-hidden="true" tabindex="-1"></a>            plt.close()</span>
<span id="cb89-2019"><a href="#cb89-2019" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-2020"><a href="#cb89-2020" aria-hidden="true" tabindex="-1"></a>        contador <span class="op">+=</span> <span class="dv">1</span> </span>
<span id="cb89-2021"><a href="#cb89-2021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2022"><a href="#cb89-2022" aria-hidden="true" tabindex="-1"></a>process_all_stations(base_folder_path, output_folder_path, indicator_names)</span>
<span id="cb89-2023"><a href="#cb89-2023" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-2024"><a href="#cb89-2024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2025"><a href="#cb89-2025" aria-hidden="true" tabindex="-1"></a>6.3.2. High flow pulses duration by station</span>
<span id="cb89-2026"><a href="#cb89-2026" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2027"><a href="#cb89-2027" aria-hidden="true" tabindex="-1"></a>6.3.2.1. Reading input files and extracting specific data related to the selected indicator.</span>
<span id="cb89-2028"><a href="#cb89-2028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2031"><a href="#cb89-2031" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-2032"><a href="#cb89-2032" aria-hidden="true" tabindex="-1"></a>indicator_names <span class="op">=</span> {</span>
<span id="cb89-2033"><a href="#cb89-2033" aria-hidden="true" tabindex="-1"></a>    <span class="st">'lsq_row'</span>: <span class="st">'High pulse duration'</span>,              </span>
<span id="cb89-2034"><a href="#cb89-2034" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ann_column'</span>: <span class="st">'Hi pulse L'</span>,           </span>
<span id="cb89-2035"><a href="#cb89-2035" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sco_row'</span>: <span class="st">'High pulse duration'</span>,              </span>
<span id="cb89-2036"><a href="#cb89-2036" aria-hidden="true" tabindex="-1"></a>    <span class="st">'plot_label'</span>: <span class="st">'High pulse duration'</span>            </span>
<span id="cb89-2037"><a href="#cb89-2037" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb89-2038"><a href="#cb89-2038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2039"><a href="#cb89-2039" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_data(lsq_file, ann_file, sco_file, indicator):</span>
<span id="cb89-2040"><a href="#cb89-2040" aria-hidden="true" tabindex="-1"></a>    lsq_data <span class="op">=</span> pd.read_csv(lsq_file, skiprows<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb89-2041"><a href="#cb89-2041" aria-hidden="true" tabindex="-1"></a>    lsq_data.set_index(lsq_data.columns[<span class="dv">0</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-2042"><a href="#cb89-2042" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb89-2043"><a href="#cb89-2043" aria-hidden="true" tabindex="-1"></a>        lsq_selected <span class="op">=</span> lsq_data.loc[indicator[<span class="st">'lsq_row'</span>], [<span class="st">'Slope'</span>, <span class="st">'YInt'</span>, <span class="st">'Sigma'</span>, <span class="st">'Corr'</span>, <span class="st">'PValue'</span>, <span class="st">'FStat'</span>, <span class="st">'R2'</span>]]</span>
<span id="cb89-2044"><a href="#cb89-2044" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">KeyError</span>:</span>
<span id="cb89-2045"><a href="#cb89-2045" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Indicator '</span><span class="sc">{</span>indicator[<span class="st">'lsq_row'</span>]<span class="sc">}</span><span class="ss">' not found in lsq_file."</span>)</span>
<span id="cb89-2046"><a href="#cb89-2046" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb89-2047"><a href="#cb89-2047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2048"><a href="#cb89-2048" aria-hidden="true" tabindex="-1"></a>    ann_data <span class="op">=</span> pd.read_csv(ann_file, skiprows<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb89-2049"><a href="#cb89-2049" aria-hidden="true" tabindex="-1"></a>    ann_data.columns <span class="op">=</span> ann_data.columns.<span class="bu">str</span>.strip()</span>
<span id="cb89-2050"><a href="#cb89-2050" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> indicator[<span class="st">'ann_column'</span>] <span class="kw">not</span> <span class="kw">in</span> ann_data.columns:</span>
<span id="cb89-2051"><a href="#cb89-2051" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Column '</span><span class="sc">{</span>indicator[<span class="st">'ann_column'</span>]<span class="sc">}</span><span class="ss">' not found in ann_file."</span>)</span>
<span id="cb89-2052"><a href="#cb89-2052" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb89-2053"><a href="#cb89-2053" aria-hidden="true" tabindex="-1"></a>    ann_data <span class="op">=</span> ann_data[[<span class="st">'Year'</span>, indicator[<span class="st">'ann_column'</span>]]].dropna()</span>
<span id="cb89-2054"><a href="#cb89-2054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2055"><a href="#cb89-2055" aria-hidden="true" tabindex="-1"></a>    sco_data <span class="op">=</span> pd.read_csv(sco_file, skiprows<span class="op">=</span><span class="dv">48</span>, nrows<span class="op">=</span><span class="dv">13</span>, header<span class="op">=</span><span class="va">None</span>, index_col<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb89-2056"><a href="#cb89-2056" aria-hidden="true" tabindex="-1"></a>    sco_data.index.name <span class="op">=</span> <span class="st">'Parameter'</span></span>
<span id="cb89-2057"><a href="#cb89-2057" aria-hidden="true" tabindex="-1"></a>    sco_data.columns <span class="op">=</span> [<span class="st">'Mediana'</span>, <span class="st">'Coef. Disper.'</span>]</span>
<span id="cb89-2058"><a href="#cb89-2058" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> indicator[<span class="st">'sco_row'</span>] <span class="kw">not</span> <span class="kw">in</span> sco_data.index:</span>
<span id="cb89-2059"><a href="#cb89-2059" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Indicator '</span><span class="sc">{</span>indicator[<span class="st">'sco_row'</span>]<span class="sc">}</span><span class="ss">' not found in sco_file."</span>)</span>
<span id="cb89-2060"><a href="#cb89-2060" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb89-2061"><a href="#cb89-2061" aria-hidden="true" tabindex="-1"></a>    sco_selected <span class="op">=</span> sco_data.loc[[indicator[<span class="st">'sco_row'</span>]]]</span>
<span id="cb89-2062"><a href="#cb89-2062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2063"><a href="#cb89-2063" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> lsq_selected, ann_data, sco_selected</span>
<span id="cb89-2064"><a href="#cb89-2064" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-2065"><a href="#cb89-2065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2066"><a href="#cb89-2066" aria-hidden="true" tabindex="-1"></a>6.3.2.2. Saving the extracted data in a single <span class="in">`.csv`</span> file.</span>
<span id="cb89-2067"><a href="#cb89-2067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2070"><a href="#cb89-2070" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-2071"><a href="#cb89-2071" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> save_to_csv(lsq_data, ann_data, sco_data, output_file):</span>
<span id="cb89-2072"><a href="#cb89-2072" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(output_file, <span class="st">'w'</span>, newline<span class="op">=</span><span class="st">''</span>) <span class="im">as</span> csvfile:</span>
<span id="cb89-2073"><a href="#cb89-2073" aria-hidden="true" tabindex="-1"></a>        writer <span class="op">=</span> csv.writer(csvfile)</span>
<span id="cb89-2074"><a href="#cb89-2074" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-2075"><a href="#cb89-2075" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Variable'</span>, <span class="st">'Valor'</span>])</span>
<span id="cb89-2076"><a href="#cb89-2076" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, value <span class="kw">in</span> lsq_data.items():</span>
<span id="cb89-2077"><a href="#cb89-2077" aria-hidden="true" tabindex="-1"></a>            writer.writerow([idx, value])</span>
<span id="cb89-2078"><a href="#cb89-2078" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-2079"><a href="#cb89-2079" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Year'</span>, indicator_names[<span class="st">'ann_column'</span>]])</span>
<span id="cb89-2080"><a href="#cb89-2080" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _, row <span class="kw">in</span> ann_data.iterrows():</span>
<span id="cb89-2081"><a href="#cb89-2081" aria-hidden="true" tabindex="-1"></a>            writer.writerow([<span class="bu">int</span>(row[<span class="st">'Year'</span>]), row[indicator_names[<span class="st">'ann_column'</span>]]])</span>
<span id="cb89-2082"><a href="#cb89-2082" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-2083"><a href="#cb89-2083" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Mediana'</span>, sco_data[<span class="st">'Mediana'</span>].values[<span class="dv">0</span>]])</span>
<span id="cb89-2084"><a href="#cb89-2084" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Coef. Disper.'</span>, sco_data[<span class="st">'Coef. Disper.'</span>].values[<span class="dv">0</span>]])</span>
<span id="cb89-2085"><a href="#cb89-2085" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-2086"><a href="#cb89-2086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2087"><a href="#cb89-2087" aria-hidden="true" tabindex="-1"></a>6.3.2.3. Graph format.</span>
<span id="cb89-2088"><a href="#cb89-2088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2091"><a href="#cb89-2091" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-2092"><a href="#cb89-2092" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_data(df, slope, intercept, r_squared, station_code, plot_label):</span>
<span id="cb89-2093"><a href="#cb89-2093" aria-hidden="true" tabindex="-1"></a>    df_anios <span class="op">=</span> df[(df[<span class="st">'Variable'</span>].<span class="bu">str</span>.isnumeric()) <span class="op">&amp;</span> (df[<span class="st">'Valor'</span>].notna())].copy()</span>
<span id="cb89-2094"><a href="#cb89-2094" aria-hidden="true" tabindex="-1"></a>    df_anios[<span class="st">'Variable'</span>] <span class="op">=</span> pd.to_numeric(df_anios[<span class="st">'Variable'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb89-2095"><a href="#cb89-2095" aria-hidden="true" tabindex="-1"></a>    df_anios[<span class="st">'Valor'</span>] <span class="op">=</span> pd.to_numeric(df_anios[<span class="st">'Valor'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb89-2096"><a href="#cb89-2096" aria-hidden="true" tabindex="-1"></a>    df_anios <span class="op">=</span> df_anios.dropna()</span>
<span id="cb89-2097"><a href="#cb89-2097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2098"><a href="#cb89-2098" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb89-2099"><a href="#cb89-2099" aria-hidden="true" tabindex="-1"></a>    plt.plot(df_anios[<span class="st">'Variable'</span>], df_anios[<span class="st">'Valor'</span>], marker<span class="op">=</span><span class="st">'o'</span>, linestyle<span class="op">=</span><span class="st">'None'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span>plot_label)</span>
<span id="cb89-2100"><a href="#cb89-2100" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-2101"><a href="#cb89-2101" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(df_anios)):</span>
<span id="cb89-2102"><a href="#cb89-2102" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> df_anios[<span class="st">'Variable'</span>].iloc[i] <span class="op">-</span> df_anios[<span class="st">'Variable'</span>].iloc[i<span class="op">-</span><span class="dv">1</span>] <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb89-2103"><a href="#cb89-2103" aria-hidden="true" tabindex="-1"></a>            plt.plot(df_anios[<span class="st">'Variable'</span>].iloc[i<span class="op">-</span><span class="dv">1</span>:i<span class="op">+</span><span class="dv">1</span>], df_anios[<span class="st">'Valor'</span>].iloc[i<span class="op">-</span><span class="dv">1</span>:i<span class="op">+</span><span class="dv">1</span>], linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb89-2104"><a href="#cb89-2104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2105"><a href="#cb89-2105" aria-hidden="true" tabindex="-1"></a>    line <span class="op">=</span> slope <span class="op">*</span> df_anios[<span class="st">'Variable'</span>] <span class="op">+</span> intercept</span>
<span id="cb89-2106"><a href="#cb89-2106" aria-hidden="true" tabindex="-1"></a>    plt.plot(df_anios[<span class="st">'Variable'</span>], line, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Regression'</span>)</span>
<span id="cb89-2107"><a href="#cb89-2107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2108"><a href="#cb89-2108" aria-hidden="true" tabindex="-1"></a>    plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb89-2109"><a href="#cb89-2109" aria-hidden="true" tabindex="-1"></a>    <span class="co">#plt.title(f'{plot_label} ({station_code})', fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb89-2110"><a href="#cb89-2110" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Year'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-2111"><a href="#cb89-2111" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Days'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-2112"><a href="#cb89-2112" aria-hidden="true" tabindex="-1"></a>    plt.xticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-2113"><a href="#cb89-2113" aria-hidden="true" tabindex="-1"></a>    plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-2114"><a href="#cb89-2114" aria-hidden="true" tabindex="-1"></a>    plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.35</span>, <span class="fl">0.95</span>), fontsize<span class="op">=</span><span class="dv">14</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb89-2115"><a href="#cb89-2115" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">False</span>)</span>
<span id="cb89-2116"><a href="#cb89-2116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2117"><a href="#cb89-2117" aria-hidden="true" tabindex="-1"></a>    info_text <span class="op">=</span> <span class="ss">f'Slope: </span><span class="sc">{</span>slope<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">R-Squared: </span><span class="sc">{</span>r_squared<span class="sc">:.2f}</span><span class="ss">'</span></span>
<span id="cb89-2118"><a href="#cb89-2118" aria-hidden="true" tabindex="-1"></a>    plt.text(<span class="fl">1.15</span>, <span class="fl">0.65</span>, info_text, transform<span class="op">=</span>plt.gca().transAxes, fontsize<span class="op">=</span><span class="dv">14</span>,</span>
<span id="cb89-2119"><a href="#cb89-2119" aria-hidden="true" tabindex="-1"></a>             verticalalignment<span class="op">=</span><span class="st">'top'</span>, horizontalalignment<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb89-2120"><a href="#cb89-2120" aria-hidden="true" tabindex="-1"></a>             bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, boxstyle<span class="op">=</span><span class="st">'round,pad=0.5'</span>))</span>
<span id="cb89-2121"><a href="#cb89-2121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2122"><a href="#cb89-2122" aria-hidden="true" tabindex="-1"></a>    station_folder <span class="op">=</span> os.path.join(output_folder_path, station_code)</span>
<span id="cb89-2123"><a href="#cb89-2123" aria-hidden="true" tabindex="-1"></a>    os.makedirs(station_folder, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-2124"><a href="#cb89-2124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2125"><a href="#cb89-2125" aria-hidden="true" tabindex="-1"></a>    graph_filename <span class="op">=</span> os.path.join(station_folder, <span class="ss">f"</span><span class="sc">{</span>plot_label<span class="sc">.</span>lower()<span class="sc">.</span>replace(<span class="st">' '</span>, <span class="st">'_'</span>)<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.png"</span>)</span>
<span id="cb89-2126"><a href="#cb89-2126" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb89-2127"><a href="#cb89-2127" aria-hidden="true" tabindex="-1"></a>    plt.savefig(graph_filename)</span>
<span id="cb89-2128"><a href="#cb89-2128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2129"><a href="#cb89-2129" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"The CSV files and figure for station </span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss"> has been saved in </span><span class="sc">{</span>graph_filename<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb89-2130"><a href="#cb89-2130" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-2131"><a href="#cb89-2131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2132"><a href="#cb89-2132" aria-hidden="true" tabindex="-1"></a>6.3.2.4. Graph generation.</span>
<span id="cb89-2133"><a href="#cb89-2133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2136"><a href="#cb89-2136" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-2137"><a href="#cb89-2137" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-polar-17</span></span>
<span id="cb89-2138"><a href="#cb89-2138" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "High flow pulses duration over time at station 9423001"</span></span>
<span id="cb89-2139"><a href="#cb89-2139" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_all_stations(base_folder_path, output_folder_path, indicator):</span>
<span id="cb89-2140"><a href="#cb89-2140" aria-hidden="true" tabindex="-1"></a>    station_folders <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(base_folder_path) <span class="cf">if</span> os.path.isdir(os.path.join(base_folder_path, f))]</span>
<span id="cb89-2141"><a href="#cb89-2141" aria-hidden="true" tabindex="-1"></a>    contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb89-2142"><a href="#cb89-2142" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-2143"><a href="#cb89-2143" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> station_code <span class="kw">in</span> station_folders:</span>
<span id="cb89-2144"><a href="#cb89-2144" aria-hidden="true" tabindex="-1"></a>        lsq_file <span class="op">=</span> os.path.join(base_folder_path, station_code, <span class="ss">f'lsq_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb89-2145"><a href="#cb89-2145" aria-hidden="true" tabindex="-1"></a>        ann_file <span class="op">=</span> os.path.join(base_folder_path, station_code, <span class="ss">f'ann_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb89-2146"><a href="#cb89-2146" aria-hidden="true" tabindex="-1"></a>        sco_file <span class="op">=</span> os.path.join(base_folder_path, station_code, <span class="ss">f'sco_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb89-2147"><a href="#cb89-2147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2148"><a href="#cb89-2148" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">all</span>(os.path.exists(f) <span class="cf">for</span> f <span class="kw">in</span> [lsq_file, ann_file, sco_file]):</span>
<span id="cb89-2149"><a href="#cb89-2149" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Missing files for station </span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">. Skipping station.'</span>)</span>
<span id="cb89-2150"><a href="#cb89-2150" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb89-2151"><a href="#cb89-2151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2152"><a href="#cb89-2152" aria-hidden="true" tabindex="-1"></a>        lsq_data, ann_data, sco_data <span class="op">=</span> extract_data(lsq_file, ann_file, sco_file, indicator)</span>
<span id="cb89-2153"><a href="#cb89-2153" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> lsq_data <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> ann_data <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> sco_data <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb89-2154"><a href="#cb89-2154" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb89-2155"><a href="#cb89-2155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2156"><a href="#cb89-2156" aria-hidden="true" tabindex="-1"></a>        output_file <span class="op">=</span> os.path.join(output_folder_path, <span class="ss">f"</span><span class="sc">{</span>indicator[<span class="st">'ann_column'</span>]<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv"</span>)</span>
<span id="cb89-2157"><a href="#cb89-2157" aria-hidden="true" tabindex="-1"></a>        save_to_csv(lsq_data, ann_data, sco_data, output_file)</span>
<span id="cb89-2158"><a href="#cb89-2158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2159"><a href="#cb89-2159" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb89-2160"><a href="#cb89-2160" aria-hidden="true" tabindex="-1"></a>            df <span class="op">=</span> pd.read_csv(output_file, names<span class="op">=</span>[<span class="st">'Variable'</span>, <span class="st">'Valor'</span>], skiprows<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb89-2161"><a href="#cb89-2161" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">FileNotFoundError</span>:</span>
<span id="cb89-2162"><a href="#cb89-2162" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'File not found: </span><span class="sc">{</span>output_file<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb89-2163"><a href="#cb89-2163" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb89-2164"><a href="#cb89-2164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2165"><a href="#cb89-2165" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df.dropna()</span>
<span id="cb89-2166"><a href="#cb89-2166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2167"><a href="#cb89-2167" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb89-2168"><a href="#cb89-2168" aria-hidden="true" tabindex="-1"></a>            slope <span class="op">=</span> <span class="bu">float</span>(df[df[<span class="st">'Variable'</span>] <span class="op">==</span> <span class="st">'Slope'</span>][<span class="st">'Valor'</span>].values[<span class="dv">0</span>])</span>
<span id="cb89-2169"><a href="#cb89-2169" aria-hidden="true" tabindex="-1"></a>            intercept <span class="op">=</span> <span class="bu">float</span>(df[df[<span class="st">'Variable'</span>] <span class="op">==</span> <span class="st">'YInt'</span>][<span class="st">'Valor'</span>].values[<span class="dv">0</span>])</span>
<span id="cb89-2170"><a href="#cb89-2170" aria-hidden="true" tabindex="-1"></a>            r_squared <span class="op">=</span> <span class="bu">float</span>(df[df[<span class="st">'Variable'</span>] <span class="op">==</span> <span class="st">'R2'</span>][<span class="st">'Valor'</span>].values[<span class="dv">0</span>])</span>
<span id="cb89-2171"><a href="#cb89-2171" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> (<span class="pp">IndexError</span>, <span class="pp">ValueError</span>) <span class="im">as</span> e:</span>
<span id="cb89-2172"><a href="#cb89-2172" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Error extracting regression values: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb89-2173"><a href="#cb89-2173" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb89-2174"><a href="#cb89-2174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2175"><a href="#cb89-2175" aria-hidden="true" tabindex="-1"></a>        plot_data(df, slope, intercept, r_squared, station_code, indicator[<span class="st">'plot_label'</span>])</span>
<span id="cb89-2176"><a href="#cb89-2176" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-2177"><a href="#cb89-2177" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb89-2178"><a href="#cb89-2178" aria-hidden="true" tabindex="-1"></a>           plt.show()</span>
<span id="cb89-2179"><a href="#cb89-2179" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb89-2180"><a href="#cb89-2180" aria-hidden="true" tabindex="-1"></a>            plt.close()</span>
<span id="cb89-2181"><a href="#cb89-2181" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-2182"><a href="#cb89-2182" aria-hidden="true" tabindex="-1"></a>        contador <span class="op">+=</span> <span class="dv">1</span> </span>
<span id="cb89-2183"><a href="#cb89-2183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2184"><a href="#cb89-2184" aria-hidden="true" tabindex="-1"></a>process_all_stations(base_folder_path, output_folder_path, indicator_names)</span>
<span id="cb89-2185"><a href="#cb89-2185" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-2186"><a href="#cb89-2186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2187"><a href="#cb89-2187" aria-hidden="true" tabindex="-1"></a>6.3.3. Base Flow Index by station</span>
<span id="cb89-2188"><a href="#cb89-2188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2189"><a href="#cb89-2189" aria-hidden="true" tabindex="-1"></a>6.3.3.1. Reading input files and extracting specific data related to the selected indicator.</span>
<span id="cb89-2190"><a href="#cb89-2190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2193"><a href="#cb89-2193" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-2194"><a href="#cb89-2194" aria-hidden="true" tabindex="-1"></a>indicator_names <span class="op">=</span> {</span>
<span id="cb89-2195"><a href="#cb89-2195" aria-hidden="true" tabindex="-1"></a>    <span class="st">'lsq_row'</span>: <span class="st">'Base flow index'</span>,              </span>
<span id="cb89-2196"><a href="#cb89-2196" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ann_column'</span>: <span class="st">'Base flow'</span>,           </span>
<span id="cb89-2197"><a href="#cb89-2197" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sco_row'</span>: <span class="st">'Base flow index'</span>,              </span>
<span id="cb89-2198"><a href="#cb89-2198" aria-hidden="true" tabindex="-1"></a>    <span class="st">'plot_label'</span>: <span class="st">'Base flow index'</span>            </span>
<span id="cb89-2199"><a href="#cb89-2199" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb89-2200"><a href="#cb89-2200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2201"><a href="#cb89-2201" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_data(lsq_file, ann_file, sco_file, indicator):</span>
<span id="cb89-2202"><a href="#cb89-2202" aria-hidden="true" tabindex="-1"></a>    lsq_data <span class="op">=</span> pd.read_csv(lsq_file, skiprows<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb89-2203"><a href="#cb89-2203" aria-hidden="true" tabindex="-1"></a>    lsq_data.set_index(lsq_data.columns[<span class="dv">0</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-2204"><a href="#cb89-2204" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb89-2205"><a href="#cb89-2205" aria-hidden="true" tabindex="-1"></a>        lsq_selected <span class="op">=</span> lsq_data.loc[indicator[<span class="st">'lsq_row'</span>], [<span class="st">'Slope'</span>, <span class="st">'YInt'</span>, <span class="st">'Sigma'</span>, <span class="st">'Corr'</span>, <span class="st">'PValue'</span>, <span class="st">'FStat'</span>, <span class="st">'R2'</span>]]</span>
<span id="cb89-2206"><a href="#cb89-2206" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">KeyError</span>:</span>
<span id="cb89-2207"><a href="#cb89-2207" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Indicator '</span><span class="sc">{</span>indicator[<span class="st">'lsq_row'</span>]<span class="sc">}</span><span class="ss">' not found in lsq_file."</span>)</span>
<span id="cb89-2208"><a href="#cb89-2208" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb89-2209"><a href="#cb89-2209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2210"><a href="#cb89-2210" aria-hidden="true" tabindex="-1"></a>    ann_data <span class="op">=</span> pd.read_csv(ann_file, skiprows<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb89-2211"><a href="#cb89-2211" aria-hidden="true" tabindex="-1"></a>    ann_data.columns <span class="op">=</span> ann_data.columns.<span class="bu">str</span>.strip()</span>
<span id="cb89-2212"><a href="#cb89-2212" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> indicator[<span class="st">'ann_column'</span>] <span class="kw">not</span> <span class="kw">in</span> ann_data.columns:</span>
<span id="cb89-2213"><a href="#cb89-2213" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Column '</span><span class="sc">{</span>indicator[<span class="st">'ann_column'</span>]<span class="sc">}</span><span class="ss">' not found in ann_file."</span>)</span>
<span id="cb89-2214"><a href="#cb89-2214" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb89-2215"><a href="#cb89-2215" aria-hidden="true" tabindex="-1"></a>    ann_data <span class="op">=</span> ann_data[[<span class="st">'Year'</span>, indicator[<span class="st">'ann_column'</span>]]].dropna()</span>
<span id="cb89-2216"><a href="#cb89-2216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2217"><a href="#cb89-2217" aria-hidden="true" tabindex="-1"></a>    sco_data <span class="op">=</span> pd.read_csv(sco_file, skiprows<span class="op">=</span><span class="dv">30</span>, nrows<span class="op">=</span><span class="dv">13</span>, header<span class="op">=</span><span class="va">None</span>, index_col<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb89-2218"><a href="#cb89-2218" aria-hidden="true" tabindex="-1"></a>    sco_data.index.name <span class="op">=</span> <span class="st">'Parameter'</span></span>
<span id="cb89-2219"><a href="#cb89-2219" aria-hidden="true" tabindex="-1"></a>    sco_data.columns <span class="op">=</span> [<span class="st">'Mediana'</span>, <span class="st">'Coef. Disper.'</span>]</span>
<span id="cb89-2220"><a href="#cb89-2220" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> indicator[<span class="st">'sco_row'</span>] <span class="kw">not</span> <span class="kw">in</span> sco_data.index:</span>
<span id="cb89-2221"><a href="#cb89-2221" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Indicator '</span><span class="sc">{</span>indicator[<span class="st">'sco_row'</span>]<span class="sc">}</span><span class="ss">' not found in sco_file."</span>)</span>
<span id="cb89-2222"><a href="#cb89-2222" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb89-2223"><a href="#cb89-2223" aria-hidden="true" tabindex="-1"></a>    sco_selected <span class="op">=</span> sco_data.loc[[indicator[<span class="st">'sco_row'</span>]]]</span>
<span id="cb89-2224"><a href="#cb89-2224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2225"><a href="#cb89-2225" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> lsq_selected, ann_data, sco_selected</span>
<span id="cb89-2226"><a href="#cb89-2226" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-2227"><a href="#cb89-2227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2228"><a href="#cb89-2228" aria-hidden="true" tabindex="-1"></a>6.3.3.2. Saving the extracted data in a single <span class="in">`.csv`</span> file.</span>
<span id="cb89-2229"><a href="#cb89-2229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2232"><a href="#cb89-2232" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-2233"><a href="#cb89-2233" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> save_to_csv(lsq_data, ann_data, sco_data, output_file):</span>
<span id="cb89-2234"><a href="#cb89-2234" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(output_file, <span class="st">'w'</span>, newline<span class="op">=</span><span class="st">''</span>) <span class="im">as</span> csvfile:</span>
<span id="cb89-2235"><a href="#cb89-2235" aria-hidden="true" tabindex="-1"></a>        writer <span class="op">=</span> csv.writer(csvfile)</span>
<span id="cb89-2236"><a href="#cb89-2236" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-2237"><a href="#cb89-2237" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Variable'</span>, <span class="st">'Valor'</span>])</span>
<span id="cb89-2238"><a href="#cb89-2238" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, value <span class="kw">in</span> lsq_data.items():</span>
<span id="cb89-2239"><a href="#cb89-2239" aria-hidden="true" tabindex="-1"></a>            writer.writerow([idx, value])</span>
<span id="cb89-2240"><a href="#cb89-2240" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-2241"><a href="#cb89-2241" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Year'</span>, indicator_names[<span class="st">'ann_column'</span>]])</span>
<span id="cb89-2242"><a href="#cb89-2242" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _, row <span class="kw">in</span> ann_data.iterrows():</span>
<span id="cb89-2243"><a href="#cb89-2243" aria-hidden="true" tabindex="-1"></a>            writer.writerow([<span class="bu">int</span>(row[<span class="st">'Year'</span>]), row[indicator_names[<span class="st">'ann_column'</span>]]])</span>
<span id="cb89-2244"><a href="#cb89-2244" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-2245"><a href="#cb89-2245" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Mediana'</span>, sco_data[<span class="st">'Mediana'</span>].values[<span class="dv">0</span>]])</span>
<span id="cb89-2246"><a href="#cb89-2246" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Coef. Disper.'</span>, sco_data[<span class="st">'Coef. Disper.'</span>].values[<span class="dv">0</span>]])</span>
<span id="cb89-2247"><a href="#cb89-2247" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-2248"><a href="#cb89-2248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2249"><a href="#cb89-2249" aria-hidden="true" tabindex="-1"></a>6.3.3.3. Graph format.</span>
<span id="cb89-2250"><a href="#cb89-2250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2253"><a href="#cb89-2253" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-2254"><a href="#cb89-2254" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_data(df, slope, intercept, r_squared, station_code, plot_label):</span>
<span id="cb89-2255"><a href="#cb89-2255" aria-hidden="true" tabindex="-1"></a>    df_anios <span class="op">=</span> df[(df[<span class="st">'Variable'</span>].<span class="bu">str</span>.isnumeric()) <span class="op">&amp;</span> (df[<span class="st">'Valor'</span>].notna())].copy()</span>
<span id="cb89-2256"><a href="#cb89-2256" aria-hidden="true" tabindex="-1"></a>    df_anios[<span class="st">'Variable'</span>] <span class="op">=</span> pd.to_numeric(df_anios[<span class="st">'Variable'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb89-2257"><a href="#cb89-2257" aria-hidden="true" tabindex="-1"></a>    df_anios[<span class="st">'Valor'</span>] <span class="op">=</span> pd.to_numeric(df_anios[<span class="st">'Valor'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb89-2258"><a href="#cb89-2258" aria-hidden="true" tabindex="-1"></a>    df_anios <span class="op">=</span> df_anios.dropna()</span>
<span id="cb89-2259"><a href="#cb89-2259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2260"><a href="#cb89-2260" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb89-2261"><a href="#cb89-2261" aria-hidden="true" tabindex="-1"></a>    plt.plot(df_anios[<span class="st">'Variable'</span>], df_anios[<span class="st">'Valor'</span>], marker<span class="op">=</span><span class="st">'o'</span>, linestyle<span class="op">=</span><span class="st">'None'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span>plot_label)</span>
<span id="cb89-2262"><a href="#cb89-2262" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-2263"><a href="#cb89-2263" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(df_anios)):</span>
<span id="cb89-2264"><a href="#cb89-2264" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> df_anios[<span class="st">'Variable'</span>].iloc[i] <span class="op">-</span> df_anios[<span class="st">'Variable'</span>].iloc[i<span class="op">-</span><span class="dv">1</span>] <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb89-2265"><a href="#cb89-2265" aria-hidden="true" tabindex="-1"></a>            plt.plot(df_anios[<span class="st">'Variable'</span>].iloc[i<span class="op">-</span><span class="dv">1</span>:i<span class="op">+</span><span class="dv">1</span>], df_anios[<span class="st">'Valor'</span>].iloc[i<span class="op">-</span><span class="dv">1</span>:i<span class="op">+</span><span class="dv">1</span>], linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb89-2266"><a href="#cb89-2266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2267"><a href="#cb89-2267" aria-hidden="true" tabindex="-1"></a>    line <span class="op">=</span> slope <span class="op">*</span> df_anios[<span class="st">'Variable'</span>] <span class="op">+</span> intercept</span>
<span id="cb89-2268"><a href="#cb89-2268" aria-hidden="true" tabindex="-1"></a>    plt.plot(df_anios[<span class="st">'Variable'</span>], line, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Regression'</span>)</span>
<span id="cb89-2269"><a href="#cb89-2269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2270"><a href="#cb89-2270" aria-hidden="true" tabindex="-1"></a>    plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb89-2271"><a href="#cb89-2271" aria-hidden="true" tabindex="-1"></a>    <span class="co">#plt.title(f'{plot_label} ({station_code})', fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb89-2272"><a href="#cb89-2272" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Year'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-2273"><a href="#cb89-2273" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'BFI'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-2274"><a href="#cb89-2274" aria-hidden="true" tabindex="-1"></a>    plt.xticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-2275"><a href="#cb89-2275" aria-hidden="true" tabindex="-1"></a>    plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-2276"><a href="#cb89-2276" aria-hidden="true" tabindex="-1"></a>    plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.35</span>, <span class="fl">0.95</span>), fontsize<span class="op">=</span><span class="dv">14</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb89-2277"><a href="#cb89-2277" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">False</span>)</span>
<span id="cb89-2278"><a href="#cb89-2278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2279"><a href="#cb89-2279" aria-hidden="true" tabindex="-1"></a>    info_text <span class="op">=</span> <span class="ss">f'Slope: </span><span class="sc">{</span>slope<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">R-Squared: </span><span class="sc">{</span>r_squared<span class="sc">:.2f}</span><span class="ss">'</span></span>
<span id="cb89-2280"><a href="#cb89-2280" aria-hidden="true" tabindex="-1"></a>    plt.text(<span class="fl">1.15</span>, <span class="fl">0.65</span>, info_text, transform<span class="op">=</span>plt.gca().transAxes, fontsize<span class="op">=</span><span class="dv">14</span>,</span>
<span id="cb89-2281"><a href="#cb89-2281" aria-hidden="true" tabindex="-1"></a>             verticalalignment<span class="op">=</span><span class="st">'top'</span>, horizontalalignment<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb89-2282"><a href="#cb89-2282" aria-hidden="true" tabindex="-1"></a>             bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, boxstyle<span class="op">=</span><span class="st">'round,pad=0.5'</span>))</span>
<span id="cb89-2283"><a href="#cb89-2283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2284"><a href="#cb89-2284" aria-hidden="true" tabindex="-1"></a>    station_folder <span class="op">=</span> os.path.join(output_folder_path, station_code)</span>
<span id="cb89-2285"><a href="#cb89-2285" aria-hidden="true" tabindex="-1"></a>    os.makedirs(station_folder, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-2286"><a href="#cb89-2286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2287"><a href="#cb89-2287" aria-hidden="true" tabindex="-1"></a>    graph_filename <span class="op">=</span> os.path.join(station_folder, <span class="ss">f"</span><span class="sc">{</span>plot_label<span class="sc">.</span>lower()<span class="sc">.</span>replace(<span class="st">' '</span>, <span class="st">'_'</span>)<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.png"</span>)</span>
<span id="cb89-2288"><a href="#cb89-2288" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb89-2289"><a href="#cb89-2289" aria-hidden="true" tabindex="-1"></a>    plt.savefig(graph_filename)</span>
<span id="cb89-2290"><a href="#cb89-2290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2291"><a href="#cb89-2291" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"The CSV files and figure for station </span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss"> has been saved in </span><span class="sc">{</span>graph_filename<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb89-2292"><a href="#cb89-2292" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-2293"><a href="#cb89-2293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2294"><a href="#cb89-2294" aria-hidden="true" tabindex="-1"></a>6.3.3.4. Graph generation.</span>
<span id="cb89-2295"><a href="#cb89-2295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2298"><a href="#cb89-2298" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-2299"><a href="#cb89-2299" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-polar-18</span></span>
<span id="cb89-2300"><a href="#cb89-2300" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Base Flow Index over time at station 9423001"</span></span>
<span id="cb89-2301"><a href="#cb89-2301" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_all_stations(base_folder_path, output_folder_path, indicator):</span>
<span id="cb89-2302"><a href="#cb89-2302" aria-hidden="true" tabindex="-1"></a>    station_folders <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(base_folder_path) <span class="cf">if</span> os.path.isdir(os.path.join(base_folder_path, f))]</span>
<span id="cb89-2303"><a href="#cb89-2303" aria-hidden="true" tabindex="-1"></a>    contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb89-2304"><a href="#cb89-2304" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-2305"><a href="#cb89-2305" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> station_code <span class="kw">in</span> station_folders:</span>
<span id="cb89-2306"><a href="#cb89-2306" aria-hidden="true" tabindex="-1"></a>        lsq_file <span class="op">=</span> os.path.join(base_folder_path, station_code, <span class="ss">f'lsq_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb89-2307"><a href="#cb89-2307" aria-hidden="true" tabindex="-1"></a>        ann_file <span class="op">=</span> os.path.join(base_folder_path, station_code, <span class="ss">f'ann_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb89-2308"><a href="#cb89-2308" aria-hidden="true" tabindex="-1"></a>        sco_file <span class="op">=</span> os.path.join(base_folder_path, station_code, <span class="ss">f'sco_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb89-2309"><a href="#cb89-2309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2310"><a href="#cb89-2310" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">all</span>(os.path.exists(f) <span class="cf">for</span> f <span class="kw">in</span> [lsq_file, ann_file, sco_file]):</span>
<span id="cb89-2311"><a href="#cb89-2311" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Missing files for station </span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">. Skipping station.'</span>)</span>
<span id="cb89-2312"><a href="#cb89-2312" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb89-2313"><a href="#cb89-2313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2314"><a href="#cb89-2314" aria-hidden="true" tabindex="-1"></a>        lsq_data, ann_data, sco_data <span class="op">=</span> extract_data(lsq_file, ann_file, sco_file, indicator)</span>
<span id="cb89-2315"><a href="#cb89-2315" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> lsq_data <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> ann_data <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> sco_data <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb89-2316"><a href="#cb89-2316" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb89-2317"><a href="#cb89-2317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2318"><a href="#cb89-2318" aria-hidden="true" tabindex="-1"></a>        output_file <span class="op">=</span> os.path.join(output_folder_path, <span class="ss">f"</span><span class="sc">{</span>indicator[<span class="st">'ann_column'</span>]<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv"</span>)</span>
<span id="cb89-2319"><a href="#cb89-2319" aria-hidden="true" tabindex="-1"></a>        save_to_csv(lsq_data, ann_data, sco_data, output_file)</span>
<span id="cb89-2320"><a href="#cb89-2320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2321"><a href="#cb89-2321" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb89-2322"><a href="#cb89-2322" aria-hidden="true" tabindex="-1"></a>            df <span class="op">=</span> pd.read_csv(output_file, names<span class="op">=</span>[<span class="st">'Variable'</span>, <span class="st">'Valor'</span>], skiprows<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb89-2323"><a href="#cb89-2323" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">FileNotFoundError</span>:</span>
<span id="cb89-2324"><a href="#cb89-2324" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'File not found: </span><span class="sc">{</span>output_file<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb89-2325"><a href="#cb89-2325" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb89-2326"><a href="#cb89-2326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2327"><a href="#cb89-2327" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df.dropna()</span>
<span id="cb89-2328"><a href="#cb89-2328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2329"><a href="#cb89-2329" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb89-2330"><a href="#cb89-2330" aria-hidden="true" tabindex="-1"></a>            slope <span class="op">=</span> <span class="bu">float</span>(df[df[<span class="st">'Variable'</span>] <span class="op">==</span> <span class="st">'Slope'</span>][<span class="st">'Valor'</span>].values[<span class="dv">0</span>])</span>
<span id="cb89-2331"><a href="#cb89-2331" aria-hidden="true" tabindex="-1"></a>            intercept <span class="op">=</span> <span class="bu">float</span>(df[df[<span class="st">'Variable'</span>] <span class="op">==</span> <span class="st">'YInt'</span>][<span class="st">'Valor'</span>].values[<span class="dv">0</span>])</span>
<span id="cb89-2332"><a href="#cb89-2332" aria-hidden="true" tabindex="-1"></a>            r_squared <span class="op">=</span> <span class="bu">float</span>(df[df[<span class="st">'Variable'</span>] <span class="op">==</span> <span class="st">'R2'</span>][<span class="st">'Valor'</span>].values[<span class="dv">0</span>])</span>
<span id="cb89-2333"><a href="#cb89-2333" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> (<span class="pp">IndexError</span>, <span class="pp">ValueError</span>) <span class="im">as</span> e:</span>
<span id="cb89-2334"><a href="#cb89-2334" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Error extracting regression values: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb89-2335"><a href="#cb89-2335" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb89-2336"><a href="#cb89-2336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2337"><a href="#cb89-2337" aria-hidden="true" tabindex="-1"></a>        plot_data(df, slope, intercept, r_squared, station_code, indicator[<span class="st">'plot_label'</span>])</span>
<span id="cb89-2338"><a href="#cb89-2338" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-2339"><a href="#cb89-2339" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb89-2340"><a href="#cb89-2340" aria-hidden="true" tabindex="-1"></a>           plt.show()</span>
<span id="cb89-2341"><a href="#cb89-2341" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb89-2342"><a href="#cb89-2342" aria-hidden="true" tabindex="-1"></a>            plt.close()</span>
<span id="cb89-2343"><a href="#cb89-2343" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-2344"><a href="#cb89-2344" aria-hidden="true" tabindex="-1"></a>        contador <span class="op">+=</span> <span class="dv">1</span> </span>
<span id="cb89-2345"><a href="#cb89-2345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2346"><a href="#cb89-2346" aria-hidden="true" tabindex="-1"></a>process_all_stations(base_folder_path, output_folder_path, indicator_names)</span>
<span id="cb89-2347"><a href="#cb89-2347" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-2348"><a href="#cb89-2348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2349"><a href="#cb89-2349" aria-hidden="true" tabindex="-1"></a>6.3.4. Small Floods Peaks over time</span>
<span id="cb89-2350"><a href="#cb89-2350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2351"><a href="#cb89-2351" aria-hidden="true" tabindex="-1"></a>The same process is repeated, adjusted to the specific indicator.</span>
<span id="cb89-2352"><a href="#cb89-2352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2355"><a href="#cb89-2355" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-2356"><a href="#cb89-2356" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-polar-19</span></span>
<span id="cb89-2357"><a href="#cb89-2357" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Small Floods Peaks over time at station 9423001"</span></span>
<span id="cb89-2358"><a href="#cb89-2358" aria-hidden="true" tabindex="-1"></a>indicator_names <span class="op">=</span> {</span>
<span id="cb89-2359"><a href="#cb89-2359" aria-hidden="true" tabindex="-1"></a>    <span class="st">'lsq_row'</span>: <span class="st">'Small Flood peak'</span>,              </span>
<span id="cb89-2360"><a href="#cb89-2360" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ann_column'</span>: <span class="st">'Sfld1 peak'</span>,           </span>
<span id="cb89-2361"><a href="#cb89-2361" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sco_row'</span>: <span class="st">'Small Flood peak'</span>,              </span>
<span id="cb89-2362"><a href="#cb89-2362" aria-hidden="true" tabindex="-1"></a>    <span class="st">'plot_label'</span>: <span class="st">'Small Flood peak'</span>            </span>
<span id="cb89-2363"><a href="#cb89-2363" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb89-2364"><a href="#cb89-2364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2365"><a href="#cb89-2365" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_data(lsq_file, ann_file, sco_file, indicator):</span>
<span id="cb89-2366"><a href="#cb89-2366" aria-hidden="true" tabindex="-1"></a>    lsq_data <span class="op">=</span> pd.read_csv(lsq_file, skiprows<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb89-2367"><a href="#cb89-2367" aria-hidden="true" tabindex="-1"></a>    lsq_data.set_index(lsq_data.columns[<span class="dv">0</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-2368"><a href="#cb89-2368" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb89-2369"><a href="#cb89-2369" aria-hidden="true" tabindex="-1"></a>        lsq_selected <span class="op">=</span> lsq_data.loc[indicator[<span class="st">'lsq_row'</span>], [<span class="st">'Slope'</span>, <span class="st">'YInt'</span>, <span class="st">'Sigma'</span>, <span class="st">'Corr'</span>, <span class="st">'PValue'</span>, <span class="st">'FStat'</span>, <span class="st">'R2'</span>]]</span>
<span id="cb89-2370"><a href="#cb89-2370" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">KeyError</span>:</span>
<span id="cb89-2371"><a href="#cb89-2371" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Indicator '</span><span class="sc">{</span>indicator[<span class="st">'lsq_row'</span>]<span class="sc">}</span><span class="ss">' not found in lsq_file."</span>)</span>
<span id="cb89-2372"><a href="#cb89-2372" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb89-2373"><a href="#cb89-2373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2374"><a href="#cb89-2374" aria-hidden="true" tabindex="-1"></a>    ann_data <span class="op">=</span> pd.read_csv(ann_file, skiprows<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb89-2375"><a href="#cb89-2375" aria-hidden="true" tabindex="-1"></a>    ann_data.columns <span class="op">=</span> ann_data.columns.<span class="bu">str</span>.strip()</span>
<span id="cb89-2376"><a href="#cb89-2376" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> indicator[<span class="st">'ann_column'</span>] <span class="kw">not</span> <span class="kw">in</span> ann_data.columns:</span>
<span id="cb89-2377"><a href="#cb89-2377" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Column '</span><span class="sc">{</span>indicator[<span class="st">'ann_column'</span>]<span class="sc">}</span><span class="ss">' not found in ann_file."</span>)</span>
<span id="cb89-2378"><a href="#cb89-2378" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb89-2379"><a href="#cb89-2379" aria-hidden="true" tabindex="-1"></a>    ann_data <span class="op">=</span> ann_data[[<span class="st">'Year'</span>, indicator[<span class="st">'ann_column'</span>]]].dropna()</span>
<span id="cb89-2380"><a href="#cb89-2380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2381"><a href="#cb89-2381" aria-hidden="true" tabindex="-1"></a>    sco_data <span class="op">=</span> pd.read_csv(sco_file, skiprows<span class="op">=</span><span class="dv">80</span>, nrows<span class="op">=</span><span class="dv">13</span>, header<span class="op">=</span><span class="va">None</span>, index_col<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb89-2382"><a href="#cb89-2382" aria-hidden="true" tabindex="-1"></a>    sco_data.index.name <span class="op">=</span> <span class="st">'Parameter'</span></span>
<span id="cb89-2383"><a href="#cb89-2383" aria-hidden="true" tabindex="-1"></a>    sco_data.columns <span class="op">=</span> [<span class="st">'Mediana'</span>, <span class="st">'Coef. Disper.'</span>]</span>
<span id="cb89-2384"><a href="#cb89-2384" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> indicator[<span class="st">'sco_row'</span>] <span class="kw">not</span> <span class="kw">in</span> sco_data.index:</span>
<span id="cb89-2385"><a href="#cb89-2385" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Indicator '</span><span class="sc">{</span>indicator[<span class="st">'sco_row'</span>]<span class="sc">}</span><span class="ss">' not found in sco_file."</span>)</span>
<span id="cb89-2386"><a href="#cb89-2386" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb89-2387"><a href="#cb89-2387" aria-hidden="true" tabindex="-1"></a>    sco_selected <span class="op">=</span> sco_data.loc[[indicator[<span class="st">'sco_row'</span>]]]</span>
<span id="cb89-2388"><a href="#cb89-2388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2389"><a href="#cb89-2389" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> lsq_selected, ann_data, sco_selected</span>
<span id="cb89-2390"><a href="#cb89-2390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2391"><a href="#cb89-2391" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> save_to_csv(lsq_data, ann_data, sco_data, output_file):</span>
<span id="cb89-2392"><a href="#cb89-2392" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(output_file, <span class="st">'w'</span>, newline<span class="op">=</span><span class="st">''</span>) <span class="im">as</span> csvfile:</span>
<span id="cb89-2393"><a href="#cb89-2393" aria-hidden="true" tabindex="-1"></a>        writer <span class="op">=</span> csv.writer(csvfile)</span>
<span id="cb89-2394"><a href="#cb89-2394" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-2395"><a href="#cb89-2395" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Variable'</span>, <span class="st">'Valor'</span>])</span>
<span id="cb89-2396"><a href="#cb89-2396" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, value <span class="kw">in</span> lsq_data.items():</span>
<span id="cb89-2397"><a href="#cb89-2397" aria-hidden="true" tabindex="-1"></a>            writer.writerow([idx, value])</span>
<span id="cb89-2398"><a href="#cb89-2398" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-2399"><a href="#cb89-2399" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Year'</span>, indicator_names[<span class="st">'ann_column'</span>]])</span>
<span id="cb89-2400"><a href="#cb89-2400" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _, row <span class="kw">in</span> ann_data.iterrows():</span>
<span id="cb89-2401"><a href="#cb89-2401" aria-hidden="true" tabindex="-1"></a>            writer.writerow([<span class="bu">int</span>(row[<span class="st">'Year'</span>]), row[indicator_names[<span class="st">'ann_column'</span>]]])</span>
<span id="cb89-2402"><a href="#cb89-2402" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-2403"><a href="#cb89-2403" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Mediana'</span>, sco_data[<span class="st">'Mediana'</span>].values[<span class="dv">0</span>]])</span>
<span id="cb89-2404"><a href="#cb89-2404" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Coef. Disper.'</span>, sco_data[<span class="st">'Coef. Disper.'</span>].values[<span class="dv">0</span>]])</span>
<span id="cb89-2405"><a href="#cb89-2405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2406"><a href="#cb89-2406" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_data(df, slope, intercept, r_squared, station_code, plot_label):</span>
<span id="cb89-2407"><a href="#cb89-2407" aria-hidden="true" tabindex="-1"></a>    df_anios <span class="op">=</span> df[(df[<span class="st">'Variable'</span>].<span class="bu">str</span>.isnumeric()) <span class="op">&amp;</span> (df[<span class="st">'Valor'</span>].notna())].copy()</span>
<span id="cb89-2408"><a href="#cb89-2408" aria-hidden="true" tabindex="-1"></a>    df_anios[<span class="st">'Variable'</span>] <span class="op">=</span> pd.to_numeric(df_anios[<span class="st">'Variable'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb89-2409"><a href="#cb89-2409" aria-hidden="true" tabindex="-1"></a>    df_anios[<span class="st">'Valor'</span>] <span class="op">=</span> pd.to_numeric(df_anios[<span class="st">'Valor'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb89-2410"><a href="#cb89-2410" aria-hidden="true" tabindex="-1"></a>    df_anios <span class="op">=</span> df_anios.dropna()</span>
<span id="cb89-2411"><a href="#cb89-2411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2412"><a href="#cb89-2412" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb89-2413"><a href="#cb89-2413" aria-hidden="true" tabindex="-1"></a>    plt.plot(df_anios[<span class="st">'Variable'</span>], df_anios[<span class="st">'Valor'</span>], marker<span class="op">=</span><span class="st">'o'</span>, linestyle<span class="op">=</span><span class="st">'None'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span>plot_label)</span>
<span id="cb89-2414"><a href="#cb89-2414" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-2415"><a href="#cb89-2415" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(df_anios)):</span>
<span id="cb89-2416"><a href="#cb89-2416" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> df_anios[<span class="st">'Variable'</span>].iloc[i] <span class="op">-</span> df_anios[<span class="st">'Variable'</span>].iloc[i<span class="op">-</span><span class="dv">1</span>] <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb89-2417"><a href="#cb89-2417" aria-hidden="true" tabindex="-1"></a>            plt.plot(df_anios[<span class="st">'Variable'</span>].iloc[i<span class="op">-</span><span class="dv">1</span>:i<span class="op">+</span><span class="dv">1</span>], df_anios[<span class="st">'Valor'</span>].iloc[i<span class="op">-</span><span class="dv">1</span>:i<span class="op">+</span><span class="dv">1</span>], linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb89-2418"><a href="#cb89-2418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2419"><a href="#cb89-2419" aria-hidden="true" tabindex="-1"></a>    line <span class="op">=</span> slope <span class="op">*</span> df_anios[<span class="st">'Variable'</span>] <span class="op">+</span> intercept</span>
<span id="cb89-2420"><a href="#cb89-2420" aria-hidden="true" tabindex="-1"></a>    plt.plot(df_anios[<span class="st">'Variable'</span>], line, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Regression'</span>)</span>
<span id="cb89-2421"><a href="#cb89-2421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2422"><a href="#cb89-2422" aria-hidden="true" tabindex="-1"></a>    plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb89-2423"><a href="#cb89-2423" aria-hidden="true" tabindex="-1"></a>    <span class="co">#plt.title(f'{plot_label} ({station_code})', fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb89-2424"><a href="#cb89-2424" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Year'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-2425"><a href="#cb89-2425" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Flow (m3/s)'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-2426"><a href="#cb89-2426" aria-hidden="true" tabindex="-1"></a>    plt.xticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-2427"><a href="#cb89-2427" aria-hidden="true" tabindex="-1"></a>    plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-2428"><a href="#cb89-2428" aria-hidden="true" tabindex="-1"></a>    plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.35</span>, <span class="fl">0.95</span>), fontsize<span class="op">=</span><span class="dv">14</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb89-2429"><a href="#cb89-2429" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">False</span>)</span>
<span id="cb89-2430"><a href="#cb89-2430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2431"><a href="#cb89-2431" aria-hidden="true" tabindex="-1"></a>    info_text <span class="op">=</span> <span class="ss">f'Slope: </span><span class="sc">{</span>slope<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">R-Squared: </span><span class="sc">{</span>r_squared<span class="sc">:.2f}</span><span class="ss">'</span></span>
<span id="cb89-2432"><a href="#cb89-2432" aria-hidden="true" tabindex="-1"></a>    plt.text(<span class="fl">1.15</span>, <span class="fl">0.65</span>, info_text, transform<span class="op">=</span>plt.gca().transAxes, fontsize<span class="op">=</span><span class="dv">14</span>,</span>
<span id="cb89-2433"><a href="#cb89-2433" aria-hidden="true" tabindex="-1"></a>             verticalalignment<span class="op">=</span><span class="st">'top'</span>, horizontalalignment<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb89-2434"><a href="#cb89-2434" aria-hidden="true" tabindex="-1"></a>             bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, boxstyle<span class="op">=</span><span class="st">'round,pad=0.5'</span>))</span>
<span id="cb89-2435"><a href="#cb89-2435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2436"><a href="#cb89-2436" aria-hidden="true" tabindex="-1"></a>    station_folder <span class="op">=</span> os.path.join(output_folder_path, station_code)</span>
<span id="cb89-2437"><a href="#cb89-2437" aria-hidden="true" tabindex="-1"></a>    os.makedirs(station_folder, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-2438"><a href="#cb89-2438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2439"><a href="#cb89-2439" aria-hidden="true" tabindex="-1"></a>    graph_filename <span class="op">=</span> os.path.join(station_folder, <span class="ss">f"</span><span class="sc">{</span>plot_label<span class="sc">.</span>lower()<span class="sc">.</span>replace(<span class="st">' '</span>, <span class="st">'_'</span>)<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.png"</span>)</span>
<span id="cb89-2440"><a href="#cb89-2440" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb89-2441"><a href="#cb89-2441" aria-hidden="true" tabindex="-1"></a>    plt.savefig(graph_filename)</span>
<span id="cb89-2442"><a href="#cb89-2442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2443"><a href="#cb89-2443" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"The CSV files and figure for station </span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss"> has been saved in </span><span class="sc">{</span>graph_filename<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb89-2444"><a href="#cb89-2444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2445"><a href="#cb89-2445" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_all_stations(base_folder_path, output_folder_path, indicator):</span>
<span id="cb89-2446"><a href="#cb89-2446" aria-hidden="true" tabindex="-1"></a>    station_folders <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(base_folder_path) <span class="cf">if</span> os.path.isdir(os.path.join(base_folder_path, f))]</span>
<span id="cb89-2447"><a href="#cb89-2447" aria-hidden="true" tabindex="-1"></a>    contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb89-2448"><a href="#cb89-2448" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-2449"><a href="#cb89-2449" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> station_code <span class="kw">in</span> station_folders:</span>
<span id="cb89-2450"><a href="#cb89-2450" aria-hidden="true" tabindex="-1"></a>        lsq_file <span class="op">=</span> os.path.join(base_folder_path, station_code, <span class="ss">f'lsq_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb89-2451"><a href="#cb89-2451" aria-hidden="true" tabindex="-1"></a>        ann_file <span class="op">=</span> os.path.join(base_folder_path, station_code, <span class="ss">f'ann_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb89-2452"><a href="#cb89-2452" aria-hidden="true" tabindex="-1"></a>        sco_file <span class="op">=</span> os.path.join(base_folder_path, station_code, <span class="ss">f'sco_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb89-2453"><a href="#cb89-2453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2454"><a href="#cb89-2454" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">all</span>(os.path.exists(f) <span class="cf">for</span> f <span class="kw">in</span> [lsq_file, ann_file, sco_file]):</span>
<span id="cb89-2455"><a href="#cb89-2455" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Missing files for station </span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">. Skipping station.'</span>)</span>
<span id="cb89-2456"><a href="#cb89-2456" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb89-2457"><a href="#cb89-2457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2458"><a href="#cb89-2458" aria-hidden="true" tabindex="-1"></a>        lsq_data, ann_data, sco_data <span class="op">=</span> extract_data(lsq_file, ann_file, sco_file, indicator)</span>
<span id="cb89-2459"><a href="#cb89-2459" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> lsq_data <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> ann_data <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> sco_data <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb89-2460"><a href="#cb89-2460" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb89-2461"><a href="#cb89-2461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2462"><a href="#cb89-2462" aria-hidden="true" tabindex="-1"></a>        output_file <span class="op">=</span> os.path.join(output_folder_path, <span class="ss">f"</span><span class="sc">{</span>indicator[<span class="st">'ann_column'</span>]<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv"</span>)</span>
<span id="cb89-2463"><a href="#cb89-2463" aria-hidden="true" tabindex="-1"></a>        save_to_csv(lsq_data, ann_data, sco_data, output_file)</span>
<span id="cb89-2464"><a href="#cb89-2464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2465"><a href="#cb89-2465" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb89-2466"><a href="#cb89-2466" aria-hidden="true" tabindex="-1"></a>            df <span class="op">=</span> pd.read_csv(output_file, names<span class="op">=</span>[<span class="st">'Variable'</span>, <span class="st">'Valor'</span>], skiprows<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb89-2467"><a href="#cb89-2467" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">FileNotFoundError</span>:</span>
<span id="cb89-2468"><a href="#cb89-2468" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'File not found: </span><span class="sc">{</span>output_file<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb89-2469"><a href="#cb89-2469" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb89-2470"><a href="#cb89-2470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2471"><a href="#cb89-2471" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df.dropna()</span>
<span id="cb89-2472"><a href="#cb89-2472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2473"><a href="#cb89-2473" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb89-2474"><a href="#cb89-2474" aria-hidden="true" tabindex="-1"></a>            slope <span class="op">=</span> <span class="bu">float</span>(df[df[<span class="st">'Variable'</span>] <span class="op">==</span> <span class="st">'Slope'</span>][<span class="st">'Valor'</span>].values[<span class="dv">0</span>])</span>
<span id="cb89-2475"><a href="#cb89-2475" aria-hidden="true" tabindex="-1"></a>            intercept <span class="op">=</span> <span class="bu">float</span>(df[df[<span class="st">'Variable'</span>] <span class="op">==</span> <span class="st">'YInt'</span>][<span class="st">'Valor'</span>].values[<span class="dv">0</span>])</span>
<span id="cb89-2476"><a href="#cb89-2476" aria-hidden="true" tabindex="-1"></a>            r_squared <span class="op">=</span> <span class="bu">float</span>(df[df[<span class="st">'Variable'</span>] <span class="op">==</span> <span class="st">'R2'</span>][<span class="st">'Valor'</span>].values[<span class="dv">0</span>])</span>
<span id="cb89-2477"><a href="#cb89-2477" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> (<span class="pp">IndexError</span>, <span class="pp">ValueError</span>) <span class="im">as</span> e:</span>
<span id="cb89-2478"><a href="#cb89-2478" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Error extracting regression values: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb89-2479"><a href="#cb89-2479" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb89-2480"><a href="#cb89-2480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2481"><a href="#cb89-2481" aria-hidden="true" tabindex="-1"></a>        plot_data(df, slope, intercept, r_squared, station_code, indicator[<span class="st">'plot_label'</span>])</span>
<span id="cb89-2482"><a href="#cb89-2482" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-2483"><a href="#cb89-2483" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb89-2484"><a href="#cb89-2484" aria-hidden="true" tabindex="-1"></a>           plt.show()</span>
<span id="cb89-2485"><a href="#cb89-2485" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb89-2486"><a href="#cb89-2486" aria-hidden="true" tabindex="-1"></a>            plt.close()</span>
<span id="cb89-2487"><a href="#cb89-2487" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-2488"><a href="#cb89-2488" aria-hidden="true" tabindex="-1"></a>        contador <span class="op">+=</span> <span class="dv">1</span> </span>
<span id="cb89-2489"><a href="#cb89-2489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2490"><a href="#cb89-2490" aria-hidden="true" tabindex="-1"></a>process_all_stations(base_folder_path, output_folder_path, indicator_names)</span>
<span id="cb89-2491"><a href="#cb89-2491" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb89-2492"><a href="#cb89-2492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2493"><a href="#cb89-2493" aria-hidden="true" tabindex="-1"></a>6.3.4. Large Floods Peaks over time</span>
<span id="cb89-2494"><a href="#cb89-2494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2495"><a href="#cb89-2495" aria-hidden="true" tabindex="-1"></a>The same process is repeated, adjusted to the specific indicator.</span>
<span id="cb89-2496"><a href="#cb89-2496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2499"><a href="#cb89-2499" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb89-2500"><a href="#cb89-2500" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-polar-20</span></span>
<span id="cb89-2501"><a href="#cb89-2501" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Large Floods Peaks over time at station 9423001"</span></span>
<span id="cb89-2502"><a href="#cb89-2502" aria-hidden="true" tabindex="-1"></a>indicator_names <span class="op">=</span> {</span>
<span id="cb89-2503"><a href="#cb89-2503" aria-hidden="true" tabindex="-1"></a>    <span class="st">'lsq_row'</span>: <span class="st">'Large flood peak'</span>,              </span>
<span id="cb89-2504"><a href="#cb89-2504" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ann_column'</span>: <span class="st">'Lfld1 peak'</span>,           </span>
<span id="cb89-2505"><a href="#cb89-2505" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sco_row'</span>: <span class="st">'Large flood peak'</span>,              </span>
<span id="cb89-2506"><a href="#cb89-2506" aria-hidden="true" tabindex="-1"></a>    <span class="st">'plot_label'</span>: <span class="st">'Large flood peak'</span>            </span>
<span id="cb89-2507"><a href="#cb89-2507" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb89-2508"><a href="#cb89-2508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2509"><a href="#cb89-2509" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_data(lsq_file, ann_file, sco_file, indicator):</span>
<span id="cb89-2510"><a href="#cb89-2510" aria-hidden="true" tabindex="-1"></a>    lsq_data <span class="op">=</span> pd.read_csv(lsq_file, skiprows<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb89-2511"><a href="#cb89-2511" aria-hidden="true" tabindex="-1"></a>    lsq_data.set_index(lsq_data.columns[<span class="dv">0</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-2512"><a href="#cb89-2512" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb89-2513"><a href="#cb89-2513" aria-hidden="true" tabindex="-1"></a>        lsq_selected <span class="op">=</span> lsq_data.loc[indicator[<span class="st">'lsq_row'</span>], [<span class="st">'Slope'</span>, <span class="st">'YInt'</span>, <span class="st">'Sigma'</span>, <span class="st">'Corr'</span>, <span class="st">'PValue'</span>, <span class="st">'FStat'</span>, <span class="st">'R2'</span>]]</span>
<span id="cb89-2514"><a href="#cb89-2514" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">KeyError</span>:</span>
<span id="cb89-2515"><a href="#cb89-2515" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Indicator '</span><span class="sc">{</span>indicator[<span class="st">'lsq_row'</span>]<span class="sc">}</span><span class="ss">' not found in lsq_file."</span>)</span>
<span id="cb89-2516"><a href="#cb89-2516" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb89-2517"><a href="#cb89-2517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2518"><a href="#cb89-2518" aria-hidden="true" tabindex="-1"></a>    ann_data <span class="op">=</span> pd.read_csv(ann_file, skiprows<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb89-2519"><a href="#cb89-2519" aria-hidden="true" tabindex="-1"></a>    ann_data.columns <span class="op">=</span> ann_data.columns.<span class="bu">str</span>.strip()</span>
<span id="cb89-2520"><a href="#cb89-2520" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> indicator[<span class="st">'ann_column'</span>] <span class="kw">not</span> <span class="kw">in</span> ann_data.columns:</span>
<span id="cb89-2521"><a href="#cb89-2521" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Column '</span><span class="sc">{</span>indicator[<span class="st">'ann_column'</span>]<span class="sc">}</span><span class="ss">' not found in ann_file."</span>)</span>
<span id="cb89-2522"><a href="#cb89-2522" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb89-2523"><a href="#cb89-2523" aria-hidden="true" tabindex="-1"></a>    ann_data <span class="op">=</span> ann_data[[<span class="st">'Year'</span>, indicator[<span class="st">'ann_column'</span>]]].dropna()</span>
<span id="cb89-2524"><a href="#cb89-2524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2525"><a href="#cb89-2525" aria-hidden="true" tabindex="-1"></a>    sco_data <span class="op">=</span> pd.read_csv(sco_file, skiprows<span class="op">=</span><span class="dv">85</span>, nrows<span class="op">=</span><span class="dv">13</span>, header<span class="op">=</span><span class="va">None</span>, index_col<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb89-2526"><a href="#cb89-2526" aria-hidden="true" tabindex="-1"></a>    sco_data.index.name <span class="op">=</span> <span class="st">'Parameter'</span></span>
<span id="cb89-2527"><a href="#cb89-2527" aria-hidden="true" tabindex="-1"></a>    sco_data.columns <span class="op">=</span> [<span class="st">'Mediana'</span>, <span class="st">'Coef. Disper.'</span>]</span>
<span id="cb89-2528"><a href="#cb89-2528" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> indicator[<span class="st">'sco_row'</span>] <span class="kw">not</span> <span class="kw">in</span> sco_data.index:</span>
<span id="cb89-2529"><a href="#cb89-2529" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Indicator '</span><span class="sc">{</span>indicator[<span class="st">'sco_row'</span>]<span class="sc">}</span><span class="ss">' not found in sco_file."</span>)</span>
<span id="cb89-2530"><a href="#cb89-2530" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb89-2531"><a href="#cb89-2531" aria-hidden="true" tabindex="-1"></a>    sco_selected <span class="op">=</span> sco_data.loc[[indicator[<span class="st">'sco_row'</span>]]]</span>
<span id="cb89-2532"><a href="#cb89-2532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2533"><a href="#cb89-2533" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> lsq_selected, ann_data, sco_selected</span>
<span id="cb89-2534"><a href="#cb89-2534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2535"><a href="#cb89-2535" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> save_to_csv(lsq_data, ann_data, sco_data, output_file):</span>
<span id="cb89-2536"><a href="#cb89-2536" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(output_file, <span class="st">'w'</span>, newline<span class="op">=</span><span class="st">''</span>) <span class="im">as</span> csvfile:</span>
<span id="cb89-2537"><a href="#cb89-2537" aria-hidden="true" tabindex="-1"></a>        writer <span class="op">=</span> csv.writer(csvfile)</span>
<span id="cb89-2538"><a href="#cb89-2538" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-2539"><a href="#cb89-2539" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Variable'</span>, <span class="st">'Valor'</span>])</span>
<span id="cb89-2540"><a href="#cb89-2540" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> idx, value <span class="kw">in</span> lsq_data.items():</span>
<span id="cb89-2541"><a href="#cb89-2541" aria-hidden="true" tabindex="-1"></a>            writer.writerow([idx, value])</span>
<span id="cb89-2542"><a href="#cb89-2542" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-2543"><a href="#cb89-2543" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Year'</span>, indicator_names[<span class="st">'ann_column'</span>]])</span>
<span id="cb89-2544"><a href="#cb89-2544" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _, row <span class="kw">in</span> ann_data.iterrows():</span>
<span id="cb89-2545"><a href="#cb89-2545" aria-hidden="true" tabindex="-1"></a>            writer.writerow([<span class="bu">int</span>(row[<span class="st">'Year'</span>]), row[indicator_names[<span class="st">'ann_column'</span>]]])</span>
<span id="cb89-2546"><a href="#cb89-2546" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-2547"><a href="#cb89-2547" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Mediana'</span>, sco_data[<span class="st">'Mediana'</span>].values[<span class="dv">0</span>]])</span>
<span id="cb89-2548"><a href="#cb89-2548" aria-hidden="true" tabindex="-1"></a>        writer.writerow([<span class="st">'Coef. Disper.'</span>, sco_data[<span class="st">'Coef. Disper.'</span>].values[<span class="dv">0</span>]])</span>
<span id="cb89-2549"><a href="#cb89-2549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2550"><a href="#cb89-2550" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_data(df, slope, intercept, r_squared, station_code, plot_label):</span>
<span id="cb89-2551"><a href="#cb89-2551" aria-hidden="true" tabindex="-1"></a>    df_anios <span class="op">=</span> df[(df[<span class="st">'Variable'</span>].<span class="bu">str</span>.isnumeric()) <span class="op">&amp;</span> (df[<span class="st">'Valor'</span>].notna())].copy()</span>
<span id="cb89-2552"><a href="#cb89-2552" aria-hidden="true" tabindex="-1"></a>    df_anios[<span class="st">'Variable'</span>] <span class="op">=</span> pd.to_numeric(df_anios[<span class="st">'Variable'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb89-2553"><a href="#cb89-2553" aria-hidden="true" tabindex="-1"></a>    df_anios[<span class="st">'Valor'</span>] <span class="op">=</span> pd.to_numeric(df_anios[<span class="st">'Valor'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb89-2554"><a href="#cb89-2554" aria-hidden="true" tabindex="-1"></a>    df_anios <span class="op">=</span> df_anios.dropna()</span>
<span id="cb89-2555"><a href="#cb89-2555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2556"><a href="#cb89-2556" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb89-2557"><a href="#cb89-2557" aria-hidden="true" tabindex="-1"></a>    plt.plot(df_anios[<span class="st">'Variable'</span>], df_anios[<span class="st">'Valor'</span>], marker<span class="op">=</span><span class="st">'o'</span>, linestyle<span class="op">=</span><span class="st">'None'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span>plot_label)</span>
<span id="cb89-2558"><a href="#cb89-2558" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-2559"><a href="#cb89-2559" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(df_anios)):</span>
<span id="cb89-2560"><a href="#cb89-2560" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> df_anios[<span class="st">'Variable'</span>].iloc[i] <span class="op">-</span> df_anios[<span class="st">'Variable'</span>].iloc[i<span class="op">-</span><span class="dv">1</span>] <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb89-2561"><a href="#cb89-2561" aria-hidden="true" tabindex="-1"></a>            plt.plot(df_anios[<span class="st">'Variable'</span>].iloc[i<span class="op">-</span><span class="dv">1</span>:i<span class="op">+</span><span class="dv">1</span>], df_anios[<span class="st">'Valor'</span>].iloc[i<span class="op">-</span><span class="dv">1</span>:i<span class="op">+</span><span class="dv">1</span>], linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb89-2562"><a href="#cb89-2562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2563"><a href="#cb89-2563" aria-hidden="true" tabindex="-1"></a>    line <span class="op">=</span> slope <span class="op">*</span> df_anios[<span class="st">'Variable'</span>] <span class="op">+</span> intercept</span>
<span id="cb89-2564"><a href="#cb89-2564" aria-hidden="true" tabindex="-1"></a>    plt.plot(df_anios[<span class="st">'Variable'</span>], line, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Regression'</span>)</span>
<span id="cb89-2565"><a href="#cb89-2565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2566"><a href="#cb89-2566" aria-hidden="true" tabindex="-1"></a>    plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">24</span>, <span class="st">'font.family'</span>: <span class="st">'Times New Roman'</span>})</span>
<span id="cb89-2567"><a href="#cb89-2567" aria-hidden="true" tabindex="-1"></a>    <span class="co">#plt.title(f'{plot_label} ({station_code})', fontsize=24, fontname='Times New Roman')</span></span>
<span id="cb89-2568"><a href="#cb89-2568" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Year'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-2569"><a href="#cb89-2569" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Flow (m3/s)'</span>, fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-2570"><a href="#cb89-2570" aria-hidden="true" tabindex="-1"></a>    plt.xticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-2571"><a href="#cb89-2571" aria-hidden="true" tabindex="-1"></a>    plt.yticks(fontsize<span class="op">=</span><span class="dv">24</span>, fontname<span class="op">=</span><span class="st">'Times New Roman'</span>)</span>
<span id="cb89-2572"><a href="#cb89-2572" aria-hidden="true" tabindex="-1"></a>    plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.35</span>, <span class="fl">0.95</span>), fontsize<span class="op">=</span><span class="dv">14</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb89-2573"><a href="#cb89-2573" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">False</span>)</span>
<span id="cb89-2574"><a href="#cb89-2574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2575"><a href="#cb89-2575" aria-hidden="true" tabindex="-1"></a>    info_text <span class="op">=</span> <span class="ss">f'Slope: </span><span class="sc">{</span>slope<span class="sc">:.2f}</span><span class="ch">\n</span><span class="ss">R-Squared: </span><span class="sc">{</span>r_squared<span class="sc">:.2f}</span><span class="ss">'</span></span>
<span id="cb89-2576"><a href="#cb89-2576" aria-hidden="true" tabindex="-1"></a>    plt.text(<span class="fl">1.15</span>, <span class="fl">0.65</span>, info_text, transform<span class="op">=</span>plt.gca().transAxes, fontsize<span class="op">=</span><span class="dv">14</span>,</span>
<span id="cb89-2577"><a href="#cb89-2577" aria-hidden="true" tabindex="-1"></a>             verticalalignment<span class="op">=</span><span class="st">'top'</span>, horizontalalignment<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb89-2578"><a href="#cb89-2578" aria-hidden="true" tabindex="-1"></a>             bbox<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'white'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, boxstyle<span class="op">=</span><span class="st">'round,pad=0.5'</span>))</span>
<span id="cb89-2579"><a href="#cb89-2579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2580"><a href="#cb89-2580" aria-hidden="true" tabindex="-1"></a>    station_folder <span class="op">=</span> os.path.join(output_folder_path, station_code)</span>
<span id="cb89-2581"><a href="#cb89-2581" aria-hidden="true" tabindex="-1"></a>    os.makedirs(station_folder, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-2582"><a href="#cb89-2582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2583"><a href="#cb89-2583" aria-hidden="true" tabindex="-1"></a>    graph_filename <span class="op">=</span> os.path.join(station_folder, <span class="ss">f"</span><span class="sc">{</span>plot_label<span class="sc">.</span>lower()<span class="sc">.</span>replace(<span class="st">' '</span>, <span class="st">'_'</span>)<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.png"</span>)</span>
<span id="cb89-2584"><a href="#cb89-2584" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb89-2585"><a href="#cb89-2585" aria-hidden="true" tabindex="-1"></a>    plt.savefig(graph_filename)</span>
<span id="cb89-2586"><a href="#cb89-2586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2587"><a href="#cb89-2587" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"The CSV files and figure for station </span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss"> has been saved in </span><span class="sc">{</span>graph_filename<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb89-2588"><a href="#cb89-2588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2589"><a href="#cb89-2589" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_all_stations(base_folder_path, output_folder_path, indicator):</span>
<span id="cb89-2590"><a href="#cb89-2590" aria-hidden="true" tabindex="-1"></a>    station_folders <span class="op">=</span> [f <span class="cf">for</span> f <span class="kw">in</span> os.listdir(base_folder_path) <span class="cf">if</span> os.path.isdir(os.path.join(base_folder_path, f))]</span>
<span id="cb89-2591"><a href="#cb89-2591" aria-hidden="true" tabindex="-1"></a>    contador <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb89-2592"><a href="#cb89-2592" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-2593"><a href="#cb89-2593" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> station_code <span class="kw">in</span> station_folders:</span>
<span id="cb89-2594"><a href="#cb89-2594" aria-hidden="true" tabindex="-1"></a>        lsq_file <span class="op">=</span> os.path.join(base_folder_path, station_code, <span class="ss">f'lsq_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb89-2595"><a href="#cb89-2595" aria-hidden="true" tabindex="-1"></a>        ann_file <span class="op">=</span> os.path.join(base_folder_path, station_code, <span class="ss">f'ann_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb89-2596"><a href="#cb89-2596" aria-hidden="true" tabindex="-1"></a>        sco_file <span class="op">=</span> os.path.join(base_folder_path, station_code, <span class="ss">f'sco_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv'</span>)</span>
<span id="cb89-2597"><a href="#cb89-2597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2598"><a href="#cb89-2598" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">all</span>(os.path.exists(f) <span class="cf">for</span> f <span class="kw">in</span> [lsq_file, ann_file, sco_file]):</span>
<span id="cb89-2599"><a href="#cb89-2599" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Missing files for station </span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">. Skipping station.'</span>)</span>
<span id="cb89-2600"><a href="#cb89-2600" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb89-2601"><a href="#cb89-2601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2602"><a href="#cb89-2602" aria-hidden="true" tabindex="-1"></a>        lsq_data, ann_data, sco_data <span class="op">=</span> extract_data(lsq_file, ann_file, sco_file, indicator)</span>
<span id="cb89-2603"><a href="#cb89-2603" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> lsq_data <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> ann_data <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> sco_data <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb89-2604"><a href="#cb89-2604" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb89-2605"><a href="#cb89-2605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2606"><a href="#cb89-2606" aria-hidden="true" tabindex="-1"></a>        output_file <span class="op">=</span> os.path.join(output_folder_path, <span class="ss">f"</span><span class="sc">{</span>indicator[<span class="st">'ann_column'</span>]<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>station_code<span class="sc">}</span><span class="ss">.csv"</span>)</span>
<span id="cb89-2607"><a href="#cb89-2607" aria-hidden="true" tabindex="-1"></a>        save_to_csv(lsq_data, ann_data, sco_data, output_file)</span>
<span id="cb89-2608"><a href="#cb89-2608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2609"><a href="#cb89-2609" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb89-2610"><a href="#cb89-2610" aria-hidden="true" tabindex="-1"></a>            df <span class="op">=</span> pd.read_csv(output_file, names<span class="op">=</span>[<span class="st">'Variable'</span>, <span class="st">'Valor'</span>], skiprows<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb89-2611"><a href="#cb89-2611" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">FileNotFoundError</span>:</span>
<span id="cb89-2612"><a href="#cb89-2612" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'File not found: </span><span class="sc">{</span>output_file<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb89-2613"><a href="#cb89-2613" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb89-2614"><a href="#cb89-2614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2615"><a href="#cb89-2615" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df.dropna()</span>
<span id="cb89-2616"><a href="#cb89-2616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2617"><a href="#cb89-2617" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb89-2618"><a href="#cb89-2618" aria-hidden="true" tabindex="-1"></a>            slope <span class="op">=</span> <span class="bu">float</span>(df[df[<span class="st">'Variable'</span>] <span class="op">==</span> <span class="st">'Slope'</span>][<span class="st">'Valor'</span>].values[<span class="dv">0</span>])</span>
<span id="cb89-2619"><a href="#cb89-2619" aria-hidden="true" tabindex="-1"></a>            intercept <span class="op">=</span> <span class="bu">float</span>(df[df[<span class="st">'Variable'</span>] <span class="op">==</span> <span class="st">'YInt'</span>][<span class="st">'Valor'</span>].values[<span class="dv">0</span>])</span>
<span id="cb89-2620"><a href="#cb89-2620" aria-hidden="true" tabindex="-1"></a>            r_squared <span class="op">=</span> <span class="bu">float</span>(df[df[<span class="st">'Variable'</span>] <span class="op">==</span> <span class="st">'R2'</span>][<span class="st">'Valor'</span>].values[<span class="dv">0</span>])</span>
<span id="cb89-2621"><a href="#cb89-2621" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> (<span class="pp">IndexError</span>, <span class="pp">ValueError</span>) <span class="im">as</span> e:</span>
<span id="cb89-2622"><a href="#cb89-2622" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f'Error extracting regression values: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb89-2623"><a href="#cb89-2623" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb89-2624"><a href="#cb89-2624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2625"><a href="#cb89-2625" aria-hidden="true" tabindex="-1"></a>        plot_data(df, slope, intercept, r_squared, station_code, indicator[<span class="st">'plot_label'</span>])</span>
<span id="cb89-2626"><a href="#cb89-2626" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb89-2627"><a href="#cb89-2627" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> contador <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb89-2628"><a href="#cb89-2628" aria-hidden="true" tabindex="-1"></a>           plt.show()</span>
<span id="cb89-2629"><a href="#cb89-2629" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb89-2630"><a href="#cb89-2630" aria-hidden="true" tabindex="-1"></a>            plt.close()</span>
<span id="cb89-2631"><a href="#cb89-2631" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb89-2632"><a href="#cb89-2632" aria-hidden="true" tabindex="-1"></a>        contador <span class="op">+=</span> <span class="dv">1</span> </span>
<span id="cb89-2633"><a href="#cb89-2633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2634"><a href="#cb89-2634" aria-hidden="true" tabindex="-1"></a>process_all_stations(base_folder_path, output_folder_path, indicator_names)</span>
<span id="cb89-2635"><a href="#cb89-2635" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>